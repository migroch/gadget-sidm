<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: read_ic.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>read_ic.c</h1>  </div>
</div>
<div class="contents">
<a href="read__ic_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;mpi.h&gt;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="allvars_8h.html" title="declares global variables.">allvars.h</a>&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="proto_8h.html" title="this file contains all function prototypes of the code">proto.h</a>&quot;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 
<a name="l00031"></a><a class="code" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1">00031</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#a150344fdc0c6e132aecdb6c646529df1">read_ic</a>(<span class="keywordtype">char</span> *fname)
<a name="l00032"></a>00032 {
<a name="l00033"></a>00033   <span class="keywordtype">int</span> i, num_files, rest_files, ngroups, gr, filenr, masterTask, lastTask, groupMaster;
<a name="l00034"></a>00034   <span class="keywordtype">double</span> u_init;
<a name="l00035"></a>00035   <span class="keywordtype">char</span> buf[500];
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#ifndef ISOTHERM_EQS</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>  <span class="keywordtype">double</span> molecular_weight;
<a name="l00039"></a>00039 <span class="preprocessor">#endif</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#ifdef SFR</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>  <span class="keywordtype">double</span> original_gas_mass, mass, masstot;
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a>00044   <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> = 0;
<a name="l00045"></a>00045   <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> = 0;
<a name="l00046"></a>00046   <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> = 0;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048   num_files = <a class="code" href="proto_8h.html#ac028b474d53a40e79377b7ae5dde636a">find_files</a>(fname);
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   rest_files = num_files;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <a class="code" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345">fill_Tab_IO_Labels</a>();
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="keywordflow">while</span>(rest_files &gt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
<a name="l00055"></a>00055     {
<a name="l00056"></a>00056       sprintf(buf, <span class="stringliteral">&quot;%s.%d&quot;</span>, fname, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> + (rest_files - <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>));
<a name="l00057"></a>00057       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00058"></a>00058         sprintf(buf, <span class="stringliteral">&quot;%s.%d.hdf5&quot;</span>, fname, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> + (rest_files - <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>));
<a name="l00059"></a>00059 
<a name="l00060"></a>00060       ngroups = <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>;
<a name="l00061"></a>00061       <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> % <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>))
<a name="l00062"></a>00062         ngroups++;
<a name="l00063"></a>00063       groupMaster = (<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> / ngroups) * ngroups;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065       <span class="keywordflow">for</span>(gr = 0; gr &lt; ngroups; gr++)
<a name="l00066"></a>00066         {
<a name="l00067"></a>00067           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == (groupMaster + gr))    <span class="comment">/* ok, it&#39;s this processor&#39;s turn */</span>
<a name="l00068"></a>00068             <a class="code" href="proto_8h.html#affd0f4e6b7bcdabf7d6f8191145f78d1">read_file</a>(buf, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);
<a name="l00069"></a>00069           MPI_Barrier(MPI_COMM_WORLD);
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072       rest_files -= <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>;
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <span class="keywordflow">if</span>(rest_files &gt; 0)
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078       <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(rest_files, 0, 0, <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> - 1, &amp;filenr, &amp;masterTask, &amp;lastTask);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080       <span class="keywordflow">if</span>(num_files &gt; 1)
<a name="l00081"></a>00081         {
<a name="l00082"></a>00082           sprintf(buf, <span class="stringliteral">&quot;%s.%d&quot;</span>, fname, filenr);
<a name="l00083"></a>00083           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00084"></a>00084             sprintf(buf, <span class="stringliteral">&quot;%s.%d.hdf5&quot;</span>, fname, filenr);
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086       <span class="keywordflow">else</span>
<a name="l00087"></a>00087         {
<a name="l00088"></a>00088           sprintf(buf, <span class="stringliteral">&quot;%s&quot;</span>, fname);
<a name="l00089"></a>00089           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00090"></a>00090             sprintf(buf, <span class="stringliteral">&quot;%s.hdf5&quot;</span>, fname);
<a name="l00091"></a>00091         }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093       ngroups = rest_files / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>;
<a name="l00094"></a>00094       <span class="keywordflow">if</span>((rest_files % <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>))
<a name="l00095"></a>00095         ngroups++;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097       <span class="keywordflow">for</span>(gr = 0; gr &lt; ngroups; gr++)
<a name="l00098"></a>00098         {
<a name="l00099"></a>00099           <span class="keywordflow">if</span>((filenr / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>) == gr)    <span class="comment">/* ok, it&#39;s this processor&#39;s turn */</span>
<a name="l00100"></a>00100             <a class="code" href="proto_8h.html#affd0f4e6b7bcdabf7d6f8191145f78d1">read_file</a>(buf, masterTask, lastTask);
<a name="l00101"></a>00101           MPI_Barrier(MPI_COMM_WORLD);
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <span class="comment">/* this makes sure that masses are initialized in the case that the mass-block</span>
<a name="l00107"></a>00107 <span class="comment">     is completely empty */</span>
<a name="l00108"></a>00108   <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
<a name="l00109"></a>00109     {
<a name="l00110"></a>00110       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#ab6119b261ff95e8f84ae171139704cbd">Type</a>] != 0)
<a name="l00111"></a>00111         <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a710e551be01f4ef85442d0928aca728c">Mass</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#ab6119b261ff95e8f84ae171139704cbd">Type</a>];
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 0)
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a633fbd557554f7932dab2641d15e6ea1">InitGasTemp</a> &gt; 0)
<a name="l00117"></a>00117         {
<a name="l00118"></a>00118           u_init = (<a class="code" href="allvars_8h.html#aa1487dae81baa2e0a5643e7b571633a0">BOLTZMANN</a> / PROTONMASS) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a633fbd557554f7932dab2641d15e6ea1">InitGasTemp</a>;
<a name="l00119"></a>00119           u_init *= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#adccf5aa82d4252d8d24ead7681b29052">UnitMass_in_g</a> / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0d48e2253ad31d76eda8e677eba2cf1">UnitEnergy_in_cgs</a>;  <span class="comment">/* unit conversion */</span>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 #ifdef ISOTHERM_EQS
<a name="l00122"></a>00122           u_init *= 1.0;
<a name="l00123"></a>00123 #<span class="keywordflow">else</span>
<a name="l00124"></a>00124           u_init *= (1.0 / <a class="code" href="allvars_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a633fbd557554f7932dab2641d15e6ea1">InitGasTemp</a> &gt; 1.0e4)   <span class="comment">/* assuming FULL ionization */</span>
<a name="l00127"></a>00127             molecular_weight = 4 / (8 - 5 * (1 - HYDROGEN_MASSFRAC));
<a name="l00128"></a>00128           <span class="keywordflow">else</span>                  <span class="comment">/* assuming NEUTRAL GAS */</span>
<a name="l00129"></a>00129             molecular_weight = 4 / (1 + 3 * HYDROGEN_MASSFRAC);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131           u_init /= molecular_weight;
<a name="l00132"></a>00132 <span class="preprocessor">#endif</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>
<a name="l00134"></a>00134           <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>; i++)
<a name="l00135"></a>00135             {
<a name="l00136"></a>00136               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Entropy == 0)
<a name="l00137"></a>00137                 <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#a7cbe9bb2086f525f400b2c12103b3116">Entropy</a> = u_init;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139               <span class="comment">/* Note: the coversion to entropy will be done in the function init(),</span>
<a name="l00140"></a>00140 <span class="comment">                 after the densities have been computed */</span>
<a name="l00141"></a>00141             }
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>; i++)
<a name="l00146"></a>00146     <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Entropy = <a class="code" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85">dmax</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ae298f2b76a8f1d0b932bee24c28987cf">MinEgySpec</a>, <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#a7cbe9bb2086f525f400b2c12103b3116">Entropy</a>);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   MPI_Barrier(MPI_COMM_WORLD);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152       printf(<span class="stringliteral">&quot;reading done.\n&quot;</span>);
<a name="l00153"></a>00153       fflush(stdout);
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158       printf(<span class="stringliteral">&quot;Total number of particles :  %d%09d\n\n&quot;</span>,
<a name="l00159"></a>00159              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> % 1000000000));
<a name="l00160"></a>00160       fflush(stdout);
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00168"></a><a class="code" href="read__ic_8c.html#a3757efb7e470353080a128388ccebec9">00168</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#a3757efb7e470353080a128388ccebec9">empty_read_buffer</a>(<span class="keyword">enum</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8">iofields</a> blocknr, <span class="keywordtype">int</span> offset, <span class="keywordtype">int</span> pc, <span class="keywordtype">int</span> type)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170   <span class="keywordtype">int</span> n, k;
<a name="l00171"></a>00171   <span class="keywordtype">float</span> *fp;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="preprocessor">#ifdef LONGIDS</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>  <span class="keywordtype">long</span> <span class="keywordtype">long</span> *ip;
<a name="l00175"></a>00175 <span class="preprocessor">#else</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>  <span class="keywordtype">int</span> *ip;
<a name="l00177"></a>00177 <span class="preprocessor">#endif</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span>
<a name="l00179"></a>00179   fp = <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
<a name="l00180"></a>00180   ip = <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="keywordflow">switch</span> (blocknr)
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a0207eb67d96fe97fb8158c42af624f8f">IO_POS</a>:                <span class="comment">/* positions */</span>
<a name="l00185"></a>00185       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00186"></a>00186         <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
<a name="l00187"></a>00187           <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].<a class="code" href="structparticle__data.html#a764ffe35d82a64065f585e3a84263dd1">Pos</a>[k] = *fp++;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00190"></a>00190         <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].<a class="code" href="structparticle__data.html#ab6119b261ff95e8f84ae171139704cbd">Type</a> = type;      <span class="comment">/* initialize type here as well */</span>
<a name="l00191"></a>00191       <span class="keywordflow">break</span>;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8aa4c3992546632e0db8015ebe534c0282">IO_VEL</a>:                <span class="comment">/* velocities */</span>
<a name="l00194"></a>00194       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00195"></a>00195         <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
<a name="l00196"></a>00196           <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].<a class="code" href="structparticle__data.html#ad7808af1e23fbd920d7eb477bc68bd00">Vel</a>[k] = *fp++;
<a name="l00197"></a>00197       <span class="keywordflow">break</span>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a34f71f128fc699de3792687fd79edf03">IO_ID</a>:         <span class="comment">/* particle ID */</span>
<a name="l00200"></a>00200       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00201"></a>00201         <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].<a class="code" href="structparticle__data.html#aefa92af245e44af30d28799ab1419e74">ID</a> = *ip++;
<a name="l00202"></a>00202       <span class="keywordflow">break</span>;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a72e1cc8b602ab38f0f3491464ed82063">IO_MASS</a>:               <span class="comment">/* particle mass */</span>
<a name="l00205"></a>00205       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00206"></a>00206         <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].<a class="code" href="structparticle__data.html#a710e551be01f4ef85442d0928aca728c">Mass</a> = *fp++;
<a name="l00207"></a>00207       <span class="keywordflow">break</span>;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a942cbf4dca00cd5260edc905f5976682">IO_U</a>:                  <span class="comment">/* temperature */</span>
<a name="l00210"></a>00210       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00211"></a>00211         <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[offset + n].Entropy = *fp++;
<a name="l00212"></a>00212       <span class="keywordflow">break</span>;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a8dd43018a3f2d1caed951b249a38b106">IO_RHO</a>:                <span class="comment">/* density */</span>
<a name="l00215"></a>00215       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00216"></a>00216         <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[offset + n].Density = *fp++;
<a name="l00217"></a>00217       <span class="keywordflow">break</span>;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a429c6a7a56e3b53597bd1eb72b87f941">IO_HSML</a>:               <span class="comment">/* SPH smoothing length */</span>
<a name="l00221"></a>00221       <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
<a name="l00222"></a>00222         <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[offset + n].Hsml = *fp++;
<a name="l00223"></a>00223       <span class="keywordflow">break</span>;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       <span class="comment">/* the other input fields (if present) are not needed to define the </span>
<a name="l00229"></a>00229 <span class="comment">         initial conditions of the code */</span>
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a27c32f555479567b88ad11dcce803fe9">IO_POT</a>:
<a name="l00232"></a>00232     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a6f80f32dfa1c0cde8a71b773f42bb97a">IO_ACCEL</a>:
<a name="l00233"></a>00233     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a74d42dcd51f76c1919f44e9f89581457">IO_DTENTR</a>:
<a name="l00234"></a>00234     <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8aac2070d9e6c597be29ae9a4c9acc36da">IO_TSTP</a>:
<a name="l00235"></a>00235       <span class="keywordflow">break</span>;
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 
<a name="l00244"></a><a class="code" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1">00244</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#affd0f4e6b7bcdabf7d6f8191145f78d1">read_file</a>(<span class="keywordtype">char</span> *fname, <span class="keywordtype">int</span> readTask, <span class="keywordtype">int</span> lastTask)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246   <span class="keywordtype">int</span> blockmaxlen;
<a name="l00247"></a>00247   <span class="keywordtype">int</span> i, n_in_file, n_for_this_task, ntask, pc, offset = 0, task;
<a name="l00248"></a>00248   <span class="keywordtype">int</span> blksize1, blksize2;
<a name="l00249"></a>00249   MPI_Status status;
<a name="l00250"></a>00250   FILE *<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a> = 0;
<a name="l00251"></a>00251   <span class="keywordtype">int</span> nall;
<a name="l00252"></a>00252   <span class="keywordtype">int</span> type;
<a name="l00253"></a>00253   <span class="keywordtype">char</span> label[4];
<a name="l00254"></a>00254   <span class="keywordtype">int</span> nstart, bytes_per_blockelement, npart, nextblock, typelist[6];
<a name="l00255"></a>00255   <span class="keyword">enum</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8">iofields</a> blocknr;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00258"></a>00258 <span class="preprocessor"></span>  <span class="keywordtype">char</span> buf[500];
<a name="l00259"></a>00259   <span class="keywordtype">int</span> rank, pcsum;
<a name="l00260"></a>00260   hid_t hdf5_file, hdf5_grp[6], hdf5_dataspace_in_file;
<a name="l00261"></a>00261   hid_t hdf5_datatype, hdf5_dataspace_in_memory, hdf5_dataset;
<a name="l00262"></a>00262   hsize_t dims[2], count[2], start[2];
<a name="l00263"></a>00263 <span class="preprocessor">#endif</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span>
<a name="l00265"></a>00265 <span class="preprocessor">#define SKIP  {my_fread(&amp;blksize1,sizeof(int),1,fd);}</span>
<a name="l00266"></a>00266 <span class="preprocessor"></span><span class="preprocessor">#define SKIP2  {my_fread(&amp;blksize2,sizeof(int),1,fd);}</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span>
<a name="l00268"></a>00268   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00271"></a>00271         {
<a name="l00272"></a>00272           <span class="keywordflow">if</span>(!(fd = fopen(fname, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l00273"></a>00273             {
<a name="l00274"></a>00274               printf(<span class="stringliteral">&quot;can&#39;t open file `%s&#39; for reading initial conditions.\n&quot;</span>, fname);
<a name="l00275"></a>00275               <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(123);
<a name="l00276"></a>00276             }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00279"></a>00279             {
<a name="l00280"></a>00280               SKIP;
<a name="l00281"></a>00281               <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;label, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 4, fd);
<a name="l00282"></a>00282               <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;nextblock, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, fd);
<a name="l00283"></a>00283               printf(<span class="stringliteral">&quot;Reading header =&gt; &#39;%c%c%c%c&#39; (%d byte)\n&quot;</span>, label[0], label[1], label[2], label[3],
<a name="l00284"></a>00284                      nextblock);
<a name="l00285"></a>00285               SKIP2;
<a name="l00286"></a>00286             }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288           SKIP;
<a name="l00289"></a>00289           <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), 1, fd);
<a name="l00290"></a>00290           SKIP2;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292           <span class="keywordflow">if</span>(blksize1 != 256 || blksize2 != 256)
<a name="l00293"></a>00293             {
<a name="l00294"></a>00294               printf(<span class="stringliteral">&quot;incorrect header format\n&quot;</span>);
<a name="l00295"></a>00295               fflush(stdout);
<a name="l00296"></a>00296               <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(890);
<a name="l00297"></a>00297             }
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00303"></a>00303         {
<a name="l00304"></a>00304           <a class="code" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a>(fname);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306           hdf5_file = H5Fopen(fname, H5F_ACC_RDONLY, H5P_DEFAULT);
<a name="l00307"></a>00307 
<a name="l00308"></a>00308           <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)
<a name="l00309"></a>00309             {
<a name="l00310"></a>00310               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type] &gt; 0)
<a name="l00311"></a>00311                 {
<a name="l00312"></a>00312                   sprintf(buf, <span class="stringliteral">&quot;/PartType%d&quot;</span>, type);
<a name="l00313"></a>00313                   hdf5_grp[type] = H5Gopen(hdf5_file, buf);
<a name="l00314"></a>00314                 }
<a name="l00315"></a>00315             }
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317 <span class="preprocessor">#endif</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>
<a name="l00319"></a>00319       <span class="keywordflow">for</span>(task = readTask + 1; task &lt;= lastTask; task++)
<a name="l00320"></a>00320         MPI_Ssend(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, task, <a class="code" href="tags_8h.html#a048ec72bf4150a4d7d2aa377a18d6cb8">TAG_HEADER</a>, MPI_COMM_WORLD);
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322   <span class="keywordflow">else</span>
<a name="l00323"></a>00323     MPI_Recv(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, readTask, <a class="code" href="tags_8h.html#a048ec72bf4150a4d7d2aa377a18d6cb8">TAG_HEADER</a>, MPI_COMM_WORLD, &amp;status);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> == 0)
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> &lt;= 1)
<a name="l00329"></a>00329         <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
<a name="l00330"></a>00330           <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[i] = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[i];
<a name="l00331"></a>00331 
<a name="l00332"></a>00332       <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2bb70816a4d5f56e0df2d9b8d706cef2">TotN_gas</a> = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[0] + (((<span class="keywordtype">long</span> <span class="keywordtype">long</span>) <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a56f54a68fe289b19902b3c4c561a7159">npartTotalHighWord</a>[0]) &lt;&lt; 32);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334       <span class="keywordflow">for</span>(i = 0, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> = 0; i &lt; 6; i++)
<a name="l00335"></a>00335         {
<a name="l00336"></a>00336           <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> += <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[i];
<a name="l00337"></a>00337           <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> += (((<span class="keywordtype">long</span> long) <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a56f54a68fe289b19902b3c4c561a7159">npartTotalHighWord</a>[i]) &lt;&lt; 32);
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 
<a name="l00341"></a>00341       <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
<a name="l00342"></a>00342         <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[i] = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a2c387b0c7c823287d424fedc70175917">mass</a>[i];
<a name="l00343"></a>00343 
<a name="l00344"></a>00344       <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);     <span class="comment">/* sets the maximum number of particles that may */</span>
<a name="l00345"></a>00345       <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a43dccd3997af759d43a2f3bcce44a2c4">MaxPartSph</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2bb70816a4d5f56e0df2d9b8d706cef2">TotN_gas</a> / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);    <span class="comment">/* sets the maximum number of particles that may </span>
<a name="l00346"></a>00346 <span class="comment">                                                                           reside on a processor */</span>
<a name="l00347"></a>00347       <a class="code" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7">allocate_memory</a>();
<a name="l00348"></a>00348 
<a name="l00349"></a>00349       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 2)
<a name="l00350"></a>00350         <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad6237959a3590772366f18000a47a7d6">time</a>;
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
<a name="l00354"></a>00354     {
<a name="l00355"></a>00355       <span class="keywordflow">for</span>(i = 0, n_in_file = 0; i &lt; 6; i++)
<a name="l00356"></a>00356         n_in_file += <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[i];
<a name="l00357"></a>00357 
<a name="l00358"></a>00358       printf(<span class="stringliteral">&quot;\nreading file `%s&#39; on task=%d (contains %d particles.)\n&quot;</span>
<a name="l00359"></a>00359              <span class="stringliteral">&quot;distributing this file to tasks %d-%d\n&quot;</span>
<a name="l00360"></a>00360              <span class="stringliteral">&quot;Type 0 (gas):   %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
<a name="l00361"></a>00361              <span class="stringliteral">&quot;Type 1 (halo):  %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
<a name="l00362"></a>00362              <span class="stringliteral">&quot;Type 2 (disk):  %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
<a name="l00363"></a>00363              <span class="stringliteral">&quot;Type 3 (bulge): %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
<a name="l00364"></a>00364              <span class="stringliteral">&quot;Type 4 (stars): %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
<a name="l00365"></a>00365              <span class="stringliteral">&quot;Type 5 (bndry): %8d  (tot=%6d%09d) masstab=%g\n\n&quot;</span>, fname, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, n_in_file, readTask,
<a name="l00366"></a>00366              lastTask, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[0], (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[0] / 1000000000),
<a name="l00367"></a>00367              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[0] % 1000000000), <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[0], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[1],
<a name="l00368"></a>00368              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[1] / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[1] % 1000000000),
<a name="l00369"></a>00369              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[1], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[2], (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[2] / 1000000000),
<a name="l00370"></a>00370              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[2] % 1000000000), <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[2], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[3],
<a name="l00371"></a>00371              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[3] / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[3] % 1000000000),
<a name="l00372"></a>00372              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[3], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[4], (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[4] / 1000000000),
<a name="l00373"></a>00373              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[4] % 1000000000), <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[4], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[5],
<a name="l00374"></a>00374              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[5] / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[5] % 1000000000),
<a name="l00375"></a>00375              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[5]);
<a name="l00376"></a>00376       fflush(stdout);
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   ntask = lastTask - readTask + 1;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <span class="comment">/* to collect the gas particles all at the beginning (in case several</span>
<a name="l00384"></a>00384 <span class="comment">     snapshot files are read on the current CPU) we move the collisionless</span>
<a name="l00385"></a>00385 <span class="comment">     particles such that a gap of the right size is created */</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   <span class="keywordflow">for</span>(type = 0, nall = 0; type &lt; 6; type++)
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389       n_in_file = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];
<a name="l00390"></a>00390 
<a name="l00391"></a>00391       n_for_this_task = n_in_file / ntask;
<a name="l00392"></a>00392       <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> - readTask) &lt; (n_in_file % ntask))
<a name="l00393"></a>00393         n_for_this_task++;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395       nall += n_for_this_task;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   memmove(&amp;<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> + nall], &amp;<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>], (<a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> - N_gas) * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structparticle__data.html">particle_data</a>));
<a name="l00399"></a>00399   nstart = N_gas;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 
<a name="l00403"></a>00403   <span class="keywordflow">for</span>(blocknr = 0; blocknr &lt; IO_NBLOCKS; blocknr++)
<a name="l00404"></a>00404     {
<a name="l00405"></a>00405       <span class="keywordflow">if</span>(<a class="code" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e">blockpresent</a>(blocknr))
<a name="l00406"></a>00406         {
<a name="l00407"></a>00407           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 0 &amp;&amp; blocknr &gt; <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a942cbf4dca00cd5260edc905f5976682">IO_U</a>)
<a name="l00408"></a>00408             <span class="keywordflow">continue</span>;           <span class="comment">/* ignore all other blocks in initial conditions */</span>
<a name="l00409"></a>00409 
<a name="l00410"></a>00410           bytes_per_blockelement = <a class="code" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c">get_bytes_per_blockelement</a>(blocknr);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412           blockmaxlen = ((int) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a> * 1024 * 1024)) / bytes_per_blockelement;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414           npart = <a class="code" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9">get_particles_in_block</a>(blocknr, &amp;typelist[0]);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416           <span class="keywordflow">if</span>(npart &gt; 0)
<a name="l00417"></a>00417             {
<a name="l00418"></a>00418               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
<a name="l00419"></a>00419                 {
<a name="l00420"></a>00420                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00421"></a>00421                     {
<a name="l00422"></a>00422                       SKIP;
<a name="l00423"></a>00423                       <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;label, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 4, fd);
<a name="l00424"></a>00424                       <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;nextblock, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, fd);
<a name="l00425"></a>00425                       printf(<span class="stringliteral">&quot;Reading header =&gt; &#39;%c%c%c%c&#39; (%d byte)\n&quot;</span>, label[0], label[1], label[2],
<a name="l00426"></a>00426                              label[3], nextblock);
<a name="l00427"></a>00427                       SKIP2;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429                       <span class="keywordflow">if</span>(strncmp(label, <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr], 4) != 0)
<a name="l00430"></a>00430                         {
<a name="l00431"></a>00431                           printf(<span class="stringliteral">&quot;incorrect block-structure!\n&quot;</span>);
<a name="l00432"></a>00432                           printf(<span class="stringliteral">&quot;expected &#39;%c%c%c%c&#39; but found &#39;%c%c%c%c&#39;\n&quot;</span>,
<a name="l00433"></a>00433                                  label[0], label[1], label[2], label[3],
<a name="l00434"></a>00434                                  <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][0], <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][1],
<a name="l00435"></a>00435                                  <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][2], <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][3]);
<a name="l00436"></a>00436                           fflush(stdout);
<a name="l00437"></a>00437                           <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1890);
<a name="l00438"></a>00438                         }
<a name="l00439"></a>00439                     }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00442"></a>00442                     SKIP;
<a name="l00443"></a>00443                 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445               <span class="keywordflow">for</span>(type = 0, offset = 0; type &lt; 6; type++)
<a name="l00446"></a>00446                 {
<a name="l00447"></a>00447                   n_in_file = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];
<a name="l00448"></a>00448 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00449"></a>00449 <span class="preprocessor"></span>                  pcsum = 0;
<a name="l00450"></a>00450 <span class="preprocessor">#endif</span>
<a name="l00451"></a>00451 <span class="preprocessor"></span>                  <span class="keywordflow">if</span>(typelist[type] == 0)
<a name="l00452"></a>00452                     {
<a name="l00453"></a>00453                       n_for_this_task = n_in_file / ntask;
<a name="l00454"></a>00454                       <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> - readTask) &lt; (n_in_file % ntask))
<a name="l00455"></a>00455                         n_for_this_task++;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                       offset += n_for_this_task;
<a name="l00458"></a>00458                     }
<a name="l00459"></a>00459                   <span class="keywordflow">else</span>
<a name="l00460"></a>00460                     {
<a name="l00461"></a>00461                       <span class="keywordflow">for</span>(task = readTask; task &lt;= lastTask; task++)
<a name="l00462"></a>00462                         {
<a name="l00463"></a>00463                           n_for_this_task = n_in_file / ntask;
<a name="l00464"></a>00464                           <span class="keywordflow">if</span>((task - readTask) &lt; (n_in_file % ntask))
<a name="l00465"></a>00465                             n_for_this_task++;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467                           <span class="keywordflow">if</span>(task == <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
<a name="l00468"></a>00468                             <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> + n_for_this_task &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>)
<a name="l00469"></a>00469                               {
<a name="l00470"></a>00470                                 printf(<span class="stringliteral">&quot;too many particles\n&quot;</span>);
<a name="l00471"></a>00471                                 <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1313);
<a name="l00472"></a>00472                               }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 
<a name="l00475"></a>00475                           <span class="keywordflow">do</span>
<a name="l00476"></a>00476                             {
<a name="l00477"></a>00477                               pc = n_for_this_task;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479                               <span class="keywordflow">if</span>(pc &gt; blockmaxlen)
<a name="l00480"></a>00480                                 pc = blockmaxlen;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482                               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
<a name="l00483"></a>00483                                 {
<a name="l00484"></a>00484                                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00485"></a>00485                                     <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement, pc, fd);
<a name="l00486"></a>00486 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span>                                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00488"></a>00488                                     {
<a name="l00489"></a>00489                                       <a class="code" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686">get_dataset_name</a>(blocknr, buf);
<a name="l00490"></a>00490                                       hdf5_dataset = H5Dopen(hdf5_grp[type], buf);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492                                       dims[0] = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];
<a name="l00493"></a>00493                                       dims[1] = <a class="code" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a>(blocknr);
<a name="l00494"></a>00494                                       <span class="keywordflow">if</span>(dims[1] == 1)
<a name="l00495"></a>00495                                         rank = 1;
<a name="l00496"></a>00496                                       <span class="keywordflow">else</span>
<a name="l00497"></a>00497                                         rank = 2;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499                                       hdf5_dataspace_in_file = H5Screate_simple(rank, dims, NULL);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501                                       dims[0] = pc;
<a name="l00502"></a>00502                                       hdf5_dataspace_in_memory = H5Screate_simple(rank, dims, NULL);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504                                       start[0] = pcsum;
<a name="l00505"></a>00505                                       start[1] = 0;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507                                       count[0] = pc;
<a name="l00508"></a>00508                                       count[1] = <a class="code" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a>(blocknr);
<a name="l00509"></a>00509                                       pcsum += pc;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511                                       H5Sselect_hyperslab(hdf5_dataspace_in_file, H5S_SELECT_SET,
<a name="l00512"></a>00512                                                           start, NULL, count, NULL);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514                                       <span class="keywordflow">switch</span> (<a class="code" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1">get_datatype_in_block</a>(blocknr))
<a name="l00515"></a>00515                                         {
<a name="l00516"></a>00516                                         <span class="keywordflow">case</span> 0:
<a name="l00517"></a>00517                                           hdf5_datatype = H5Tcopy(H5T_NATIVE_UINT);
<a name="l00518"></a>00518                                           <span class="keywordflow">break</span>;
<a name="l00519"></a>00519                                         <span class="keywordflow">case</span> 1:
<a name="l00520"></a>00520                                           hdf5_datatype = H5Tcopy(H5T_NATIVE_FLOAT);
<a name="l00521"></a>00521                                           <span class="keywordflow">break</span>;
<a name="l00522"></a>00522                                         <span class="keywordflow">case</span> 2:
<a name="l00523"></a>00523                                           hdf5_datatype = H5Tcopy(H5T_NATIVE_UINT64);
<a name="l00524"></a>00524                                           <span class="keywordflow">break</span>;
<a name="l00525"></a>00525                                         }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527                                       H5Dread(hdf5_dataset, hdf5_datatype, hdf5_dataspace_in_memory,
<a name="l00528"></a>00528                                               hdf5_dataspace_in_file, H5P_DEFAULT, <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530                                       H5Tclose(hdf5_datatype);
<a name="l00531"></a>00531                                       H5Sclose(hdf5_dataspace_in_memory);
<a name="l00532"></a>00532                                       H5Sclose(hdf5_dataspace_in_file);
<a name="l00533"></a>00533                                       H5Dclose(hdf5_dataset);
<a name="l00534"></a>00534                                     }
<a name="l00535"></a>00535 <span class="preprocessor">#endif</span>
<a name="l00536"></a>00536 <span class="preprocessor"></span>                                }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538                               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask &amp;&amp; task != readTask)
<a name="l00539"></a>00539                                 MPI_Ssend(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement * pc, MPI_BYTE, task, <a class="code" href="tags_8h.html#a41c046c7898c1956074313fd83f50b39">TAG_PDATA</a>,
<a name="l00540"></a>00540                                           MPI_COMM_WORLD);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542                               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> != readTask &amp;&amp; task == <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
<a name="l00543"></a>00543                                 MPI_Recv(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement * pc, MPI_BYTE, readTask,
<a name="l00544"></a>00544                                          <a class="code" href="tags_8h.html#a41c046c7898c1956074313fd83f50b39">TAG_PDATA</a>, MPI_COMM_WORLD, &amp;status);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546                               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == task)
<a name="l00547"></a>00547                                 {
<a name="l00548"></a>00548                                   <a class="code" href="proto_8h.html#a3757efb7e470353080a128388ccebec9">empty_read_buffer</a>(blocknr, nstart + offset, pc, type);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550                                   offset += pc;
<a name="l00551"></a>00551                                 }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553                               n_for_this_task -= pc;
<a name="l00554"></a>00554                             }
<a name="l00555"></a>00555                           <span class="keywordflow">while</span>(n_for_this_task &gt; 0);
<a name="l00556"></a>00556                         }
<a name="l00557"></a>00557                     }
<a name="l00558"></a>00558                 }
<a name="l00559"></a>00559               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
<a name="l00560"></a>00560                 {
<a name="l00561"></a>00561                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00562"></a>00562                     {
<a name="l00563"></a>00563                       SKIP2;
<a name="l00564"></a>00564                       <span class="keywordflow">if</span>(blksize1 != blksize2)
<a name="l00565"></a>00565                         {
<a name="l00566"></a>00566                           printf(<span class="stringliteral">&quot;incorrect block-sizes detected!\n&quot;</span>);
<a name="l00567"></a>00567                           printf(<span class="stringliteral">&quot;Task=%d   blocknr=%d  blksize1=%d  blksize2=%d\n&quot;</span>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, blocknr,
<a name="l00568"></a>00568                                  blksize1, blksize2);
<a name="l00569"></a>00569                           fflush(stdout);
<a name="l00570"></a>00570                           <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1889);
<a name="l00571"></a>00571                         }
<a name="l00572"></a>00572                     }
<a name="l00573"></a>00573                 }
<a name="l00574"></a>00574             }
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)
<a name="l00580"></a>00580     {
<a name="l00581"></a>00581       n_in_file = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];
<a name="l00582"></a>00582 
<a name="l00583"></a>00583       n_for_this_task = n_in_file / ntask;
<a name="l00584"></a>00584       <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> - readTask) &lt; (n_in_file % ntask))
<a name="l00585"></a>00585         n_for_this_task++;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587       <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> += n_for_this_task;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589       <span class="keywordflow">if</span>(type == 0)
<a name="l00590"></a>00590         N_gas += n_for_this_task;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
<a name="l00594"></a>00594     {
<a name="l00595"></a>00595       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00596"></a>00596         fclose(fd);
<a name="l00597"></a>00597 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00598"></a>00598 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00599"></a>00599         {
<a name="l00600"></a>00600           <span class="keywordflow">for</span>(type = 5; type &gt;= 0; type--)
<a name="l00601"></a>00601             <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type] &gt; 0)
<a name="l00602"></a>00602               H5Gclose(hdf5_grp[type]);
<a name="l00603"></a>00603           H5Fclose(hdf5_file);
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605 <span class="preprocessor">#endif</span>
<a name="l00606"></a>00606 <span class="preprocessor"></span>    }
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 
<a name="l00615"></a><a class="code" href="read__ic_8c.html#ac028b474d53a40e79377b7ae5dde636a">00615</a> <span class="keywordtype">int</span> <a class="code" href="proto_8h.html#ac028b474d53a40e79377b7ae5dde636a">find_files</a>(<span class="keywordtype">char</span> *fname)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617   FILE *<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>;
<a name="l00618"></a>00618   <span class="keywordtype">char</span> buf[200], buf1[200];
<a name="l00619"></a>00619   <span class="keywordtype">int</span> dummy;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   sprintf(buf, <span class="stringliteral">&quot;%s.%d&quot;</span>, fname, 0);
<a name="l00622"></a>00622   sprintf(buf1, <span class="stringliteral">&quot;%s&quot;</span>, fname);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00625"></a>00625     {
<a name="l00626"></a>00626       sprintf(buf, <span class="stringliteral">&quot;%s.%d.hdf5&quot;</span>, fname, 0);
<a name="l00627"></a>00627       sprintf(buf1, <span class="stringliteral">&quot;%s.hdf5&quot;</span>, fname);
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="preprocessor">#ifndef  HAVE_HDF5</span>
<a name="l00631"></a>00631 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
<a name="l00634"></a>00634         printf(<span class="stringliteral">&quot;Code wasn&#39;t compiled with HDF5 support enabled!\n&quot;</span>);
<a name="l00635"></a>00635       <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637 <span class="preprocessor">#endif</span>
<a name="l00638"></a>00638 <span class="preprocessor"></span>
<a name="l00639"></a>00639   <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> = 0;
<a name="l00640"></a>00640 
<a name="l00641"></a>00641   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643       <span class="keywordflow">if</span>((fd = fopen(buf, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l00644"></a>00644         {
<a name="l00645"></a>00645           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00646"></a>00646             {
<a name="l00647"></a>00647               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00648"></a>00648                 {
<a name="l00649"></a>00649                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00650"></a>00650                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00651"></a>00651                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00652"></a>00652                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00653"></a>00653                 }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655               fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00656"></a>00656               fread(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), 1, fd);
<a name="l00657"></a>00657               fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00658"></a>00658             }
<a name="l00659"></a>00659           fclose(fd);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00662"></a>00662 <span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00663"></a>00663             <a class="code" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a>(buf);
<a name="l00664"></a>00664 <span class="preprocessor">#endif</span>
<a name="l00665"></a>00665 <span class="preprocessor"></span>        }
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667 
<a name="l00668"></a>00668   MPI_Bcast(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, 0, MPI_COMM_WORLD);
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> &gt; 0)
<a name="l00671"></a>00671     <span class="keywordflow">return</span> <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a>;
<a name="l00672"></a>00672 
<a name="l00673"></a>00673   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
<a name="l00674"></a>00674     {
<a name="l00675"></a>00675       <span class="keywordflow">if</span>((fd = fopen(buf1, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l00676"></a>00676         {
<a name="l00677"></a>00677           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00678"></a>00678             {
<a name="l00679"></a>00679               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
<a name="l00680"></a>00680                 {
<a name="l00681"></a>00681                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00682"></a>00682                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00683"></a>00683                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00684"></a>00684                   fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00685"></a>00685                 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687               fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00688"></a>00688               fread(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), 1, fd);
<a name="l00689"></a>00689               fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
<a name="l00690"></a>00690             }
<a name="l00691"></a>00691           fclose(fd);
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00694"></a>00694 <span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
<a name="l00695"></a>00695             <a class="code" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a>(buf1);
<a name="l00696"></a>00696 <span class="preprocessor">#endif</span>
<a name="l00697"></a>00697 <span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> = 1;
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   MPI_Bcast(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, 0, MPI_COMM_WORLD);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> &gt; 0)
<a name="l00704"></a>00704     <span class="keywordflow">return</span> <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a>;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
<a name="l00707"></a>00707     {
<a name="l00708"></a>00708       printf(<span class="stringliteral">&quot;\nCan&#39;t find initial conditions file.&quot;</span>);
<a name="l00709"></a>00709       printf(<span class="stringliteral">&quot;neither as &#39;%s&#39;\nnor as &#39;%s&#39;\n&quot;</span>, buf, buf1);
<a name="l00710"></a>00710       fflush(stdout);
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
<a name="l00714"></a>00714   <span class="keywordflow">return</span> 0;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 
<a name="l00724"></a><a class="code" href="read__ic_8c.html#abf75a70e8719e8ed6de565a6ae90f1ab">00724</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(<span class="keywordtype">int</span> nfiles, <span class="keywordtype">int</span> firstfile, <span class="keywordtype">int</span> firsttask, <span class="keywordtype">int</span> lasttask, <span class="keywordtype">int</span> *filenr, <span class="keywordtype">int</span> *master,
<a name="l00725"></a>00725                      <span class="keywordtype">int</span> *<a class="code" href="forcetree_8c.html#a72e27dee31b1c4c6a504fbed29542d97">last</a>)
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727   <span class="keywordtype">int</span> ntask, filesleft, filesright, tasksleft, tasksright;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729   <span class="keywordflow">if</span>(nfiles &gt; 1)
<a name="l00730"></a>00730     {
<a name="l00731"></a>00731       ntask = lasttask - firsttask + 1;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733       filesleft = (((double) (ntask / 2)) / ntask) * nfiles;
<a name="l00734"></a>00734       <span class="keywordflow">if</span>(filesleft &lt;= 0)
<a name="l00735"></a>00735         filesleft = 1;
<a name="l00736"></a>00736       <span class="keywordflow">if</span>(filesleft &gt;= nfiles)
<a name="l00737"></a>00737         filesleft = nfiles - 1;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739       filesright = nfiles - filesleft;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741       tasksleft = ntask / 2;
<a name="l00742"></a>00742       tasksright = ntask - tasksleft;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744       <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(filesleft, firstfile, firsttask, firsttask + tasksleft - 1, filenr, master, last);
<a name="l00745"></a>00745       <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(filesright, firstfile + filesleft, firsttask + tasksleft, lasttask, filenr, master,
<a name="l00746"></a>00746                       last);
<a name="l00747"></a>00747     }
<a name="l00748"></a>00748   <span class="keywordflow">else</span>
<a name="l00749"></a>00749     {
<a name="l00750"></a>00750       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> &gt;= firsttask &amp;&amp; <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> &lt;= lasttask)
<a name="l00751"></a>00751         {
<a name="l00752"></a>00752           *filenr = firstfile;
<a name="l00753"></a>00753           *master = firsttask;
<a name="l00754"></a>00754           *last = lasttask;
<a name="l00755"></a>00755         }
<a name="l00756"></a>00756     }
<a name="l00757"></a>00757 }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 
<a name="l00763"></a>00763 <span class="preprocessor">#ifdef HAVE_HDF5</span>
<a name="l00764"></a><a class="code" href="read__ic_8c.html#af87c21a0c70ac5e7d5f769b952d08fe9">00764</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a>(<span class="keywordtype">char</span> *fname)
<a name="l00765"></a>00765 {
<a name="l00766"></a>00766   hid_t hdf5_file, hdf5_headergrp, hdf5_attribute;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768 
<a name="l00769"></a>00769   hdf5_file = H5Fopen(fname, H5F_ACC_RDONLY, H5P_DEFAULT);
<a name="l00770"></a>00770   hdf5_headergrp = H5Gopen(hdf5_file, <span class="stringliteral">&quot;/Header&quot;</span>);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumPart_ThisFile&quot;</span>);
<a name="l00774"></a>00774   H5Aread(hdf5_attribute, H5T_NATIVE_INT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>);
<a name="l00775"></a>00775   H5Aclose(hdf5_attribute);
<a name="l00776"></a>00776 
<a name="l00777"></a>00777   hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumPart_Total&quot;</span>);
<a name="l00778"></a>00778   H5Aread(hdf5_attribute, H5T_NATIVE_UINT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>);
<a name="l00779"></a>00779   H5Aclose(hdf5_attribute);
<a name="l00780"></a>00780 
<a name="l00781"></a>00781   hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumPart_Total_HighWord&quot;</span>);
<a name="l00782"></a>00782   H5Aread(hdf5_attribute, H5T_NATIVE_UINT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a56f54a68fe289b19902b3c4c561a7159">npartTotalHighWord</a>);
<a name="l00783"></a>00783   H5Aclose(hdf5_attribute);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785   hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;MassTable&quot;</span>);
<a name="l00786"></a>00786   H5Aread(hdf5_attribute, H5T_NATIVE_DOUBLE, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a2c387b0c7c823287d424fedc70175917">mass</a>);
<a name="l00787"></a>00787   H5Aclose(hdf5_attribute);
<a name="l00788"></a>00788 
<a name="l00789"></a>00789   hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;Time&quot;</span>);
<a name="l00790"></a>00790   H5Aread(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad6237959a3590772366f18000a47a7d6">time</a>);
<a name="l00791"></a>00791   H5Aclose(hdf5_attribute);
<a name="l00792"></a>00792 
<a name="l00793"></a>00793   hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumFilesPerSnapshot&quot;</span>);
<a name="l00794"></a>00794   H5Aread(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a>);
<a name="l00795"></a>00795   H5Aclose(hdf5_attribute);
<a name="l00796"></a>00796 
<a name="l00797"></a>00797   hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;Flag_Entropy_ICs&quot;</span>);
<a name="l00798"></a>00798   H5Aread(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a448788ace72155e22d19af1c01917857">flag_entropy_instead_u</a>);
<a name="l00799"></a>00799   H5Aclose(hdf5_attribute);
<a name="l00800"></a>00800 
<a name="l00801"></a>00801   H5Gclose(hdf5_headergrp);
<a name="l00802"></a>00802   H5Fclose(hdf5_file);
<a name="l00803"></a>00803 }
<a name="l00804"></a>00804 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 3 2010 18:45:43 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
