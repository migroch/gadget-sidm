<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gadget-sidm: pm_periodic.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gadget-sidm
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('pm__periodic_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">pm_periodic.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>routines for periodic PM-force computation  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;float.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &lt;srfftw_mpi.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for pm_periodic.c:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c__incl.png" border="0" usemap="#pm__periodic_8c" alt=""/></div>
<map name="pm__periodic_8c" id="pm__periodic_8c">
<area shape="rect" id="node17" href="allvars_8h.html" title="declares global variables." alt="" coords="561,161,635,189"/><area shape="rect" id="node24" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="646,83,713,111"/><area shape="rect" id="node22" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="621,238,682,266"/></map>
</div>
</div>
<p><a href="pm__periodic_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a>&#160;&#160;&#160;(2*(PMGRID/2 + 1))</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a13e381f05efdb739cf5026384e908409">pm_init_periodic</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#acb5c64377fad9e1a34bad88fb7c61a3e">pm_init_periodic_allocate</a> (int dimprod)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a259e6f8400ee889c64bc667334060742">pm_init_periodic_free</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#af8dfaf42f3b513118ad6aa3ab5cd3c1b">pmforce_periodic</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a7938f2181f23d56ac46f3625d1a855a0">pmpotential_periodic</a> (void)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static rfftwnd_mpi_plan&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#ada1bb88285e667f67d30ddac8c9fa924">fft_forward_plan</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static rfftwnd_mpi_plan&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#affe0aa143bfd852f161120fe9a09f285">fft_inverse_plan</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a> [1]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#ad054897488b61bb22501d6ad4b01e6c8">slabs_per_task</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#aee0d2641b59b02dd9f5ed3070784d995">meshmax_list</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a140eccd2a65fea3b4e2080aea519eff1">slabstart_x</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a9dfa9b82d22c2a6cc503bcbebe6d774c">nslab_x</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#ae33694d88449fd0eb1d291ac33498ac1">nslab_y</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#ab401ed54b1c5572b1b6a2949ffd5c1f8">smallest_slab</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a9ae463305ca6786e02bc9000726802b1">maxfftsize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static fftw_real *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static fftw_real *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static fftw_real *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static fftw_complex *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>routines for periodic PM-force computation </p>

<p>Definition in file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a8a4d19d2948b1d7b3eff694719e5f436"></a><!-- doxytag: member="pm_periodic.c::PMGRID2" ref="a8a4d19d2948b1d7b3eff694719e5f436" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a>&#160;&#160;&#160;(2*(PMGRID/2 + 1))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00029">29</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a13e381f05efdb739cf5026384e908409"></a><!-- doxytag: member="pm_periodic.c::pm_init_periodic" ref="a13e381f05efdb739cf5026384e908409" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#a13e381f05efdb739cf5026384e908409">pm_init_periodic</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routines generates the FFTW-plans to carry out the parallel FFTs later on. Some auxiliary variables are also initialized. </p>
<p>&lt; ASMTH gives the scale of the short-range/long-range force split in units of FFT-mesh cells</p>
<p>&lt; RCUT gives the maximum distance (in units of the scale used for the force split) out to which short-range forces are evaluated in the short-range tree walk. </p>

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00055">55</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="pm__periodic_8c_source.html#l00034">fft_forward_plan</a>, <a class="el" href="pm__periodic_8c_source.html#l00034">fft_inverse_plan</a>, <a class="el" href="pm__periodic_8c_source.html#l00043">fftsize</a>, <a class="el" href="pm__periodic_8c_source.html#l00038">first_slab_of_task</a>, <a class="el" href="pm__periodic_8c_source.html#l00043">maxfftsize</a>, <a class="el" href="pm__periodic_8c_source.html#l00039">meshmax_list</a>, <a class="el" href="pm__periodic_8c_source.html#l00039">meshmin_list</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">nslab_x</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">nslab_y</a>, <a class="el" href="allvars_8c_source.html#l00016">NTask</a>, <a class="el" href="pm__periodic_8c_source.html#l00036">slab_to_task</a>, <a class="el" href="pm__periodic_8c_source.html#l00037">slabs_per_task</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">slabstart_x</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">slabstart_y</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">smallest_slab</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, and <a class="el" href="pm__periodic_8c_source.html#l00049">to_slab_fac</a>.</p>

<p>Referenced by <a class="el" href="longrange_8c_source.html#l00020">long_range_init()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i;
  <span class="keywordtype">int</span> slab_to_task_local[PMGRID];

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Asmth[0] = ASMTH * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize / PMGRID;
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Rcut[0] = RCUT * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Asmth[0];

  <span class="comment">/* Set up the FFTW plan files. */</span>

  <a class="code" href="pm__periodic_8c.html#ada1bb88285e667f67d30ddac8c9fa924">fft_forward_plan</a> = rfftw3d_mpi_create_plan(MPI_COMM_WORLD, PMGRID, PMGRID, PMGRID,
                                             FFTW_REAL_TO_COMPLEX, FFTW_ESTIMATE | FFTW_IN_PLACE);
  <a class="code" href="pm__periodic_8c.html#affe0aa143bfd852f161120fe9a09f285">fft_inverse_plan</a> = rfftw3d_mpi_create_plan(MPI_COMM_WORLD, PMGRID, PMGRID, PMGRID,
                                             FFTW_COMPLEX_TO_REAL, FFTW_ESTIMATE | FFTW_IN_PLACE);

  <span class="comment">/* Workspace out the ranges on each processor. */</span>

  rfftwnd_mpi_local_sizes(<a class="code" href="pm__periodic_8c.html#ada1bb88285e667f67d30ddac8c9fa924">fft_forward_plan</a>, &amp;<a class="code" href="pm__periodic_8c.html#a9dfa9b82d22c2a6cc503bcbebe6d774c">nslab_x</a>, &amp;<a class="code" href="pm__periodic_8c.html#a140eccd2a65fea3b4e2080aea519eff1">slabstart_x</a>, &amp;<a class="code" href="pm__periodic_8c.html#ae33694d88449fd0eb1d291ac33498ac1">nslab_y</a>, &amp;<a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a>, &amp;<a class="code" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a>);

  <span class="keywordflow">for</span>(i = 0; i &lt; PMGRID; i++)
    slab_to_task_local[i] = 0;

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="pm__periodic_8c.html#a9dfa9b82d22c2a6cc503bcbebe6d774c">nslab_x</a>; i++)
    slab_to_task_local[<a class="code" href="pm__periodic_8c.html#a140eccd2a65fea3b4e2080aea519eff1">slabstart_x</a> + i] = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;

  MPI_Allreduce(slab_to_task_local, <a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>, PMGRID, MPI_INT, MPI_SUM, MPI_COMM_WORLD);

  MPI_Allreduce(&amp;nslab_x, &amp;<a class="code" href="pm__periodic_8c.html#ab401ed54b1c5572b1b6a2949ffd5c1f8">smallest_slab</a>, 1, MPI_INT, MPI_MIN, MPI_COMM_WORLD);

  <a class="code" href="pm__periodic_8c.html#ad054897488b61bb22501d6ad4b01e6c8">slabs_per_task</a> = malloc(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  MPI_Allgather(&amp;nslab_x, 1, MPI_INT, <a class="code" href="pm__periodic_8c.html#ad054897488b61bb22501d6ad4b01e6c8">slabs_per_task</a>, 1, MPI_INT, MPI_COMM_WORLD);

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; i++)
        printf(<span class="stringliteral">&quot;Task=%d  FFT-Slabs=%d\n&quot;</span>, i, <a class="code" href="pm__periodic_8c.html#ad054897488b61bb22501d6ad4b01e6c8">slabs_per_task</a>[i]);
    }

  <a class="code" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a> = malloc(NTask * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  MPI_Allgather(&amp;<a class="code" href="pm__periodic_8c.html#a140eccd2a65fea3b4e2080aea519eff1">slabstart_x</a>, 1, MPI_INT, <a class="code" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a>, 1, MPI_INT, MPI_COMM_WORLD);

  <a class="code" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a> = malloc(3 * NTask * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  <a class="code" href="pm__periodic_8c.html#aee0d2641b59b02dd9f5ed3070784d995">meshmax_list</a> = malloc(3 * NTask * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));


  <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> = PMGRID / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize;

  MPI_Allreduce(&amp;<a class="code" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a>, &amp;<a class="code" href="pm__periodic_8c.html#a9ae463305ca6786e02bc9000726802b1">maxfftsize</a>, 1, MPI_INT, MPI_MAX, MPI_COMM_WORLD);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_a13e381f05efdb739cf5026384e908409_icgraph.png" border="0" usemap="#pm__periodic_8c_a13e381f05efdb739cf5026384e908409_icgraph" alt=""/></div>
<map name="pm__periodic_8c_a13e381f05efdb739cf5026384e908409_icgraph" id="pm__periodic_8c_a13e381f05efdb739cf5026384e908409_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#af52079f2c63002aca9463ba0b13727df" title="long_range_init" alt="" coords="183,5,300,33"/><area shape="rect" id="node5" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="349,5,416,33"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="465,5,519,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acb5c64377fad9e1a34bad88fb7c61a3e"></a><!-- doxytag: member="pm_periodic.c::pm_init_periodic_allocate" ref="acb5c64377fad9e1a34bad88fb7c61a3e" args="(int dimprod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#acb5c64377fad9e1a34bad88fb7c61a3e">pm_init_periodic_allocate</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dimprod</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function allocates the memory neeed to compute the long-range PM force. Three fields are used, one to hold the density (and its FFT, and then the real-space potential), one to hold the force field obtained by finite differencing, and finally a workspace field, which is used both as workspace for the parallel FFT, and as buffer for the communication algorithm used in the force computation. </p>

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00113">113</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>References <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="pm__periodic_8c_source.html#l00046">fft_of_rhogrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00043">fftsize</a>, <a class="el" href="pm__periodic_8c_source.html#l00045">forcegrid</a>, <a class="el" href="system_8c_source.html#l00111">imax()</a>, <a class="el" href="pm__periodic_8c_source.html#l00043">maxfftsize</a>, <a class="el" href="pm__periodic_8c_source.html#l00045">rhogrid</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">static</span> <span class="keywordtype">int</span> first_alloc = 1;
  <span class="keywordtype">int</span> dimprodmax;
  <span class="keywordtype">double</span> bytes_tot = 0;
  <span class="keywordtype">size_t</span> bytes;

  MPI_Allreduce(&amp;dimprod, &amp;dimprodmax, 1, MPI_INT, MPI_MAX, MPI_COMM_WORLD);

  <span class="comment">/* allocate the memory to hold the FFT fields */</span>

  <span class="keywordflow">if</span>(!(<a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a> = (fftw_real *) malloc(bytes = <a class="code" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a> * <span class="keyword">sizeof</span>(fftw_real))))
    {
      printf(<span class="stringliteral">&quot;failed to allocate memory for `FFT-rhogrid&#39; (%g MB).\n&quot;</span>, bytes / (1024.0 * 1024.0));
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
    }
  bytes_tot += bytes;


  <span class="keywordflow">if</span>(!(<a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a> = (fftw_real *) malloc(bytes = <a class="code" href="proto_8h.html#a05ba897ffe0dfe737254a09c91c50d10">imax</a>(<a class="code" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a>, dimprodmax) * <span class="keyword">sizeof</span>(fftw_real))))
    {
      printf(<span class="stringliteral">&quot;failed to allocate memory for `FFT-forcegrid&#39; (%g MB).\n&quot;</span>, bytes / (1024.0 * 1024.0));
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
    }
  bytes_tot += bytes;

  <span class="keywordflow">if</span>(!(<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> = (fftw_real *) malloc(bytes = <a class="code" href="proto_8h.html#a05ba897ffe0dfe737254a09c91c50d10">imax</a>(<a class="code" href="pm__periodic_8c.html#a9ae463305ca6786e02bc9000726802b1">maxfftsize</a>, dimprodmax) * <span class="keyword">sizeof</span>(fftw_real))))
    {
      printf(<span class="stringliteral">&quot;failed to allocate memory for `FFT-workspace&#39; (%g MB).\n&quot;</span>, bytes / (1024.0 * 1024.0));
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
    }
  bytes_tot += bytes;

  <span class="keywordflow">if</span>(first_alloc == 1)
    {
      first_alloc = 0;
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;\nAllocated %g MByte for FFT data.\n\n&quot;</span>, bytes_tot / (1024.0 * 1024.0));
    }

  <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a> = (fftw_complex *) &amp; <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>[0];
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_cgraph.png" border="0" usemap="#pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_cgraph" alt=""/></div>
<map name="pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_cgraph" id="pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="237,5,304,33"/><area shape="rect" id="node7" href="proto_8h.html#a05ba897ffe0dfe737254a09c91c50d10" title="imax" alt="" coords="244,55,297,83"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="352,5,509,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_icgraph.png" border="0" usemap="#pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_icgraph" alt=""/></div>
<map name="pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_icgraph" id="pm__periodic_8c_acb5c64377fad9e1a34bad88fb7c61a3e_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#af8dfaf42f3b513118ad6aa3ab5cd3c1b" title="pmforce_periodic" alt="" coords="251,5,381,33"/><area shape="rect" id="node13" href="proto_8h.html#a7938f2181f23d56ac46f3625d1a855a0" title="pmpotential_periodic" alt="" coords="239,55,393,83"/><area shape="rect" id="node5" href="proto_8h.html#a5989a3f57c7d6dfdef205dc6b72a1d25" title="long_range_force" alt="" coords="449,5,580,33"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="659,5,829,33"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="901,55,944,83"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="993,55,1047,83"/><area shape="rect" id="node15" href="proto_8h.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="444,55,585,83"/><area shape="rect" id="node18" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="635,106,853,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a259e6f8400ee889c64bc667334060742"></a><!-- doxytag: member="pm_periodic.c::pm_init_periodic_free" ref="a259e6f8400ee889c64bc667334060742" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#a259e6f8400ee889c64bc667334060742">pm_init_periodic_free</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine frees the space allocated for the parallel FFT algorithm. </p>

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00160">160</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>References <a class="el" href="pm__periodic_8c_source.html#l00045">forcegrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00045">rhogrid</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="comment">/* allocate the memory to hold the FFT fields */</span>
  free(<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>);
  free(<a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>);
  free(<a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_a259e6f8400ee889c64bc667334060742_icgraph.png" border="0" usemap="#pm__periodic_8c_a259e6f8400ee889c64bc667334060742_icgraph" alt=""/></div>
<map name="pm__periodic_8c_a259e6f8400ee889c64bc667334060742_icgraph" id="pm__periodic_8c_a259e6f8400ee889c64bc667334060742_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#af8dfaf42f3b513118ad6aa3ab5cd3c1b" title="pmforce_periodic" alt="" coords="227,5,357,33"/><area shape="rect" id="node13" href="proto_8h.html#a7938f2181f23d56ac46f3625d1a855a0" title="pmpotential_periodic" alt="" coords="215,55,369,83"/><area shape="rect" id="node5" href="proto_8h.html#a5989a3f57c7d6dfdef205dc6b72a1d25" title="long_range_force" alt="" coords="425,5,556,33"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="635,5,805,33"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="877,55,920,83"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="969,55,1023,83"/><area shape="rect" id="node15" href="proto_8h.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="420,55,561,83"/><area shape="rect" id="node18" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="611,106,829,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af8dfaf42f3b513118ad6aa3ab5cd3c1b"></a><!-- doxytag: member="pm_periodic.c::pmforce_periodic" ref="af8dfaf42f3b513118ad6aa3ab5cd3c1b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#af8dfaf42f3b513118ad6aa3ab5cd3c1b">pmforce_periodic</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Calculates the long-range periodic force given the particle positions using the PM method. The force is Gaussian filtered with Asmth, given in mesh-cell units. We carry out a CIC charge assignment, and compute the potenial by Fourier transform methods. The potential is finite differenced using a 4-point finite differencing formula, and the forces are interpolated tri-linearly to the particle positions. The CIC kernel is deconvolved. Note that the particle distribution is not in the slab decomposition that is used for the FFT. Instead, overlapping patches between local domains and FFT slabs are communicated as needed. </p>

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00180">180</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="pm__periodic_8c_source.html#l00034">fft_forward_plan</a>, <a class="el" href="pm__periodic_8c_source.html#l00034">fft_inverse_plan</a>, <a class="el" href="pm__periodic_8c_source.html#l00046">fft_of_rhogrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00043">fftsize</a>, <a class="el" href="pm__periodic_8c_source.html#l00038">first_slab_of_task</a>, <a class="el" href="forcetree_8c_source.html#l02911">force_treeallocate()</a>, <a class="el" href="forcetree_8c_source.html#l02976">force_treefree()</a>, <a class="el" href="pm__periodic_8c_source.html#l00045">forcegrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00039">meshmax_list</a>, <a class="el" href="pm__periodic_8c_source.html#l00039">meshmin_list</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">nslab_y</a>, <a class="el" href="allvars_8c_source.html#l00016">NTask</a>, <a class="el" href="allvars_8c_source.html#l00019">NumPart</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>, <a class="el" href="pm__periodic_8c_source.html#l00160">pm_init_periodic_free()</a>, <a class="el" href="pm__periodic_8c_source.html#l00029">PMGRID2</a>, <a class="el" href="allvars_8c_source.html#l00017">PTask</a>, <a class="el" href="pm__periodic_8c_source.html#l00045">rhogrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00036">slab_to_task</a>, <a class="el" href="pm__periodic_8c_source.html#l00037">slabs_per_task</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">slabstart_y</a>, <a class="el" href="tags_8h_source.html#l00020">TAG_PERIODIC_A</a>, <a class="el" href="tags_8h_source.html#l00021">TAG_PERIODIC_B</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, <a class="el" href="pm__periodic_8c_source.html#l00049">to_slab_fac</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p>Referenced by <a class="el" href="longrange_8c_source.html#l00056">long_range_force()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> k2, kx, ky, kz, smth;
  <span class="keywordtype">double</span> dx, dy, dz;
  <span class="keywordtype">double</span> fx, fy, fz, ff;
  <span class="keywordtype">double</span> asmth2, fac, acc_dim;
  <span class="keywordtype">int</span> i, j, slab, level, sendTask, recvTask;
  <span class="keywordtype">int</span> x, y, z, xl, yl, zl, xr, yr, zr, xll, yll, zll, xrr, yrr, zrr, ip, dim;
  <span class="keywordtype">int</span> slab_x, slab_y, slab_z;
  <span class="keywordtype">int</span> slab_xx, slab_yy, slab_zz;
  <span class="keywordtype">int</span> meshmin[3], meshmax[3], sendmin, sendmax, recvmin, recvmax;
  <span class="keywordtype">int</span> rep, ncont, cont_sendmin[2], cont_sendmax[2], cont_recvmin[2], cont_recvmax[2];
  <span class="keywordtype">int</span> dimx, dimy, dimz, recv_dimx, recv_dimy, recv_dimz;
  MPI_Status status;


  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      printf(<span class="stringliteral">&quot;Starting periodic PM calculation.\n&quot;</span>);
      fflush(stdout);
    }


  <a class="code" href="forcetree_8c.html#a0a9667f530dad09ebed8c0c98e5d3888">force_treefree</a>();


  asmth2 = (2 * M_PI) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Asmth[0] / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize;
  asmth2 *= asmth2;

  fac = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.G / (M_PI * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize);   <span class="comment">/* to get potential */</span>
  fac *= 1 / (2 * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize / PMGRID);        <span class="comment">/* for finite differencing */</span>

  <span class="comment">/* first, establish the extension of the local patch in the PMGRID  */</span>

  <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
    {
      meshmin[j] = PMGRID;
      meshmax[j] = 0;
    }

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    {
      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
        {
          slab = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[j];
          <span class="keywordflow">if</span>(slab &gt;= PMGRID)
            slab = PMGRID - 1;

          <span class="keywordflow">if</span>(slab &lt; meshmin[j])
            meshmin[j] = slab;

          <span class="keywordflow">if</span>(slab &gt; meshmax[j])
            meshmax[j] = slab;
        }
    }

  MPI_Allgather(meshmin, 3, MPI_INT, <a class="code" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a>, 3, MPI_INT, MPI_COMM_WORLD);
  MPI_Allgather(meshmax, 3, MPI_INT, <a class="code" href="pm__periodic_8c.html#aee0d2641b59b02dd9f5ed3070784d995">meshmax_list</a>, 3, MPI_INT, MPI_COMM_WORLD);

  dimx = meshmax[0] - meshmin[0] + 2;
  dimy = meshmax[1] - meshmin[1] + 2;
  dimz = meshmax[2] - meshmin[2] + 2;

  <a class="code" href="pm__periodic_8c.html#acb5c64377fad9e1a34bad88fb7c61a3e">pm_init_periodic_allocate</a>((dimx + 4) * (dimy + 4) * (dimz + 4));

  <span class="keywordflow">for</span>(i = 0; i &lt; dimx * dimy * dimz; i++)
    <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[i] = 0;

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    {
      slab_x = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0];
      <span class="keywordflow">if</span>(slab_x &gt;= PMGRID)
        slab_x = PMGRID - 1;
      dx = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0] - slab_x;
      slab_x -= meshmin[0];
      slab_xx = slab_x + 1;

      slab_y = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1];
      <span class="keywordflow">if</span>(slab_y &gt;= PMGRID)
        slab_y = PMGRID - 1;
      dy = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1] - slab_y;
      slab_y -= meshmin[1];
      slab_yy = slab_y + 1;

      slab_z = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2];
      <span class="keywordflow">if</span>(slab_z &gt;= PMGRID)
        slab_z = PMGRID - 1;
      dz = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2] - slab_z;
      slab_z -= meshmin[2];
      slab_zz = slab_z + 1;

      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_y) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * (1.0 - dy) * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_yy) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * dy * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_y) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * (1.0 - dy) * dz;
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_yy) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * dy * dz;

      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_y) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * (1.0 - dy) * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_yy) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * dy * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_y) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * (1.0 - dy) * dz;
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_yy) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * dy * dz;
    }


  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a>; i++)  <span class="comment">/* clear local density field */</span>
    <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>[i] = 0;

  <span class="keywordflow">for</span>(level = 0; level &lt; (1 &lt;&lt; <a class="code" href="allvars_8c.html#a9a18606803f69f24d3cb2864640c122e">PTask</a>); level++) <span class="comment">/* note: for level=0, target is the same task */</span>
    {
      sendTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;
      recvTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> ^ level;
      <span class="keywordflow">if</span>(recvTask &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
        {
          <span class="comment">/* check how much we have to send */</span>
          sendmin = 2 * PMGRID;
          sendmax = -1;
          <span class="keywordflow">for</span>(slab_x = meshmin[0]; slab_x &lt; meshmax[0] + 2; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[slab_x % PMGRID] == recvTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; sendmin)
                  sendmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; sendmax)
                  sendmax = slab_x;
              }
          <span class="keywordflow">if</span>(sendmax == -1)
            sendmin = 0;

          <span class="comment">/* check how much we have to receive */</span>
          recvmin = 2 * PMGRID;
          recvmax = -1;
          <span class="keywordflow">for</span>(slab_x = <a class="code" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a>[3 * recvTask]; slab_x &lt; <a class="code" href="pm__periodic_8c.html#aee0d2641b59b02dd9f5ed3070784d995">meshmax_list</a>[3 * recvTask] + 2; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[slab_x % PMGRID] == sendTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; recvmin)
                  recvmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; recvmax)
                  recvmax = slab_x;
              }
          <span class="keywordflow">if</span>(recvmax == -1)
            recvmin = 0;


          <span class="keywordflow">if</span>((recvmax - recvmin) &gt;= 0 || (sendmax - sendmin) &gt;= 0)      <span class="comment">/* ok, we have a contribution to the slab */</span>
            {
              recv_dimx = meshmax_list[3 * recvTask + 0] - <a class="code" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a>[3 * recvTask + 0] + 2;
              recv_dimy = meshmax_list[3 * recvTask + 1] - meshmin_list[3 * recvTask + 1] + 2;
              recv_dimz = meshmax_list[3 * recvTask + 2] - meshmin_list[3 * recvTask + 2] + 2;

              <span class="keywordflow">if</span>(level &gt; 0)
                {
                  MPI_Sendrecv(<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (sendmin - meshmin[0]) * dimy * dimz,
                               (sendmax - sendmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real), MPI_BYTE, recvTask,
                               <a class="code" href="tags_8h.html#a4a6e55a8ac447faebc4a6c279d5f5b8a">TAG_PERIODIC_A</a>, <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>,
                               (recvmax - recvmin + 1) * recv_dimy * recv_dimz * <span class="keyword">sizeof</span>(fftw_real), MPI_BYTE,
                               recvTask, <a class="code" href="tags_8h.html#a4a6e55a8ac447faebc4a6c279d5f5b8a">TAG_PERIODIC_A</a>, MPI_COMM_WORLD, &amp;status);
                }
              <span class="keywordflow">else</span>
                {
                  memcpy(<a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>, <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (sendmin - meshmin[0]) * dimy * dimz,
                         (sendmax - sendmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real));
                }

              <span class="keywordflow">for</span>(slab_x = recvmin; slab_x &lt;= recvmax; slab_x++)
                {
                  slab_xx = (slab_x % PMGRID) - <a class="code" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>];

                  <span class="keywordflow">if</span>(slab_xx &gt;= 0 &amp;&amp; slab_xx &lt; <a class="code" href="pm__periodic_8c.html#ad054897488b61bb22501d6ad4b01e6c8">slabs_per_task</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>])
                    {
                      <span class="keywordflow">for</span>(slab_y = meshmin_list[3 * recvTask + 1];
                          slab_y &lt;= meshmax_list[3 * recvTask + 1] + 1; slab_y++)
                        {
                          slab_yy = slab_y;
                          <span class="keywordflow">if</span>(slab_yy &gt;= PMGRID)
                            slab_yy -= PMGRID;

                          <span class="keywordflow">for</span>(slab_z = meshmin_list[3 * recvTask + 2];
                              slab_z &lt;= meshmax_list[3 * recvTask + 2] + 1; slab_z++)
                            {
                              slab_zz = slab_z;
                              <span class="keywordflow">if</span>(slab_zz &gt;= PMGRID)
                                slab_zz -= PMGRID;

                              <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>[PMGRID * <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_xx + <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_yy + slab_zz] +=
                                <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[((slab_x - recvmin) * recv_dimy +
                                           (slab_y - meshmin_list[3 * recvTask + 1])) * recv_dimz +
                                          (slab_z - meshmin_list[3 * recvTask + 2])];
                            }
                        }
                    }
                }
            }
        }
    }

  <span class="comment">/* Do the FFT of the density field */</span>

  rfftwnd_mpi(<a class="code" href="pm__periodic_8c.html#ada1bb88285e667f67d30ddac8c9fa924">fft_forward_plan</a>, 1, <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>, <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>, FFTW_TRANSPOSED_ORDER);

  <span class="comment">/* multiply with Green&#39;s function for the potential */</span>

  <span class="keywordflow">for</span>(y = <a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a>; y &lt; <a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a> + <a class="code" href="pm__periodic_8c.html#ae33694d88449fd0eb1d291ac33498ac1">nslab_y</a>; y++)
    <span class="keywordflow">for</span>(x = 0; x &lt; PMGRID; x++)
      <span class="keywordflow">for</span>(z = 0; z &lt; PMGRID / 2 + 1; z++)
        {
          <span class="keywordflow">if</span>(x &gt; PMGRID / 2)
            kx = x - PMGRID;
          <span class="keywordflow">else</span>
            kx = x;
          <span class="keywordflow">if</span>(y &gt; PMGRID / 2)
            ky = y - PMGRID;
          <span class="keywordflow">else</span>
            ky = y;
          <span class="keywordflow">if</span>(z &gt; PMGRID / 2)
            kz = z - PMGRID;
          <span class="keywordflow">else</span>
            kz = z;

          k2 = kx * kx + ky * ky + kz * kz;

          <span class="keywordflow">if</span>(k2 &gt; 0)
            {
              smth = -exp(-k2 * asmth2) / k2;

              <span class="comment">/* do deconvolution */</span>

              fx = fy = fz = 1;
              <span class="keywordflow">if</span>(kx != 0)
                {
                  fx = (M_PI * kx) / PMGRID;
                  fx = sin(fx) / fx;
                }
              <span class="keywordflow">if</span>(ky != 0)
                {
                  fy = (M_PI * ky) / PMGRID;
                  fy = sin(fy) / fy;
                }
              <span class="keywordflow">if</span>(kz != 0)
                {
                  fz = (M_PI * kz) / PMGRID;
                  fz = sin(fz) / fz;
                }
              ff = 1 / (fx * fy * fz);
              smth *= ff * ff * ff * ff;

              <span class="comment">/* end deconvolution */</span>

              ip = PMGRID * (PMGRID / 2 + 1) * (y - <a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a>) + (PMGRID / 2 + 1) * x + z;
              <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[ip].re *= smth;
              <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[ip].im *= smth;
            }
        }

  <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a> == 0)
    <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[0].re = <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[0].im = 0.0;

  <span class="comment">/* Do the FFT to get the potential */</span>

  rfftwnd_mpi(<a class="code" href="pm__periodic_8c.html#affe0aa143bfd852f161120fe9a09f285">fft_inverse_plan</a>, 1, <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>, <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>, FFTW_TRANSPOSED_ORDER);

  <span class="comment">/* Now rhogrid holds the potential */</span>
  <span class="comment">/* construct the potential for the local patch */</span>


  dimx = meshmax[0] - meshmin[0] + 6;
  dimy = meshmax[1] - meshmin[1] + 6;
  dimz = meshmax[2] - meshmin[2] + 6;

  <span class="keywordflow">for</span>(level = 0; level &lt; (1 &lt;&lt; <a class="code" href="allvars_8c.html#a9a18606803f69f24d3cb2864640c122e">PTask</a>); level++) <span class="comment">/* note: for level=0, target is the same task */</span>
    {
      sendTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;
      recvTask = ThisTask ^ level;

      <span class="keywordflow">if</span>(recvTask &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
        {

          <span class="comment">/* check how much we have to send */</span>
          sendmin = 2 * PMGRID;
          sendmax = -PMGRID;
          <span class="keywordflow">for</span>(slab_x = meshmin_list[3 * recvTask] - 2; slab_x &lt; meshmax_list[3 * recvTask] + 4; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] == sendTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; sendmin)
                  sendmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; sendmax)
                  sendmax = slab_x;
              }
          <span class="keywordflow">if</span>(sendmax == -PMGRID)
            sendmin = sendmax + 1;


          <span class="comment">/* check how much we have to receive */</span>
          recvmin = 2 * PMGRID;
          recvmax = -PMGRID;
          <span class="keywordflow">for</span>(slab_x = meshmin[0] - 2; slab_x &lt; meshmax[0] + 4; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] == recvTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; recvmin)
                  recvmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; recvmax)
                  recvmax = slab_x;
              }
          <span class="keywordflow">if</span>(recvmax == -PMGRID)
            recvmin = recvmax + 1;

          <span class="keywordflow">if</span>((recvmax - recvmin) &gt;= 0 || (sendmax - sendmin) &gt;= 0)      <span class="comment">/* ok, we have a contribution to the slab */</span>
            {
              recv_dimx = meshmax_list[3 * recvTask + 0] - meshmin_list[3 * recvTask + 0] + 6;
              recv_dimy = meshmax_list[3 * recvTask + 1] - meshmin_list[3 * recvTask + 1] + 6;
              recv_dimz = meshmax_list[3 * recvTask + 2] - meshmin_list[3 * recvTask + 2] + 6;

              ncont = 1;
              cont_sendmin[0] = sendmin;
              cont_sendmax[0] = sendmax;
              cont_sendmin[1] = sendmax + 1;
              cont_sendmax[1] = sendmax;

              cont_recvmin[0] = recvmin;
              cont_recvmax[0] = recvmax;
              cont_recvmin[1] = recvmax + 1;
              cont_recvmax[1] = recvmax;

              <span class="keywordflow">for</span>(slab_x = sendmin; slab_x &lt;= sendmax; slab_x++)
                {
                  <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                    {
                      <span class="comment">/* non-contiguous */</span>
                      cont_sendmax[0] = slab_x - 1;
                      <span class="keywordflow">while</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                        slab_x++;
                      cont_sendmin[1] = slab_x;
                      ncont++;
                    }
                }

              <span class="keywordflow">for</span>(slab_x = recvmin; slab_x &lt;= recvmax; slab_x++)
                {
                  <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != recvTask)
                    {
                      <span class="comment">/* non-contiguous */</span>
                      cont_recvmax[0] = slab_x - 1;
                      <span class="keywordflow">while</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != recvTask)
                        slab_x++;
                      cont_recvmin[1] = slab_x;
                      <span class="keywordflow">if</span>(ncont == 1)
                        ncont++;
                    }
                }


              <span class="keywordflow">for</span>(rep = 0; rep &lt; ncont; rep++)
                {
                  sendmin = cont_sendmin[rep];
                  sendmax = cont_sendmax[rep];
                  recvmin = cont_recvmin[rep];
                  recvmax = cont_recvmax[rep];

                  <span class="comment">/* prepare what we want to send */</span>
                  <span class="keywordflow">if</span>(sendmax - sendmin &gt;= 0)
                    {
                      <span class="keywordflow">for</span>(slab_x = sendmin; slab_x &lt;= sendmax; slab_x++)
                        {
                          slab_xx = ((slab_x + PMGRID) % PMGRID) - <a class="code" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>];

                          <span class="keywordflow">for</span>(slab_y = meshmin_list[3 * recvTask + 1] - 2;
                              slab_y &lt; meshmax_list[3 * recvTask + 1] + 4; slab_y++)
                            {
                              slab_yy = (slab_y + PMGRID) % PMGRID;

                              <span class="keywordflow">for</span>(slab_z = meshmin_list[3 * recvTask + 2] - 2;
                                  slab_z &lt; meshmax_list[3 * recvTask + 2] + 4; slab_z++)
                                {
                                  slab_zz = (slab_z + PMGRID) % PMGRID;

                                  <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[((slab_x - sendmin) * recv_dimy +
                                             (slab_y - (meshmin_list[3 * recvTask + 1] - 2))) * recv_dimz +
                                            slab_z - (meshmin_list[3 * recvTask + 2] - 2)] =
                                    <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>[PMGRID * <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_xx + <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_yy + slab_zz];
                                }
                            }
                        }
                    }

                  <span class="keywordflow">if</span>(level &gt; 0)
                    {
                      MPI_Sendrecv(<a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>,
                                   (sendmax - sendmin + 1) * recv_dimy * recv_dimz * <span class="keyword">sizeof</span>(fftw_real),
                                   MPI_BYTE, recvTask, <a class="code" href="tags_8h.html#ab2ae970ad97e212acadb61581cd5643e">TAG_PERIODIC_B</a>,
                                   <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (recvmin - (meshmin[0] - 2)) * dimy * dimz,
                                   (recvmax - recvmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real), MPI_BYTE,
                                   recvTask, <a class="code" href="tags_8h.html#ab2ae970ad97e212acadb61581cd5643e">TAG_PERIODIC_B</a>, MPI_COMM_WORLD, &amp;status);
                    }
                  <span class="keywordflow">else</span>
                    {
                      memcpy(<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (recvmin - (meshmin[0] - 2)) * dimy * dimz,
                             <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>, (recvmax - recvmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real));
                    }
                }
            }
        }
    }


  dimx = meshmax[0] - meshmin[0] + 2;
  dimy = meshmax[1] - meshmin[1] + 2;
  dimz = meshmax[2] - meshmin[2] + 2;

  recv_dimx = meshmax[0] - meshmin[0] + 6;
  recv_dimy = meshmax[1] - meshmin[1] + 6;
  recv_dimz = meshmax[2] - meshmin[2] + 6;


  <span class="keywordflow">for</span>(dim = 0; dim &lt; 3; dim++)  <span class="comment">/* Calculate each component of the force. */</span>
    {
      <span class="comment">/* get the force component by finite differencing the potential */</span>
      <span class="comment">/* note: &quot;workspace&quot; now contains the potential for the local patch, plus a suffiently large buffer region */</span>

      <span class="keywordflow">for</span>(x = 0; x &lt; meshmax[0] - meshmin[0] + 2; x++)
        <span class="keywordflow">for</span>(y = 0; y &lt; meshmax[1] - meshmin[1] + 2; y++)
          <span class="keywordflow">for</span>(z = 0; z &lt; meshmax[2] - meshmin[2] + 2; z++)
            {
              xrr = xll = xr = xl = x;
              yrr = yll = yr = yl = y;
              zrr = zll = zr = zl = z;

              <span class="keywordflow">switch</span> (dim)
                {
                <span class="keywordflow">case</span> 0:
                  xr = x + 1;
                  xrr = x + 2;
                  xl = x - 1;
                  xll = x - 2;
                  <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> 1:
                  yr = y + 1;
                  yl = y - 1;
                  yrr = y + 2;
                  yll = y - 2;
                  <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> 2:
                  zr = z + 1;
                  zl = z - 1;
                  zrr = z + 2;
                  zll = z - 2;
                  <span class="keywordflow">break</span>;
                }

              <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(x * dimy + y) * dimz + z]
                =
                fac * ((4.0 / 3) *
                       (<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[((xl + 2) * recv_dimy + (yl + 2)) * recv_dimz + (zl + 2)]
                        - <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[((xr + 2) * recv_dimy + (yr + 2)) * recv_dimz + (zr + 2)]) -
                       (1.0 / 6) *
                       (<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[((xll + 2) * recv_dimy + (yll + 2)) * recv_dimz + (zll + 2)] -
                        <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[((xrr + 2) * recv_dimy + (yrr + 2)) * recv_dimz + (zrr + 2)]));
            }

      <span class="comment">/* read out the forces */</span>

      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
        {
          slab_x = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0];
          <span class="keywordflow">if</span>(slab_x &gt;= PMGRID)
            slab_x = PMGRID - 1;
          dx = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0] - slab_x;
          slab_x -= meshmin[0];
          slab_xx = slab_x + 1;

          slab_y = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1];
          <span class="keywordflow">if</span>(slab_y &gt;= PMGRID)
            slab_y = PMGRID - 1;
          dy = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1] - slab_y;
          slab_y -= meshmin[1];
          slab_yy = slab_y + 1;

          slab_z = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2];
          <span class="keywordflow">if</span>(slab_z &gt;= PMGRID)
            slab_z = PMGRID - 1;
          dz = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2] - slab_z;
          slab_z -= meshmin[2];
          slab_zz = slab_z + 1;

          acc_dim =
            <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_y) * dimz + slab_z] * (1.0 - dx) * (1.0 - dy) * (1.0 - dz);
          acc_dim += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_yy) * dimz + slab_z] * (1.0 - dx) * dy * (1.0 - dz);
          acc_dim += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_y) * dimz + slab_zz] * (1.0 - dx) * (1.0 - dy) * dz;
          acc_dim += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_yy) * dimz + slab_zz] * (1.0 - dx) * dy * dz;

          acc_dim += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_y) * dimz + slab_z] * (dx) * (1.0 - dy) * (1.0 - dz);
          acc_dim += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_yy) * dimz + slab_z] * (dx) * dy * (1.0 - dz);
          acc_dim += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_y) * dimz + slab_zz] * (dx) * (1.0 - dy) * dz;
          acc_dim += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_yy) * dimz + slab_zz] * (dx) * dy * dz;

          <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravPM[dim] = acc_dim;
        }
    }

  <a class="code" href="pm__periodic_8c.html#a259e6f8400ee889c64bc667334060742">pm_init_periodic_free</a>();
  <a class="code" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2">force_treeallocate</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TreeAllocFactor * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MaxPart, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MaxPart);

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumForcesSinceLastDomainDecomp = 1 + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TotNumPart * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TreeDomainUpdateFrequency;

  <span class="keywordflow">if</span>(ThisTask == 0)
    {
      printf(<span class="stringliteral">&quot;done PM.\n&quot;</span>);
      fflush(stdout);
    }
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_cgraph.png" border="0" usemap="#pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_cgraph" alt=""/></div>
<map name="pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_cgraph" id="pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_cgraph">
<area shape="rect" id="node3" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2" title="force_treeallocate" alt="" coords="211,5,347,33"/><area shape="rect" id="node9" href="forcetree_8c.html#a0a9667f530dad09ebed8c0c98e5d3888" title="force_treefree" alt="" coords="223,55,335,83"/><area shape="rect" id="node11" href="pm__periodic_8c.html#acb5c64377fad9e1a34bad88fb7c61a3e" title="pm_init_periodic_allocate" alt="" coords="188,106,369,134"/><area shape="rect" id="node16" href="pm__periodic_8c.html#a259e6f8400ee889c64bc667334060742" title="pm_init_periodic_free" alt="" coords="200,157,357,185"/><area shape="rect" id="node5" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="419,30,485,58"/><area shape="rect" id="node7" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="533,30,691,58"/><area shape="rect" id="node14" href="proto_8h.html#a05ba897ffe0dfe737254a09c91c50d10" title="imax" alt="" coords="425,106,479,134"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_icgraph.png" border="0" usemap="#pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_icgraph" alt=""/></div>
<map name="pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_icgraph" id="pm__periodic_8c_af8dfaf42f3b513118ad6aa3ab5cd3c1b_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a5989a3f57c7d6dfdef205dc6b72a1d25" title="long_range_force" alt="" coords="188,5,319,33"/><area shape="rect" id="node5" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="368,5,539,33"/><area shape="rect" id="node7" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="587,5,629,33"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="679,5,732,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7938f2181f23d56ac46f3625d1a855a0"></a><!-- doxytag: member="pm_periodic.c::pmpotential_periodic" ref="a7938f2181f23d56ac46f3625d1a855a0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#a7938f2181f23d56ac46f3625d1a855a0">pmpotential_periodic</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Calculates the long-range potential using the PM method. The potential is Gaussian filtered with Asmth, given in mesh-cell units. We carry out a CIC charge assignment, and compute the potenial by Fourier transform methods. The CIC kernel is deconvolved. </p>

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00693">693</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="pm__periodic_8c_source.html#l00034">fft_forward_plan</a>, <a class="el" href="pm__periodic_8c_source.html#l00034">fft_inverse_plan</a>, <a class="el" href="pm__periodic_8c_source.html#l00046">fft_of_rhogrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00043">fftsize</a>, <a class="el" href="pm__periodic_8c_source.html#l00038">first_slab_of_task</a>, <a class="el" href="forcetree_8c_source.html#l02911">force_treeallocate()</a>, <a class="el" href="forcetree_8c_source.html#l02976">force_treefree()</a>, <a class="el" href="pm__periodic_8c_source.html#l00045">forcegrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00039">meshmax_list</a>, <a class="el" href="pm__periodic_8c_source.html#l00039">meshmin_list</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">nslab_y</a>, <a class="el" href="allvars_8c_source.html#l00016">NTask</a>, <a class="el" href="allvars_8c_source.html#l00019">NumPart</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>, <a class="el" href="pm__periodic_8c_source.html#l00160">pm_init_periodic_free()</a>, <a class="el" href="pm__periodic_8c_source.html#l00029">PMGRID2</a>, <a class="el" href="allvars_8c_source.html#l00017">PTask</a>, <a class="el" href="pm__periodic_8c_source.html#l00045">rhogrid</a>, <a class="el" href="pm__periodic_8c_source.html#l00036">slab_to_task</a>, <a class="el" href="pm__periodic_8c_source.html#l00037">slabs_per_task</a>, <a class="el" href="pm__periodic_8c_source.html#l00041">slabstart_y</a>, <a class="el" href="tags_8h_source.html#l00022">TAG_PERIODIC_C</a>, <a class="el" href="tags_8h_source.html#l00023">TAG_PERIODIC_D</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, <a class="el" href="pm__periodic_8c_source.html#l00049">to_slab_fac</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p>Referenced by <a class="el" href="potential_8c_source.html#l00022">compute_potential()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> k2, kx, ky, kz, smth;
  <span class="keywordtype">double</span> dx, dy, dz;
  <span class="keywordtype">double</span> fx, fy, fz, ff;
  <span class="keywordtype">double</span> asmth2, fac;
  <span class="keywordtype">int</span> i, j, slab, level, sendTask, recvTask;
  <span class="keywordtype">int</span> x, y, z, ip;
  <span class="keywordtype">int</span> slab_x, slab_y, slab_z;
  <span class="keywordtype">int</span> slab_xx, slab_yy, slab_zz;
  <span class="keywordtype">int</span> meshmin[3], meshmax[3], sendmin, sendmax, recvmin, recvmax;
  <span class="keywordtype">int</span> rep, ncont, cont_sendmin[2], cont_sendmax[2], cont_recvmin[2], cont_recvmax[2];
  <span class="keywordtype">int</span> dimx, dimy, dimz, recv_dimx, recv_dimy, recv_dimz;
  MPI_Status status;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      printf(<span class="stringliteral">&quot;Starting periodic PM calculation.\n&quot;</span>);
      fflush(stdout);
    }

  asmth2 = (2 * M_PI) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Asmth[0] / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize;
  asmth2 *= asmth2;

  fac = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.G / (M_PI * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize);   <span class="comment">/* to get potential */</span>

  <a class="code" href="forcetree_8c.html#a0a9667f530dad09ebed8c0c98e5d3888">force_treefree</a>();

  <span class="comment">/* first, establish the extension of the local patch in the PMGRID  */</span>

  <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
    {
      meshmin[j] = PMGRID;
      meshmax[j] = 0;
    }

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    {
      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
        {
          slab = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[j];
          <span class="keywordflow">if</span>(slab &gt;= PMGRID)
            slab = PMGRID - 1;

          <span class="keywordflow">if</span>(slab &lt; meshmin[j])
            meshmin[j] = slab;

          <span class="keywordflow">if</span>(slab &gt; meshmax[j])
            meshmax[j] = slab;
        }
    }

  MPI_Allgather(meshmin, 3, MPI_INT, <a class="code" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a>, 3, MPI_INT, MPI_COMM_WORLD);
  MPI_Allgather(meshmax, 3, MPI_INT, <a class="code" href="pm__periodic_8c.html#aee0d2641b59b02dd9f5ed3070784d995">meshmax_list</a>, 3, MPI_INT, MPI_COMM_WORLD);

  dimx = meshmax[0] - meshmin[0] + 2;
  dimy = meshmax[1] - meshmin[1] + 2;
  dimz = meshmax[2] - meshmin[2] + 2;

  <a class="code" href="pm__periodic_8c.html#acb5c64377fad9e1a34bad88fb7c61a3e">pm_init_periodic_allocate</a>((dimx + 4) * (dimy + 4) * (dimz + 4));

  <span class="keywordflow">for</span>(i = 0; i &lt; dimx * dimy * dimz; i++)
    <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[i] = 0;

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    {
      slab_x = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0];
      <span class="keywordflow">if</span>(slab_x &gt;= PMGRID)
        slab_x = PMGRID - 1;
      dx = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0] - slab_x;
      slab_x -= meshmin[0];
      slab_xx = slab_x + 1;

      slab_y = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1];
      <span class="keywordflow">if</span>(slab_y &gt;= PMGRID)
        slab_y = PMGRID - 1;
      dy = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1] - slab_y;
      slab_y -= meshmin[1];
      slab_yy = slab_y + 1;

      slab_z = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2];
      <span class="keywordflow">if</span>(slab_z &gt;= PMGRID)
        slab_z = PMGRID - 1;
      dz = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2] - slab_z;
      slab_z -= meshmin[2];
      slab_zz = slab_z + 1;

      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_y) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * (1.0 - dy) * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_yy) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * dy * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_y) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * (1.0 - dy) * dz;
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_x * dimy + slab_yy) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (1.0 - dx) * dy * dz;

      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_y) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * (1.0 - dy) * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_yy) * dimz + slab_z] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * dy * (1.0 - dz);
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_y) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * (1.0 - dy) * dz;
      <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[(slab_xx * dimy + slab_yy) * dimz + slab_zz] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Mass * (dx) * dy * dz;
    }


  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a>; i++)  <span class="comment">/* clear local density field */</span>
    <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>[i] = 0;

  <span class="keywordflow">for</span>(level = 0; level &lt; (1 &lt;&lt; <a class="code" href="allvars_8c.html#a9a18606803f69f24d3cb2864640c122e">PTask</a>); level++) <span class="comment">/* note: for level=0, target is the same task */</span>
    {
      sendTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;
      recvTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> ^ level;
      <span class="keywordflow">if</span>(recvTask &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
        {
          <span class="comment">/* check how much we have to send */</span>
          sendmin = 2 * PMGRID;
          sendmax = -1;
          <span class="keywordflow">for</span>(slab_x = meshmin[0]; slab_x &lt; meshmax[0] + 2; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[slab_x % PMGRID] == recvTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; sendmin)
                  sendmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; sendmax)
                  sendmax = slab_x;
              }
          <span class="keywordflow">if</span>(sendmax == -1)
            sendmin = 0;

          <span class="comment">/* check how much we have to receive */</span>
          recvmin = 2 * PMGRID;
          recvmax = -1;
          <span class="keywordflow">for</span>(slab_x = <a class="code" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a>[3 * recvTask]; slab_x &lt; <a class="code" href="pm__periodic_8c.html#aee0d2641b59b02dd9f5ed3070784d995">meshmax_list</a>[3 * recvTask] + 2; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[slab_x % PMGRID] == sendTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; recvmin)
                  recvmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; recvmax)
                  recvmax = slab_x;
              }
          <span class="keywordflow">if</span>(recvmax == -1)
            recvmin = 0;


          <span class="keywordflow">if</span>((recvmax - recvmin) &gt;= 0 || (sendmax - sendmin) &gt;= 0)      <span class="comment">/* ok, we have a contribution to the slab */</span>
            {
              recv_dimx = meshmax_list[3 * recvTask + 0] - <a class="code" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a>[3 * recvTask + 0] + 2;
              recv_dimy = meshmax_list[3 * recvTask + 1] - meshmin_list[3 * recvTask + 1] + 2;
              recv_dimz = meshmax_list[3 * recvTask + 2] - meshmin_list[3 * recvTask + 2] + 2;

              <span class="keywordflow">if</span>(level &gt; 0)
                {
                  MPI_Sendrecv(<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (sendmin - meshmin[0]) * dimy * dimz,
                               (sendmax - sendmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real), MPI_BYTE, recvTask,
                               <a class="code" href="tags_8h.html#a610ba4f94d6150970c21c76fa9a22af1">TAG_PERIODIC_C</a>, <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>,
                               (recvmax - recvmin + 1) * recv_dimy * recv_dimz * <span class="keyword">sizeof</span>(fftw_real), MPI_BYTE,
                               recvTask, <a class="code" href="tags_8h.html#a610ba4f94d6150970c21c76fa9a22af1">TAG_PERIODIC_C</a>, MPI_COMM_WORLD, &amp;status);
                }
              <span class="keywordflow">else</span>
                {
                  memcpy(<a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>, <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (sendmin - meshmin[0]) * dimy * dimz,
                         (sendmax - sendmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real));
                }

              <span class="keywordflow">for</span>(slab_x = recvmin; slab_x &lt;= recvmax; slab_x++)
                {
                  slab_xx = (slab_x % PMGRID) - <a class="code" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>];

                  <span class="keywordflow">if</span>(slab_xx &gt;= 0 &amp;&amp; slab_xx &lt; <a class="code" href="pm__periodic_8c.html#ad054897488b61bb22501d6ad4b01e6c8">slabs_per_task</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>])
                    {
                      <span class="keywordflow">for</span>(slab_y = meshmin_list[3 * recvTask + 1];
                          slab_y &lt;= meshmax_list[3 * recvTask + 1] + 1; slab_y++)
                        {
                          slab_yy = slab_y;
                          <span class="keywordflow">if</span>(slab_yy &gt;= PMGRID)
                            slab_yy -= PMGRID;

                          <span class="keywordflow">for</span>(slab_z = meshmin_list[3 * recvTask + 2];
                              slab_z &lt;= meshmax_list[3 * recvTask + 2] + 1; slab_z++)
                            {
                              slab_zz = slab_z;
                              <span class="keywordflow">if</span>(slab_zz &gt;= PMGRID)
                                slab_zz -= PMGRID;

                              <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>[PMGRID * <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_xx + <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_yy + slab_zz] +=
                                <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[((slab_x - recvmin) * recv_dimy +
                                           (slab_y - meshmin_list[3 * recvTask + 1])) * recv_dimz +
                                          (slab_z - meshmin_list[3 * recvTask + 2])];
                            }
                        }
                    }
                }
            }
        }
    }



  <span class="comment">/* Do the FFT of the density field */</span>

  rfftwnd_mpi(<a class="code" href="pm__periodic_8c.html#ada1bb88285e667f67d30ddac8c9fa924">fft_forward_plan</a>, 1, <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>, <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>, FFTW_TRANSPOSED_ORDER);

  <span class="comment">/* multiply with Green&#39;s function for the potential */</span>

  <span class="keywordflow">for</span>(y = <a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a>; y &lt; <a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a> + <a class="code" href="pm__periodic_8c.html#ae33694d88449fd0eb1d291ac33498ac1">nslab_y</a>; y++)
    <span class="keywordflow">for</span>(x = 0; x &lt; PMGRID; x++)
      <span class="keywordflow">for</span>(z = 0; z &lt; PMGRID / 2 + 1; z++)
        {
          <span class="keywordflow">if</span>(x &gt; PMGRID / 2)
            kx = x - PMGRID;
          <span class="keywordflow">else</span>
            kx = x;
          <span class="keywordflow">if</span>(y &gt; PMGRID / 2)
            ky = y - PMGRID;
          <span class="keywordflow">else</span>
            ky = y;
          <span class="keywordflow">if</span>(z &gt; PMGRID / 2)
            kz = z - PMGRID;
          <span class="keywordflow">else</span>
            kz = z;

          k2 = kx * kx + ky * ky + kz * kz;

          <span class="keywordflow">if</span>(k2 &gt; 0)
            {
              smth = -exp(-k2 * asmth2) / k2 * fac;
              <span class="comment">/* do deconvolution */</span>
              fx = fy = fz = 1;
              <span class="keywordflow">if</span>(kx != 0)
                {
                  fx = (M_PI * kx) / PMGRID;
                  fx = sin(fx) / fx;
                }
              <span class="keywordflow">if</span>(ky != 0)
                {
                  fy = (M_PI * ky) / PMGRID;
                  fy = sin(fy) / fy;
                }
              <span class="keywordflow">if</span>(kz != 0)
                {
                  fz = (M_PI * kz) / PMGRID;
                  fz = sin(fz) / fz;
                }
              ff = 1 / (fx * fy * fz);
              smth *= ff * ff * ff * ff;
              <span class="comment">/* end deconvolution */</span>

              ip = PMGRID * (PMGRID / 2 + 1) * (y - <a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a>) + (PMGRID / 2 + 1) * x + z;
              <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[ip].re *= smth;
              <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[ip].im *= smth;
            }
        }

  <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a> == 0)
    <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[0].re = <a class="code" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a>[0].im = 0.0;

  <span class="comment">/* Do the FFT to get the potential */</span>

  rfftwnd_mpi(<a class="code" href="pm__periodic_8c.html#affe0aa143bfd852f161120fe9a09f285">fft_inverse_plan</a>, 1, <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>, <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>, FFTW_TRANSPOSED_ORDER);

  <span class="comment">/* note: &quot;rhogrid&quot; now contains the potential */</span>



  dimx = meshmax[0] - meshmin[0] + 6;
  dimy = meshmax[1] - meshmin[1] + 6;
  dimz = meshmax[2] - meshmin[2] + 6;

  <span class="keywordflow">for</span>(level = 0; level &lt; (1 &lt;&lt; <a class="code" href="allvars_8c.html#a9a18606803f69f24d3cb2864640c122e">PTask</a>); level++) <span class="comment">/* note: for level=0, target is the same task */</span>
    {
      sendTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;
      recvTask = ThisTask ^ level;

      <span class="keywordflow">if</span>(recvTask &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
        {

          <span class="comment">/* check how much we have to send */</span>
          sendmin = 2 * PMGRID;
          sendmax = -PMGRID;
          <span class="keywordflow">for</span>(slab_x = meshmin_list[3 * recvTask] - 2; slab_x &lt; meshmax_list[3 * recvTask] + 4; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] == sendTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; sendmin)
                  sendmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; sendmax)
                  sendmax = slab_x;
              }
          <span class="keywordflow">if</span>(sendmax == -PMGRID)
            sendmin = sendmax + 1;


          <span class="comment">/* check how much we have to receive */</span>
          recvmin = 2 * PMGRID;
          recvmax = -PMGRID;
          <span class="keywordflow">for</span>(slab_x = meshmin[0] - 2; slab_x &lt; meshmax[0] + 4; slab_x++)
            <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] == recvTask)
              {
                <span class="keywordflow">if</span>(slab_x &lt; recvmin)
                  recvmin = slab_x;
                <span class="keywordflow">if</span>(slab_x &gt; recvmax)
                  recvmax = slab_x;
              }
          <span class="keywordflow">if</span>(recvmax == -PMGRID)
            recvmin = recvmax + 1;

          <span class="keywordflow">if</span>((recvmax - recvmin) &gt;= 0 || (sendmax - sendmin) &gt;= 0)      <span class="comment">/* ok, we have a contribution to the slab */</span>
            {
              recv_dimx = meshmax_list[3 * recvTask + 0] - meshmin_list[3 * recvTask + 0] + 6;
              recv_dimy = meshmax_list[3 * recvTask + 1] - meshmin_list[3 * recvTask + 1] + 6;
              recv_dimz = meshmax_list[3 * recvTask + 2] - meshmin_list[3 * recvTask + 2] + 6;

              ncont = 1;
              cont_sendmin[0] = sendmin;
              cont_sendmax[0] = sendmax;
              cont_sendmin[1] = sendmax + 1;
              cont_sendmax[1] = sendmax;

              cont_recvmin[0] = recvmin;
              cont_recvmax[0] = recvmax;
              cont_recvmin[1] = recvmax + 1;
              cont_recvmax[1] = recvmax;

              <span class="keywordflow">for</span>(slab_x = sendmin; slab_x &lt;= sendmax; slab_x++)
                {
                  <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                    {
                      <span class="comment">/* non-contiguous */</span>
                      cont_sendmax[0] = slab_x - 1;
                      <span class="keywordflow">while</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                        slab_x++;
                      cont_sendmin[1] = slab_x;
                      ncont++;
                    }
                }

              <span class="keywordflow">for</span>(slab_x = recvmin; slab_x &lt;= recvmax; slab_x++)
                {
                  <span class="keywordflow">if</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != recvTask)
                    {
                      <span class="comment">/* non-contiguous */</span>
                      cont_recvmax[0] = slab_x - 1;
                      <span class="keywordflow">while</span>(<a class="code" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[(slab_x + PMGRID) % PMGRID] != recvTask)
                        slab_x++;
                      cont_recvmin[1] = slab_x;
                      <span class="keywordflow">if</span>(ncont == 1)
                        ncont++;
                    }
                }


              <span class="keywordflow">for</span>(rep = 0; rep &lt; ncont; rep++)
                {
                  sendmin = cont_sendmin[rep];
                  sendmax = cont_sendmax[rep];
                  recvmin = cont_recvmin[rep];
                  recvmax = cont_recvmax[rep];

                  <span class="comment">/* prepare what we want to send */</span>
                  <span class="keywordflow">if</span>(sendmax - sendmin &gt;= 0)
                    {
                      <span class="keywordflow">for</span>(slab_x = sendmin; slab_x &lt;= sendmax; slab_x++)
                        {
                          slab_xx = ((slab_x + PMGRID) % PMGRID) - <a class="code" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a>[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>];

                          <span class="keywordflow">for</span>(slab_y = meshmin_list[3 * recvTask + 1] - 2;
                              slab_y &lt; meshmax_list[3 * recvTask + 1] + 4; slab_y++)
                            {
                              slab_yy = (slab_y + PMGRID) % PMGRID;

                              <span class="keywordflow">for</span>(slab_z = meshmin_list[3 * recvTask + 2] - 2;
                                  slab_z &lt; meshmax_list[3 * recvTask + 2] + 4; slab_z++)
                                {
                                  slab_zz = (slab_z + PMGRID) % PMGRID;

                                  <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[((slab_x - sendmin) * recv_dimy +
                                             (slab_y - (meshmin_list[3 * recvTask + 1] - 2))) * recv_dimz +
                                            slab_z - (meshmin_list[3 * recvTask + 2] - 2)] =
                                    <a class="code" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a>[PMGRID * <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_xx + <a class="code" href="pm__periodic_8c.html#a8a4d19d2948b1d7b3eff694719e5f436">PMGRID2</a> * slab_yy + slab_zz];
                                }
                            }
                        }
                    }

                  <span class="keywordflow">if</span>(level &gt; 0)
                    {
                      MPI_Sendrecv(<a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>,
                                   (sendmax - sendmin + 1) * recv_dimy * recv_dimz * <span class="keyword">sizeof</span>(fftw_real),
                                   MPI_BYTE, recvTask, <a class="code" href="tags_8h.html#a0434224ef1101b06dd3142342582069a">TAG_PERIODIC_D</a>,
                                   <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (recvmin - (meshmin[0] - 2)) * dimy * dimz,
                                   (recvmax - recvmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real), MPI_BYTE,
                                   recvTask, <a class="code" href="tags_8h.html#a0434224ef1101b06dd3142342582069a">TAG_PERIODIC_D</a>, MPI_COMM_WORLD, &amp;status);
                    }
                  <span class="keywordflow">else</span>
                    {
                      memcpy(<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a> + (recvmin - (meshmin[0] - 2)) * dimy * dimz,
                             <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>, (recvmax - recvmin + 1) * dimy * dimz * <span class="keyword">sizeof</span>(fftw_real));
                    }
                }
            }
        }
    }


  dimx = meshmax[0] - meshmin[0] + 2;
  dimy = meshmax[1] - meshmin[1] + 2;
  dimz = meshmax[2] - meshmin[2] + 2;

  recv_dimx = meshmax[0] - meshmin[0] + 6;
  recv_dimy = meshmax[1] - meshmin[1] + 6;
  recv_dimz = meshmax[2] - meshmin[2] + 6;



  <span class="keywordflow">for</span>(x = 0; x &lt; meshmax[0] - meshmin[0] + 2; x++)
    <span class="keywordflow">for</span>(y = 0; y &lt; meshmax[1] - meshmin[1] + 2; y++)
      <span class="keywordflow">for</span>(z = 0; z &lt; meshmax[2] - meshmin[2] + 2; z++)
        {
          <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(x * dimy + y) * dimz + z] =
            <a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>[((x + 2) * recv_dimy + (y + 2)) * recv_dimz + (z + 2)];
        }


  <span class="comment">/* read out the potential */</span>

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    {
      slab_x = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0];
      <span class="keywordflow">if</span>(slab_x &gt;= PMGRID)
        slab_x = PMGRID - 1;
      dx = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[0] - slab_x;
      slab_x -= meshmin[0];
      slab_xx = slab_x + 1;

      slab_y = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1];
      <span class="keywordflow">if</span>(slab_y &gt;= PMGRID)
        slab_y = PMGRID - 1;
      dy = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[1] - slab_y;
      slab_y -= meshmin[1];
      slab_yy = slab_y + 1;

      slab_z = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2];
      <span class="keywordflow">if</span>(slab_z &gt;= PMGRID)
        slab_z = PMGRID - 1;
      dz = <a class="code" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[2] - slab_z;
      slab_z -= meshmin[2];
      slab_zz = slab_z + 1;

      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential +=
        <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_y) * dimz + slab_z] * (1.0 - dx) * (1.0 - dy) * (1.0 - dz);
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_yy) * dimz + slab_z] * (1.0 - dx) * dy * (1.0 - dz);
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_y) * dimz + slab_zz] * (1.0 - dx) * (1.0 - dy) * dz;
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_x * dimy + slab_yy) * dimz + slab_zz] * (1.0 - dx) * dy * dz;

      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_y) * dimz + slab_z] * (dx) * (1.0 - dy) * (1.0 - dz);
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_yy) * dimz + slab_z] * (dx) * dy * (1.0 - dz);
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_y) * dimz + slab_zz] * (dx) * (1.0 - dy) * dz;
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Potential += <a class="code" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a>[(slab_xx * dimy + slab_yy) * dimz + slab_zz] * (dx) * dy * dz;
    }

  <a class="code" href="pm__periodic_8c.html#a259e6f8400ee889c64bc667334060742">pm_init_periodic_free</a>();
  <a class="code" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2">force_treeallocate</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TreeAllocFactor * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MaxPart, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MaxPart);

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumForcesSinceLastDomainDecomp = 1 + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TotNumPart * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TreeDomainUpdateFrequency;

  <span class="keywordflow">if</span>(ThisTask == 0)
    {
      printf(<span class="stringliteral">&quot;done PM-Potential.\n&quot;</span>);
      fflush(stdout);
    }
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_cgraph.png" border="0" usemap="#pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_cgraph" alt=""/></div>
<map name="pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_cgraph" id="pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_cgraph">
<area shape="rect" id="node3" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2" title="force_treeallocate" alt="" coords="235,5,371,33"/><area shape="rect" id="node9" href="forcetree_8c.html#a0a9667f530dad09ebed8c0c98e5d3888" title="force_treefree" alt="" coords="247,55,359,83"/><area shape="rect" id="node11" href="pm__periodic_8c.html#acb5c64377fad9e1a34bad88fb7c61a3e" title="pm_init_periodic_allocate" alt="" coords="212,106,393,134"/><area shape="rect" id="node16" href="pm__periodic_8c.html#a259e6f8400ee889c64bc667334060742" title="pm_init_periodic_free" alt="" coords="224,157,381,185"/><area shape="rect" id="node5" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="443,30,509,58"/><area shape="rect" id="node7" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="557,30,715,58"/><area shape="rect" id="node14" href="proto_8h.html#a05ba897ffe0dfe737254a09c91c50d10" title="imax" alt="" coords="449,106,503,134"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_icgraph.png" border="0" usemap="#pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_icgraph" alt=""/></div>
<map name="pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_icgraph" id="pm__periodic_8c_a7938f2181f23d56ac46f3625d1a855a0_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="212,5,353,33"/><area shape="rect" id="node5" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="669,5,712,33"/><area shape="rect" id="node9" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="403,30,621,58"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="761,5,815,33"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ada1bb88285e667f67d30ddac8c9fa924"></a><!-- doxytag: member="pm_periodic.c::fft_forward_plan" ref="ada1bb88285e667f67d30ddac8c9fa924" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rfftwnd_mpi_plan <a class="el" href="pm__periodic_8c.html#ada1bb88285e667f67d30ddac8c9fa924">fft_forward_plan</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00034">34</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="affe0aa143bfd852f161120fe9a09f285"></a><!-- doxytag: member="pm_periodic.c::fft_inverse_plan" ref="affe0aa143bfd852f161120fe9a09f285" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rfftwnd_mpi_plan <a class="el" href="pm__periodic_8c.html#affe0aa143bfd852f161120fe9a09f285">fft_inverse_plan</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00034">34</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a8f0b56ad473150630454fbceefe2c1e7"></a><!-- doxytag: member="pm_periodic.c::fft_of_rhogrid" ref="a8f0b56ad473150630454fbceefe2c1e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fftw_complex* <a class="el" href="pm__periodic_8c.html#a8f0b56ad473150630454fbceefe2c1e7">fft_of_rhogrid</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00046">46</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a7575000a7b0c6532786de0ac15da4052"></a><!-- doxytag: member="pm_periodic.c::fftsize" ref="a7575000a7b0c6532786de0ac15da4052" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#a7575000a7b0c6532786de0ac15da4052">fftsize</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00043">43</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a8b608f18c44e494650da5577ddb34082"></a><!-- doxytag: member="pm_periodic.c::first_slab_of_task" ref="a8b608f18c44e494650da5577ddb34082" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="pm__periodic_8c.html#a8b608f18c44e494650da5577ddb34082">first_slab_of_task</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00038">38</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="afa4a65b248baddbf9f8c388a48a1787f"></a><!-- doxytag: member="pm_periodic.c::forcegrid" ref="afa4a65b248baddbf9f8c388a48a1787f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fftw_real * <a class="el" href="pm__periodic_8c.html#afa4a65b248baddbf9f8c388a48a1787f">forcegrid</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00045">45</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>, <a class="el" href="pm__periodic_8c_source.html#l00160">pm_init_periodic_free()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a9ae463305ca6786e02bc9000726802b1"></a><!-- doxytag: member="pm_periodic.c::maxfftsize" ref="a9ae463305ca6786e02bc9000726802b1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#a9ae463305ca6786e02bc9000726802b1">maxfftsize</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00043">43</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>.</p>

</div>
</div>
<a class="anchor" id="aee0d2641b59b02dd9f5ed3070784d995"></a><!-- doxytag: member="pm_periodic.c::meshmax_list" ref="aee0d2641b59b02dd9f5ed3070784d995" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int * <a class="el" href="pm__periodic_8c.html#aee0d2641b59b02dd9f5ed3070784d995">meshmax_list</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00039">39</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a0bdf8c7e2cab6c38a4357cf4817e7cbf"></a><!-- doxytag: member="pm_periodic.c::meshmin_list" ref="a0bdf8c7e2cab6c38a4357cf4817e7cbf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="pm__periodic_8c.html#a0bdf8c7e2cab6c38a4357cf4817e7cbf">meshmin_list</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00039">39</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a9dfa9b82d22c2a6cc503bcbebe6d774c"></a><!-- doxytag: member="pm_periodic.c::nslab_x" ref="a9dfa9b82d22c2a6cc503bcbebe6d774c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#a9dfa9b82d22c2a6cc503bcbebe6d774c">nslab_x</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00041">41</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="ae33694d88449fd0eb1d291ac33498ac1"></a><!-- doxytag: member="pm_periodic.c::nslab_y" ref="ae33694d88449fd0eb1d291ac33498ac1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#ae33694d88449fd0eb1d291ac33498ac1">nslab_y</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00041">41</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a07a721ff607175c756095575f9c14fe3"></a><!-- doxytag: member="pm_periodic.c::rhogrid" ref="a07a721ff607175c756095575f9c14fe3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fftw_real* <a class="el" href="pm__periodic_8c.html#a07a721ff607175c756095575f9c14fe3">rhogrid</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00045">45</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>, <a class="el" href="pm__periodic_8c_source.html#l00160">pm_init_periodic_free()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="af5fc4d76c1156f1aabbfa15968b9ad4c"></a><!-- doxytag: member="pm_periodic.c::slab_to_task" ref="af5fc4d76c1156f1aabbfa15968b9ad4c" args="[1]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#af5fc4d76c1156f1aabbfa15968b9ad4c">slab_to_task</a>[1]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00036">36</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="ad054897488b61bb22501d6ad4b01e6c8"></a><!-- doxytag: member="pm_periodic.c::slabs_per_task" ref="ad054897488b61bb22501d6ad4b01e6c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* <a class="el" href="pm__periodic_8c.html#ad054897488b61bb22501d6ad4b01e6c8">slabs_per_task</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00037">37</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a140eccd2a65fea3b4e2080aea519eff1"></a><!-- doxytag: member="pm_periodic.c::slabstart_x" ref="a140eccd2a65fea3b4e2080aea519eff1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#a140eccd2a65fea3b4e2080aea519eff1">slabstart_x</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00041">41</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a17e825b584286e00d2e435dff44af196"></a><!-- doxytag: member="pm_periodic.c::slabstart_y" ref="a17e825b584286e00d2e435dff44af196" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#a17e825b584286e00d2e435dff44af196">slabstart_y</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00041">41</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="ab401ed54b1c5572b1b6a2949ffd5c1f8"></a><!-- doxytag: member="pm_periodic.c::smallest_slab" ref="ab401ed54b1c5572b1b6a2949ffd5c1f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pm__periodic_8c.html#ab401ed54b1c5572b1b6a2949ffd5c1f8">smallest_slab</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00041">41</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a2a1ee0c9996dcb96caf409aacc6888cd"></a><!-- doxytag: member="pm_periodic.c::to_slab_fac" ref="a2a1ee0c9996dcb96caf409aacc6888cd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="pm__periodic_8c.html#a2a1ee0c9996dcb96caf409aacc6888cd">to_slab_fac</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00049">49</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="pm__periodic_8c_source.html#l00055">pm_init_periodic()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
<a class="anchor" id="a182a8913bc59d672bb2a85e63ffcde0f"></a><!-- doxytag: member="pm_periodic.c::workspace" ref="a182a8913bc59d672bb2a85e63ffcde0f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fftw_real * <a class="el" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pm__periodic_8c_source.html#l00045">45</a> of file <a class="el" href="pm__periodic_8c_source.html">pm_periodic.c</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00141">geofactor_integ()</a>, <a class="el" href="driftfac_8c_source.html#l00026">init_drift_table()</a>, <a class="el" href="sidm__routines_8c_source.html#l00120">init_geofactor_table()</a>, <a class="el" href="pm__periodic_8c_source.html#l00113">pm_init_periodic_allocate()</a>, <a class="el" href="pm__periodic_8c_source.html#l00160">pm_init_periodic_free()</a>, <a class="el" href="pm__periodic_8c_source.html#l00180">pmforce_periodic()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00693">pmpotential_periodic()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="pm__periodic_8c.html">pm_periodic.c</a>      </li>

    <li class="footer">Generated on Fri Dec 6 2013 15:20:11 for gadget-sidm by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
