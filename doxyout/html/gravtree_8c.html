<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gadget-sidm: gravtree.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gadget-sidm
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('gravtree_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">gravtree.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>main driver routines for gravitational (short-range) force computation  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;float.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for gravtree.c:</div>
<div class="dyncontent">
<div class="center"><img src="gravtree_8c__incl.png" border="0" usemap="#gravtree_8c" alt=""/></div>
<map name="gravtree_8c" id="gravtree_8c">
<area shape="rect" id="node13" href="allvars_8h.html" title="declares global variables." alt="" coords="424,161,499,189"/><area shape="rect" id="node21" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="499,83,565,111"/><area shape="rect" id="node19" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="536,238,597,266"/></map>
</div>
</div>
<p><a href="gravtree_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gravtree_8c.html#ac559dc2aeb21d5a379a3751bea7736af">gravity_tree</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gravtree_8c.html#aab39b7857a85e95ef6f926ac82d4ff91">set_softenings</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gravtree_8c.html#ae9c157451dcc4cdbe02813141df2be42">grav_tree_compare_key</a> (const void *a, const void *b)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>main driver routines for gravitational (short-range) force computation </p>
<p>This file contains the code for the gravitational force computation by means of the tree algorithm. To this end, a tree force is computed for all active local particles, and particles are exported to other processors if needed, where they can receive additional force contributions. If the TreePM algorithm is enabled, the force computed will only be the short-range part. </p>

<p>Definition in file <a class="el" href="gravtree_8c_source.html">gravtree.c</a>.</p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae9c157451dcc4cdbe02813141df2be42"></a><!-- doxytag: member="gravtree.c::grav_tree_compare_key" ref="ae9c157451dcc4cdbe02813141df2be42" args="(const void *a, const void *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="proto_8h.html#ae9c157451dcc4cdbe02813141df2be42">grav_tree_compare_key</a> </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is used as a comparison kernel in a sort routine. It is used to group particles in the communication buffer that are going to be sent to the same CPU. </p>

<p>Definition at line <a class="el" href="gravtree_8c_source.html#l00551">551</a> of file <a class="el" href="gravtree_8c_source.html">gravtree.c</a>.</p>

<p>Referenced by <a class="el" href="potential_8c_source.html#l00022">compute_potential()</a>, <a class="el" href="gravtree__forcetest_8c_source.html#l00028">gravity_forcetest()</a>, and <a class="el" href="gravtree_8c_source.html#l00027">gravity_tree()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span>(((<span class="keyword">struct</span> gravdata_index *) a)-&gt;Task &lt; (((<span class="keyword">struct</span> gravdata_index *) b)-&gt;Task))
    <span class="keywordflow">return</span> -1;

  <span class="keywordflow">if</span>(((<span class="keyword">struct</span> gravdata_index *) a)-&gt;Task &gt; (((<span class="keyword">struct</span> gravdata_index *) b)-&gt;Task))
    <span class="keywordflow">return</span> +1;

  <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="gravtree_8c_ae9c157451dcc4cdbe02813141df2be42_icgraph.png" border="0" usemap="#gravtree_8c_ae9c157451dcc4cdbe02813141df2be42_icgraph" alt=""/></div>
<map name="gravtree_8c_ae9c157451dcc4cdbe02813141df2be42_icgraph" id="gravtree_8c_ae9c157451dcc4cdbe02813141df2be42_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="231,5,372,33"/><area shape="rect" id="node12" href="proto_8h.html#a51b074bdf1ec1efc0f7a323415a47e79" title="gravity_forcetest" alt="" coords="237,55,365,83"/><area shape="rect" id="node17" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="252,106,351,134"/><area shape="rect" id="node5" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="688,30,731,58"/><area shape="rect" id="node9" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="421,30,640,58"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="780,30,833,58"/><area shape="rect" id="node14" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="445,81,616,109"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac559dc2aeb21d5a379a3751bea7736af"></a><!-- doxytag: member="gravtree.c::gravity_tree" ref="ac559dc2aeb21d5a379a3751bea7736af" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af">gravity_tree</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function computes the gravitational forces for all active particles. If needed, a new tree is constructed, otherwise the dynamically updated tree is used. Particles are only exported to other processors when really needed, thereby allowing a good use of the communication buffer. </p>

<p>Definition at line <a class="el" href="gravtree_8c_source.html#l00027">27</a> of file <a class="el" href="gravtree_8c_source.html">gravtree.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8c_source.html#l00034">Exportflag</a>, <a class="el" href="allvars_8c_source.html#l00091">FdTimings</a>, <a class="el" href="forcetree_8c_source.html#l00061">force_treebuild()</a>, <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, <a class="el" href="forcetree_8c_source.html#l01542">force_treeevaluate_shortrange()</a>, <a class="el" href="gravtree_8c_source.html#l00551">grav_tree_compare_key()</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataGet</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataIn</a>, <a class="el" href="allvars_8c_source.html#l00186">GravDataIndexTable</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataOut</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataResult</a>, <a class="el" href="allvars_8c_source.html#l00016">NTask</a>, <a class="el" href="allvars_8c_source.html#l00024">NumForceUpdate</a>, <a class="el" href="allvars_8c_source.html#l00140">Numnodestree</a>, <a class="el" href="allvars_8c_source.html#l00019">NumPart</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="allvars_8c_source.html#l00017">PTask</a>, <a class="el" href="system_8c_source.html#l00049">second()</a>, <a class="el" href="gravtree_8c_source.html#l00494">set_softenings()</a>, <a class="el" href="allvars_8c_source.html#l00128">SphP</a>, <a class="el" href="tags_8h_source.html#l00013">TAG_GRAV_A</a>, <a class="el" href="tags_8h_source.html#l00014">TAG_GRAV_B</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, <a class="el" href="system_8c_source.html#l00070">timediff()</a>, and <a class="el" href="allvars_8c_source.html#l00038">TreeReconstructFlag</a>.</p>

<p>Referenced by <a class="el" href="accel_8c_source.html#l00024">compute_accelerations()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">long</span> <span class="keywordtype">long</span> ntot;
  <span class="keywordtype">int</span> numnodes, nexportsum = 0;
  <span class="keywordtype">int</span> i, j, iter = 0;
  <span class="keywordtype">int</span> *numnodeslist, maxnumnodes, nexport, *numlist, *nrecv, *ndonelist;
  <span class="keywordtype">double</span> tstart, tend, timetree = 0, timecommsumm = 0, timeimbalance = 0, sumimbalance;
  <span class="keywordtype">double</span> ewaldcount;
  <span class="keywordtype">double</span> costtotal, ewaldtot, *costtreelist, *ewaldlist;
  <span class="keywordtype">double</span> maxt, sumt, *timetreelist, *timecommlist;
  <span class="keywordtype">double</span> fac, plb, plb_max, sumcomm;

<span class="preprocessor">#ifndef NOGRAVITY</span>
<span class="preprocessor"></span>  <span class="keywordtype">int</span> *noffset, *nbuffer, *nsend, *nsend_local;
  <span class="keywordtype">long</span> <span class="keywordtype">long</span> ntotleft;
  <span class="keywordtype">int</span> ndone, maxfill, ngrp;
  <span class="keywordtype">int</span> k, place;
  <span class="keywordtype">int</span> level, sendTask, recvTask;
  <span class="keywordtype">double</span> ax, ay, az;
  MPI_Status status;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef COMPUTE_SELFINTERACTION_FORDARK</span>
<span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *Nself_interactionsList;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">/* set new softening lengths */</span>
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
    <a class="code" href="gravtree_8c.html#aab39b7857a85e95ef6f926ac82d4ff91">set_softenings</a>();


  <span class="comment">/* contruct tree if needed */</span>
  tstart = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#aa32d7269f9baf3ffdbdd509982fca128">TreeReconstructFlag</a>)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;Tree construction.\n&quot;</span>);

      <a class="code" href="forcetree_8c.html#a10f92098e86f82baec9f84a283f4c9e5">force_treebuild</a>(<a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>);

      <a class="code" href="allvars_8c.html#aa32d7269f9baf3ffdbdd509982fca128">TreeReconstructFlag</a> = 0;

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;Tree construction done.\n&quot;</span>);
    }
  tend = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.CPU_TreeConstruction += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(tstart, tend);

  costtotal = ewaldcount = 0;

  <span class="comment">/* Note: &#39;NumForceUpdate&#39; has already been determined in find_next_sync_point_and_drift() */</span>
  numlist = malloc(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);
  MPI_Allgather(&amp;<a class="code" href="allvars_8c.html#a4c8b412a9883b4f6e0e8962ba54fd4ef">NumForceUpdate</a>, 1, MPI_INT, numlist, 1, MPI_INT, MPI_COMM_WORLD);
  <span class="keywordflow">for</span>(i = 0, ntot = 0; i &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; i++)
    ntot += numlist[i];
  free(numlist);


<span class="preprocessor">#ifndef NOGRAVITY</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    printf(<span class="stringliteral">&quot;Begin tree force.\n&quot;</span>);


<span class="preprocessor">#ifdef SELECTIVE_NO_GRAVITY</span>
<span class="preprocessor"></span>  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    <span class="keywordflow">if</span>(((1 &lt;&lt; <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Type) &amp; (SELECTIVE_NO_GRAVITY)))
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep = -<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep - 1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef COMPUTE_SELFINTERACTION_FORDARK</span>
<span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactions = 0;
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactionsSum = 0;
  <span class="keywordflow">for</span> (i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
    <span class="keywordflow">for</span>(j = 0; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
      InteractionTable[i][j] = 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  noffset = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NTask);        <span class="comment">/* offsets of bunches in common list */</span>
  nbuffer = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NTask);
  nsend_local = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NTask);
  nsend = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NTask * NTask);
  ndonelist = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NTask);

  i = 0;                        <span class="comment">/* beginn with this index */</span>
  ntotleft = ntot;              <span class="comment">/* particles left for all tasks together */</span>

  <span class="keywordflow">while</span>(ntotleft &gt; 0)
    {
      iter++;

      <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
        nsend_local[j] = 0;

      <span class="comment">/* do local particles and prepare export list */</span>
      tstart = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
      <span class="keywordflow">for</span>(nexport = 0, ndone = 0; i &lt; NumPart &amp;&amp; nexport &lt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BunchSizeForce - <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; i++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep == <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current)
          {
            ndone++;

            <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
              <a class="code" href="allvars_8c.html#a768b23818449e1b33a55747cb3cc2025">Exportflag</a>[j] = 0;
<span class="preprocessor">#ifndef PMGRID</span>
<span class="preprocessor"></span>            costtotal += <a class="code" href="forcetree_8c.html#a59ae74ef51d6a7065605638422489391">force_treeevaluate</a>(i, 0, &amp;ewaldcount);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>            costtotal += <a class="code" href="forcetree_8c.html#ae01e179b7686a7fe62970160b7bbdb46">force_treeevaluate_shortrange</a>(i, 0);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
              {
                <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a768b23818449e1b33a55747cb3cc2025">Exportflag</a>[j])
                  {
                    <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
                      <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].u.Pos[k] = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[k];
#ifdef COMPUTE_SELFINTERACTION_FORDARK
                    <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
                      <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].Vel[k] = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Vel[k];                  
                    <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].Ti_begstep = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_begstep;
                    <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].Ti_endstep = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep;
                    <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].dTi_selfInt = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].dTi_selfInt;
                    <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].ID = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].ID;
                    <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].Type = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Type;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef UNEQUALSOFTENINGS</span>
<span class="preprocessor"></span>                    <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].Type = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Type;
<span class="preprocessor">#ifdef ADAPTIVE_GRAVSOFT_FORGAS</span>
<span class="preprocessor"></span>                    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Type == 0)
                      <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].Soft = <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Hsml;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                    <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nexport].w.OldAcc = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].OldAcc;
                    <a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a>[nexport].Task = j;
                    <a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a>[nexport].Index = i;
                    <a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a>[nexport].SortIndex = nexport;
                    nexport++;
                    nexportsum++;
                    nsend_local[j]++;
                  }
              }
          }
      tend = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
      timetree += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(tstart, tend);

      qsort(<a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a>, nexport, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> gravdata_index), <a class="code" href="gravtree_8c.html#ae9c157451dcc4cdbe02813141df2be42">grav_tree_compare_key</a>);

      <span class="keywordflow">for</span>(j = 0; j &lt; nexport; j++)
        <a class="code" href="allvars_8c.html#aeb6d889627ff712e7f0f30510842eb2c">GravDataIn</a>[j] = <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[<a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a>[j].SortIndex];

      <span class="keywordflow">for</span>(j = 1, noffset[0] = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
        noffset[j] = noffset[j - 1] + nsend_local[j - 1];

      tstart = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();

      MPI_Allgather(nsend_local, NTask, MPI_INT, nsend, NTask, MPI_INT, MPI_COMM_WORLD);

      tend = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
      timeimbalance += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(tstart, tend);

      <span class="comment">/* now do the particles that need to be exported */</span>

      <span class="keywordflow">for</span>(level = 1; level &lt; (1 &lt;&lt; <a class="code" href="allvars_8c.html#a9a18606803f69f24d3cb2864640c122e">PTask</a>); level++)
        {
          tstart = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
            nbuffer[j] = 0;
          <span class="keywordflow">for</span>(ngrp = level; ngrp &lt; (1 &lt;&lt; <a class="code" href="allvars_8c.html#a9a18606803f69f24d3cb2864640c122e">PTask</a>); ngrp++)
            {
              maxfill = 0;
              <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
                {
                  <span class="keywordflow">if</span>((j ^ ngrp) &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
                    <span class="keywordflow">if</span>(maxfill &lt; nbuffer[j] + nsend[(j ^ ngrp) * NTask + j])
                      maxfill = nbuffer[j] + nsend[(j ^ ngrp) * NTask + j];
                }
              <span class="keywordflow">if</span>(maxfill &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BunchSizeForce)
                <span class="keywordflow">break</span>;

              sendTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;
              recvTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> ^ ngrp;

              <span class="keywordflow">if</span>(recvTask &lt; NTask)
                {
                  <span class="keywordflow">if</span>(nsend[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> * NTask + recvTask] &gt; 0 || nsend[recvTask * NTask + <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>] &gt; 0)
                    {
                      <span class="comment">/* get the particles */</span>
                      MPI_Sendrecv(&amp;<a class="code" href="allvars_8c.html#aeb6d889627ff712e7f0f30510842eb2c">GravDataIn</a>[noffset[recvTask]],
                                   nsend_local[recvTask] * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> gravdata_in), MPI_BYTE,
                                   recvTask, <a class="code" href="tags_8h.html#ab06a1de467a388455caae6dacd9d91cd">TAG_GRAV_A</a>,
                                   &amp;<a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>[nbuffer[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>]],
                                   nsend[recvTask * NTask + ThisTask] * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> gravdata_in), MPI_BYTE,
                                   recvTask, <a class="code" href="tags_8h.html#ab06a1de467a388455caae6dacd9d91cd">TAG_GRAV_A</a>, MPI_COMM_WORLD, &amp;status);
                    }
                }

              <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
                <span class="keywordflow">if</span>((j ^ ngrp) &lt; NTask)
                  nbuffer[j] += nsend[(j ^ ngrp) * NTask + j];
            }
          tend = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          timecommsumm += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(tstart, tend);


          tstart = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          <span class="keywordflow">for</span>(j = 0; j &lt; nbuffer[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>]; j++)
            {
<span class="preprocessor">#ifndef PMGRID</span>
<span class="preprocessor"></span>              costtotal += <a class="code" href="forcetree_8c.html#a59ae74ef51d6a7065605638422489391">force_treeevaluate</a>(j, 1, &amp;ewaldcount);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>              costtotal += <a class="code" href="forcetree_8c.html#ae01e179b7686a7fe62970160b7bbdb46">force_treeevaluate_shortrange</a>(j, 1);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            }
          tend = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          timetree += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(tstart, tend);

          tstart = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          MPI_Barrier(MPI_COMM_WORLD);
          tend = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          timeimbalance += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(tstart, tend);

          <span class="comment">/* get the result */</span>
          tstart = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
            nbuffer[j] = 0;
          <span class="keywordflow">for</span>(ngrp = level; ngrp &lt; (1 &lt;&lt; <a class="code" href="allvars_8c.html#a9a18606803f69f24d3cb2864640c122e">PTask</a>); ngrp++)
            {
              maxfill = 0;
              <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
                {
                  <span class="keywordflow">if</span>((j ^ ngrp) &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
                    <span class="keywordflow">if</span>(maxfill &lt; nbuffer[j] + nsend[(j ^ ngrp) * NTask + j])
                      maxfill = nbuffer[j] + nsend[(j ^ ngrp) * NTask + j];
                }
              <span class="keywordflow">if</span>(maxfill &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BunchSizeForce)
                <span class="keywordflow">break</span>;

              sendTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>;
              recvTask = <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> ^ ngrp;
              <span class="keywordflow">if</span>(recvTask &lt; NTask)
                {
                  <span class="keywordflow">if</span>(nsend[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> * NTask + recvTask] &gt; 0 || nsend[recvTask * NTask + <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>] &gt; 0)
                    {
                      <span class="comment">/* send the results */</span>
                      MPI_Sendrecv(&amp;<a class="code" href="allvars_8c.html#a1aab0f29675c0745b5c2887e4791c070">GravDataResult</a>[nbuffer[<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>]],
                                   nsend[recvTask * NTask + ThisTask] * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> gravdata_in),
                                   MPI_BYTE, recvTask, <a class="code" href="tags_8h.html#aa45a8037459a1e2b706c535a63594b73">TAG_GRAV_B</a>,
                                   &amp;<a class="code" href="allvars_8c.html#a7b537ba13fc3cfff5d6fbb245e892fb6">GravDataOut</a>[noffset[recvTask]],
                                   nsend_local[recvTask] * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> gravdata_in),
                                   MPI_BYTE, recvTask, <a class="code" href="tags_8h.html#aa45a8037459a1e2b706c535a63594b73">TAG_GRAV_B</a>, MPI_COMM_WORLD, &amp;status);

                      <span class="comment">/* add the result to the particles */</span>
                      <span class="keywordflow">for</span>(j = 0; j &lt; nsend_local[recvTask]; j++)
                        {
                          place = <a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a>[noffset[recvTask] + j].Index;

                          <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
                            <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[place].GravAccel[k] += <a class="code" href="allvars_8c.html#a7b537ba13fc3cfff5d6fbb245e892fb6">GravDataOut</a>[j + noffset[recvTask]].u.Acc[k];
#ifdef COMPUTE_SELFINTERACTION_FORDARK
                          <span class="keywordflow">if</span>( <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ErrTolTheta == 0 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TypeOfOpeningCriterion == 0)
                            {
                              <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
                                <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[place].Vel[k] += <a class="code" href="allvars_8c.html#a7b537ba13fc3cfff5d6fbb245e892fb6">GravDataOut</a>[j + noffset[recvTask]].Vel[k];
                              <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[place].dTi_selfInt = <a class="code" href="allvars_8c.html#a7b537ba13fc3cfff5d6fbb245e892fb6">GravDataOut</a>[j + noffset[recvTask]].dTi_selfInt;
                            }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                          <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[place].GravCost += <a class="code" href="allvars_8c.html#a7b537ba13fc3cfff5d6fbb245e892fb6">GravDataOut</a>[j + noffset[recvTask]].w.Ninteractions;
                        }
                    }
                }

              <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
                <span class="keywordflow">if</span>((j ^ ngrp) &lt; NTask)
                  nbuffer[j] += nsend[(j ^ ngrp) * NTask + j];
            }
          tend = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();
          timecommsumm += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(tstart, tend);

          level = ngrp - 1;
        }

      MPI_Allgather(&amp;ndone, 1, MPI_INT, ndonelist, 1, MPI_INT, MPI_COMM_WORLD);
      <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
        ntotleft -= ndonelist[j];
    }

  free(ndonelist);
  free(nsend);
  free(nsend_local);
  free(nbuffer);
  free(noffset);

  <span class="comment">/* now add things for comoving integration */</span>

<span class="preprocessor">#ifndef PERIODIC</span>
<span class="preprocessor"></span><span class="preprocessor">#ifndef PMGRID</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
    {
      fac = 0.5 * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Hubble * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Hubble * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Omega0 / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.G;

      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep == <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current)
          <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
            <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[j] += fac * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[j];
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep == <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current)
      {
<span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>        ax = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[0] + <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravPM[0] / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.G;
        ay = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[1] + <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravPM[1] / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.G;
        az = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[2] + <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravPM[2] / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.G;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        ax = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[0];
        ay = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[1];
        az = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[2];
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].OldAcc = sqrt(ax * ax + ay * ay + az * az);
      }


  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TypeOfOpeningCriterion == 1)
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ErrTolTheta = 0;        <span class="comment">/* This will switch to the relative opening criterion for the following force computations */</span>

  <span class="comment">/*  muliply by G */</span>
  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep == <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current)
      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[j] *= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.G;


  <span class="comment">/* Finally, the following factor allows a computation of a cosmological simulation </span>
<span class="comment">     with vacuum energy in physical coordinates */</span>
#ifndef PERIODIC
#ifndef PMGRID
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn == 0)
    {
      fac = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.OmegaLambda * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Hubble * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Hubble;

      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep == <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current)
          <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
            <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[j] += fac * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Pos[j];
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef SELECTIVE_NO_GRAVITY</span>
<span class="preprocessor"></span>  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep &lt; 0)
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep = -<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep - 1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span>(ThisTask == 0)
    printf(<span class="stringliteral">&quot;tree is done.\n&quot;</span>);

<span class="preprocessor">#else </span><span class="comment">/* gravity is switched off */</span>

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Ti_endstep == <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current)
      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[j] = 0;

<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>



  <span class="comment">/* Now the force computation is finished */</span>

  <span class="comment">/*  gather some diagnostic information */</span>

  timetreelist = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * NTask);
  timecommlist = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * NTask);
  costtreelist = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * NTask);
  numnodeslist = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NTask);
  ewaldlist = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * NTask);
  nrecv = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * NTask);

  numnodes = <a class="code" href="allvars_8c.html#acf4151281b98d29aa500c5e56e66741f">Numnodestree</a>;

  MPI_Gather(&amp;costtotal, 1, MPI_DOUBLE, costtreelist, 1, MPI_DOUBLE, 0, MPI_COMM_WORLD);
  MPI_Gather(&amp;numnodes, 1, MPI_INT, numnodeslist, 1, MPI_INT, 0, MPI_COMM_WORLD);
  MPI_Gather(&amp;timetree, 1, MPI_DOUBLE, timetreelist, 1, MPI_DOUBLE, 0, MPI_COMM_WORLD);
  MPI_Gather(&amp;timecommsumm, 1, MPI_DOUBLE, timecommlist, 1, MPI_DOUBLE, 0, MPI_COMM_WORLD);
  MPI_Gather(&amp;NumPart, 1, MPI_INT, nrecv, 1, MPI_INT, 0, MPI_COMM_WORLD);
  MPI_Gather(&amp;ewaldcount, 1, MPI_DOUBLE, ewaldlist, 1, MPI_DOUBLE, 0, MPI_COMM_WORLD);
  MPI_Reduce(&amp;nexportsum, &amp;nexport, 1, MPI_INT, MPI_SUM, 0, MPI_COMM_WORLD);
  MPI_Reduce(&amp;timeimbalance, &amp;sumimbalance, 1, MPI_DOUBLE, MPI_SUM, 0, MPI_COMM_WORLD);

<span class="preprocessor">#ifdef COMPUTE_SELFINTERACTION_FORDARK</span>
<span class="preprocessor"></span>  Nself_interactionsList = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) * NTask);
  MPI_Gather(&amp;<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactions, 1, MPI_UNSIGNED_LONG, Nself_interactionsList, 1, MPI_UNSIGNED_LONG, 0, MPI_COMM_WORLD);
  <span class="keywordflow">if</span>(ThisTask == 0)
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; i++)
        {
          <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactionsSum += Nself_interactionsList[i];
        }
    }
  free(Nself_interactionsList);  
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span>(ThisTask == 0)
    {
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TotNumOfForces += ntot;

      fprintf(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>, <span class="stringliteral">&quot;Step= %d  t= %g  dt= %g \n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumCurrentTiStep, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TimeStep);
      fprintf(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>, <span class="stringliteral">&quot;Nf= %d%09d  total-Nf= %d%09d  ex-frac= %g  iter= %d\n&quot;</span>,
              (<span class="keywordtype">int</span>) (ntot / 1000000000), (<span class="keywordtype">int</span>) (ntot % 1000000000),
              (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TotNumOfForces / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TotNumOfForces % 1000000000),
              nexport / ((<span class="keywordtype">double</span>) ntot), iter);
      <span class="comment">/* note: on Linux, the 8-byte integer could be printed with the format identifier &quot;%qd&quot;, but doesn&#39;t work on AIX */</span>

      fac = NTask / ((double) <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TotNumPart);

      <span class="keywordflow">for</span>(i = 0, maxt = timetreelist[0], sumt = 0, plb_max = 0,
          maxnumnodes = 0, costtotal = 0, sumcomm = 0, ewaldtot = 0; i &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; i++)
        {
          costtotal += costtreelist[i];

          sumcomm += timecommlist[i];

          <span class="keywordflow">if</span>(maxt &lt; timetreelist[i])
            maxt = timetreelist[i];
          sumt += timetreelist[i];

          plb = nrecv[i] * fac;

          <span class="keywordflow">if</span>(plb &gt; plb_max)
            plb_max = plb;

          <span class="keywordflow">if</span>(numnodeslist[i] &gt; maxnumnodes)
            maxnumnodes = numnodeslist[i];

          ewaldtot += ewaldlist[i];
        }
      fprintf(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>, <span class="stringliteral">&quot;work-load balance: %g  max=%g avg=%g PE0=%g\n&quot;</span>,
              maxt / (sumt / NTask), maxt, sumt / NTask, timetreelist[0]);
      fprintf(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>, <span class="stringliteral">&quot;particle-load balance: %g\n&quot;</span>, plb_max);
      fprintf(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>, <span class="stringliteral">&quot;max. nodes: %d, filled: %g\n&quot;</span>, maxnumnodes,
              maxnumnodes / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TreeAllocFactor * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MaxPart));
      fprintf(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>, <span class="stringliteral">&quot;part/sec=%g | %g  ia/part=%g (%g)\n&quot;</span>, ntot / (sumt + 1.0e-20),
              ntot / (maxt * NTask), ((<span class="keywordtype">double</span>) (costtotal)) / ntot, ((<span class="keywordtype">double</span>) ewaldtot) / ntot);
      fprintf(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>, <span class="stringliteral">&quot;\n&quot;</span>);

      fflush(<a class="code" href="allvars_8c.html#a603fc3e63a037dff4463c67aa7a4c91e">FdTimings</a>);

      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.CPU_TreeWalk += sumt / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>;
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.CPU_Imbalance += sumimbalance / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>;
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.CPU_CommSum += sumcomm / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>;
    }

  free(nrecv);
  free(ewaldlist);
  free(numnodeslist);
  free(costtreelist);
  free(timecommlist);
  free(timetreelist);
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_cgraph.png" border="0" usemap="#gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_cgraph" alt=""/></div>
<map name="gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_cgraph" id="gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_cgraph">
<area shape="rect" id="node3" href="forcetree_8c.html#a10f92098e86f82baec9f84a283f4c9e5" title="force_treebuild" alt="" coords="181,427,299,455"/><area shape="rect" id="node40" href="forcetree_8c.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="937,209,1079,237"/><area shape="rect" id="node56" href="forcetree_8c.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="899,133,1117,161"/><area shape="rect" id="node63" href="gravtree_8c.html#ae9c157451dcc4cdbe02813141df2be42" title="grav_tree_compare_key" alt="" coords="152,478,328,506"/><area shape="rect" id="node65" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174" title="second" alt="" coords="207,529,273,557"/><area shape="rect" id="node67" href="gravtree_8c.html#aab39b7857a85e95ef6f926ac82d4ff91" title="set_softenings" alt="" coords="183,579,297,607"/><area shape="rect" id="node69" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d" title="timediff" alt="" coords="205,661,275,689"/><area shape="rect" id="node5" href="forcetree_8c.html#a947a734f3bbba14d4092c7480880d3c7" title="force_flag_localnodes" alt="" coords="405,411,563,439"/><area shape="rect" id="node7" href="forcetree_8c.html#aadc9b1624ed78f3ccd0dbb9908fe0bb6" title="force_treebuild_single" alt="" coords="404,462,564,490"/><area shape="rect" id="node34" href="forcetree_8c.html#af9a7e3a922557e089da5d7ee1dde89a0" title="force_update_pseudoparticles" alt="" coords="377,673,591,701"/><area shape="rect" id="node9" href="forcetree_8c.html#ab303b92c6d6b4144999c5cebabd65ec0" title="dump_particles" alt="" coords="948,587,1068,615"/><area shape="rect" id="node13" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="1469,361,1536,389"/><area shape="rect" id="node18" href="forcetree_8c.html#a8eaedfa5c6d72bca79b465003679ed89" title="force_create_empty_nodes" alt="" coords="648,587,843,615"/><area shape="rect" id="node23" href="peano_8c.html#a9eec17b80ae63eb79e98064f2d4f25df" title="peano_hilbert_key" alt="" coords="939,467,1077,495"/><area shape="rect" id="node25" href="forcetree_8c.html#ad9e0a57b7577d64a315c142e197d292d" title="force_insert_pseudo_particles" alt="" coords="903,411,1113,439"/><area shape="rect" id="node28" href="forcetree_8c.html#ab745c54c805d07ad255a3f86ff77e18d" title="force_update_node_recursive" alt="" coords="640,361,851,389"/><area shape="rect" id="node31" href="proto_8h.html#a0d508d57eb6f608ff6eec8ac11bb9c05" title="get_random_number" alt="" coords="667,513,824,541"/><area shape="rect" id="node11" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21" title="my_fwrite" alt="" coords="1252,575,1335,603"/><area shape="rect" id="node15" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="1584,361,1741,389"/><area shape="rect" id="node36" href="forcetree_8c.html#aaabf16b5e99c9ac6bc6bbe039756bddb" title="force_exchange_pseudodata" alt="" coords="643,739,848,767"/><area shape="rect" id="node38" href="forcetree_8c.html#ab8e5d4fed349d96c6d4f55897473ce19" title="force_treeupdate_pseudos" alt="" coords="649,689,841,717"/><area shape="rect" id="node42" href="sidm__routines_8c.html#a7601ceef7848e2277fd5dd1f2800dfd9" title="calculate_interact_kick" alt="" coords="1211,158,1376,186"/><area shape="rect" id="node44" href="sidm__routines_8c.html#a06b0e0f213ae5bd086307e76cddc68a4" title="check_interaction_table" alt="" coords="1207,107,1380,135"/><area shape="rect" id="node47" href="forcetree_8c.html#ab6894fe5ae268ea8f6bc7c4a8c87a87f" title="force_treeevaluate_ewald_correction" alt="" coords="1165,259,1421,287"/><area shape="rect" id="node49" href="sidm__routines_8c.html#a5b36e92449c7102086706b7b24899be8" title="prob_of_interaction" alt="" coords="1221,57,1365,85"/><area shape="rect" id="node53" href="sidm__routines_8c.html#a07ab80a1f9370ead2bc2a38884436615" title="update_interaction_table" alt="" coords="1203,209,1384,237"/><area shape="rect" id="node51" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d" title="g_geo" alt="" coords="1472,57,1533,85"/><area shape="rect" id="node71" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="461,723,507,751"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_icgraph.png" border="0" usemap="#gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_icgraph" alt=""/></div>
<map name="gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_icgraph" id="gravtree_8c_ac559dc2aeb21d5a379a3751bea7736af_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="152,5,323,33"/><area shape="rect" id="node5" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="371,5,413,33"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="463,5,516,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aab39b7857a85e95ef6f926ac82d4ff91"></a><!-- doxytag: member="gravtree.c::set_softenings" ref="aab39b7857a85e95ef6f926ac82d4ff91" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#aab39b7857a85e95ef6f926ac82d4ff91">set_softenings</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function sets the (comoving) softening length of all particle types in the table All.SofteningTable[...]. We check that the physical softening length is bounded by the Softening-MaxPhys values. </p>

<p>Definition at line <a class="el" href="gravtree_8c_source.html#l00494">494</a> of file <a class="el" href="gravtree_8c_source.html">gravtree.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>.</p>

<p>Referenced by <a class="el" href="potential_8c_source.html#l00022">compute_potential()</a>, <a class="el" href="gravtree__forcetest_8c_source.html#l00028">gravity_forcetest()</a>, <a class="el" href="gravtree_8c_source.html#l00027">gravity_tree()</a>, and <a class="el" href="init_8c_source.html#l00020">init()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningGas * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningGasMaxPhys)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[0] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningGasMaxPhys / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;
      <span class="keywordflow">else</span>
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[0] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningGas;
      
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningHalo * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningHaloMaxPhys)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[1] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningHaloMaxPhys / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;
      <span class="keywordflow">else</span>
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[1] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningHalo;
      
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningDisk * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningDiskMaxPhys)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[2] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningDiskMaxPhys / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;
      <span class="keywordflow">else</span>
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[2] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningDisk;
      
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBulge * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBulgeMaxPhys)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[3] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBulgeMaxPhys / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;
      <span class="keywordflow">else</span>
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[3] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBulge;
      
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningStars * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningStarsMaxPhys)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[4] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningStarsMaxPhys / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;
      <span class="keywordflow">else</span>
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[4] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningStars;
      
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBndry * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBndryMaxPhys)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[5] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBndryMaxPhys / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;
      <span class="keywordflow">else</span>
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[5] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBndry;
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[0] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningGas;
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[1] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningHalo;
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[2] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningDisk;
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[3] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBulge;
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[4] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningStars;
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[5] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningBndry;
    }

  <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ForceSoftening[i] = 2.8 * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SofteningTable[i];

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MinGasHsml = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MinGasHsmlFractional * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ForceSoftening[0];
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="gravtree_8c_aab39b7857a85e95ef6f926ac82d4ff91_icgraph.png" border="0" usemap="#gravtree_8c_aab39b7857a85e95ef6f926ac82d4ff91_icgraph" alt=""/></div>
<map name="gravtree_8c_aab39b7857a85e95ef6f926ac82d4ff91_icgraph" id="gravtree_8c_aab39b7857a85e95ef6f926ac82d4ff91_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="169,5,311,33"/><area shape="rect" id="node12" href="proto_8h.html#a51b074bdf1ec1efc0f7a323415a47e79" title="gravity_forcetest" alt="" coords="176,55,304,83"/><area shape="rect" id="node17" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="191,106,289,134"/><area shape="rect" id="node20" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="449,157,489,185"/><area shape="rect" id="node5" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="639,81,681,109"/><area shape="rect" id="node9" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="360,55,579,83"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="743,106,796,134"/><area shape="rect" id="node14" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="384,106,555,134"/><area shape="rect" id="node22" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="627,131,693,159"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="gravtree_8c.html">gravtree.c</a>      </li>

    <li class="footer">Generated on Fri Dec 6 2013 15:20:10 for gadget-sidm by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
