<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gadget-sidm: io.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gadget-sidm
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('io_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">io.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Routines for producing a snapshot file on disk.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;hdf5.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for io.c:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c__incl.png" border="0" usemap="#io_8c" alt=""/></div>
<map name="io_8c" id="io_8c">
<area shape="rect" id="node17" href="allvars_8h.html" title="declares global variables." alt="" coords="547,161,621,189"/><area shape="rect" id="node24" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="529,83,596,111"/><area shape="rect" id="node22" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="605,238,667,266"/></map>
</div>
</div>
<p><a href="io_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>&#160;&#160;&#160;{<a class="el" href="proto_8h.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(&amp;blksize,sizeof(int),1,<a class="el" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);}</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a523730833804b6d92aa7f4dd474805c5">savepositions</a> (int num)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a4b34f2381777023014f80c959ad1f88a">fill_write_buffer</a> (enum iofields blocknr, int *startindex, int pc, int type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c">get_bytes_per_blockelement</a> (enum iofields blocknr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1">get_datatype_in_block</a> (enum iofields blocknr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a> (enum iofields blocknr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9">get_particles_in_block</a> (enum iofields blocknr, int *typelist)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e">blockpresent</a> (enum iofields blocknr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345">fill_Tab_IO_Labels</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686">get_dataset_name</a> (enum iofields blocknr, char *buf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a2b3f5bacd7313da0f3ffa55e41907481">write_file</a> (char *fname, int writeTask, int lastTask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#ad5243b69dcba17be62f7d64f422bfbbf">write_header_attributes_in_hdf5</a> (hid_t handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a> (void *ptr, size_t size, size_t nmemb, FILE *stream)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a> (void *ptr, size_t size, size_t nmemb, FILE *stream)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a> [6]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static long long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a3cfb701790acb5a9b71ba995148bbf40">ntot_type_all</a> [6]</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Routines for producing a snapshot file on disk. </p>

<p>Definition in file <a class="el" href="io_8c_source.html">io.c</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a688a4adbb87520a2b68681bd6bfb199e"></a><!-- doxytag: member="io.c::SKIP" ref="a688a4adbb87520a2b68681bd6bfb199e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="read__ic_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>&#160;&#160;&#160;{<a class="el" href="proto_8h.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(&amp;blksize,sizeof(int),1,<a class="el" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad9c685a2d6d48224bfec61680ce82b1e"></a><!-- doxytag: member="io.c::blockpresent" ref="ad9c685a2d6d48224bfec61680ce82b1e" args="(enum iofields blocknr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="proto_8h.html#ad9c685a2d6d48224bfec61680ce82b1e">blockpresent</a> </td>
          <td>(</td>
          <td class="paramtype">enum iofields&#160;</td>
          <td class="paramname"><em>blocknr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function tells whether or not a given block in the output file is present, depending on the type of simulation run and the compile-time options. If one wants to add a new output-block, this function should be augmented accordingly. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00532">532</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{

<span class="preprocessor">#ifndef OUTPUTPOTENTIAL</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(blocknr == IO_POT)
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifndef OUTPUTACCELERATION</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(blocknr == IO_ACCEL)
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifndef OUTPUTCHANGEOFENTROPY</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(blocknr == IO_DTENTR)
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifndef OUTPUTTIMESTEP</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(blocknr == IO_TSTP)
    <span class="keywordflow">return</span> 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">return</span> 1;                     <span class="comment">/* default: present */</span>
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_ad9c685a2d6d48224bfec61680ce82b1e_icgraph.png" border="0" usemap="#io_8c_ad9c685a2d6d48224bfec61680ce82b1e_icgraph" alt=""/></div>
<map name="io_8c_ad9c685a2d6d48224bfec61680ce82b1e_icgraph" id="io_8c_ad9c685a2d6d48224bfec61680ce82b1e_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="159,5,233,33"/><area shape="rect" id="node13" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="157,55,235,83"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="304,5,371,33"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="529,5,569,33"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="707,5,773,33"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="823,30,876,58"/><area shape="rect" id="node15" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="283,55,392,83"/><area shape="rect" id="node17" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="719,55,761,83"/><area shape="rect" id="node20" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="440,106,659,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a10281a87abe1e07d6ca603de6a533345"></a><!-- doxytag: member="io.c::fill_Tab_IO_Labels" ref="a10281a87abe1e07d6ca603de6a533345" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#a10281a87abe1e07d6ca603de6a533345">fill_Tab_IO_Labels</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function associates a short 4-character block name with each block number. This is stored in front of each block for snapshot FileFormat=2. If one wants to add a new output-block, this function should be augmented accordingly. </p>
<p>&lt; total number of defined information blocks for snapshot files. Must be equal to the number of entries in "enum iofields" </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00566">566</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00167">Tab_IO_Labels</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00031">read_ic()</a>, and <a class="el" href="io_8c_source.html#l00033">savepositions()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keyword">enum</span> iofields i;

  <span class="keywordflow">for</span>(i = 0; i &lt; IO_NBLOCKS; i++)
    <span class="keywordflow">switch</span> (i)
      {
      <span class="keywordflow">case</span> IO_POS:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_POS], <span class="stringliteral">&quot;POS &quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_VEL:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_VEL], <span class="stringliteral">&quot;VEL &quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_ID:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_ID], <span class="stringliteral">&quot;ID  &quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_MASS:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_MASS], <span class="stringliteral">&quot;MASS&quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_U:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_U], <span class="stringliteral">&quot;U   &quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_RHO:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_RHO], <span class="stringliteral">&quot;RHO &quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_HSML:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_HSML], <span class="stringliteral">&quot;HSML&quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_POT:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_POT], <span class="stringliteral">&quot;POT &quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_ACCEL:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_ACCEL], <span class="stringliteral">&quot;ACCE&quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_DTENTR:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_DTENTR], <span class="stringliteral">&quot;ENDT&quot;</span>, 4);
        <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> IO_TSTP:
        strncpy(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[IO_TSTP], <span class="stringliteral">&quot;TSTP&quot;</span>, 4);
        <span class="keywordflow">break</span>;
      }
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a10281a87abe1e07d6ca603de6a533345_icgraph.png" border="0" usemap="#io_8c_a10281a87abe1e07d6ca603de6a533345_icgraph" alt=""/></div>
<map name="io_8c_a10281a87abe1e07d6ca603de6a533345_icgraph" id="io_8c_a10281a87abe1e07d6ca603de6a533345_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="208,5,275,33"/><area shape="rect" id="node11" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="187,55,296,83"/><area shape="rect" id="node5" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="433,5,473,33"/><area shape="rect" id="node7" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="611,5,677,33"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="727,30,780,58"/><area shape="rect" id="node13" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="623,55,665,83"/><area shape="rect" id="node16" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="344,106,563,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4b34f2381777023014f80c959ad1f88a"></a><!-- doxytag: member="io.c::fill_write_buffer" ref="a4b34f2381777023014f80c959ad1f88a" args="(enum iofields blocknr, int *startindex, int pc, int type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#aea8fa222a10c4796687c6ff25550cd74">fill_write_buffer</a> </td>
          <td>(</td>
          <td class="paramtype">enum iofields&#160;</td>
          <td class="paramname"><em>blocknr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>startindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function fills the write buffer with particle data. New output blocks can in principle be added here. </p>
<p>&lt; adiabatic index of simulated gas</p>
<p>&lt; adiabatic index of simulated gas</p>
<p>&lt; adiabatic index of simulated gas </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00129">129</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="hydra_8c_source.html#l00019">a3inv</a>, <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="density_8c_source.html#l00022">boxSize</a>, <a class="el" href="allvars_8c_source.html#l00102">CommBuffer</a>, <a class="el" href="system_8c_source.html#l00091">dmax()</a>, <a class="el" href="timestep_8c_source.html#l00013">fac1</a>, <a class="el" href="timestep_8c_source.html#l00013">fac2</a>, <a class="el" href="driftfac_8c_source.html#l00105">get_gravkick_factor()</a>, <a class="el" href="driftfac_8c_source.html#l00142">get_hydrokick_factor()</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow()</a>, and <a class="el" href="allvars_8c_source.html#l00128">SphP</a>.</p>

<p>Referenced by <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> n, k, pindex;
  <span class="keywordtype">float</span> *fp;

<span class="preprocessor">#ifdef LONGIDS</span>
<span class="preprocessor"></span>  <span class="keywordtype">long</span> <span class="keywordtype">long</span> *ip;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <span class="keywordtype">int</span> *ip;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>  FLOAT <a class="code" href="density_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>  <span class="keywordtype">double</span> dt_gravkick_pm = 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  <span class="keywordtype">double</span> dt_gravkick, dt_hydrokick, <a class="code" href="hydra_8c.html#a7f2a6bb4bade30e4e04ee29be22d0962">a3inv</a> = 1, <a class="code" href="timestep_8c.html#a59a20f8242197c1ba41f7a0b1b880d62">fac1</a>, <a class="code" href="timestep_8c.html#a1a666a0983f6d540fa41ec867aa40d09">fac2</a>;


  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
    {
      a3inv = 1 / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time);
      <a class="code" href="timestep_8c.html#a59a20f8242197c1ba41f7a0b1b880d62">fac1</a> = 1 / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time);
      fac2 = 1 / <a class="code" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time, 3 * GAMMA - 2);
    }
  <span class="keywordflow">else</span>
    a3inv = <a class="code" href="timestep_8c.html#a59a20f8242197c1ba41f7a0b1b880d62">fac1</a> = fac2 = 1;

<span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
    dt_gravkick_pm =
      <a class="code" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059">get_gravkick_factor</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.PM_Ti_begstep,
                          <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current) -
      <a class="code" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059">get_gravkick_factor</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.PM_Ti_begstep, (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.PM_Ti_begstep + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.PM_Ti_endstep) / 2);
  <span class="keywordflow">else</span>
    dt_gravkick_pm = (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current - (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.PM_Ti_begstep + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.PM_Ti_endstep) / 2) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Timebase_interval;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>


  fp = <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
  ip = <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;

  pindex = *startindex;

  <span class="keywordflow">switch</span> (blocknr)
    {
    <span class="keywordflow">case</span> IO_POS:                <span class="comment">/* positions */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
              {
                fp[k] = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Pos[k];
<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>                boxSize = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize;
<span class="preprocessor">#ifdef LONG_X</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span>(k == 0)
                  boxSize = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize * LONG_X;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef LONG_Y</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span>(k == 1)
                  boxSize = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize * LONG_Y;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef LONG_Z</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span>(k == 2)
                  boxSize = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize * LONG_Z;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                <span class="keywordflow">while</span>(fp[k] &lt; 0)
                  fp[k] += <a class="code" href="density_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a>;
                <span class="keywordflow">while</span>(fp[k] &gt;= boxSize)
                  fp[k] -= <a class="code" href="density_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>              }
            n++;
            fp += 3;
          }
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_VEL:                <span class="comment">/* velocities */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
              {
                dt_gravkick =
                  <a class="code" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059">get_gravkick_factor</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep,
                                      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current) -
                  <a class="code" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059">get_gravkick_factor</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep,
                                      (<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep + <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_endstep) / 2);
                dt_hydrokick =
                  <a class="code" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c">get_hydrokick_factor</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep,
                                       <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current) -
                  <a class="code" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c">get_hydrokick_factor</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep,
                                       (<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep + <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_endstep) / 2);
              }
            <span class="keywordflow">else</span>
              dt_gravkick = dt_hydrokick =
                (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Ti_Current - (<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep + <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_endstep) / 2) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Timebase_interval;

            <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
              {
                fp[k] = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Vel[k] + <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].GravAccel[k] * dt_gravkick;
                <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == 0)
                  fp[k] += <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].HydroAccel[k] * dt_hydrokick;
              }
<span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>            <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
              fp[k] += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].GravPM[k] * dt_gravkick_pm;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
              fp[k] *= sqrt(a3inv);

            n++;
            fp += 3;
          }
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_ID:         <span class="comment">/* particle ID */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            *ip++ = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].ID;
            n++;
          }
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_MASS:               <span class="comment">/* particle mass */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            *fp++ = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Mass;
            n++;
          }
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_U:                  <span class="comment">/* internal energy */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
<span class="preprocessor">#ifdef ISOTHERM_EQS</span>
<span class="preprocessor"></span>            *fp++ = <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].Entropy;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>            *fp++ =
              <a class="code" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85">dmax</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MinEgySpec,
                   <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].Entropy / GAMMA_MINUS1 * <a class="code" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(<a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].Density * a3inv, GAMMA_MINUS1));
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            n++;
          }
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_RHO:                <span class="comment">/* density */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            *fp++ = <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].Density;
            n++;
          }
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_HSML:               <span class="comment">/* SPH smoothing length */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            *fp++ = <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].Hsml;
            n++;
          }
      <span class="keywordflow">break</span>;


    <span class="keywordflow">case</span> IO_POT:                <span class="comment">/* gravitational potential */</span>
<span class="preprocessor">#ifdef OUTPUTPOTENTIAL</span>
<span class="preprocessor"></span>      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            *fp++ = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Potential;
            n++;
          }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_ACCEL:              <span class="comment">/* acceleration */</span>
<span class="preprocessor">#ifdef OUTPUTACCELERATION</span>
<span class="preprocessor"></span>      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
              fp[k] = <a class="code" href="timestep_8c.html#a59a20f8242197c1ba41f7a0b1b880d62">fac1</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].GravAccel[k];
<span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>            <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
              fp[k] += <a class="code" href="timestep_8c.html#a59a20f8242197c1ba41f7a0b1b880d62">fac1</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].GravPM[k];
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == 0)
              <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
                fp[k] += fac2 * <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].HydroAccel[k];
            fp += 3;
            n++;
          }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_DTENTR:             <span class="comment">/* rate of change of entropy */</span>
<span class="preprocessor">#ifdef OUTPUTCHANGEOFENTROPY</span>
<span class="preprocessor"></span>      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            *fp++ = <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[pindex].DtEntropy;
            n++;
          }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_TSTP:               <span class="comment">/* timestep  */</span>
<span class="preprocessor">#ifdef OUTPUTTIMESTEP</span>
<span class="preprocessor"></span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; pindex++)
        <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Type == type)
          {
            *fp++ = (<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_endstep - <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[pindex].Ti_begstep) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Timebase_interval;
            n++;
          }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">break</span>;

    }

  *startindex = pindex;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a4b34f2381777023014f80c959ad1f88a_cgraph.png" border="0" usemap="#io_8c_a4b34f2381777023014f80c959ad1f88a_cgraph" alt=""/></div>
<map name="io_8c_a4b34f2381777023014f80c959ad1f88a_cgraph" id="io_8c_a4b34f2381777023014f80c959ad1f88a_cgraph">
<area shape="rect" id="node3" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85" title="dmax" alt="" coords="219,5,277,33"/><area shape="rect" id="node5" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059" title="get_gravkick_factor" alt="" coords="175,55,321,83"/><area shape="rect" id="node7" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c" title="get_hydrokick_factor" alt="" coords="171,106,325,134"/><area shape="rect" id="node9" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="225,157,271,185"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a4b34f2381777023014f80c959ad1f88a_icgraph.png" border="0" usemap="#io_8c_a4b34f2381777023014f80c959ad1f88a_icgraph" alt=""/></div>
<map name="io_8c_a4b34f2381777023014f80c959ad1f88a_icgraph" id="io_8c_a4b34f2381777023014f80c959ad1f88a_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="171,5,248,33"/><area shape="rect" id="node5" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="296,5,405,33"/><area shape="rect" id="node7" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="720,5,763,33"/><area shape="rect" id="node11" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="453,30,672,58"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="812,5,865,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a49492470fcccf9d05bf51993f281f16c"></a><!-- doxytag: member="io.c::get_bytes_per_blockelement" ref="a49492470fcccf9d05bf51993f281f16c" args="(enum iofields blocknr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="proto_8h.html#a49492470fcccf9d05bf51993f281f16c">get_bytes_per_blockelement</a> </td>
          <td>(</td>
          <td class="paramtype">enum iofields&#160;</td>
          <td class="paramname"><em>blocknr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function tells the size of one data entry in each of the blocks defined for the output file. If one wants to add a new output-block, this function should be augmented accordingly. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00366">366</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> bytes_per_blockelement = 0;

  <span class="keywordflow">switch</span> (blocknr)
    {
    <span class="keywordflow">case</span> IO_POS:
    <span class="keywordflow">case</span> IO_VEL:
    <span class="keywordflow">case</span> IO_ACCEL:
      bytes_per_blockelement = 3 * <span class="keyword">sizeof</span>(float);
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_ID:
<span class="preprocessor">#ifdef LONGIDS</span>
<span class="preprocessor"></span>      bytes_per_blockelement = <span class="keyword">sizeof</span>(<span class="keywordtype">long</span> long);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      bytes_per_blockelement = <span class="keyword">sizeof</span>(int);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_MASS:
    <span class="keywordflow">case</span> IO_U:
    <span class="keywordflow">case</span> IO_RHO:
    <span class="keywordflow">case</span> IO_HSML:
    <span class="keywordflow">case</span> IO_POT:
    <span class="keywordflow">case</span> IO_DTENTR:
    <span class="keywordflow">case</span> IO_TSTP:
      bytes_per_blockelement = <span class="keyword">sizeof</span>(float);
      <span class="keywordflow">break</span>;
    }

  <span class="keywordflow">return</span> bytes_per_blockelement;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a49492470fcccf9d05bf51993f281f16c_icgraph.png" border="0" usemap="#io_8c_a49492470fcccf9d05bf51993f281f16c_icgraph" alt=""/></div>
<map name="io_8c_a49492470fcccf9d05bf51993f281f16c_icgraph" id="io_8c_a49492470fcccf9d05bf51993f281f16c_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="263,5,337,33"/><area shape="rect" id="node13" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="261,55,339,83"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="408,5,475,33"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="633,5,673,33"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="811,5,877,33"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="927,30,980,58"/><area shape="rect" id="node15" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="387,55,496,83"/><area shape="rect" id="node17" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="823,55,865,83"/><area shape="rect" id="node20" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="544,106,763,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4d30ce1aad9c69d5af676a6a13173686"></a><!-- doxytag: member="io.c::get_dataset_name" ref="a4d30ce1aad9c69d5af676a6a13173686" args="(enum iofields blocknr, char *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#a4d30ce1aad9c69d5af676a6a13173686">get_dataset_name</a> </td>
          <td>(</td>
          <td class="paramtype">enum iofields&#160;</td>
          <td class="paramname"><em>blocknr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns a descriptive character string that describes the name of the block when the HDF5 file format is used. If one wants to add a new output-block, this function should be augmented accordingly. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00613">613</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{

  strcpy(buf, <span class="stringliteral">&quot;default&quot;</span>);

  <span class="keywordflow">switch</span> (blocknr)
    {
    <span class="keywordflow">case</span> IO_POS:
      strcpy(buf, <span class="stringliteral">&quot;Coordinates&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_VEL:
      strcpy(buf, <span class="stringliteral">&quot;Velocities&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_ID:
      strcpy(buf, <span class="stringliteral">&quot;ParticleIDs&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_MASS:
      strcpy(buf, <span class="stringliteral">&quot;Masses&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_U:
      strcpy(buf, <span class="stringliteral">&quot;InternalEnergy&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_RHO:
      strcpy(buf, <span class="stringliteral">&quot;Density&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_HSML:
      strcpy(buf, <span class="stringliteral">&quot;SmoothingLength&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_POT:
      strcpy(buf, <span class="stringliteral">&quot;Potential&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_ACCEL:
      strcpy(buf, <span class="stringliteral">&quot;Acceleration&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_DTENTR:
      strcpy(buf, <span class="stringliteral">&quot;RateOfChangeOfEntropy&quot;</span>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> IO_TSTP:
      strcpy(buf, <span class="stringliteral">&quot;TimeStep&quot;</span>);
      <span class="keywordflow">break</span>;
    }
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a4d30ce1aad9c69d5af676a6a13173686_icgraph.png" border="0" usemap="#io_8c_a4d30ce1aad9c69d5af676a6a13173686_icgraph" alt=""/></div>
<map name="io_8c_a4d30ce1aad9c69d5af676a6a13173686_icgraph" id="io_8c_a4d30ce1aad9c69d5af676a6a13173686_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="199,5,273,33"/><area shape="rect" id="node13" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="197,55,275,83"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="344,5,411,33"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="569,5,609,33"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="747,5,813,33"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="863,30,916,58"/><area shape="rect" id="node15" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="323,55,432,83"/><area shape="rect" id="node17" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="759,55,801,83"/><area shape="rect" id="node20" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="480,106,699,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acdf59daa02f065452a596cf88b4de1a1"></a><!-- doxytag: member="io.c::get_datatype_in_block" ref="acdf59daa02f065452a596cf88b4de1a1" args="(enum iofields blocknr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="proto_8h.html#acdf59daa02f065452a596cf88b4de1a1">get_datatype_in_block</a> </td>
          <td>(</td>
          <td class="paramtype">enum iofields&#160;</td>
          <td class="paramname"><em>blocknr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the type of the data contained in a given block of the output file. If one wants to add a new output-block, this function should be augmented accordingly. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00405">405</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> typekey;

  <span class="keywordflow">switch</span> (blocknr)
    {
    <span class="keywordflow">case</span> IO_ID:
<span class="preprocessor">#ifdef LONGIDS</span>
<span class="preprocessor"></span>      typekey = 2;              <span class="comment">/* native long long */</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      typekey = 0;              <span class="comment">/* native int */</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">break</span>;

    <span class="keywordflow">default</span>:
      typekey = 1;              <span class="comment">/* native float */</span>
      <span class="keywordflow">break</span>;
    }

  <span class="keywordflow">return</span> typekey;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_acdf59daa02f065452a596cf88b4de1a1_icgraph.png" border="0" usemap="#io_8c_acdf59daa02f065452a596cf88b4de1a1_icgraph" alt=""/></div>
<map name="io_8c_acdf59daa02f065452a596cf88b4de1a1_icgraph" id="io_8c_acdf59daa02f065452a596cf88b4de1a1_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="220,5,295,33"/><area shape="rect" id="node13" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="219,55,296,83"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="365,5,432,33"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="591,5,631,33"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="768,5,835,33"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="884,30,937,58"/><area shape="rect" id="node15" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="344,55,453,83"/><area shape="rect" id="node17" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="780,55,823,83"/><area shape="rect" id="node20" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="501,106,720,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5ce310b1efc19d96d530c1264fd5eca9"></a><!-- doxytag: member="io.c::get_particles_in_block" ref="a5ce310b1efc19d96d530c1264fd5eca9" args="(enum iofields blocknr, int *typelist)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="proto_8h.html#a5ce310b1efc19d96d530c1264fd5eca9">get_particles_in_block</a> </td>
          <td>(</td>
          <td class="paramtype">enum iofields&#160;</td>
          <td class="paramname"><em>blocknr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>typelist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function determines how many particles there are in a given block, based on the information in the header-structure. It also flags particle types that are present in the block in the typelist array. If one wants to add a new output-block, this function should be augmented accordingly. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00465">465</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, and <a class="el" href="allvars_8c_source.html#l00162">header</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i, nall, ntot_withmasses, ngas, nstars;

  nall = 0;
  ntot_withmasses = 0;

  <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
    {
      typelist[i] = 0;

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[i] &gt; 0)
        {
          nall += <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[i];
          typelist[i] = 1;
        }

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MassTable[i] == 0)
        ntot_withmasses += <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[i];
    }

  ngas = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[0];
  nstars = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[4];


  <span class="keywordflow">switch</span> (blocknr)
    {
    <span class="keywordflow">case</span> IO_POS:
    <span class="keywordflow">case</span> IO_VEL:
    <span class="keywordflow">case</span> IO_ACCEL:
    <span class="keywordflow">case</span> IO_TSTP:
    <span class="keywordflow">case</span> IO_ID:
    <span class="keywordflow">case</span> IO_POT:
      <span class="keywordflow">return</span> nall;
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_MASS:
      <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
        {
          typelist[i] = 0;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MassTable[i] == 0 &amp;&amp; <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[i] &gt; 0)
            typelist[i] = 1;
        }
      <span class="keywordflow">return</span> ntot_withmasses;
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_U:
    <span class="keywordflow">case</span> IO_RHO:
    <span class="keywordflow">case</span> IO_HSML:
    <span class="keywordflow">case</span> IO_DTENTR:
      <span class="keywordflow">for</span>(i = 1; i &lt; 6; i++)
        typelist[i] = 0;
      <span class="keywordflow">return</span> ngas;
      <span class="keywordflow">break</span>;
    }

  <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(212);
  <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a5ce310b1efc19d96d530c1264fd5eca9_cgraph.png" border="0" usemap="#io_8c_a5ce310b1efc19d96d530c1264fd5eca9_cgraph" alt=""/></div>
<map name="io_8c_a5ce310b1efc19d96d530c1264fd5eca9_cgraph" id="io_8c_a5ce310b1efc19d96d530c1264fd5eca9_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="216,5,283,33"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="331,5,488,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a5ce310b1efc19d96d530c1264fd5eca9_icgraph.png" border="0" usemap="#io_8c_a5ce310b1efc19d96d530c1264fd5eca9_icgraph" alt=""/></div>
<map name="io_8c_a5ce310b1efc19d96d530c1264fd5eca9_icgraph" id="io_8c_a5ce310b1efc19d96d530c1264fd5eca9_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="217,5,292,33"/><area shape="rect" id="node13" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="216,55,293,83"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="363,5,429,33"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="588,5,628,33"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="765,5,832,33"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="881,30,935,58"/><area shape="rect" id="node15" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="341,55,451,83"/><area shape="rect" id="node17" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="777,55,820,83"/><area shape="rect" id="node20" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="499,106,717,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3892776d6528c51f720d2a48deb2486f"></a><!-- doxytag: member="io.c::get_values_per_blockelement" ref="a3892776d6528c51f720d2a48deb2486f" args="(enum iofields blocknr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="proto_8h.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a> </td>
          <td>(</td>
          <td class="paramtype">enum iofields&#160;</td>
          <td class="paramname"><em>blocknr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function informs about the number of elements stored per particle for the given block of the output file. If one wants to add a new output-block, this function should be augmented accordingly. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00432">432</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> values = 0;

  <span class="keywordflow">switch</span> (blocknr)
    {
    <span class="keywordflow">case</span> IO_POS:
    <span class="keywordflow">case</span> IO_VEL:
    <span class="keywordflow">case</span> IO_ACCEL:
      values = 3;
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> IO_ID:
    <span class="keywordflow">case</span> IO_MASS:
    <span class="keywordflow">case</span> IO_U:
    <span class="keywordflow">case</span> IO_RHO:
    <span class="keywordflow">case</span> IO_HSML:
    <span class="keywordflow">case</span> IO_POT:
    <span class="keywordflow">case</span> IO_DTENTR:
    <span class="keywordflow">case</span> IO_TSTP:
      values = 1;
      <span class="keywordflow">break</span>;
    }

  <span class="keywordflow">return</span> values;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a3892776d6528c51f720d2a48deb2486f_icgraph.png" border="0" usemap="#io_8c_a3892776d6528c51f720d2a48deb2486f_icgraph" alt=""/></div>
<map name="io_8c_a3892776d6528c51f720d2a48deb2486f_icgraph" id="io_8c_a3892776d6528c51f720d2a48deb2486f_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="268,5,343,33"/><area shape="rect" id="node13" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="267,55,344,83"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="413,5,480,33"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="639,5,679,33"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="816,5,883,33"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="932,30,985,58"/><area shape="rect" id="node15" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="392,55,501,83"/><area shape="rect" id="node17" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="828,55,871,83"/><area shape="rect" id="node20" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="549,106,768,134"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1609620c03f6b0068601735c42e3c660"></a><!-- doxytag: member="io.c::my_fread" ref="a1609620c03f6b0068601735c42e3c660" args="(void *ptr, size_t size, size_t nmemb, FILE *stream)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="proto_8h.html#a1609620c03f6b0068601735c42e3c660">my_fread</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nmemb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>stream</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This catches I/O errors occuring for fread(). In this case we better stop. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l01139">1139</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, and <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="restart_8c_source.html#l00289">byten()</a>, <a class="el" href="forcetree_8c_source.html#l03163">ewald_init()</a>, <a class="el" href="restart_8c_source.html#l00300">in()</a>, and <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">size_t</span> nread;

  <span class="keywordflow">if</span>((nread = fread(ptr, size, nmemb, stream)) != nmemb)
    {
      printf(<span class="stringliteral">&quot;I/O error (fread) on task=%d has occured: %s\n&quot;</span>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, strerror(errno));
      fflush(stdout);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(778);
    }
  <span class="keywordflow">return</span> nread;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a1609620c03f6b0068601735c42e3c660_cgraph.png" border="0" usemap="#io_8c_a1609620c03f6b0068601735c42e3c660_cgraph" alt=""/></div>
<map name="io_8c_a1609620c03f6b0068601735c42e3c660_cgraph" id="io_8c_a1609620c03f6b0068601735c42e3c660_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="136,5,203,33"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="251,5,408,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a1609620c03f6b0068601735c42e3c660_icgraph.png" border="0" usemap="#io_8c_a1609620c03f6b0068601735c42e3c660_icgraph" alt=""/></div>
<map name="io_8c_a1609620c03f6b0068601735c42e3c660_icgraph" id="io_8c_a1609620c03f6b0068601735c42e3c660_icgraph">
<area shape="rect" id="node3" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21" title="byten" alt="" coords="145,5,204,33"/><area shape="rect" id="node14" href="proto_8h.html#a47f99270d9b0b0f75d86b3b9d078dff6" title="ewald_init" alt="" coords="380,106,463,134"/><area shape="rect" id="node17" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5" title="in" alt="" coords="156,55,193,83"/><area shape="rect" id="node20" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="137,157,212,185"/><area shape="rect" id="node5" href="restart_8c.html#ae81d30f52dddd39aef76bb1890d16f2f" title="restart" alt="" coords="264,55,328,83"/><area shape="rect" id="node7" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="512,94,579,122"/><area shape="rect" id="node11" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="524,18,567,46"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="628,57,681,85"/><area shape="rect" id="node22" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="263,157,329,185"/><area shape="rect" id="node24" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="401,157,441,185"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aab1e6568bf14b3a23c66f70c94aabd21"></a><!-- doxytag: member="io.c::my_fwrite" ref="aab1e6568bf14b3a23c66f70c94aabd21" args="(void *ptr, size_t size, size_t nmemb, FILE *stream)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="proto_8h.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nmemb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>stream</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This catches I/O errors occuring for <a class="el" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite()</a>. In this case we better stop. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l01122">1122</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, and <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="restart_8c_source.html#l00289">byten()</a>, <a class="el" href="forcetree_8c_source.html#l03124">dump_particles()</a>, <a class="el" href="forcetree_8c_source.html#l03163">ewald_init()</a>, <a class="el" href="restart_8c_source.html#l00300">in()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">size_t</span> nwritten;

  <span class="keywordflow">if</span>((nwritten = fwrite(ptr, size, nmemb, stream)) != nmemb)
    {
      printf(<span class="stringliteral">&quot;I/O error (fwrite) on task=%d has occured: %s\n&quot;</span>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, strerror(errno));
      fflush(stdout);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(777);
    }
  <span class="keywordflow">return</span> nwritten;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_aab1e6568bf14b3a23c66f70c94aabd21_cgraph.png" border="0" usemap="#io_8c_aab1e6568bf14b3a23c66f70c94aabd21_cgraph" alt=""/></div>
<map name="io_8c_aab1e6568bf14b3a23c66f70c94aabd21_cgraph" id="io_8c_aab1e6568bf14b3a23c66f70c94aabd21_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="136,5,203,33"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="251,5,408,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_aab1e6568bf14b3a23c66f70c94aabd21_icgraph.png" border="0" usemap="#io_8c_aab1e6568bf14b3a23c66f70c94aabd21_icgraph" alt=""/></div>
<map name="io_8c_aab1e6568bf14b3a23c66f70c94aabd21_icgraph" id="io_8c_aab1e6568bf14b3a23c66f70c94aabd21_icgraph">
<area shape="rect" id="node3" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21" title="byten" alt="" coords="167,124,225,152"/><area shape="rect" id="node14" href="proto_8h.html#ab303b92c6d6b4144999c5cebabd65ec0" title="dump_particles" alt="" coords="136,225,256,253"/><area shape="rect" id="node40" href="proto_8h.html#a47f99270d9b0b0f75d86b3b9d078dff6" title="ewald_init" alt="" coords="777,9,860,37"/><area shape="rect" id="node43" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5" title="in" alt="" coords="384,73,421,101"/><area shape="rect" id="node46" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="364,174,441,202"/><area shape="rect" id="node5" href="restart_8c.html#ae81d30f52dddd39aef76bb1890d16f2f" title="restart" alt="" coords="599,98,663,126"/><area shape="rect" id="node7" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="1384,110,1451,138"/><area shape="rect" id="node11" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="1396,237,1439,265"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1500,161,1553,189"/><area shape="rect" id="node16" href="proto_8h.html#aadc9b1624ed78f3ccd0dbb9908fe0bb6" title="force_treebuild_single" alt="" coords="551,272,711,300"/><area shape="rect" id="node36" href="proto_8h.html#a8eaedfa5c6d72bca79b465003679ed89" title="force_create_empty_nodes" alt="" coords="305,300,500,328"/><area shape="rect" id="node18" href="proto_8h.html#a10f92098e86f82baec9f84a283f4c9e5" title="force_treebuild" alt="" coords="760,272,877,300"/><area shape="rect" id="node20" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="948,338,1047,366"/><area shape="rect" id="node25" href="proto_8h.html#ac56af97a1dbbbbb07db8207246852f79" title="ngb_treebuild" alt="" coords="943,161,1052,189"/><area shape="rect" id="node30" href="proto_8h.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="927,272,1068,300"/><area shape="rect" id="node22" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="1141,364,1312,392"/><area shape="rect" id="node27" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="1207,161,1247,189"/><area shape="rect" id="node33" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="1117,262,1336,290"/><area shape="rect" id="node48" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="943,212,1052,240"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a523730833804b6d92aa7f4dd474805c5"></a><!-- doxytag: member="io.c::savepositions" ref="a523730833804b6d92aa7f4dd474805c5" args="(int num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5">savepositions</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function writes a snapshot of the particle distribution to one or several files using the selected file format. If NumFilesPerSnapshot&gt;1, the snapshot is distributed onto several files, several of them can be written simultaneously (up to NumFilesWrittenInParallel). Each file contains data from a group of processors. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00033">33</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="read__ic_8c_source.html#l00724">distribute_file()</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="io_8c_source.html#l00566">fill_Tab_IO_Labels()</a>, <a class="el" href="io_8c_source.html#l00021">n_type</a>, <a class="el" href="allvars_8c_source.html#l00016">NTask</a>, <a class="el" href="io_8c_source.html#l00022">ntot_type_all</a>, <a class="el" href="allvars_8c_source.html#l00019">NumPart</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="system_8c_source.html#l00049">second()</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, <a class="el" href="system_8c_source.html#l00070">timediff()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>

<p>Referenced by <a class="el" href="run_8c_source.html#l00151">find_next_sync_point_and_drift()</a>, and <a class="el" href="run_8c_source.html#l00020">run()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> t0, t1;
  <span class="keywordtype">char</span> buf[500];
  <span class="keywordtype">int</span> i, j, *temp, n, filenr, gr, ngroups, masterTask, lastTask;

  t0 = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    printf(<span class="stringliteral">&quot;\nwriting snapshot file... \n&quot;</span>);

<span class="preprocessor">#if defined(SFR) || defined(BLACK_HOLES)</span>
<span class="preprocessor"></span>  rearrange_particle_sequence();
  <span class="comment">/* ensures that new tree will be constructed */</span>
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumForcesSinceLastDomainDecomp = 1 + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TreeDomainUpdateFrequency * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.TotNumPart;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> &lt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesPerSnapshot)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;Fatal error.\nNumber of processors must be larger or equal than All.NumFilesPerSnapshot.\n&quot;</span>);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
    }
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat &lt; 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat &gt; 3)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;Unsupported File-Format\n&quot;</span>);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
    }
<span class="preprocessor">#ifndef  HAVE_HDF5</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 3)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;Code wasn&#39;t compiled with HDF5 support enabled!\n&quot;</span>);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

  <span class="comment">/* determine global and local particle numbers */</span>
  <span class="keywordflow">for</span>(n = 0; n &lt; 6; n++)
    <a class="code" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a>[n] = 0;

  <span class="keywordflow">for</span>(n = 0; n &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; n++)
    <a class="code" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a>[<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[n].Type]++;

  <span class="comment">/* because ntot_type_all[] is of type `long long&#39;, we cannot do a simple</span>
<span class="comment">   * MPI_Allreduce() to sum the total particle numbers </span>
<span class="comment">   */</span>
  temp = malloc(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * 6 * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  MPI_Allgather(<a class="code" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a>, 6, MPI_INT, temp, 6, MPI_INT, MPI_COMM_WORLD);
  <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
    {
      <a class="code" href="io_8c.html#a3cfb701790acb5a9b71ba995148bbf40">ntot_type_all</a>[i] = 0;
      <span class="keywordflow">for</span>(j = 0; j &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; j++)
        <a class="code" href="io_8c.html#a3cfb701790acb5a9b71ba995148bbf40">ntot_type_all</a>[i] += temp[j * 6 + i];
    }
  free(temp);


  <span class="comment">/* assign processors to output files */</span>
  <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesPerSnapshot, 0, 0, <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> - 1, &amp;filenr, &amp;masterTask, &amp;lastTask);

  <a class="code" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345">fill_Tab_IO_Labels</a>();

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesPerSnapshot &gt; 1)
    sprintf(buf, <span class="stringliteral">&quot;%s%s_%03d.%d&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.OutputDir, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapshotFileBase, num, filenr);
  <span class="keywordflow">else</span>
    sprintf(buf, <span class="stringliteral">&quot;%s%s_%03d&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.OutputDir, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapshotFileBase, num);

  ngroups = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesPerSnapshot / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesWrittenInParallel;
  <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesPerSnapshot % <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesWrittenInParallel))
    ngroups++;

  <span class="keywordflow">for</span>(gr = 0; gr &lt; ngroups; gr++)
    {
      <span class="keywordflow">if</span>((filenr / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesWrittenInParallel) == gr)        <span class="comment">/* ok, it&#39;s this processor&#39;s turn */</span>
        <a class="code" href="io_8c.html#a2b3f5bacd7313da0f3ffa55e41907481">write_file</a>(buf, masterTask, lastTask);
      MPI_Barrier(MPI_COMM_WORLD);
    }


  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    printf(<span class="stringliteral">&quot;done with snapshot.\n&quot;</span>);

  t1 = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.CPU_Snapshot += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(t0, t1);

}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a523730833804b6d92aa7f4dd474805c5_cgraph.png" border="0" usemap="#io_8c_a523730833804b6d92aa7f4dd474805c5_cgraph" alt=""/></div>
<map name="io_8c_a523730833804b6d92aa7f4dd474805c5_cgraph" id="io_8c_a523730833804b6d92aa7f4dd474805c5_cgraph">
<area shape="rect" id="node3" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab" title="distribute_file" alt="" coords="176,86,283,114"/><area shape="rect" id="node6" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="663,314,729,342"/><area shape="rect" id="node10" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345" title="fill_Tab_IO_Labels" alt="" coords="164,188,295,216"/><area shape="rect" id="node12" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174" title="second" alt="" coords="196,238,263,266"/><area shape="rect" id="node14" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d" title="timediff" alt="" coords="195,137,264,165"/><area shape="rect" id="node18" href="io_8c.html#a2b3f5bacd7313da0f3ffa55e41907481" title="write_file" alt="" coords="191,289,268,317"/><area shape="rect" id="node8" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="821,314,979,342"/><area shape="rect" id="node16" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="673,10,719,38"/><area shape="rect" id="node20" href="io_8c.html#ad5243b69dcba17be62f7d64f422bfbbf" title="write_header_attributes_in_hdf5" alt="" coords="344,264,571,292"/><area shape="rect" id="node23" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21" title="my_fwrite" alt="" coords="416,416,499,444"/><area shape="rect" id="node26" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e" title="blockpresent" alt="" coords="405,314,509,342"/><area shape="rect" id="node28" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c" title="get_bytes_per_blockelement" alt="" coords="355,365,560,393"/><area shape="rect" id="node30" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9" title="get_particles_in_block" alt="" coords="376,162,539,190"/><area shape="rect" id="node33" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1" title="get_datatype_in_block" alt="" coords="375,466,540,494"/><area shape="rect" id="node35" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f" title="get_values_per_blockelement" alt="" coords="352,517,563,545"/><area shape="rect" id="node37" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686" title="get_dataset_name" alt="" coords="387,112,528,140"/><area shape="rect" id="node39" href="io_8c.html#a4b34f2381777023014f80c959ad1f88a" title="fill_write_buffer" alt="" coords="400,61,515,89"/><area shape="rect" id="node41" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85" title="dmax" alt="" coords="667,162,725,190"/><area shape="rect" id="node43" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059" title="get_gravkick_factor" alt="" coords="623,61,769,89"/><area shape="rect" id="node45" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c" title="get_hydrokick_factor" alt="" coords="619,112,773,140"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a523730833804b6d92aa7f4dd474805c5_icgraph.png" border="0" usemap="#io_8c_a523730833804b6d92aa7f4dd474805c5_icgraph" alt=""/></div>
<map name="io_8c_a523730833804b6d92aa7f4dd474805c5_icgraph" id="io_8c_a523730833804b6d92aa7f4dd474805c5_icgraph">
<area shape="rect" id="node3" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="163,5,381,33"/><area shape="rect" id="node5" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="429,30,472,58"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="521,30,575,58"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2b3f5bacd7313da0f3ffa55e41907481"></a><!-- doxytag: member="io.c::write_file" ref="a2b3f5bacd7313da0f3ffa55e41907481" args="(char *fname, int writeTask, int lastTask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c">write_file</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>writeTask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lastTask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function writes an actual snapshot file containing the data from processors 'writeTask' to 'lastTask'. 'writeTask' is the one that actually writes. Each snapshot file contains a header first, then particle positions, velocities and ID's. Particle masses are written only for those particle types with zero entry in MassTable. After that, first the internal energies u, and then the density is written for the SPH particles. If cooling is enabled, mean molecular weight and neutral hydrogen abundance are written for the gas particles. This is followed by the SPH smoothing length and further blocks of information, depending on included physics and compile-time flags. If HDF5 is used, the header is stored in a group called "/Header", and the particle data is stored separately for each particle type in groups calles "/PartType0", "/PartType1", etc. The sequence of the blocks is unimportant in this case. </p>
<p>&lt; Various tags used for labelling MPI messages</p>
<p>&lt; Various tags used for labelling MPI messages</p>
<p>&lt; total number of defined information blocks for snapshot files. Must be equal to the number of entries in "enum iofields" </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00672">672</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="io_8c_source.html#l00532">blockpresent()</a>, <a class="el" href="allvars_8c_source.html#l00102">CommBuffer</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="restart_8c_source.html#l00021">fd</a>, <a class="el" href="io_8c_source.html#l00129">fill_write_buffer()</a>, <a class="el" href="io_8c_source.html#l00366">get_bytes_per_blockelement()</a>, <a class="el" href="io_8c_source.html#l00613">get_dataset_name()</a>, <a class="el" href="io_8c_source.html#l00405">get_datatype_in_block()</a>, <a class="el" href="io_8c_source.html#l00465">get_particles_in_block()</a>, <a class="el" href="io_8c_source.html#l00432">get_values_per_blockelement()</a>, <a class="el" href="allvars_8c_source.html#l00162">header</a>, <a class="el" href="io_8c_source.html#l01122">my_fwrite()</a>, <a class="el" href="io_8c_source.html#l00021">n_type</a>, <a class="el" href="io_8c_source.html#l00022">ntot_type_all</a>, <a class="el" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>, <a class="el" href="allvars_8c_source.html#l00167">Tab_IO_Labels</a>, <a class="el" href="tags_8h_source.html#l00032">TAG_LOCALN</a>, <a class="el" href="tags_8h_source.html#l00005">TAG_N</a>, <a class="el" href="tags_8h_source.html#l00019">TAG_NFORTHISTASK</a>, <a class="el" href="tags_8h_source.html#l00007">TAG_PDATA</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, and <a class="el" href="io_8c_source.html#l00998">write_header_attributes_in_hdf5()</a>.</p>

<p>Referenced by <a class="el" href="io_8c_source.html#l00033">savepositions()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> type, bytes_per_blockelement, npart, nextblock, typelist[6];
  <span class="keywordtype">int</span> n_for_this_task, ntask, n, p, pc, offset = 0, task;
  <span class="keywordtype">int</span> blockmaxlen, ntot_type[6], nn[6];
  <span class="keyword">enum</span> iofields blocknr;
  <span class="keywordtype">int</span> blksize;
  MPI_Status status;
  FILE *<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a> = 0;

<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>  hid_t hdf5_file = 0, hdf5_grp[6], hdf5_headergrp = 0, hdf5_dataspace_memory;
  hid_t hdf5_datatype = 0, hdf5_dataspace_in_file = 0, hdf5_dataset = 0;
  herr_t hdf5_status;
  hsize_t dims[2], count[2], start[2];
  <span class="keywordtype">int</span> rank, pcsum = 0;
  <span class="keywordtype">char</span> buf[500];
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define SKIP  {my_fwrite(&amp;blksize,sizeof(int),1,fd);}</span>
<span class="preprocessor"></span>
  <span class="comment">/* determine particle numbers of each type in file */</span>

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask)
    {
      <span class="keywordflow">for</span>(n = 0; n &lt; 6; n++)
        ntot_type[n] = <a class="code" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a>[n];

      <span class="keywordflow">for</span>(task = writeTask + 1; task &lt;= lastTask; task++)
        {
          MPI_Recv(&amp;nn[0], 6, MPI_INT, task, <a class="code" href="tags_8h.html#a6c22de1ede8c37798a40f89dbaa7cf25">TAG_LOCALN</a>, MPI_COMM_WORLD, &amp;status);
          <span class="keywordflow">for</span>(n = 0; n &lt; 6; n++)
            ntot_type[n] += nn[n];
        }

      <span class="keywordflow">for</span>(task = writeTask + 1; task &lt;= lastTask; task++)
        MPI_Send(&amp;ntot_type[0], 6, MPI_INT, task, <a class="code" href="tags_8h.html#a8b9f258d53a5b3f5291fd7b034d74a02">TAG_N</a>, MPI_COMM_WORLD);
    }
  <span class="keywordflow">else</span>
    {
      MPI_Send(&amp;<a class="code" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a>[0], 6, MPI_INT, writeTask, <a class="code" href="tags_8h.html#a6c22de1ede8c37798a40f89dbaa7cf25">TAG_LOCALN</a>, MPI_COMM_WORLD);
      MPI_Recv(&amp;ntot_type[0], 6, MPI_INT, writeTask, <a class="code" href="tags_8h.html#a8b9f258d53a5b3f5291fd7b034d74a02">TAG_N</a>, MPI_COMM_WORLD, &amp;status);
    }



  <span class="comment">/* fill file header */</span>

  <span class="keywordflow">for</span>(n = 0; n &lt; 6; n++)
    {
      <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[n] = ntot_type[n];
      <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npartTotal[n] = (<span class="keywordtype">unsigned</span> int) <a class="code" href="io_8c.html#a3cfb701790acb5a9b71ba995148bbf40">ntot_type_all</a>[n];
      <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npartTotalHighWord[n] = (<span class="keywordtype">unsigned</span> int) (<a class="code" href="io_8c.html#a3cfb701790acb5a9b71ba995148bbf40">ntot_type_all</a>[n] &gt;&gt; 32);
    }

  <span class="keywordflow">for</span>(n = 0; n &lt; 6; n++)
    <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.mass[n] = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MassTable[n];

  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.time = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
    <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.redshift = 1.0 / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time - 1;
  <span class="keywordflow">else</span>
    <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.redshift = 0;

  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_sfr = 0;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_feedback = 0;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_cooling = 0;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_stellarage = 0;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_metals = 0;

<span class="preprocessor">#ifdef COOLING</span>
<span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_cooling = 1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef SFR</span>
<span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_sfr = 1;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_feedback = 1;
<span class="preprocessor">#ifdef STELLARAGE</span>
<span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_stellarage = 1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef METALS</span>
<span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_metals = 1;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.num_files = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.NumFilesPerSnapshot;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.BoxSize = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BoxSize;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.Omega0 = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Omega0;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.OmegaLambda = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.OmegaLambda;
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.HubbleParam = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.HubbleParam;


  <span class="comment">/* open file and write header */</span>

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 3)
        {
<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>          sprintf(buf, <span class="stringliteral">&quot;%s.hdf5&quot;</span>, fname);
          hdf5_file = H5Fcreate(buf, H5F_ACC_TRUNC, H5P_DEFAULT, H5P_DEFAULT);

          hdf5_headergrp = H5Gcreate(hdf5_file, <span class="stringliteral">&quot;/Header&quot;</span>, 0);

          <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[type] &gt; 0)
                {
                  sprintf(buf, <span class="stringliteral">&quot;/PartType%d&quot;</span>, type);
                  hdf5_grp[type] = H5Gcreate(hdf5_file, buf, 0);
                }
            }

          <a class="code" href="io_8c.html#ad5243b69dcba17be62f7d64f422bfbbf">write_header_attributes_in_hdf5</a>(hdf5_headergrp);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }
      <span class="keywordflow">else</span>
        {
          <span class="keywordflow">if</span>(!(fd = fopen(fname, <span class="stringliteral">&quot;w&quot;</span>)))
            {
              printf(<span class="stringliteral">&quot;can&#39;t open file `%s&#39; for writing snapshot.\n&quot;</span>, fname);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(123);
            }

          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 2)
            {
              blksize = <span class="keyword">sizeof</span>(int) + 4 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>);
              <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;
              <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(<span class="stringliteral">&quot;HEAD&quot;</span>, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 4, fd);
              nextblock = <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>) + 2 * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>);
              <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(&amp;nextblock, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, fd);
              <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;
            }

          blksize = <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>);
          <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;
          <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), 1, fd);
          <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;
        }
    }

  ntask = lastTask - writeTask + 1;

  <span class="keywordflow">for</span>(blocknr = 0; blocknr &lt; IO_NBLOCKS; blocknr++)
    {
      <span class="keywordflow">if</span>(<a class="code" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e">blockpresent</a>(blocknr))
        {
          bytes_per_blockelement = <a class="code" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c">get_bytes_per_blockelement</a>(blocknr);

          blockmaxlen = ((int) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.BufferSize * 1024 * 1024)) / bytes_per_blockelement;

          npart = <a class="code" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9">get_particles_in_block</a>(blocknr, &amp;typelist[0]);

          <span class="keywordflow">if</span>(npart &gt; 0)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask)
                {

                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 2)
                    {
                      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 2)
                        {
                          blksize = <span class="keyword">sizeof</span>(int) + 4 * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>);
                          <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;
                          <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(<a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr], <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 4, fd);
                          nextblock = npart * bytes_per_blockelement + 2 * <span class="keyword">sizeof</span>(int);
                          <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(&amp;nextblock, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, fd);
                          <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;
                        }

                      blksize = npart * bytes_per_blockelement;
                      <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;

                    }
                }

              <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)
                {
                  <span class="keywordflow">if</span>(typelist[type])
                    {
<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>                      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask &amp;&amp; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 3 &amp;&amp; <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[type] &gt; 0)
                        {
                          <span class="keywordflow">switch</span> (<a class="code" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1">get_datatype_in_block</a>(blocknr))
                            {
                            <span class="keywordflow">case</span> 0:
                              hdf5_datatype = H5Tcopy(H5T_NATIVE_UINT);
                              <span class="keywordflow">break</span>;
                            <span class="keywordflow">case</span> 1:
                              hdf5_datatype = H5Tcopy(H5T_NATIVE_FLOAT);
                              <span class="keywordflow">break</span>;
                            <span class="keywordflow">case</span> 2:
                              hdf5_datatype = H5Tcopy(H5T_NATIVE_UINT64);
                              <span class="keywordflow">break</span>;
                            }

                          dims[0] = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[type];
                          dims[1] = <a class="code" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a>(blocknr);
                          <span class="keywordflow">if</span>(dims[1] == 1)
                            rank = 1;
                          <span class="keywordflow">else</span>
                            rank = 2;

                          <a class="code" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686">get_dataset_name</a>(blocknr, buf);

                          hdf5_dataspace_in_file = H5Screate_simple(rank, dims, NULL);
                          hdf5_dataset =
                            H5Dcreate(hdf5_grp[type], buf, hdf5_datatype, hdf5_dataspace_in_file,
                                      H5P_DEFAULT);
                          pcsum = 0;
                        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
                      <span class="keywordflow">for</span>(task = writeTask, offset = 0; task &lt;= lastTask; task++)
                        {
                          <span class="keywordflow">if</span>(task == <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                            {
                              n_for_this_task = <a class="code" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a>[type];

                              <span class="keywordflow">for</span>(p = writeTask; p &lt;= lastTask; p++)
                                <span class="keywordflow">if</span>(p != <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                                  MPI_Send(&amp;n_for_this_task, 1, MPI_INT, p, <a class="code" href="tags_8h.html#a1acb707e12b7d1963c1d9101e93f6f4e">TAG_NFORTHISTASK</a>, MPI_COMM_WORLD);
                            }
                          <span class="keywordflow">else</span>
                            MPI_Recv(&amp;n_for_this_task, 1, MPI_INT, task, <a class="code" href="tags_8h.html#a1acb707e12b7d1963c1d9101e93f6f4e">TAG_NFORTHISTASK</a>, MPI_COMM_WORLD,
                                     &amp;status);

                          <span class="keywordflow">while</span>(n_for_this_task &gt; 0)
                            {
                              pc = n_for_this_task;

                              <span class="keywordflow">if</span>(pc &gt; blockmaxlen)
                                pc = blockmaxlen;

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == task)
                                <a class="code" href="io_8c.html#a4b34f2381777023014f80c959ad1f88a">fill_write_buffer</a>(blocknr, &amp;offset, pc, type);

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask &amp;&amp; task != writeTask)
                                MPI_Recv(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement * pc, MPI_BYTE, task,
                                         <a class="code" href="tags_8h.html#a41c046c7898c1956074313fd83f50b39">TAG_PDATA</a>, MPI_COMM_WORLD, &amp;status);

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> != writeTask &amp;&amp; task == <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                                MPI_Ssend(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement * pc, MPI_BYTE, writeTask,
                                          <a class="code" href="tags_8h.html#a41c046c7898c1956074313fd83f50b39">TAG_PDATA</a>, MPI_COMM_WORLD);

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask)
                                {
                                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 3)
                                    {
<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>                                      start[0] = pcsum;
                                      start[1] = 0;

                                      count[0] = pc;
                                      count[1] = <a class="code" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a>(blocknr);
                                      pcsum += pc;

                                      H5Sselect_hyperslab(hdf5_dataspace_in_file, H5S_SELECT_SET,
                                                          start, NULL, count, NULL);

                                      dims[0] = pc;
                                      dims[1] = <a class="code" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a>(blocknr);
                                      hdf5_dataspace_memory = H5Screate_simple(rank, dims, NULL);

                                      hdf5_status =
                                        H5Dwrite(hdf5_dataset, hdf5_datatype, hdf5_dataspace_memory,
                                                 hdf5_dataspace_in_file, H5P_DEFAULT, <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>);

                                      H5Sclose(hdf5_dataspace_memory);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                                    }
                                  <span class="keywordflow">else</span>
                                    <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement, pc, fd);
                                }

                              n_for_this_task -= pc;
                            }
                        }

<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>                      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask &amp;&amp; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 3 &amp;&amp; <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[type] &gt; 0)
                        {
                          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 3)
                            {
                              H5Dclose(hdf5_dataset);
                              H5Sclose(hdf5_dataspace_in_file);
                              H5Tclose(hdf5_datatype);
                            }
                        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                    }
                }

              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask)
                {
                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 2)
                    <a class="code" href="io_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;
                }
            }
        }
    }

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == writeTask)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SnapFormat == 3)
        {
<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>          <span class="keywordflow">for</span>(type = 5; type &gt;= 0; type--)
            <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart[type] &gt; 0)
              H5Gclose(hdf5_grp[type]);
          H5Gclose(hdf5_headergrp);
          H5Fclose(hdf5_file);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }
      <span class="keywordflow">else</span>
        fclose(fd);
    }
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a2b3f5bacd7313da0f3ffa55e41907481_cgraph.png" border="0" usemap="#io_8c_a2b3f5bacd7313da0f3ffa55e41907481_cgraph" alt=""/></div>
<map name="io_8c_a2b3f5bacd7313da0f3ffa55e41907481_cgraph" id="io_8c_a2b3f5bacd7313da0f3ffa55e41907481_cgraph">
<area shape="rect" id="node3" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e" title="blockpresent" alt="" coords="192,30,296,58"/><area shape="rect" id="node5" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="449,334,516,362"/><area shape="rect" id="node9" href="io_8c.html#a4b34f2381777023014f80c959ad1f88a" title="fill_write_buffer" alt="" coords="187,81,301,109"/><area shape="rect" id="node19" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c" title="get_bytes_per_blockelement" alt="" coords="141,182,347,210"/><area shape="rect" id="node21" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686" title="get_dataset_name" alt="" coords="173,233,315,261"/><area shape="rect" id="node23" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1" title="get_datatype_in_block" alt="" coords="161,283,327,311"/><area shape="rect" id="node25" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9" title="get_particles_in_block" alt="" coords="163,334,325,362"/><area shape="rect" id="node28" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f" title="get_values_per_blockelement" alt="" coords="139,385,349,413"/><area shape="rect" id="node30" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21" title="my_fwrite" alt="" coords="203,435,285,463"/><area shape="rect" id="node33" href="io_8c.html#ad5243b69dcba17be62f7d64f422bfbbf" title="write_header_attributes_in_hdf5" alt="" coords="131,486,357,514"/><area shape="rect" id="node7" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="608,334,765,362"/><area shape="rect" id="node11" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85" title="dmax" alt="" coords="453,5,512,33"/><area shape="rect" id="node13" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059" title="get_gravkick_factor" alt="" coords="409,55,556,83"/><area shape="rect" id="node15" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c" title="get_hydrokick_factor" alt="" coords="405,106,560,134"/><area shape="rect" id="node17" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="460,157,505,185"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_a2b3f5bacd7313da0f3ffa55e41907481_icgraph.png" border="0" usemap="#io_8c_a2b3f5bacd7313da0f3ffa55e41907481_icgraph" alt=""/></div>
<map name="io_8c_a2b3f5bacd7313da0f3ffa55e41907481_icgraph" id="io_8c_a2b3f5bacd7313da0f3ffa55e41907481_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="131,5,240,33"/><area shape="rect" id="node5" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="555,5,597,33"/><area shape="rect" id="node9" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="288,30,507,58"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="647,5,700,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad5243b69dcba17be62f7d64f422bfbbf"></a><!-- doxytag: member="io.c::write_header_attributes_in_hdf5" ref="ad5243b69dcba17be62f7d64f422bfbbf" args="(hid_t handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="proto_8h.html#ad5243b69dcba17be62f7d64f422bfbbf">write_header_attributes_in_hdf5</a> </td>
          <td>(</td>
          <td class="paramtype">hid_t&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function writes the header information in case HDF5 is selected as file format. </p>

<p>Definition at line <a class="el" href="io_8c_source.html#l00998">998</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00162">header</a>.</p>

<p>Referenced by <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>
<div class="fragment"><pre class="fragment">{
  hsize_t adim[1] = { 6 };
  hid_t hdf5_dataspace, hdf5_attribute;

  hdf5_dataspace = H5Screate(H5S_SIMPLE);
  H5Sset_extent_simple(hdf5_dataspace, 1, adim, NULL);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;NumPart_ThisFile&quot;</span>, H5T_NATIVE_INT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_UINT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npart);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SIMPLE);
  H5Sset_extent_simple(hdf5_dataspace, 1, adim, NULL);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;NumPart_Total&quot;</span>, H5T_NATIVE_UINT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_UINT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npartTotal);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SIMPLE);
  H5Sset_extent_simple(hdf5_dataspace, 1, adim, NULL);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;NumPart_Total_HW&quot;</span>, H5T_NATIVE_UINT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_UINT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.npartTotalHighWord);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);


  hdf5_dataspace = H5Screate(H5S_SIMPLE);
  H5Sset_extent_simple(hdf5_dataspace, 1, adim, NULL);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;MassTable&quot;</span>, H5T_NATIVE_DOUBLE, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_DOUBLE, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.mass);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Time&quot;</span>, H5T_NATIVE_DOUBLE, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.time);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Redshift&quot;</span>, H5T_NATIVE_DOUBLE, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.redshift);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;BoxSize&quot;</span>, H5T_NATIVE_DOUBLE, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.BoxSize);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;NumFilesPerSnapshot&quot;</span>, H5T_NATIVE_INT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.num_files);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Omega0&quot;</span>, H5T_NATIVE_DOUBLE, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.Omega0);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;OmegaLambda&quot;</span>, H5T_NATIVE_DOUBLE, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.OmegaLambda);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;HubbleParam&quot;</span>, H5T_NATIVE_DOUBLE, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.HubbleParam);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Flag_Sfr&quot;</span>, H5T_NATIVE_INT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_sfr);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Flag_Cooling&quot;</span>, H5T_NATIVE_INT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_cooling);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Flag_StellarAge&quot;</span>, H5T_NATIVE_INT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_stellarage);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Flag_Metals&quot;</span>, H5T_NATIVE_INT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_metals);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  hdf5_dataspace = H5Screate(H5S_SCALAR);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Flag_Feedback&quot;</span>, H5T_NATIVE_INT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_feedback);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);

  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_entropy_instead_u = 0;

  hdf5_dataspace = H5Screate(H5S_SIMPLE);
  H5Sset_extent_simple(hdf5_dataspace, 1, adim, NULL);
  hdf5_attribute = H5Acreate(handle, <span class="stringliteral">&quot;Flag_Entropy_ICs&quot;</span>, H5T_NATIVE_UINT, hdf5_dataspace, H5P_DEFAULT);
  H5Awrite(hdf5_attribute, H5T_NATIVE_UINT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.flag_entropy_instead_u);
  H5Aclose(hdf5_attribute);
  H5Sclose(hdf5_dataspace);
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c_ad5243b69dcba17be62f7d64f422bfbbf_icgraph.png" border="0" usemap="#io_8c_ad5243b69dcba17be62f7d64f422bfbbf_icgraph" alt=""/></div>
<map name="io_8c_ad5243b69dcba17be62f7d64f422bfbbf_icgraph" id="io_8c_ad5243b69dcba17be62f7d64f422bfbbf_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a48b0ed3a843924501df8ed871e08e77c" title="write_file" alt="" coords="280,5,357,33"/><area shape="rect" id="node5" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="405,5,515,33"/><area shape="rect" id="node7" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="829,5,872,33"/><area shape="rect" id="node11" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="563,30,781,58"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="921,5,975,33"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a217c441656b4bdc1caf0019b5a809bee"></a><!-- doxytag: member="io.c::n_type" ref="a217c441656b4bdc1caf0019b5a809bee" args="[6]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="io_8c.html#a217c441656b4bdc1caf0019b5a809bee">n_type</a>[6]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="io_8c_source.html#l00021">21</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>Referenced by <a class="el" href="io_8c_source.html#l00033">savepositions()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>

</div>
</div>
<a class="anchor" id="a3cfb701790acb5a9b71ba995148bbf40"></a><!-- doxytag: member="io.c::ntot_type_all" ref="a3cfb701790acb5a9b71ba995148bbf40" args="[6]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long long <a class="el" href="io_8c.html#a3cfb701790acb5a9b71ba995148bbf40">ntot_type_all</a>[6]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="io_8c_source.html#l00022">22</a> of file <a class="el" href="io_8c_source.html">io.c</a>.</p>

<p>Referenced by <a class="el" href="io_8c_source.html#l00033">savepositions()</a>, and <a class="el" href="io_8c_source.html#l00672">write_file()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="io_8c.html">io.c</a>      </li>

    <li class="footer">Generated on Fri Dec 6 2013 15:20:11 for gadget-sidm by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
