<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: init.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>init.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>Code for initialisation of a simulation from initial conditions.  
<a href="#_details">More...</a></p>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for init.c:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c__incl.png" border="0" usemap="#init_8c" alt=""/></div>
<map name="init_8c" id="init_8c">
<area shape="rect" id="node11" href="allvars_8h.html" title="declares global variables." alt="" coords="339,160,413,189"/><area shape="rect" id="node19" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="413,83,480,112"/><area shape="rect" id="node17" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="451,237,512,267"/></map>
</div>

<p><a href="init_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a2858154e2009b0e6e616f313177762bc">init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#a1b96c5b41f1209ee91cd369f01a52352">check_omega</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="init_8c.html#abca44f066552d38c44a1cd6020d349d5">setup_smoothinglengths</a> (void)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Code for initialisation of a simulation from initial conditions. </p>

<p>Definition in file <a class="el" href="init_8c_source.html">init.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1b96c5b41f1209ee91cd369f01a52352"></a><!-- doxytag: member="init.c::check_omega" ref="a1b96c5b41f1209ee91cd369f01a52352" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_omega </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine computes the mass content of the box and compares it to the specified value of Omega-matter. If discrepant, the run is terminated. </p>

<p>Definition at line <a class="el" href="init_8c_source.html#l00161">161</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00264">global_data_all_processes::BoxSize</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="allvars_8h_source.html#l00307">global_data_all_processes::G</a>, <a class="el" href="allvars_8h_source.html#l00324">global_data_all_processes::Hubble</a>, <a class="el" href="allvars_8h_source.html#l00668">state_of_system::Mass</a>, <a class="el" href="allvars_8c_source.html#l00015">NumPart</a>, <a class="el" href="allvars_8h_source.html#l00325">global_data_all_processes::Omega0</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, and <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00020">init()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> mass = 0, masstot, omega;
  <span class="keywordtype">int</span> i;

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    mass += <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structstate__of__system.html#a8a3263df2542de95325b0684814dab52">Mass</a>;

  MPI_Allreduce(&amp;mass, &amp;masstot, 1, MPI_DOUBLE, MPI_SUM, MPI_COMM_WORLD);

  omega =
    masstot / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">BoxSize</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">BoxSize</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">BoxSize</a>) / (3 * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a6e6a37250907d90a56f92a55aefdda5f">Hubble</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a6e6a37250907d90a56f92a55aefdda5f">Hubble</a> / (8 * M_PI * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1250b5c6e116b576ff09cbcd928d2063">G</a>));

  <span class="keywordflow">if</span>(fabs(omega - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abac5eca1b5851e670eec01d4dd47c417">Omega0</a>) &gt; 1.0e-3)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        {
          printf(<span class="stringliteral">&quot;\n\nI&#39;ve found something odd!\n&quot;</span>);
          printf
            (<span class="stringliteral">&quot;The mass content accounts only for Omega=%g,\nbut you specified Omega=%g in the parameterfile.\n&quot;</span>,
             omega, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abac5eca1b5851e670eec01d4dd47c417">Omega0</a>);
          printf(<span class="stringliteral">&quot;\nI better stop.\n&quot;</span>);

          fflush(stdout);
        }
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c_a1b96c5b41f1209ee91cd369f01a52352_cgraph.png" border="0" usemap="#init_8c_a1b96c5b41f1209ee91cd369f01a52352_cgraph" alt=""/></div>
<map name="init_8c_a1b96c5b41f1209ee91cd369f01a52352_cgraph" id="init_8c_a1b96c5b41f1209ee91cd369f01a52352_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="165,5,232,35"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="280,5,437,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c_a1b96c5b41f1209ee91cd369f01a52352_icgraph.png" border="0" usemap="#init_8c_a1b96c5b41f1209ee91cd369f01a52352_icgraph" alt=""/></div>
<map name="init_8c_a1b96c5b41f1209ee91cd369f01a52352_icgraph" id="init_8c_a1b96c5b41f1209ee91cd369f01a52352_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="167,5,207,35"/><area shape="rect" id="node5" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="256,5,323,35"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="372,5,425,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2858154e2009b0e6e616f313177762bc"></a><!-- doxytag: member="init.c::init" ref="a2858154e2009b0e6e616f313177762bc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function reads the initial conditions, and allocates storage for the tree. Various variables of the particle data are initialised and An intial domain decomposition is performed. If SPH particles are present, the inial SPH smoothing lengths are determined. </p>

<p><p>&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], * where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29</p>
<p>&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], * where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29</p>
<p>&lt; defines maximum length of neighbour list</p>
<p>&lt; adiabatic index of simulated gas</p>
<p>&lt; adiabatic index of simulated gas </p>
</p>

<p>Definition at line <a class="el" href="init_8c_source.html#l00020">20</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="init_8c_source.html#l00161">check_omega()</a>, <a class="el" href="allvars_8h_source.html#l00333">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="allvars_8h_source.html#l00541">sph_particle_data::Density</a>, <a class="el" href="domain_8c_source.html#l00062">domain_Decomposition()</a>, <a class="el" href="allvars_8h_source.html#l00547">sph_particle_data::DtEntropy</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="allvars_8h_source.html#l00636">io_header::flag_entropy_instead_u</a>, <a class="el" href="allvars_8c_source.html#l00036">Flag_FullStep</a>, <a class="el" href="forcetree_8c_source.html#l02808">force_treeallocate()</a>, <a class="el" href="allvars_8h_source.html#l00055">GAMMA_MINUS1</a>, <a class="el" href="system_8c_source.html#l00029">get_random_number()</a>, <a class="el" href="allvars_8h_source.html#l00523">particle_data::GravCost</a>, <a class="el" href="allvars_8c_source.html#l00162">header</a>, <a class="el" href="allvars_8h_source.html#l00542">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h_source.html#l00548">sph_particle_data::HydroAccel</a>, <a class="el" href="allvars_8h_source.html#l00266">global_data_all_processes::ICFormat</a>, <a class="el" href="allvars_8h_source.html#l00475">global_data_all_processes::InitCondFile</a>, <a class="el" href="allvars_8h_source.html#l00091">MAX_NGB</a>, <a class="el" href="allvars_8h_source.html#l00261">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8c_source.html#l00016">N_gas</a>, <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>, <a class="el" href="ngb_8c_source.html#l00403">ngb_treebuild()</a>, <a class="el" href="allvars_8h_source.html#l00350">global_data_all_processes::NumCurrentTiStep</a>, <a class="el" href="allvars_8h_source.html#l00302">global_data_all_processes::NumForcesSinceLastDomainDecomp</a>, <a class="el" href="allvars_8c_source.html#l00015">NumPart</a>, <a class="el" href="allvars_8h_source.html#l00510">particle_data::OldAcc</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="allvars_8h_source.html#l00334">global_data_all_processes::PeriodicBoundariesOn</a>, <a class="el" href="allvars_8h_source.html#l00372">global_data_all_processes::PM_Ti_begstep</a>, <a class="el" href="allvars_8h_source.html#l00371">global_data_all_processes::PM_Ti_endstep</a>, <a class="el" href="allvars_8h_source.html#l00509">particle_data::Potential</a>, <a class="el" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow()</a>, <a class="el" href="read__ic_8c_source.html#l00031">read_ic()</a>, <a class="el" href="allvars_8c_source.html#l00026">RestartFlag</a>, <a class="el" href="proto_8h.html#aeb05544fcefa17dff1e34bf3c65a0135">seed_glass()</a>, <a class="el" href="gravtree_8c_source.html#l00464">set_softenings()</a>, <a class="el" href="init_8c_source.html#l00198">setup_smoothinglengths()</a>, <a class="el" href="allvars_8h_source.html#l00343">global_data_all_processes::SnapshotFileCount</a>, <a class="el" href="allvars_8c_source.html#l00128">SphP</a>, <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h_source.html#l00519">particle_data::Ti_begstep</a>, <a class="el" href="allvars_8h_source.html#l00364">global_data_all_processes::Ti_Current</a>, <a class="el" href="allvars_8h_source.html#l00518">particle_data::Ti_endstep</a>, <a class="el" href="allvars_8h_source.html#l00355">global_data_all_processes::Time</a>, <a class="el" href="allvars_8h_source.html#l00025">TIMEBASE</a>, <a class="el" href="allvars_8h_source.html#l00363">global_data_all_processes::Timebase_interval</a>, <a class="el" href="allvars_8h_source.html#l00356">global_data_all_processes::TimeBegin</a>, <a class="el" href="allvars_8h_source.html#l00348">global_data_all_processes::TimeBetStatistics</a>, <a class="el" href="allvars_8h_source.html#l00349">global_data_all_processes::TimeLastStatistics</a>, <a class="el" href="allvars_8h_source.html#l00358">global_data_all_processes::TimeMax</a>, <a class="el" href="allvars_8h_source.html#l00301">global_data_all_processes::TotNumOfForces</a>, <a class="el" href="allvars_8h_source.html#l00258">global_data_all_processes::TotNumPart</a>, <a class="el" href="allvars_8h_source.html#l00284">global_data_all_processes::TreeAllocFactor</a>, <a class="el" href="allvars_8h_source.html#l00438">global_data_all_processes::TreeDomainUpdateFrequency</a>, <a class="el" href="allvars_8c_source.html#l00034">TreeReconstructFlag</a>, <a class="el" href="allvars_8h_source.html#l00501">particle_data::Vel</a>, and <a class="el" href="allvars_8h_source.html#l00549">sph_particle_data::VelPred</a>.</p>

<p>Referenced by <a class="el" href="begrun_8c_source.html#l00028">begrun()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i, j;
  <span class="keywordtype">double</span> a3;

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>;

  <span class="keywordflow">switch</span> (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a>)
    {
    <span class="keywordflow">case</span> 1:
<span class="preprocessor">#if (MAKEGLASS &gt; 1)</span>
<span class="preprocessor"></span>      <a class="code" href="proto_8h.html#aeb05544fcefa17dff1e34bf3c65a0135">seed_glass</a>();
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      <a class="code" href="proto_8h.html#a150344fdc0c6e132aecdb6c646529df1">read_ic</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#adacd2b54a924bb4ce144afc1abbc6138">InitCondFile</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> 2:
    <span class="keywordflow">case</span> 3:
      <a class="code" href="proto_8h.html#a150344fdc0c6e132aecdb6c646529df1">read_ic</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#adacd2b54a924bb4ce144afc1abbc6138">InitCondFile</a>);
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;ICFormat=%d not supported.\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a>);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
    }

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>;
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> = 0;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
    {
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a> = (log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3e22fbc2ce177c1e383e9acbbf44f8d5">TimeMax</a>) - log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>)) / <a class="code" href="allvars_8h.html#ad44dabdb7a0bef8536e2d34a01177d48">TIMEBASE</a>;
      a3 = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>;
    }
  <span class="keywordflow">else</span>
    {
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a> = (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3e22fbc2ce177c1e383e9acbbf44f8d5">TimeMax</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>) / <a class="code" href="allvars_8h.html#ad44dabdb7a0bef8536e2d34a01177d48">TIMEBASE</a>;
      a3 = 1;
    }

  <a class="code" href="gravtree_8c.html#aab39b7857a85e95ef6f926ac82d4ff91">set_softenings</a>();

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a> = 0;     <span class="comment">/* setup some counters */</span>
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aac0d3fcbac688a31e6bda55ef819c44b">SnapshotFileCount</a> = 0;
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 2)
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aac0d3fcbac688a31e6bda55ef819c44b">SnapshotFileCount</a> = atoi(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#adacd2b54a924bb4ce144afc1abbc6138">InitCondFile</a> + strlen(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#adacd2b54a924bb4ce144afc1abbc6138">InitCondFile</a>) - 3) + 1;

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a44181b6f6375de86c7dda1059d2fc3f4">TotNumOfForces</a> = 0;
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a64e0b5f35f25dd09297bc41acf0502f7">NumForcesSinceLastDomainDecomp</a> = 0;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a52b027433ffad064869c606656e9bf7d">PeriodicBoundariesOn</a> == 1)
      <a class="code" href="init_8c.html#a1b96c5b41f1209ee91cd369f01a52352">check_omega</a>();

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab088f20e7889a88f2e0f652df4781e44">TimeLastStatistics</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a516be9ff5c4fd4171aa8e1a687e1e72d">TimeBetStatistics</a>;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>) <span class="comment">/*  change to new velocity variable */</span>
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
        <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
          <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].Vel[j] *= sqrt(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>;
    }

  <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)  <span class="comment">/*  start-up initialization */</span>
    {
      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravAccel[j] = 0;
<span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].GravPM[j] = 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a9bf2c52c7378a961222d9fe8faa9c208">Ti_endstep</a> = 0;
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a6c9f057d234839cecaaeffc87b7a9794">Ti_begstep</a> = 0;

      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a5466aae28c06365368c9399c8f7cc02d">OldAcc</a> = 0;
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a2f34828ae7803611a4e86bb201697317">GravCost</a> = 1;
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a9d45a0cefc6121831905e169072550d0">Potential</a> = 0;
    }

<span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a723a0aa2f2ac0ac4cc58ebc049dda9b3">PM_Ti_endstep</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a53412b692a49924318748259987031aa">PM_Ti_begstep</a> = 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef FLEXSTEPS</span>
<span class="preprocessor"></span>  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.PresentMinStep = TIMEBASE;
  <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)  <span class="comment">/*  start-up initialization */</span>
    {
      <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].FlexStepGrp = (int) (<a class="code" href="allvars_8h.html#ad44dabdb7a0bef8536e2d34a01177d48">TIMEBASE</a> * <a class="code" href="proto_8h.html#a0d508d57eb6f608ff6eec8ac11bb9c05">get_random_number</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].ID));
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>; i++)    <span class="comment">/* initialize sph_properties */</span>
    {
      <span class="keywordflow">for</span>(j = 0; j &lt; 3; j++)
        {
          <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#a730acdc1da11f80da2214ebb76e6c2b3">VelPred</a>[j] = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#ad7808af1e23fbd920d7eb477bc68bd00">Vel</a>[j];
          <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#aa3441b1ee8351048b3dcac10b36b0b6c">HydroAccel</a>[j] = 0;
        }

      <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#a27aeefa50674867d3dec1c359b7191c8">DtEntropy</a> = 0;

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 0)
        {
          <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#af9efa599cdd656b26a0df5f89430b4d1">Hsml</a> = 0;
          <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#aaeca7f3efec44ebd5b7d36ce79d38779">Density</a> = -1;
        }
    }

  <a class="code" href="ngb_8c.html#a6f7a3b85f10701b9067f012cc9a30f55">ngb_treeallocate</a>(<a class="code" href="allvars_8h.html#a459bf1b27bb8a17c4496d2783e62161c">MAX_NGB</a>);

  <a class="code" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2">force_treeallocate</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>);

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a64e0b5f35f25dd09297bc41acf0502f7">NumForcesSinceLastDomainDecomp</a> = 1 + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a31f122fafb06e13f611ff905f514bfa9">TreeDomainUpdateFrequency</a>;

  <a class="code" href="allvars_8c.html#a6343a9f3619e77c1796309b8deda7f50">Flag_FullStep</a> = 1;            <span class="comment">/* to ensure that Peano-Hilber order is done */</span>

  <a class="code" href="domain_8c.html#ae8e3aa408eaab9544cb7f93e69185492">domain_Decomposition</a>();       <span class="comment">/* do initial domain decomposition (gives equal numbers of particles) */</span>

  <a class="code" href="ngb_8c.html#ac56af97a1dbbbbb07db8207246852f79">ngb_treebuild</a>();              <span class="comment">/* will build tree */</span>

  <a class="code" href="init_8c.html#abca44f066552d38c44a1cd6020d349d5">setup_smoothinglengths</a>();

  <a class="code" href="allvars_8c.html#aa32d7269f9baf3ffdbdd509982fca128">TreeReconstructFlag</a> = 1;

  <span class="comment">/* at this point, the entropy variable normally contains the </span>
<span class="comment">   * internal energy, read in from the initial conditions file, unless the file</span>
<span class="comment">   * explicitly signals that the initial conditions contain the entropy directly. </span>
<span class="comment">   * Once the density has been computed, we can convert thermal energy to entropy.</span>
<span class="comment">   */</span>
<span class="preprocessor">#ifndef ISOTHERM_EQS</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a448788ace72155e22d19af1c01917857">flag_entropy_instead_u</a> == 0)
    <span class="keywordflow">for</span>(i = 0; i &lt; N_gas; i++)
      <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Entropy = <a class="code" href="allvars_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a> * <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Entropy / <a class="code" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(<a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Density / a3, <a class="code" href="allvars_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c_a2858154e2009b0e6e616f313177762bc_cgraph.png" border="0" usemap="#init_8c_a2858154e2009b0e6e616f313177762bc_cgraph" alt=""/></div>
<map name="init_8c_a2858154e2009b0e6e616f313177762bc_cgraph" id="init_8c_a2858154e2009b0e6e616f313177762bc_cgraph">
<area shape="rect" id="node3" href="init_8c.html#a1b96c5b41f1209ee91cd369f01a52352" title="check_omega" alt="" coords="132,1005,241,1034"/><area shape="rect" id="node5" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="845,801,912,830"/><area shape="rect" id="node9" href="domain_8c.html#ae8e3aa408eaab9544cb7f93e69185492" title="domain_Decomposition" alt="" coords="100,1692,273,1721"/><area shape="rect" id="node49" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="856,2004,901,2033"/><area shape="rect" id="node52" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2" title="force_treeallocate" alt="" coords="119,1058,255,1088"/><area shape="rect" id="node55" href="proto_8h.html#a0d508d57eb6f608ff6eec8ac11bb9c05" title="get_random_number" alt="" coords="800,64,957,93"/><area shape="rect" id="node57" href="ngb_8c.html#a6f7a3b85f10701b9067f012cc9a30f55" title="ngb_treeallocate" alt="" coords="123,220,251,249"/><area shape="rect" id="node60" href="ngb_8c.html#ac56af97a1dbbbbb07db8207246852f79" title="ngb_treebuild" alt="" coords="132,153,241,182"/><area shape="rect" id="node73" href="proto_8h.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="153,876,220,905"/><area shape="rect" id="node111" href="proto_8h.html#aeb05544fcefa17dff1e34bf3c65a0135" title="seed_glass" alt="" coords="140,2132,233,2161"/><area shape="rect" id="node113" href="gravtree_8c.html#aab39b7857a85e95ef6f926ac82d4ff91" title="set_softenings" alt="" coords="129,2185,244,2214"/><area shape="rect" id="node115" href="init_8c.html#abca44f066552d38c44a1cd6020d349d5" title="setup_smoothinglengths" alt="" coords="97,1876,276,1905"/><area shape="rect" id="node7" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="1005,801,1163,830"/><area shape="rect" id="node11" href="predict_8c.html#adda9e167a16a53d1aa40180406950446" title="do_box_wrapping" alt="" coords="336,1718,467,1748"/><area shape="rect" id="node13" href="domain_8c.html#a647e0c1a76b7f064ed5d201662f364bf" title="domain_decompose" alt="" coords="325,1372,477,1401"/><area shape="rect" id="node37" href="peano_8c.html#af3e45a4293584b3fe28e83af75c6ed71" title="peano_hilbert_order" alt="" coords="327,1665,476,1694"/><area shape="rect" id="node45" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174" title="second" alt="" coords="605,1772,672,1801"/><area shape="rect" id="node47" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d" title="timediff" alt="" coords="604,1876,673,1905"/><area shape="rect" id="node15" href="domain_8c.html#a77c115c3aa2069d0eb8521329be0483c" title="domain_countToGo" alt="" coords="567,1268,711,1297"/><area shape="rect" id="node17" href="domain_8c.html#a25b4f5eb395f918bad4b4bc1fc3dc729" title="domain_determineTopTree" alt="" coords="544,1398,733,1428"/><area shape="rect" id="node19" href="domain_8c.html#ab7d41435f73c1626208d63b2d5ba28ca" title="domain_exchangeParticles" alt="" coords="543,1161,735,1190"/><area shape="rect" id="node22" href="domain_8c.html#a0e758ec7eef32fc7180092547f5a11b9" title="domain_findExchangeNumbers" alt="" coords="528,1452,749,1481"/><area shape="rect" id="node24" href="domain_8c.html#add5620cbc133c73f0ce7da3a8fe9c01e" title="domain_findExtent" alt="" coords="568,1505,709,1534"/><area shape="rect" id="node26" href="domain_8c.html#a412d5d8810751249cc8dcd9e219e4e57" title="domain_findSplit" alt="" coords="575,1345,703,1374"/><area shape="rect" id="node31" href="domain_8c.html#a89c54187117b91d4270a4f0c406ce2ba" title="domain_shiftSplit" alt="" coords="573,1558,704,1588"/><area shape="rect" id="node34" href="domain_8c.html#a25aada0d3751c2afd2a376151d1d917e" title="domain_sumCost" alt="" coords="572,1214,705,1244"/><area shape="rect" id="node28" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85" title="dmax" alt="" coords="849,1452,908,1481"/><area shape="rect" id="node39" href="peano_8c.html#af3ffb253e14a79419d1effeee1b7261d" title="compare_key" alt="" coords="585,1665,692,1694"/><area shape="rect" id="node41" href="peano_8c.html#af744cef873e3093ba2924da8265d1711" title="reorder_gas" alt="" coords="589,1718,688,1748"/><area shape="rect" id="node43" href="peano_8c.html#afcb358154dd7fd5de8b4156f417fb0ba" title="reorder_particles" alt="" coords="573,1612,704,1641"/><area shape="rect" id="node62" href="forcetree_8c.html#a10f92098e86f82baec9f84a283f4c9e5" title="force_treebuild" alt="" coords="343,141,460,170"/><area shape="rect" id="node64" href="forcetree_8c.html#a947a734f3bbba14d4092c7480880d3c7" title="force_flag_localnodes" alt="" coords="560,62,717,92"/><area shape="rect" id="node66" href="forcetree_8c.html#aadc9b1624ed78f3ccd0dbb9908fe0bb6" title="force_treebuild_single" alt="" coords="559,116,719,145"/><area shape="rect" id="node70" href="forcetree_8c.html#af9a7e3a922557e089da5d7ee1dde89a0" title="force_update_pseudoparticles" alt="" coords="532,169,745,198"/><area shape="rect" id="node75" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab" title="distribute_file" alt="" coords="348,796,455,825"/><area shape="rect" id="node79" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345" title="fill_Tab_IO_Labels" alt="" coords="336,849,467,878"/><area shape="rect" id="node81" href="proto_8h.html#ac028b474d53a40e79377b7ae5dde636a" title="find_files" alt="" coords="363,902,440,932"/><area shape="rect" id="node86" href="proto_8h.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="364,617,439,646"/><area shape="rect" id="node84" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9" title="read_header_attributes_in_hdf5" alt="" coords="527,854,751,884"/><area shape="rect" id="node88" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7" title="allocate_memory" alt="" coords="572,748,705,777"/><area shape="rect" id="node91" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e" title="blockpresent" alt="" coords="587,484,691,513"/><area shape="rect" id="node93" href="proto_8h.html#a3757efb7e470353080a128388ccebec9" title="empty_read_buffer" alt="" coords="568,537,709,566"/><area shape="rect" id="node96" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c" title="get_bytes_per_blockelement" alt="" coords="536,590,741,620"/><area shape="rect" id="node98" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686" title="get_dataset_name" alt="" coords="568,324,709,353"/><area shape="rect" id="node100" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1" title="get_datatype_in_block" alt="" coords="556,377,721,406"/><area shape="rect" id="node102" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9" title="get_particles_in_block" alt="" coords="557,801,720,830"/><area shape="rect" id="node105" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f" title="get_values_per_blockelement" alt="" coords="533,430,744,460"/><area shape="rect" id="node107" href="io_8c.html#a1609620c03f6b0068601735c42e3c660" title="my_fread" alt="" coords="597,644,680,673"/><area shape="rect" id="node117" href="density_8c.html#ad86cdeb9e3bfbe9af379ac9f7daf194c" title="density" alt="" coords="368,1876,435,1905"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c_a2858154e2009b0e6e616f313177762bc_icgraph.png" border="0" usemap="#init_8c_a2858154e2009b0e6e616f313177762bc_icgraph" alt=""/></div>
<map name="init_8c_a2858154e2009b0e6e616f313177762bc_icgraph" id="init_8c_a2858154e2009b0e6e616f313177762bc_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="96,5,163,35"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="212,5,265,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abca44f066552d38c44a1cd6020d349d5"></a><!-- doxytag: member="init.c::setup_smoothinglengths" ref="abca44f066552d38c44a1cd6020d349d5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_smoothinglengths </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function is used to find an initial smoothing length for each SPH particle. It guarantees that the number of neighbours will be between desired_ngb-MAXDEV and desired_ngb+MAXDEV. For simplicity, a first guess of the smoothing length is provided to the function <a class="el" href="density_8c.html#ad86cdeb9e3bfbe9af379ac9f7daf194c">density()</a>, which will then iterate if needed to find the right smoothing length. </p>

<p>Definition at line <a class="el" href="init_8c_source.html#l00198">198</a> of file <a class="el" href="init_8c_source.html">init.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">NODE::d</a>, <a class="el" href="density_8c_source.html#l00056">density()</a>, <a class="el" href="allvars_8h_source.html#l00290">global_data_all_processes::DesNumNgb</a>, <a class="el" href="allvars_8c_source.html#l00149">Father</a>, <a class="el" href="allvars_8h_source.html#l00542">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h_source.html#l00571">NODE::len</a>, <a class="el" href="allvars_8h_source.html#l00500">particle_data::Mass</a>, <a class="el" href="allvars_8c_source.html#l00016">N_gas</a>, <a class="el" href="allvars_8c_source.html#l00142">Nodes</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow()</a>, <a class="el" href="allvars_8c_source.html#l00026">RestartFlag</a>, <a class="el" href="allvars_8c_source.html#l00128">SphP</a>, and <a class="el" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">NODE::u</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00020">init()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i, no, p;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 0)
    {

      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>; i++)
        {
          no = <a class="code" href="allvars_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[i];

          <span class="keywordflow">while</span>(10 * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#accb74aa1ccf3fb13e31f5704bb692313">DesNumNgb</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a710e551be01f4ef85442d0928aca728c">Mass</a> &gt; <a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.mass)
            {
              p = <a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.father;

              <span class="keywordflow">if</span>(p &lt; 0)
                <span class="keywordflow">break</span>;

              no = p;
            }
<span class="preprocessor">#ifndef TWODIMS</span>
<span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#af9efa599cdd656b26a0df5f89430b4d1">Hsml</a> =
            <a class="code" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(3.0 / (4 * M_PI) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#accb74aa1ccf3fb13e31f5704bb692313">DesNumNgb</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a710e551be01f4ef85442d0928aca728c">Mass</a> / <a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.mass, 1.0 / 3) * <a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#af9efa599cdd656b26a0df5f89430b4d1">Hsml</a> =
            <a class="code" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e">pow</a>(1.0 / (M_PI) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#accb74aa1ccf3fb13e31f5704bb692313">DesNumNgb</a> * <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a710e551be01f4ef85442d0928aca728c">Mass</a> / <a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.mass, 1.0 / 2) * <a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no].<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }
    }

  <a class="code" href="density_8c.html#ad86cdeb9e3bfbe9af379ac9f7daf194c">density</a>();
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c_abca44f066552d38c44a1cd6020d349d5_cgraph.png" border="0" usemap="#init_8c_abca44f066552d38c44a1cd6020d349d5_cgraph" alt=""/></div>
<map name="init_8c_abca44f066552d38c44a1cd6020d349d5_cgraph" id="init_8c_abca44f066552d38c44a1cd6020d349d5_cgraph">
<area shape="rect" id="node3" href="density_8c.html#ad86cdeb9e3bfbe9af379ac9f7daf194c" title="density" alt="" coords="236,192,303,221"/><area shape="rect" id="node19" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="604,323,649,352"/><area shape="rect" id="node5" href="density_8c.html#ab6453dd0ac2ecf2478b1208374e68ae1" title="dens_compare_key" alt="" coords="352,5,499,35"/><area shape="rect" id="node7" href="density_8c.html#a4e6b32342a24a33518b6ae8723809749" title="density_evaluate" alt="" coords="360,59,491,88"/><area shape="rect" id="node13" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85" title="dmax" alt="" coords="396,112,455,141"/><area shape="rect" id="node15" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="392,165,459,195"/><area shape="rect" id="node21" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174" title="second" alt="" coords="392,269,459,299"/><area shape="rect" id="node23" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d" title="timediff" alt="" coords="391,323,460,352"/><area shape="rect" id="node9" href="ngb_8c.html#ae39a878e9bb71ae346097aace71632f9" title="ngb_treefind_variable" alt="" coords="548,59,705,88"/><area shape="rect" id="node11" href="ngb_8c.html#a674ac0d18eaff78ba700f1278f078274" title="ngb_clear_buf" alt="" coords="756,59,865,88"/><area shape="rect" id="node17" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="548,165,705,195"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="init_8c_abca44f066552d38c44a1cd6020d349d5_icgraph.png" border="0" usemap="#init_8c_abca44f066552d38c44a1cd6020d349d5_icgraph" alt=""/></div>
<map name="init_8c_abca44f066552d38c44a1cd6020d349d5_icgraph" id="init_8c_abca44f066552d38c44a1cd6020d349d5_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="236,5,276,35"/><area shape="rect" id="node5" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="325,5,392,35"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="441,5,495,35"/></map>
</div>
</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 26 2010 21:34:16 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
