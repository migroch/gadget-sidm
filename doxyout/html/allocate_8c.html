<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: allocate.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>allocate.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>routines for allocating particle and tree storage  
<a href="#_details">More...</a></p>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for allocate.c:</div>
<div class="dyncontent">
<div class="center"><img src="allocate_8c__incl.png" border="0" usemap="#allocate_8c" alt=""/></div>
<map name="allocate_8c" id="allocate_8c">
<area shape="rect" id="node11" href="allvars_8h.html" title="declares global variables." alt="" coords="273,160,347,189"/><area shape="rect" id="node18" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="358,83,425,112"/><area shape="rect" id="node16" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="333,237,394,267"/></map>
</div>

<p><a href="allocate_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="allocate_8c.html#a9e761db39213af33ba28aeed461f1a5a">allocate_commbuffers</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7">allocate_memory</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="allocate_8c.html#a99877ff0dc6228eabf8f959569f2771e">free_memory</a> (void)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>routines for allocating particle and tree storage </p>

<p>Definition in file <a class="el" href="allocate_8c_source.html">allocate.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a9e761db39213af33ba28aeed461f1a5a"></a><!-- doxytag: member="allocate.c::allocate_commbuffers" ref="a9e761db39213af33ba28aeed461f1a5a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void allocate_commbuffers </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allocates a number of small buffers and arrays, the largest one being the communication buffer. The communication buffer itself is mapped onto various tables used in the different parts of the force algorithms. We further allocate space for the top-level tree nodes, and auxiliary arrays for the domain decomposition algorithm. </p>

<p><p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition</p>
<p>&lt; Maximum number of nodes in the top-level tree used for domain decomposition </p>
</p>

<p>Definition at line <a class="el" href="allocate_8c_source.html#l00019">19</a> of file <a class="el" href="allocate_8c_source.html">allocate.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00274">global_data_all_processes::BufferSize</a>, <a class="el" href="allvars_8h_source.html#l00276">global_data_all_processes::BunchSizeDensity</a>, <a class="el" href="allvars_8h_source.html#l00278">global_data_all_processes::BunchSizeDomain</a>, <a class="el" href="allvars_8h_source.html#l00275">global_data_all_processes::BunchSizeForce</a>, <a class="el" href="allvars_8h_source.html#l00277">global_data_all_processes::BunchSizeHydro</a>, <a class="el" href="allvars_8c_source.html#l00102">CommBuffer</a>, <a class="el" href="allvars_8c_source.html#l00191">DensDataGet</a>, <a class="el" href="allvars_8c_source.html#l00191">DensDataIn</a>, <a class="el" href="allvars_8c_source.html#l00195">DensDataPartialResult</a>, <a class="el" href="allvars_8c_source.html#l00195">DensDataResult</a>, <a class="el" href="allvars_8c_source.html#l00053">DomainCount</a>, <a class="el" href="allvars_8c_source.html#l00054">DomainCountSph</a>, <a class="el" href="allvars_8c_source.html#l00051">DomainEndList</a>, <a class="el" href="allvars_8c_source.html#l00059">DomainHmax</a>, <a class="el" href="allvars_8c_source.html#l00064">DomainKeyBuf</a>, <a class="el" href="allvars_8c_source.html#l00061">DomainMoment</a>, <a class="el" href="allvars_8c_source.html#l00057">DomainNodeIndex</a>, <a class="el" href="allvars_8c_source.html#l00120">DomainPartBuf</a>, <a class="el" href="allvars_8c_source.html#l00128">DomainSphBuf</a>, <a class="el" href="allvars_8c_source.html#l00050">DomainStartList</a>, <a class="el" href="allvars_8c_source.html#l00056">DomainTask</a>, <a class="el" href="allvars_8c_source.html#l00058">DomainTreeNodeLen</a>, <a class="el" href="allvars_8c_source.html#l00052">DomainWork</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="allvars_8c_source.html#l00030">Exportflag</a>, <a class="el" href="allvars_8h_source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataGet</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataIn</a>, <a class="el" href="allvars_8c_source.html#l00186">GravDataIndexTable</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataOut</a>, <a class="el" href="allvars_8c_source.html#l00180">GravDataResult</a>, <a class="el" href="allvars_8c_source.html#l00201">HydroDataGet</a>, <a class="el" href="allvars_8c_source.html#l00201">HydroDataIn</a>, <a class="el" href="allvars_8c_source.html#l00205">HydroDataPartialResult</a>, <a class="el" href="allvars_8c_source.html#l00205">HydroDataResult</a>, <a class="el" href="allvars_8h_source.html#l00029">MAXTOPNODES</a>, <a class="el" href="allvars_8c_source.html#l00012">NTask</a>, <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>, and <a class="el" href="allvars_8c_source.html#l00073">TopNodes</a>.</p>

<p>Referenced by <a class="el" href="begrun_8c_source.html#l00028">begrun()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">size_t</span> bytes;

  <a class="code" href="allvars_8c.html#a768b23818449e1b33a55747cb3cc2025">Exportflag</a> = malloc(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
  <a class="code" href="allvars_8c.html#a3c2a7b96fe94b5151d568fe321888d23">DomainStartList</a> = malloc(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  <a class="code" href="allvars_8c.html#abb42257c117a39d968334cd054c16dcf">DomainEndList</a> = malloc(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));

  <a class="code" href="allvars_8c.html#a855acc131f2f1193f48d60fe63037e8c">TopNodes</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structtopnode__data.html">topnode_data</a>));

  <a class="code" href="allvars_8c.html#aed1b2c641567602d5935709a6a05b363">DomainWork</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
  <a class="code" href="allvars_8c.html#a743ddd39e492911973f9acd210df0c7c">DomainCount</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  <a class="code" href="allvars_8c.html#acfb9351c127127b0de4a310bf91974e4">DomainCountSph</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  <a class="code" href="allvars_8c.html#a6f4a30ea20d1347d14d2e32de91390bb">DomainTask</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  <a class="code" href="allvars_8c.html#acd2b211f08f9b7e83da8cb58bf3931a0">DomainNodeIndex</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  <a class="code" href="allvars_8c.html#a52e5390127f5298d6639b9399077bfbf">DomainTreeNodeLen</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a>));
  <a class="code" href="allvars_8c.html#a5a4689ebf26bc52b81819580362ef4dc">DomainHmax</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a>));
  <a class="code" href="allvars_8c.html#ad90674eef0b2180889d1620d5cc8672b">DomainMoment</a> = malloc(<a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structDomainNODE.html">DomainNODE</a>));

  <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a> = malloc(bytes = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a> * 1024 * 1024)))
    {
      printf(<span class="stringliteral">&quot;failed to allocate memory for `CommBuffer&#39; (%g MB).\n&quot;</span>, bytes / (1024.0 * 1024.0));
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(2);
    }

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f6d4697219a2ec2e3db7f09ab31bcea">BunchSizeForce</a> =
    (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a> * 1024 * 1024) / (<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structgravdata__index.html">gravdata_index</a>) + 2 * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structgravdata__in.html">gravdata_in</a>));

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f6d4697219a2ec2e3db7f09ab31bcea">BunchSizeForce</a> &amp; 1)
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f6d4697219a2ec2e3db7f09ab31bcea">BunchSizeForce</a> -= 1;    <span class="comment">/* make sure that All.BunchSizeForce is an even number </span>
<span class="comment">                                   --&gt; 8-byte alignment for 64bit processors */</span>

  <a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a> = (<span class="keyword">struct </span><a class="code" href="structgravdata__index.html">gravdata_index</a> *) <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
  <a class="code" href="allvars_8c.html#aeb6d889627ff712e7f0f30510842eb2c">GravDataIn</a> = (<span class="keyword">struct </span><a class="code" href="structgravdata__in.html">gravdata_in</a> *) (<a class="code" href="allvars_8c.html#a430ddb048d692102568b323d8ebe1812">GravDataIndexTable</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f6d4697219a2ec2e3db7f09ab31bcea">BunchSizeForce</a>);
  <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a> = <a class="code" href="allvars_8c.html#aeb6d889627ff712e7f0f30510842eb2c">GravDataIn</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f6d4697219a2ec2e3db7f09ab31bcea">BunchSizeForce</a>;
  <a class="code" href="allvars_8c.html#a7b537ba13fc3cfff5d6fbb245e892fb6">GravDataOut</a> = <a class="code" href="allvars_8c.html#aeb6d889627ff712e7f0f30510842eb2c">GravDataIn</a>;     <span class="comment">/* this will overwrite the GravDataIn-Table */</span>
  <a class="code" href="allvars_8c.html#a1aab0f29675c0745b5c2887e4791c070">GravDataResult</a> = <a class="code" href="allvars_8c.html#abc4ea40ab91f3e9288a0394c2544c65b">GravDataGet</a>; <span class="comment">/* this will overwrite the GravDataGet-Table */</span>


  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a9ab84bfa2f66ade551d613aeb3921d76">BunchSizeDensity</a> =
    (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a> * 1024 * 1024) / (2 * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdensdata__in.html">densdata_in</a>) + 2 * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structdensdata__out.html">densdata_out</a>));

  <a class="code" href="allvars_8c.html#ae697d6f8bee6bc6d77eb68e46155aed6">DensDataIn</a> = (<span class="keyword">struct </span><a class="code" href="structdensdata__in.html">densdata_in</a> *) <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
  <a class="code" href="allvars_8c.html#aa2903f03b426e94ee0e7dbd08e281e3e">DensDataGet</a> = <a class="code" href="allvars_8c.html#ae697d6f8bee6bc6d77eb68e46155aed6">DensDataIn</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a9ab84bfa2f66ade551d613aeb3921d76">BunchSizeDensity</a>;
  <a class="code" href="allvars_8c.html#a85a5932e895f3ffca16cbfdb0b0d4b10">DensDataResult</a> = (<span class="keyword">struct </span><a class="code" href="structdensdata__out.html">densdata_out</a> *) (<a class="code" href="allvars_8c.html#aa2903f03b426e94ee0e7dbd08e281e3e">DensDataGet</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a9ab84bfa2f66ade551d613aeb3921d76">BunchSizeDensity</a>);
  <a class="code" href="allvars_8c.html#a6ba7d2763f0c08d5759c63d3ba44b3bd">DensDataPartialResult</a> = <a class="code" href="allvars_8c.html#a85a5932e895f3ffca16cbfdb0b0d4b10">DensDataResult</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a9ab84bfa2f66ade551d613aeb3921d76">BunchSizeDensity</a>;

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#afe2775a289a902710358d98ba607a0aa">BunchSizeHydro</a> =
    (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a> * 1024 * 1024) / (2 * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structhydrodata__in.html">hydrodata_in</a>) + 2 * <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structhydrodata__out.html">hydrodata_out</a>));

  <a class="code" href="allvars_8c.html#ac76194e83ab629234cfbe7ea412f4147">HydroDataIn</a> = (<span class="keyword">struct </span><a class="code" href="structhydrodata__in.html">hydrodata_in</a> *) <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
  <a class="code" href="allvars_8c.html#a361f3970d23b525898314bd2742ecf8c">HydroDataGet</a> = <a class="code" href="allvars_8c.html#ac76194e83ab629234cfbe7ea412f4147">HydroDataIn</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#afe2775a289a902710358d98ba607a0aa">BunchSizeHydro</a>;
  <a class="code" href="allvars_8c.html#a4ec6a36a80786f2f8e7fb9794c1f6629">HydroDataResult</a> = (<span class="keyword">struct </span><a class="code" href="structhydrodata__out.html">hydrodata_out</a> *) (<a class="code" href="allvars_8c.html#a361f3970d23b525898314bd2742ecf8c">HydroDataGet</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#afe2775a289a902710358d98ba607a0aa">BunchSizeHydro</a>);
  <a class="code" href="allvars_8c.html#ab7f7e4c36b3ed818849ba610d82b38bc">HydroDataPartialResult</a> = <a class="code" href="allvars_8c.html#a4ec6a36a80786f2f8e7fb9794c1f6629">HydroDataResult</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#afe2775a289a902710358d98ba607a0aa">BunchSizeHydro</a>;

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abf3206e6032910640e91585c25bd85b2">BunchSizeDomain</a> =
    (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a> * 1024 * 1024) / (<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structparticle__data.html">particle_data</a>) + <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structsph__particle__data.html">sph_particle_data</a>) +
                                      sizeof(<a class="code" href="allvars_8h.html#a63f10772bd5776dcb4b6301f425e0d26">peanokey</a>));

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abf3206e6032910640e91585c25bd85b2">BunchSizeDomain</a> &amp; 1)
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abf3206e6032910640e91585c25bd85b2">BunchSizeDomain</a> -= 1;   <span class="comment">/* make sure that All.BunchSizeDomain is even </span>
<span class="comment">                                   --&gt; 8-byte alignment of DomainKeyBuf for 64bit processors */</span>

  <a class="code" href="allvars_8c.html#a386309bed4018948d42bc72ae4b5e1bb">DomainPartBuf</a> = (<span class="keyword">struct </span><a class="code" href="structparticle__data.html">particle_data</a> *) <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
  <a class="code" href="allvars_8c.html#a6034b1d1d1f6fb31d07d2077914aa1fc">DomainSphBuf</a> = (<span class="keyword">struct </span><a class="code" href="structsph__particle__data.html">sph_particle_data</a> *) (<a class="code" href="allvars_8c.html#a386309bed4018948d42bc72ae4b5e1bb">DomainPartBuf</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abf3206e6032910640e91585c25bd85b2">BunchSizeDomain</a>);
  <a class="code" href="allvars_8c.html#a6918a0815266193ad242888c455c5886">DomainKeyBuf</a> = (<a class="code" href="allvars_8h.html#a63f10772bd5776dcb4b6301f425e0d26">peanokey</a> *) (<a class="code" href="allvars_8c.html#a6034b1d1d1f6fb31d07d2077914aa1fc">DomainSphBuf</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abf3206e6032910640e91585c25bd85b2">BunchSizeDomain</a>);


  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      printf(<span class="stringliteral">&quot;\nAllocated %d MByte communication buffer per processor.\n\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a>);
      printf(<span class="stringliteral">&quot;Communication buffer has room for %d particles in gravity computation\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f6d4697219a2ec2e3db7f09ab31bcea">BunchSizeForce</a>);
      printf(<span class="stringliteral">&quot;Communication buffer has room for %d particles in density computation\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a9ab84bfa2f66ade551d613aeb3921d76">BunchSizeDensity</a>);
      printf(<span class="stringliteral">&quot;Communication buffer has room for %d particles in hydro computation\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#afe2775a289a902710358d98ba607a0aa">BunchSizeHydro</a>);
      printf(<span class="stringliteral">&quot;Communication buffer has room for %d particles in domain decomposition\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abf3206e6032910640e91585c25bd85b2">BunchSizeDomain</a>);
      printf(<span class="stringliteral">&quot;\n&quot;</span>);
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="allocate_8c_a9e761db39213af33ba28aeed461f1a5a_cgraph.png" border="0" usemap="#allocate_8c_a9e761db39213af33ba28aeed461f1a5a_cgraph" alt=""/></div>
<map name="allocate_8c_a9e761db39213af33ba28aeed461f1a5a_cgraph" id="allocate_8c_a9e761db39213af33ba28aeed461f1a5a_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="219,5,285,35"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="333,5,491,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="allocate_8c_a9e761db39213af33ba28aeed461f1a5a_icgraph.png" border="0" usemap="#allocate_8c_a9e761db39213af33ba28aeed461f1a5a_icgraph" alt=""/></div>
<map name="allocate_8c_a9e761db39213af33ba28aeed461f1a5a_icgraph" id="allocate_8c_a9e761db39213af33ba28aeed461f1a5a_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="219,5,285,35"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="335,5,388,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7fe5e304baaf5f418a22fef9a9cc02c7"></a><!-- doxytag: member="allocate.c::allocate_memory" ref="a7fe5e304baaf5f418a22fef9a9cc02c7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void allocate_memory </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine allocates memory for particle storage, both the collisionless and the SPH particles. </p>

<p>Definition at line <a class="el" href="allocate_8c_source.html#l00103">103</a> of file <a class="el" href="allocate_8c_source.html">allocate.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="allvars_8h_source.html#l00261">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8h_source.html#l00262">global_data_all_processes::MaxPartSph</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="allvars_8c_source.html#l00128">SphP</a>, and <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, and <a class="el" href="restart_8c_source.html#l00035">restart()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">size_t</span> bytes;
  <span class="keywordtype">double</span> bytes_tot = 0;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> &gt; 0)
    {
      <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a> = malloc(bytes = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structparticle__data.html">particle_data</a>))))
        {
          printf(<span class="stringliteral">&quot;failed to allocate memory for `P&#39; (%g MB).\n&quot;</span>, bytes / (1024.0 * 1024.0));
          <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
        }
      bytes_tot += bytes;

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;\nAllocated %g MByte for particle storage. %d\n\n&quot;</span>, bytes_tot / (1024.0 * 1024.0), <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structparticle__data.html">particle_data</a>));
    }

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a43dccd3997af759d43a2f3bcce44a2c4">MaxPartSph</a> &gt; 0)
    {
      bytes_tot = 0;

      <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a> = malloc(bytes = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a43dccd3997af759d43a2f3bcce44a2c4">MaxPartSph</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsph__particle__data.html">sph_particle_data</a>))))
        {
          printf(<span class="stringliteral">&quot;failed to allocate memory for `SphP&#39; (%g MB) %d.\n&quot;</span>, bytes / (1024.0 * 1024.0), <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsph__particle__data.html">sph_particle_data</a>));
          <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
        }
      bytes_tot += bytes;

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;Allocated %g MByte for storage of SPH data. %d\n\n&quot;</span>, bytes_tot / (1024.0 * 1024.0), <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsph__particle__data.html">sph_particle_data</a>));
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_cgraph.png" border="0" usemap="#allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_cgraph" alt=""/></div>
<map name="allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_cgraph" id="allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="187,5,253,35"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="301,5,459,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_icgraph.png" border="0" usemap="#allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_icgraph" alt=""/></div>
<map name="allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_icgraph" id="allocate_8c_a7fe5e304baaf5f418a22fef9a9cc02c7_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="188,7,263,36"/><area shape="rect" id="node13" href="restart_8c.html#ae81d30f52dddd39aef76bb1890d16f2f" title="restart" alt="" coords="431,59,495,88"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="313,7,380,36"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="443,5,483,35"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="544,5,611,35"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="660,32,713,61"/><area shape="rect" id="node16" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="556,59,599,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a99877ff0dc6228eabf8f959569f2771e"></a><!-- doxytag: member="allocate.c::free_memory" ref="a99877ff0dc6228eabf8f959569f2771e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_memory </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine frees the memory for the particle storage. Note: We don't actually bother to call it in the code... When the program terminats, the memory will be automatically freed by the operating system. </p>

<p>Definition at line <a class="el" href="allocate_8c_source.html#l00144">144</a> of file <a class="el" href="allocate_8c_source.html">allocate.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00261">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8h_source.html#l00262">global_data_all_processes::MaxPartSph</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, and <a class="el" href="allvars_8c_source.html#l00128">SphP</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a43dccd3997af759d43a2f3bcce44a2c4">MaxPartSph</a> &gt; 0)
    free(<a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>);

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> &gt; 0)
    free(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>);
}
</pre></div></p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 26 2010 21:34:15 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
