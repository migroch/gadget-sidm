<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: sidm_routines.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>sidm_routines.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>Extra fuctions and routines needed for the calculations of dark matter self interactions.  
<a href="#_details">More...</a></p>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_math.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_integration.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for sidm_routines.c:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c__incl.png" border="0" usemap="#sidm__routines_8c" alt=""/></div>
<map name="sidm__routines_8c" id="sidm__routines_8c">
<area shape="rect" id="node19" href="allvars_8h.html" title="declares global variables." alt="" coords="752,160,827,189"/><area shape="rect" id="node26" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="838,83,904,112"/><area shape="rect" id="node24" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="812,237,874,267"/></map>
</div>

<p><a href="sidm__routines_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>&nbsp;&nbsp;&nbsp;100000</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d">g_geo</a> (double r)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc">geofactor_integ</a> (double x, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7">geofactor_angle_integ</a> (double u, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4">kernel</a> (double u)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a5b36e92449c7102086706b7b24899be8">prob_of_interaction</a> (double r, float Vtarget[3], float Vno[3], int tbegin, int tend)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a7601ceef7848e2277fd5dd1f2800dfd9">calculate_interact_kick</a> (float Vtarget[3], float Vno[3], double kick_target[3], double kick_no[3])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5">init_geofactor_table</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a07ab80a1f9370ead2bc2a38884436615">update_interaction_table</a> (IDTYPE id1, IDTYPE id2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a06b0e0f213ae5bd086307e76cddc68a4">check_interaction_table</a> (IDTYPE id1, IDTYPE id2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a75d4b55f95852e708a563c3521438fe1">AllocateInteractionTable</a> (int x, int y)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Extra fuctions and routines needed for the calculations of dark matter self interactions. </p>
<p>This file contains the functions and routines necesary for the computation of the self interactions probabilities and the velocity kicks due to the interactios. Written by Miguel Rocha, <a href="mailto:rocham@uci.edu">rocham@uci.edu</a>. Oct 2010 </p>

<p>Definition in file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="af3f7d23e690c4253a44e7a674d31d276"></a><!-- doxytag: member="sidm_routines.c::GSLWORKSIZE" ref="af3f7d23e690c4253a44e7a674d31d276" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GSLWORKSIZE&nbsp;&nbsp;&nbsp;100000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00013">13</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00141">geofactor_integ()</a>, and <a class="el" href="sidm__routines_8c_source.html#l00120">init_geofactor_table()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a75d4b55f95852e708a563c3521438fe1"></a><!-- doxytag: member="sidm_routines.c::AllocateInteractionTable" ref="a75d4b55f95852e708a563c3521438fe1" args="(int x, int y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AllocateInteractionTable </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>y</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00323">323</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>.</p>

<p>Referenced by <a class="el" href="begrun_8c_source.html#l00028">begrun()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i,j;

  InteractionTable = (IDTYPE**) malloc(x*<span class="keyword">sizeof</span>(IDTYPE*)); 
  <span class="keywordflow">if</span> (InteractionTable == NULL)
    {
      free(InteractionTable);
      printf(<span class="stringliteral">&quot;Failed to allocate memory for the interaction table&quot;</span>);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(2);
    }

  <span class="keywordflow">for</span> (i = 0; i &lt; x; i++)
    {   
      InteractionTable[i] = (IDTYPE*) malloc(y*<span class="keyword">sizeof</span>(IDTYPE)); 
      <span class="keywordflow">if</span> (InteractionTable[i] == NULL)
        {
          free(InteractionTable[i]);
          printf(<span class="stringliteral">&quot;Failed to allocate memory for the interaction table&quot;</span>);
          <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(2);
        }
    }
  
    <span class="keywordflow">for</span> (i = 0; i &lt; x; i++)
      <span class="keywordflow">for</span>(j = 0; j &lt; y; j++)
        InteractionTable[i][j]= 0;
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph.png" border="0" usemap="#sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph" id="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="229,5,296,35"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="344,5,501,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph.png" border="0" usemap="#sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph" id="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="229,5,296,35"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="345,5,399,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7601ceef7848e2277fd5dd1f2800dfd9"></a><!-- doxytag: member="sidm_routines.c::calculate_interact_kick" ref="a7601ceef7848e2277fd5dd1f2800dfd9" args="(float Vtarget[3], float Vno[3], double kick_target[3], double kick_no[3])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_interact_kick </td>
          <td>(</td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>Vtarget</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>Vno</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>kick_target</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>kick_no</em>[3]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine sets the kicks for each particle after it has been decided that they will interact. It uses an algorithm tha conserves energy and momentum but picks a random direction so it does not conserves angular momentum. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00094">94</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00043">random_generator</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01500">force_treeevaluate_shortrange()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> dV,theta,phi,dvx,dvy,dvz;

  dvx = Vno[0]-Vtarget[0];
  dvy = Vno[1]-Vtarget[1];
  dvz = Vno[2]-Vtarget[2];
  dV = sqrt(dvx*dvx + dvy*dvy + dvz*dvz);

  theta = gsl_rng_uniform(<a class="code" href="allvars_8c.html#a4ec93729b85eb5da23dd6ffb23c3702b">random_generator</a>)*M_PI;
  phi = gsl_rng_uniform(<a class="code" href="allvars_8c.html#a4ec93729b85eb5da23dd6ffb23c3702b">random_generator</a>)*2.0*M_PI;

  kick_target[0] = (-Vtarget[0] + Vno[0] + dV*sin(theta)*cos(phi))/2.0;
  kick_no[0] = (Vtarget[0] - Vno[0] - dV*sin(theta)*cos(phi))/2.0;

  kick_target[1] = (-Vtarget[1] + Vno[1] + dV*sin(theta)*sin(phi))/2.0;
  kick_no[1] = (Vtarget[1] - Vno[1] - dV*sin(theta)*sin(phi))/2.0;

  kick_target[2] = (-Vtarget[2] + Vno[2] + dV*cos(theta))/2.0;
  kick_no[2] = (Vtarget[2] - Vno[2] - dV*cos(theta))/2.0;
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph.png" border="0" usemap="#sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph" id="sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="260,5,401,35"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="221,59,440,88"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="488,32,587,61"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="635,32,805,61"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="853,32,896,61"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="945,32,999,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a06b0e0f213ae5bd086307e76cddc68a4"></a><!-- doxytag: member="sidm_routines.c::check_interaction_table" ref="a06b0e0f213ae5bd086307e76cddc68a4" args="(IDTYPE id1, IDTYPE id2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_interaction_table </td>
          <td>(</td>
          <td class="paramtype">IDTYPE&nbsp;</td>
          <td class="paramname"> <em>id1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IDTYPE&nbsp;</td>
          <td class="paramname"> <em>id2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function checks if a pair of particles have interacted in the current time step. It looks at the InteractionTable and returns 0 if the pair is not found and 1 if pair is found. This is used to avoid double counting of interactions. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00292">292</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01500">force_treeevaluate_shortrange()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i,j,flag;
  
  flag = 0;
  id1 += 1;
  id2 += 1;
  
  <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
    { 
      <span class="keywordflow">if</span>(InteractionTable[i][0] == id1 || InteractionTable[i][0] == id2 )
        {
          <span class="keywordflow">for</span>(j = 1; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
            {
              <span class="keywordflow">if</span>(InteractionTable[i][0] == id1 &amp;&amp; InteractionTable[i][j] == id2)
                { 
                  flag = 1;
                  <span class="keywordflow">break</span>;
                }
              <span class="keywordflow">if</span>(InteractionTable[i][0] == id2 &amp;&amp; InteractionTable[i][j] == id1)
                {
                  flag = 1;
                  <span class="keywordflow">break</span>;
                }
            }
        }
    }

  <span class="keywordflow">return</span> flag;
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph.png" border="0" usemap="#sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph" id="sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="265,5,407,35"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="227,59,445,88"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="493,32,592,61"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="640,32,811,61"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="859,32,901,61"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="951,32,1004,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab5ff10bfb368309b0dd01aaa72c6be1d"></a><!-- doxytag: member="sidm_routines.c::g_geo" ref="ab5ff10bfb368309b0dd01aaa72c6be1d" args="(double r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double g_geo </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>r</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the value of the geometrical factor needed for the calculation of the interaction probability. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00072">72</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00032">prob_of_interaction()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span>  f, u;
  <span class="keywordtype">int</span> i;

  u = r / 2.0 * GEOFACTOR_TABLE_LENGTH;
  i = (int) u;
  <span class="keywordflow">if</span> (i &gt;= GEOFACTOR_TABLE_LENGTH)
    i = GEOFACTOR_TABLE_LENGTH - 1;

  <span class="keywordflow">if</span> (i &lt;= 1)
    f = 0.992318  + (GeoFactorTable[0] - 0.992318)*u;
  <span class="keywordflow">else</span>
    f = GeoFactorTable[i - 1] + (GeoFactorTable[i] - GeoFactorTable[i - 1]) * (u - i);

  <span class="keywordflow">return</span> f;
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph.png" border="0" usemap="#sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph" alt=""/></div>
<map name="sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph" id="sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a5b36e92449c7102086706b7b24899be8" title="prob_of_interaction" alt="" coords="116,32,260,61"/><area shape="rect" id="node5" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="348,5,489,35"/><area shape="rect" id="node15" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="309,59,528,88"/><area shape="rect" id="node7" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="576,32,675,61"/><area shape="rect" id="node9" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="723,32,893,61"/><area shape="rect" id="node11" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="941,32,984,61"/><area shape="rect" id="node13" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1033,32,1087,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a309de7eeb7e8c96c4d127696d4d9a4a7"></a><!-- doxytag: member="sidm_routines.c::geofactor_angle_integ" ref="a309de7eeb7e8c96c4d127696d4d9a4a7" args="(double u, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double geofactor_angle_integ </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the integrand of the angular part of the integral done on <a class="el" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5">init_geofactor_table()</a>. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00167">167</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="sidm__routines_8c_source.html#l00180">kernel()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> x,r,f;

  r = *(<span class="keywordtype">double</span> *) params;
  x = *(<span class="keywordtype">double</span> *) (params + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
  f = sqrt(x*x + r*r + 2*x*r*u);

  <span class="keywordflow">return</span> <a class="code" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4">kernel</a>(f);
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph.png" border="0" usemap="#sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph" id="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4" title="kernel" alt="" coords="219,5,280,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5b60a9da4d9d0c091769f0e9fc6c6bdc"></a><!-- doxytag: member="sidm_routines.c::geofactor_integ" ref="a5b60a9da4d9d0c091769f0e9fc6c6bdc" args="(double x, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double geofactor_integ </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the integrand of the numerical integration done on <a class="el" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5">init_geofactor_table()</a>. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00141">141</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="sidm__routines_8c_source.html#l00013">GSLWORKSIZE</a>, <a class="el" href="sidm__routines_8c_source.html#l00180">kernel()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> result, abserr,r;
  <span class="keywordtype">double</span> newparams[2];

  r = *(<span class="keywordtype">double</span> *) params;
  newparams[0] = r;
  newparams[1] = x;

  gsl_function F;
  gsl_integration_workspace *<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>;
  workspace = gsl_integration_workspace_alloc(<a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>);

  F.function = &amp;geofactor_angle_integ;
  F.params = newparams;

  gsl_integration_qag(&amp;F, -1.0, 1.0, 0, 1.0e-8, <a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>, GSL_INTEG_GAUSS41,workspace, &amp;result, &amp;abserr);

  gsl_integration_workspace_free(workspace);

  <span class="keywordflow">return</span> x*x*<a class="code" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4">kernel</a>(x)*result;
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph.png" border="0" usemap="#sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph" id="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4" title="kernel" alt="" coords="176,5,237,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae54bb3071b061a41ef29fcd551f50da5"></a><!-- doxytag: member="sidm_routines.c::init_geofactor_table" ref="ae54bb3071b061a41ef29fcd551f50da5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_geofactor_table </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine initialazes the table that will be used to get the geometrical factor as a function of the two particle separations. It populates a table with the results of the numerical integration. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00120">120</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="sidm__routines_8c_source.html#l00013">GSLWORKSIZE</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p>Referenced by <a class="el" href="begrun_8c_source.html#l00028">begrun()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i;
  <span class="keywordtype">double</span> result, abserr,r;
  gsl_function F;
  gsl_integration_workspace *<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>;
  workspace = gsl_integration_workspace_alloc(<a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>);

  <span class="keywordflow">for</span>(i = 0; i &lt; GEOFACTOR_TABLE_LENGTH; i++)
  {
    r =  2.0/GEOFACTOR_TABLE_LENGTH * (i + 1);
    F.function = &amp;geofactor_integ;
    F.params = &amp;r;
    gsl_integration_qag(&amp;F, 0.0, 1.0, 0, 1.0e-8, <a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>, GSL_INTEG_GAUSS41,workspace, &amp;result, &amp;abserr);
    GeoFactorTable[i] = 2*M_PI*result;
  }
  gsl_integration_workspace_free(workspace);
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph.png" border="0" usemap="#sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph" alt=""/></div>
<map name="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph" id="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="203,5,269,35"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="319,5,372,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1d33f5b567083ba4e0775814536fd0b4"></a><!-- doxytag: member="sidm_routines.c::kernel" ref="a1d33f5b567083ba4e0775814536fd0b4" args="(double u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double kernel </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>u</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the value W(x). The values of the density kernel as a funtion of x=r/h. </p>

<p><p>&lt; Coefficients for SPH spline kernel and its derivative </p>
</p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00180">180</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="allvars_8h_source.html#l00125">KERNEL_COEFF_1</a>, <a class="el" href="allvars_8h_source.html#l00126">KERNEL_COEFF_2</a>, and <a class="el" href="allvars_8h_source.html#l00129">KERNEL_COEFF_5</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00167">geofactor_angle_integ()</a>, and <a class="el" href="sidm__routines_8c_source.html#l00141">geofactor_integ()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> w;

  <span class="keywordflow">if</span> (u &lt; 1.0)
    {
      <span class="keywordflow">if</span> (u &lt;= 0.5)
        {
          w = <a class="code" href="allvars_8h.html#ab5f539f35b0297ef0f6650cf869ce461">KERNEL_COEFF_1</a> + <a class="code" href="allvars_8h.html#a5d38a374d10a6baf4406b7c65b542056">KERNEL_COEFF_2</a> * (u - 1) * u * u;
          <span class="keywordflow">return</span> w;
        }
      <span class="keywordflow">else</span>
        {
          w = <a class="code" href="allvars_8h.html#a7840162cc2fd06c919b18817d647b667">KERNEL_COEFF_5</a> * (1.0 - u) * (1.0 - u) * (1.0 - u);
          <span class="keywordflow">return</span> w;
        }
    }
  <span class="keywordflow">else</span>
  {
    <span class="keywordflow">return</span> 0.0;
  }
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph.png" border="0" usemap="#sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph" id="sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7" title="geofactor_angle_integ" alt="" coords="116,5,279,35"/><area shape="rect" id="node5" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc" title="geofactor_integ" alt="" coords="136,59,259,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5b36e92449c7102086706b7b24899be8"></a><!-- doxytag: member="sidm_routines.c::prob_of_interaction" ref="a5b36e92449c7102086706b7b24899be8" args="(double r, float Vtarget[3], float Vno[3], int tbegin, int tend)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double prob_of_interaction </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>Vtarget</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>Vno</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>tbegin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>tend</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function calculates the interaction probability between two particles. It checks if comoving integration is on and does the necesary change of variables and units. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00032">32</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00347">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="allvars_8h_source.html#l00478">global_data_all_processes::ForceSoftening</a>, <a class="el" href="sidm__routines_8c_source.html#l00072">g_geo()</a>, <a class="el" href="allvars_8h_source.html#l00338">global_data_all_processes::Hubble</a>, <a class="el" href="hydra_8c_source.html#l00019">hubble_a</a>, <a class="el" href="allvars_8h_source.html#l00481">global_data_all_processes::MassTable</a>, <a class="el" href="peano_8c.html#a6bca09dac540caff82dc91b8875b2893">mp</a>, <a class="el" href="allvars_8h_source.html#l00339">global_data_all_processes::Omega0</a>, <a class="el" href="allvars_8h_source.html#l00340">global_data_all_processes::OmegaLambda</a>, <a class="el" href="allvars_8h_source.html#l00369">global_data_all_processes::Time</a>, <a class="el" href="allvars_8h_source.html#l00377">global_data_all_processes::Timebase_interval</a>, <a class="el" href="allvars_8h_source.html#l00325">global_data_all_processes::UnitLength_in_cm</a>, and <a class="el" href="allvars_8h_source.html#l00323">global_data_all_processes::UnitMass_in_g</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01500">force_treeevaluate_shortrange()</a>.</p>

<p><div class="fragment"><pre class="fragment">  {
    <span class="keywordtype">double</span> dT, dloga, dV, dvx, dvy, dvz, prob,h,<a class="code" href="hydra_8c.html#abb7074f2e4b01309c6f2dc87bb3a1a40">hubble_a</a>,<a class="code" href="peano_8c.html#a6bca09dac540caff82dc91b8875b2893">mp</a>;

    dvx = Vno[0]-Vtarget[0];
    dvy = Vno[1]-Vtarget[1];
    dvz = Vno[2]-Vtarget[2];
    dV = sqrt(dvx*dvx + dvy*dvy + dvz*dvz);

    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
      {
        r =  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>*r;
        h = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f875884085b35ff64047e46f5348be4">ForceSoftening</a>[1]*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>;

        dloga = (tend - tbegin)*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;
        hubble_a = (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abac5eca1b5851e670eec01d4dd47c417">Omega0</a> / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>)
                    + (1 - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abac5eca1b5851e670eec01d4dd47c417">Omega0</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ae272abeafbcb16230374a903a3e4e298">OmegaLambda</a>) / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ae272abeafbcb16230374a903a3e4e298">OmegaLambda</a>);
        hubble_a = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a6e6a37250907d90a56f92a55aefdda5f">Hubble</a> * sqrt(hubble_a);
        dT = dloga/hubble_a;

        dV = dV/<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>; <span class="comment">/* Convert from internal velocity p = a^2 dx/dt to peculiar velocity v = a dx/dt*/</span>
        dV -= hubble_a*r; <span class="comment">/* Substract Hubble flow */</span>
   
      }
    <span class="keywordflow">else</span>
      {
        dT = (tend-tbegin)*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;
        h = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2f875884085b35ff64047e46f5348be4">ForceSoftening</a>[1];
      }

    mp =  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[1]*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#adccf5aa82d4252d8d24ead7681b29052">UnitMass_in_g</a>;
    prob = mp*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.InteractionCrossSection*dV*dT*<a class="code" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d">g_geo</a>(r/h)/(h*h*h*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a111a45896aafd67faa8f0c9ef897612f">UnitLength_in_cm</a>*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a111a45896aafd67faa8f0c9ef897612f">UnitLength_in_cm</a>);

    <span class="keywordflow">return</span> prob;

  }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph.png" border="0" usemap="#sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph" id="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d" title="g_geo" alt="" coords="200,5,261,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph.png" border="0" usemap="#sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph" id="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="239,5,380,35"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="200,59,419,88"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="467,32,565,61"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="613,32,784,61"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="832,32,875,61"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="924,32,977,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a07ab80a1f9370ead2bc2a38884436615"></a><!-- doxytag: member="sidm_routines.c::update_interaction_table" ref="a07ab80a1f9370ead2bc2a38884436615" args="(IDTYPE id1, IDTYPE id2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_interaction_table </td>
          <td>(</td>
          <td class="paramtype">IDTYPE&nbsp;</td>
          <td class="paramname"> <em>id1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IDTYPE&nbsp;</td>
          <td class="paramname"> <em>id2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine updates the interaction table each time there is an interaction. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00205">205</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01500">force_treeevaluate_shortrange()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i,j,id1_index,id2_index;
  id1 += 1;
  id2 += 1;
  id1_index = -1;
  id2_index = -1;

  <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
    {
      <span class="keywordflow">if</span>(InteractionTable[i][0] == id1) id1_index = i;
      <span class="keywordflow">if</span>(InteractionTable[i][0] == id2) id2_index = i;
    }

   <span class="keywordflow">if</span>(id1_index == -1)
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
        {
          <span class="keywordflow">if</span>(InteractionTable[i][0] == 0)
            {
              InteractionTable[i][0] = id1;
              InteractionTable[i][1] = id2;
              <span class="keywordflow">break</span>;
            }
          <span class="keywordflow">if</span> (i == INTERACTION_TABLE_LENGTH - 1)
            {
              printf(<span class="stringliteral">&quot;ERROR: There were more interactions in this timestep than INTERACTION_TABLE_LENGTH&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
            }
        }
    }
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">for</span>(j = 1; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
        {
          <span class="keywordflow">if</span>(InteractionTable[id1_index][j] == 0)
            {
              InteractionTable[id1_index][j] = id2;
              <span class="keywordflow">break</span>;
            }
          <span class="keywordflow">if</span> (j == PARTICLE_MAX_INTERACTIONS )
            {
              printf(<span class="stringliteral">&quot;ERROR: A particle interacted more than PARTICLE_MAX_INTERACTIONS&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
            }
        }
    } 

  <span class="keywordflow">if</span>(id2_index == -1)
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
        {
          <span class="keywordflow">if</span>(InteractionTable[i][0] == 0)
            {
              InteractionTable[i][0] = id2;
              InteractionTable[i][1] = id1;
              <span class="keywordflow">break</span>;
            }
          <span class="keywordflow">if</span> (i == INTERACTION_TABLE_LENGTH - 1)
            {
              printf(<span class="stringliteral">&quot;ERROR: There were more interactions in this timestep than INTERACTION_TABLE_LENGTH&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
            }
        }
    }
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">for</span>(j = 1; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
        {
          <span class="keywordflow">if</span>(InteractionTable[id2_index][j] == 0)
            {
              InteractionTable[id2_index][j] = id1;
              <span class="keywordflow">break</span>;
            }
          <span class="keywordflow">if</span> (j == PARTICLE_MAX_INTERACTIONS )
            {
              printf(<span class="stringliteral">&quot;ERROR: A particle interacted more than PARTICLE_MAX_INTERACTIONS&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
            }
        }
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph.png" border="0" usemap="#sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph" id="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="235,5,301,35"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="349,5,507,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph.png" border="0" usemap="#sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph" id="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="273,5,415,35"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="235,59,453,88"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="501,32,600,61"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="648,32,819,61"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="867,32,909,61"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="959,32,1012,61"/></map>
</div>
</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 3 2010 18:45:45 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
