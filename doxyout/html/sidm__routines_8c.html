<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gadget-sidm: sidm_routines.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gadget-sidm
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('sidm__routines_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sidm_routines.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Extra fuctions and routines needed for the calculations of dark matter self interactions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_math.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_integration.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for sidm_routines.c:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c__incl.png" border="0" usemap="#sidm__routines_8c" alt=""/></div>
<map name="sidm__routines_8c" id="sidm__routines_8c">
<area shape="rect" id="node19" href="allvars_8h.html" title="declares global variables." alt="" coords="752,161,827,189"/><area shape="rect" id="node26" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="838,83,904,111"/><area shape="rect" id="node24" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="812,238,874,266"/></map>
</div>
</div>
<p><a href="sidm__routines_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>&#160;&#160;&#160;100000</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d">g_geo</a> (double r)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc">geofactor_integ</a> (double x, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7">geofactor_angle_integ</a> (double u, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4">kernel</a> (double u)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a5b36e92449c7102086706b7b24899be8">prob_of_interaction</a> (double r, float Vtarget[3], float Vno[3], int tbegin, int tend)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a7601ceef7848e2277fd5dd1f2800dfd9">calculate_interact_kick</a> (float Vtarget[3], float Vno[3], double kick_target[3], double kick_no[3])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5">init_geofactor_table</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a07ab80a1f9370ead2bc2a38884436615">update_interaction_table</a> (IDTYPE id1, IDTYPE id2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a06b0e0f213ae5bd086307e76cddc68a4">check_interaction_table</a> (IDTYPE id1, IDTYPE id2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sidm__routines_8c.html#a75d4b55f95852e708a563c3521438fe1">AllocateInteractionTable</a> (int x, int y)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Extra fuctions and routines needed for the calculations of dark matter self interactions. </p>
<p>This file contains the functions and routines necesary for the computation of the self interactions probabilities and the velocity kicks due to the interactios. Written by Miguel Rocha, <a href="mailto:rocham@uci.edu">rocham@uci.edu</a>. Oct 2010 </p>

<p>Definition in file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="af3f7d23e690c4253a44e7a674d31d276"></a><!-- doxytag: member="sidm_routines.c::GSLWORKSIZE" ref="af3f7d23e690c4253a44e7a674d31d276" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>&#160;&#160;&#160;100000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00013">13</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00141">geofactor_integ()</a>, and <a class="el" href="sidm__routines_8c_source.html#l00120">init_geofactor_table()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a75d4b55f95852e708a563c3521438fe1"></a><!-- doxytag: member="sidm_routines.c::AllocateInteractionTable" ref="a75d4b55f95852e708a563c3521438fe1" args="(int x, int y)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sidm__routines_8c.html#a75d4b55f95852e708a563c3521438fe1">AllocateInteractionTable</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00326">326</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>.</p>

<p>Referenced by <a class="el" href="begrun_8c_source.html#l00028">begrun()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i,j;

  InteractionTable = (IDTYPE**) malloc(x*<span class="keyword">sizeof</span>(IDTYPE*)); 
  <span class="keywordflow">if</span> (InteractionTable == NULL)
    {
      free(InteractionTable);
      printf(<span class="stringliteral">&quot;Failed to allocate memory for the interaction table\n&quot;</span>);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(2);
    }

  <span class="keywordflow">for</span> (i = 0; i &lt; x; i++)
    {   
      InteractionTable[i] = (IDTYPE*) malloc(y*<span class="keyword">sizeof</span>(IDTYPE)); 
      <span class="keywordflow">if</span> (InteractionTable[i] == NULL)
        {
          free(InteractionTable[i]);
          printf(<span class="stringliteral">&quot;Failed to allocate memory for the interaction table\n&quot;</span>);
          <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(2);
        }
    }
  
    <span class="keywordflow">for</span> (i = 0; i &lt; x; i++)
      <span class="keywordflow">for</span>(j = 0; j &lt; y; j++)
        InteractionTable[i][j]= 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph.png" border="0" usemap="#sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph" id="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="229,5,296,33"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="344,5,501,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph.png" border="0" usemap="#sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph" id="sidm__routines_8c_a75d4b55f95852e708a563c3521438fe1_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="229,5,296,33"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="345,5,399,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7601ceef7848e2277fd5dd1f2800dfd9"></a><!-- doxytag: member="sidm_routines.c::calculate_interact_kick" ref="a7601ceef7848e2277fd5dd1f2800dfd9" args="(float Vtarget[3], float Vno[3], double kick_target[3], double kick_no[3])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sidm__routines_8c.html#a7601ceef7848e2277fd5dd1f2800dfd9">calculate_interact_kick</a> </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Vtarget</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Vno</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kick_target</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kick_no</em>[3]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine sets the kicks for each particle after it has been decided that they will interact. It uses an algorithm tha conserves energy and momentum but picks a random direction so it does not conserves angular momentum. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00094">94</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00043">random_generator</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01542">force_treeevaluate_shortrange()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> dV,theta,phi,dvx,dvy,dvz;

  dvx = Vno[0]-Vtarget[0];
  dvy = Vno[1]-Vtarget[1];
  dvz = Vno[2]-Vtarget[2];
  dV = sqrt(dvx*dvx + dvy*dvy + dvz*dvz);

  theta = acos(2*gsl_rng_uniform(<a class="code" href="allvars_8c.html#a4ec93729b85eb5da23dd6ffb23c3702b">random_generator</a>)-1.0);
  phi = gsl_rng_uniform(<a class="code" href="allvars_8c.html#a4ec93729b85eb5da23dd6ffb23c3702b">random_generator</a>)*2.0*M_PI;

  kick_target[0] = (-Vtarget[0] + Vno[0] + dV*sin(theta)*cos(phi))/2.0;
  kick_no[0] = (Vtarget[0] - Vno[0] - dV*sin(theta)*cos(phi))/2.0;

  kick_target[1] = (-Vtarget[1] + Vno[1] + dV*sin(theta)*sin(phi))/2.0;
  kick_no[1] = (Vtarget[1] - Vno[1] - dV*sin(theta)*sin(phi))/2.0;

  kick_target[2] = (-Vtarget[2] + Vno[2] + dV*cos(theta))/2.0;
  kick_no[2] = (Vtarget[2] - Vno[2] - dV*cos(theta))/2.0;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph.png" border="0" usemap="#sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph" id="sidm__routines_8c_a7601ceef7848e2277fd5dd1f2800dfd9_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="260,5,401,33"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="221,55,440,83"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="488,30,587,58"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="635,30,805,58"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="853,30,896,58"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="945,30,999,58"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a06b0e0f213ae5bd086307e76cddc68a4"></a><!-- doxytag: member="sidm_routines.c::check_interaction_table" ref="a06b0e0f213ae5bd086307e76cddc68a4" args="(IDTYPE id1, IDTYPE id2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="sidm__routines_8c.html#a06b0e0f213ae5bd086307e76cddc68a4">check_interaction_table</a> </td>
          <td>(</td>
          <td class="paramtype">IDTYPE&#160;</td>
          <td class="paramname"><em>id1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IDTYPE&#160;</td>
          <td class="paramname"><em>id2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function checks if a pair of particles have interacted in the current time step. It looks at the InteractionTable and returns 0 if the pair is not found and 1 if pair is found. This is used to avoid double counting of interactions. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00282">282</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01542">force_treeevaluate_shortrange()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i,j,flag;
  
  flag = 0;
  id1 += 1;
  id2 += 1;
  
  <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
    { 
      <span class="keywordflow">if</span>(InteractionTable[i][0] == id1)
        {
          <span class="keywordflow">for</span>(j = 1; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
            {
              <span class="keywordflow">if</span>(InteractionTable[i][j] == id2)
                { 
                  flag = 1;
                  <span class="keywordflow">break</span>;
                }
            }
        }
    }

  <span class="keywordflow">if</span>(flag == 0)
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
        { 
          <span class="keywordflow">if</span>(InteractionTable[i][0] == id2)
            {
              <span class="keywordflow">for</span>(j = 1; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
                {
                  <span class="keywordflow">if</span>(InteractionTable[i][j] == id1)
                    { 
                      flag = 1;
                      <span class="keywordflow">break</span>;
                    }
                }
            }
        }
    }

  <span class="keywordflow">return</span> flag;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph.png" border="0" usemap="#sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph" id="sidm__routines_8c_a06b0e0f213ae5bd086307e76cddc68a4_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="265,5,407,33"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="227,55,445,83"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="493,30,592,58"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="640,30,811,58"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="859,30,901,58"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="951,30,1004,58"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab5ff10bfb368309b0dd01aaa72c6be1d"></a><!-- doxytag: member="sidm_routines.c::g_geo" ref="ab5ff10bfb368309b0dd01aaa72c6be1d" args="(double r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d">g_geo</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the value of the geometrical factor needed for the calculation of the interaction probability. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00072">72</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00032">prob_of_interaction()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span>  f, u;
  <span class="keywordtype">int</span> i;

  u = r / 2.0 * GEOFACTOR_TABLE_LENGTH;
  i = (int) u;
  <span class="keywordflow">if</span> (i &gt;= GEOFACTOR_TABLE_LENGTH)
    i = GEOFACTOR_TABLE_LENGTH - 1;

  <span class="keywordflow">if</span> (i &lt;= 1)
    f = 0.992318  + (GeoFactorTable[0] - 0.992318)*u;
  <span class="keywordflow">else</span>
    f = GeoFactorTable[i - 1] + (GeoFactorTable[i] - GeoFactorTable[i - 1]) * (u - i);

  <span class="keywordflow">return</span> f;
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph.png" border="0" usemap="#sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph" alt=""/></div>
<map name="sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph" id="sidm__routines_8c_ab5ff10bfb368309b0dd01aaa72c6be1d_icgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a5b36e92449c7102086706b7b24899be8" title="prob_of_interaction" alt="" coords="116,30,260,58"/><area shape="rect" id="node5" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="348,5,489,33"/><area shape="rect" id="node15" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="309,55,528,83"/><area shape="rect" id="node7" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="576,30,675,58"/><area shape="rect" id="node9" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="723,30,893,58"/><area shape="rect" id="node11" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="941,30,984,58"/><area shape="rect" id="node13" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1033,30,1087,58"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a309de7eeb7e8c96c4d127696d4d9a4a7"></a><!-- doxytag: member="sidm_routines.c::geofactor_angle_integ" ref="a309de7eeb7e8c96c4d127696d4d9a4a7" args="(double u, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7">geofactor_angle_integ</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the integrand of the angular part of the integral done on <a class="el" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5">init_geofactor_table()</a>. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00167">167</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="sidm__routines_8c_source.html#l00180">kernel()</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00141">geofactor_integ()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> x,r,f;

  r = *(<span class="keywordtype">double</span> *) params;
  x = *(<span class="keywordtype">double</span> *) (params + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
  f = sqrt(x*x + r*r + 2*x*r*u);

  <span class="keywordflow">return</span> <a class="code" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4">kernel</a>(f);
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph.png" border="0" usemap="#sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph" id="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_cgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4" title="kernel" alt="" coords="219,5,280,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_icgraph.png" border="0" usemap="#sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_icgraph" id="sidm__routines_8c_a309de7eeb7e8c96c4d127696d4d9a4a7_icgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc" title="geofactor_integ" alt="" coords="219,5,341,33"/><area shape="rect" id="node5" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5" title="init_geofactor_table" alt="" coords="391,5,537,33"/><area shape="rect" id="node7" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="587,5,653,33"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="703,5,756,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5b60a9da4d9d0c091769f0e9fc6c6bdc"></a><!-- doxytag: member="sidm_routines.c::geofactor_integ" ref="a5b60a9da4d9d0c091769f0e9fc6c6bdc" args="(double x, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc">geofactor_integ</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the integrand of the numerical integration done on <a class="el" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5">init_geofactor_table()</a>. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00141">141</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="sidm__routines_8c_source.html#l00167">geofactor_angle_integ()</a>, <a class="el" href="sidm__routines_8c_source.html#l00013">GSLWORKSIZE</a>, <a class="el" href="sidm__routines_8c_source.html#l00180">kernel()</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00120">init_geofactor_table()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> result, abserr,r;
  <span class="keywordtype">double</span> newparams[2];

  r = *(<span class="keywordtype">double</span> *) params;
  newparams[0] = r;
  newparams[1] = x;

  gsl_function F;
  gsl_integration_workspace *<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>;
  workspace = gsl_integration_workspace_alloc(<a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>);

  F.function = &amp;<a class="code" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7">geofactor_angle_integ</a>;
  F.params = newparams;

  gsl_integration_qag(&amp;F, -1.0, 1.0, 0, 1.0e-8, <a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>, GSL_INTEG_GAUSS41,workspace, &amp;result, &amp;abserr);

  gsl_integration_workspace_free(workspace);

  <span class="keywordflow">return</span> x*x*<a class="code" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4">kernel</a>(x)*result;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph.png" border="0" usemap="#sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph" id="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_cgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7" title="geofactor_angle_integ" alt="" coords="177,5,340,33"/><area shape="rect" id="node5" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4" title="kernel" alt="" coords="389,30,451,58"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_icgraph.png" border="0" usemap="#sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_icgraph" id="sidm__routines_8c_a5b60a9da4d9d0c091769f0e9fc6c6bdc_icgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5" title="init_geofactor_table" alt="" coords="177,5,324,33"/><area shape="rect" id="node5" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="373,5,440,33"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="489,5,543,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae54bb3071b061a41ef29fcd551f50da5"></a><!-- doxytag: member="sidm_routines.c::init_geofactor_table" ref="ae54bb3071b061a41ef29fcd551f50da5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5">init_geofactor_table</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine initialazes the table that will be used to get the geometrical factor as a function of the two particle separations. It populates a table with the results of the numerical integration. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00120">120</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="sidm__routines_8c_source.html#l00141">geofactor_integ()</a>, <a class="el" href="sidm__routines_8c_source.html#l00013">GSLWORKSIZE</a>, and <a class="el" href="pm__periodic_8c_source.html#l00045">workspace</a>.</p>

<p>Referenced by <a class="el" href="begrun_8c_source.html#l00028">begrun()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i;
  <span class="keywordtype">double</span> result, abserr,r;
  gsl_function F;
  gsl_integration_workspace *<a class="code" href="pm__periodic_8c.html#a182a8913bc59d672bb2a85e63ffcde0f">workspace</a>;
  workspace = gsl_integration_workspace_alloc(<a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>);

  <span class="keywordflow">for</span>(i = 0; i &lt; GEOFACTOR_TABLE_LENGTH; i++)
  {
    r =  2.0/GEOFACTOR_TABLE_LENGTH * (i + 1);
    F.function = &amp;<a class="code" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc">geofactor_integ</a>;
    F.params = &amp;r;
    gsl_integration_qag(&amp;F, 0.0, 1.0, 0, 1.0e-8, <a class="code" href="sidm__routines_8c.html#af3f7d23e690c4253a44e7a674d31d276">GSLWORKSIZE</a>, GSL_INTEG_GAUSS41,workspace, &amp;result, &amp;abserr);
    GeoFactorTable[i] = 2*M_PI*result;
  }
  gsl_integration_workspace_free(workspace);
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_cgraph.png" border="0" usemap="#sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_cgraph" alt=""/></div>
<map name="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_cgraph" id="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_cgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc" title="geofactor_integ" alt="" coords="203,30,325,58"/><area shape="rect" id="node5" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7" title="geofactor_angle_integ" alt="" coords="375,5,537,33"/><area shape="rect" id="node7" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4" title="kernel" alt="" coords="587,30,648,58"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph.png" border="0" usemap="#sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph" alt=""/></div>
<map name="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph" id="sidm__routines_8c_ae54bb3071b061a41ef29fcd551f50da5_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="203,5,269,33"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="319,5,372,33"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1d33f5b567083ba4e0775814536fd0b4"></a><!-- doxytag: member="sidm_routines.c::kernel" ref="a1d33f5b567083ba4e0775814536fd0b4" args="(double u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="sidm__routines_8c.html#a1d33f5b567083ba4e0775814536fd0b4">kernel</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>u</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns the value W(x). The values of the density kernel as a funtion of x=r/h. </p>
<p>&lt; Coefficients for SPH spline kernel and its derivative </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00180">180</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>Referenced by <a class="el" href="sidm__routines_8c_source.html#l00167">geofactor_angle_integ()</a>, and <a class="el" href="sidm__routines_8c_source.html#l00141">geofactor_integ()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> w;

  <span class="keywordflow">if</span> (u &lt; 1.0)
    {
      <span class="keywordflow">if</span> (u &lt;= 0.5)
        {
          w = KERNEL_COEFF_1 + KERNEL_COEFF_2 * (u - 1) * u * u;
          <span class="keywordflow">return</span> w;
        }
      <span class="keywordflow">else</span>
        {
          w = KERNEL_COEFF_5 * (1.0 - u) * (1.0 - u) * (1.0 - u);
          <span class="keywordflow">return</span> w;
        }
    }
  <span class="keywordflow">else</span>
  {
    <span class="keywordflow">return</span> 0.0;
  }
}
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph.png" border="0" usemap="#sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph" id="sidm__routines_8c_a1d33f5b567083ba4e0775814536fd0b4_icgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#a309de7eeb7e8c96c4d127696d4d9a4a7" title="geofactor_angle_integ" alt="" coords="116,5,279,33"/><area shape="rect" id="node5" href="sidm__routines_8c.html#a5b60a9da4d9d0c091769f0e9fc6c6bdc" title="geofactor_integ" alt="" coords="328,30,451,58"/><area shape="rect" id="node7" href="sidm__routines_8c.html#ae54bb3071b061a41ef29fcd551f50da5" title="init_geofactor_table" alt="" coords="500,30,647,58"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="696,30,763,58"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="812,30,865,58"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5b36e92449c7102086706b7b24899be8"></a><!-- doxytag: member="sidm_routines.c::prob_of_interaction" ref="a5b36e92449c7102086706b7b24899be8" args="(double r, float Vtarget[3], float Vno[3], int tbegin, int tend)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="sidm__routines_8c.html#a5b36e92449c7102086706b7b24899be8">prob_of_interaction</a> </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Vtarget</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>Vno</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tbegin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tend</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function calculates the interaction probability between two particles. It checks if comoving integration is on and does the necesary change of variables and units. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00032">32</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="sidm__routines_8c_source.html#l00072">g_geo()</a>, <a class="el" href="hydra_8c_source.html#l00019">hubble_a</a>, and <a class="el" href="peano_8c.html#a6bca09dac540caff82dc91b8875b2893">mp</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01542">force_treeevaluate_shortrange()</a>.</p>
<div class="fragment"><pre class="fragment">  {
    <span class="keywordtype">double</span> dT, dloga, dV, dvx, dvy, dvz, prob,h,<a class="code" href="hydra_8c.html#abb7074f2e4b01309c6f2dc87bb3a1a40">hubble_a</a>,<a class="code" href="peano_8c.html#a6bca09dac540caff82dc91b8875b2893">mp</a>;

    dvx = Vno[0]-Vtarget[0];
    dvy = Vno[1]-Vtarget[1];
    dvz = Vno[2]-Vtarget[2];
    dV = sqrt(dvx*dvx + dvy*dvy + dvz*dvz);

    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ComovingIntegrationOn)
      {
        r =  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time*r;
        h = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SIDMSmoothingFactor*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ForceSoftening[1]*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time;

        dloga = (tend - tbegin)*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Timebase_interval;
        hubble_a = (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Omega0 / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time)
                    + (1 - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Omega0 - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.OmegaLambda) / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time) + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.OmegaLambda);
        hubble_a = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Hubble * sqrt(hubble_a);
        dT = dloga/<a class="code" href="hydra_8c.html#abb7074f2e4b01309c6f2dc87bb3a1a40">hubble_a</a>;

        dV = dV/<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Time; <span class="comment">/* Convert from internal velocity p = a^2 dx/dt to peculiar velocity v = a dx/dt*/</span>
        <span class="comment">//dV -= hubble_a*r; /* This is not the right way to do it, disregard for know */</span>
   
      }
    <span class="keywordflow">else</span>
      {
        dT = (tend-tbegin)*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Timebase_interval;
        h = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.SIDMSmoothingFactor*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.ForceSoftening[1];
      }

    mp =  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.MassTable[1]*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.UnitMass_in_g;
    prob = mp*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.InteractionCrossSection*dV*dT*<a class="code" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d">g_geo</a>(r/h)/(h*h*h*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.UnitLength_in_cm*<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.UnitLength_in_cm);

    <span class="keywordflow">return</span> prob/2; <span class="comment">/* The factor of 2 comes from tests showing that the number of interactions converge to twice the</span>
<span class="comment">                      expected number of interactions*/</span>
  }
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph.png" border="0" usemap="#sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph" id="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_cgraph">
<area shape="rect" id="node3" href="sidm__routines_8c.html#ab5ff10bfb368309b0dd01aaa72c6be1d" title="g_geo" alt="" coords="200,5,261,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph.png" border="0" usemap="#sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph" id="sidm__routines_8c_a5b36e92449c7102086706b7b24899be8_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="239,5,380,33"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="200,55,419,83"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="467,30,565,58"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="613,30,784,58"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="832,30,875,58"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="924,30,977,58"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a07ab80a1f9370ead2bc2a38884436615"></a><!-- doxytag: member="sidm_routines.c::update_interaction_table" ref="a07ab80a1f9370ead2bc2a38884436615" args="(IDTYPE id1, IDTYPE id2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="sidm__routines_8c.html#a07ab80a1f9370ead2bc2a38884436615">update_interaction_table</a> </td>
          <td>(</td>
          <td class="paramtype">IDTYPE&#160;</td>
          <td class="paramname"><em>id1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IDTYPE&#160;</td>
          <td class="paramname"><em>id2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine updates the interaction table each time there is an interaction. </p>

<p>Definition at line <a class="el" href="sidm__routines_8c_source.html#l00205">205</a> of file <a class="el" href="sidm__routines_8c_source.html">sidm_routines.c</a>.</p>

<p>References <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>.</p>

<p>Referenced by <a class="el" href="forcetree_8c_source.html#l01126">force_treeevaluate()</a>, and <a class="el" href="forcetree_8c_source.html#l01542">force_treeevaluate_shortrange()</a>.</p>
<div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i,j,id1_index,id2_index;
  id1 += 1;
  id2 += 1;
  id1_index = -1;
  id2_index = -1;

  <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
    {
      <span class="keywordflow">if</span>(InteractionTable[i][0] == id1)
        {
          id1_index = i;
          <span class="keywordflow">break</span>;
        }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(InteractionTable[i][0] == id2) 
        {
          id2_index = i;
          <span class="keywordflow">break</span>;
        }
    }

   <span class="keywordflow">if</span>(id1_index == -1 &amp;&amp; id2_index == -1)
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; INTERACTION_TABLE_LENGTH; i++)
        {
          <span class="keywordflow">if</span>(InteractionTable[i][0] == 0)
            {
              InteractionTable[i][0] = id1;
              InteractionTable[i][1] = id2;
              <span class="keywordflow">break</span>;
            }
          <span class="keywordflow">if</span> (i == INTERACTION_TABLE_LENGTH - 1)
            {
              printf(<span class="stringliteral">&quot;ERROR: There were more interactions in this timestep than INTERACTION_TABLE_LENGTH\n&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
            }
        }
    }
   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(id1_index &gt;= 0)
     {
       <span class="keywordflow">for</span>(j = 1; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
         {
           <span class="keywordflow">if</span>(InteractionTable[id1_index][j] == 0)
             {
               InteractionTable[id1_index][j] = id2;
               <span class="keywordflow">break</span>;
             }
           <span class="keywordflow">if</span> (j == PARTICLE_MAX_INTERACTIONS )
             {
               printf(<span class="stringliteral">&quot;ERROR: A particle interacted more than PARTICLE_MAX_INTERACTIONS\n&quot;</span>);
               <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
             }
         }
     } 
   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(id2_index &gt;= 0)
     {
       <span class="keywordflow">for</span>(j = 1; j &lt; PARTICLE_MAX_INTERACTIONS + 1; j++)
         {
           <span class="keywordflow">if</span>(InteractionTable[id2_index][j] == 0)
             {
               InteractionTable[id2_index][j] = id1;
               <span class="keywordflow">break</span>;
             }
           <span class="keywordflow">if</span> (j == PARTICLE_MAX_INTERACTIONS )
             {
               printf(<span class="stringliteral">&quot;ERROR: A particle interacted more than PARTICLE_MAX_INTERACTIONS\n&quot;</span>);
               <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1);
             }
         }
     }
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph.png" border="0" usemap="#sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph" alt=""/></div>
<map name="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph" id="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="235,5,301,33"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="349,5,507,33"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph.png" border="0" usemap="#sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph" alt=""/></div>
<map name="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph" id="sidm__routines_8c_a07ab80a1f9370ead2bc2a38884436615_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a59ae74ef51d6a7065605638422489391" title="force_treeevaluate" alt="" coords="273,5,415,33"/><area shape="rect" id="node13" href="proto_8h.html#ae01e179b7686a7fe62970160b7bbdb46" title="force_treeevaluate_shortrange" alt="" coords="235,55,453,83"/><area shape="rect" id="node5" href="proto_8h.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="501,30,600,58"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="648,30,819,58"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="867,30,909,58"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="959,30,1012,58"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="sidm__routines_8c.html">sidm_routines.c</a>      </li>

    <li class="footer">Generated on Fri Dec 6 2013 15:20:11 for gadget-sidm by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
