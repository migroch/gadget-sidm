<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: restart.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>restart.c</h1>  </div>
</div>
<div class="contents">
<a href="restart_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;mpi.h&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;sys/file.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;gsl/gsl_rng.h&gt;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="allvars_8h.html" title="declares global variables.">allvars.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="proto_8h.html" title="this file contains all function prototypes of the code">proto.h</a>&quot;</span>
<a name="l00016"></a>00016 
<a name="l00021"></a><a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">00021</a> <span class="keyword">static</span> FILE *<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5">in</a>(<span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> modus);
<a name="l00024"></a>00024 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<span class="keywordtype">void</span> *x, <span class="keywordtype">size_t</span> n, <span class="keywordtype">int</span> modus);
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00035"></a><a class="code" href="restart_8c.html#ae81d30f52dddd39aef76bb1890d16f2f">00035</a> <span class="keywordtype">void</span> <a class="code" href="proto_8h.html#af3e3dd8294f983f9ed9f75c81d149ec9">restart</a>(<span class="keywordtype">int</span> modus)
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037   <span class="keywordtype">char</span> buf[200], buf_bak[200], buf_mv[500];
<a name="l00038"></a>00038   <span class="keywordtype">double</span> save_PartAllocFactor, save_TreeAllocFactor;
<a name="l00039"></a>00039   <span class="keywordtype">int</span> i, nprocgroup, masterTask, groupTask, old_MaxPart, old_MaxNodes;
<a name="l00040"></a>00040   <span class="keyword">struct </span><a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a> all_task0;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   sprintf(buf, <span class="stringliteral">&quot;%s%s.%d&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aebda5d1b80cfb767b9668d7858c36bcc">OutputDir</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a67e197a37469217aa8ad32c42230b286">RestartFile</a>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);
<a name="l00044"></a>00044   sprintf(buf_bak, <span class="stringliteral">&quot;%s%s.%d.bak&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aebda5d1b80cfb767b9668d7858c36bcc">OutputDir</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a67e197a37469217aa8ad32c42230b286">RestartFile</a>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);
<a name="l00045"></a>00045   sprintf(buf_mv, <span class="stringliteral">&quot;mv %s %s&quot;</span>, buf, buf_bak);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 
<a name="l00048"></a>00048   <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> &lt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>))
<a name="l00049"></a>00049     {
<a name="l00050"></a>00050       printf
<a name="l00051"></a>00051         (<span class="stringliteral">&quot;Fatal error.\nNumber of processors must be a smaller or equal than `NumFilesWrittenInParallel&#39;.\n&quot;</span>);
<a name="l00052"></a>00052       <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(2131);
<a name="l00053"></a>00053     }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   nprocgroup = <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057   <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> % <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>))
<a name="l00058"></a>00058     {
<a name="l00059"></a>00059       nprocgroup++;
<a name="l00060"></a>00060     }
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   masterTask = (<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> / nprocgroup) * nprocgroup;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="keywordflow">for</span>(groupTask = 0; groupTask &lt; nprocgroup; groupTask++)
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == (masterTask + groupTask))  <span class="comment">/* ok, it&#39;s this processor&#39;s turn */</span>
<a name="l00067"></a>00067         {
<a name="l00068"></a>00068           <span class="keywordflow">if</span>(modus)
<a name="l00069"></a>00069             {
<a name="l00070"></a>00070               <span class="keywordflow">if</span>(!(<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a> = fopen(buf, <span class="stringliteral">&quot;r&quot;</span>)))
<a name="l00071"></a>00071                 {
<a name="l00072"></a>00072                   printf(<span class="stringliteral">&quot;Restart file &#39;%s&#39; not found.\n&quot;</span>, buf);
<a name="l00073"></a>00073                   <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(7870);
<a name="l00074"></a>00074                 }
<a name="l00075"></a>00075             }
<a name="l00076"></a>00076           <span class="keywordflow">else</span>
<a name="l00077"></a>00077             {
<a name="l00078"></a>00078               system(buf_mv);   <span class="comment">/* move old restart files to .bak files */</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080               <span class="keywordflow">if</span>(!(<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a> = fopen(buf, <span class="stringliteral">&quot;w&quot;</span>)))
<a name="l00081"></a>00081                 {
<a name="l00082"></a>00082                   printf(<span class="stringliteral">&quot;Restart file &#39;%s&#39; cannot be opened.\n&quot;</span>, buf);
<a name="l00083"></a>00083                   <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(7878);
<a name="l00084"></a>00084                 }
<a name="l00085"></a>00085             }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 
<a name="l00088"></a>00088           save_PartAllocFactor = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a>;
<a name="l00089"></a>00089           save_TreeAllocFactor = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091           <span class="comment">/* common data  */</span>
<a name="l00092"></a>00092           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(&amp;<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a>), modus);
<a name="l00093"></a>00093 
<a name="l00094"></a>00094           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0 &amp;&amp; modus &gt; 0)
<a name="l00095"></a>00095             all_task0 = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097           <span class="keywordflow">if</span>(modus &gt; 0 &amp;&amp; groupTask == 0)       <span class="comment">/* read */</span>
<a name="l00098"></a>00098             {
<a name="l00099"></a>00099               MPI_Bcast(&amp;all_task0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a>), MPI_BYTE, 0, MPI_COMM_WORLD);
<a name="l00100"></a>00100             }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102           old_MaxPart = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>;
<a name="l00103"></a>00103           old_MaxNodes = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105           <span class="keywordflow">if</span>(modus)             <span class="comment">/* read */</span>
<a name="l00106"></a>00106             {
<a name="l00107"></a>00107               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> != save_PartAllocFactor)
<a name="l00108"></a>00108                 {
<a name="l00109"></a>00109                   <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> = save_PartAllocFactor;
<a name="l00110"></a>00110                   <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);
<a name="l00111"></a>00111                   <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a43dccd3997af759d43a2f3bcce44a2c4">MaxPartSph</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2bb70816a4d5f56e0df2d9b8d706cef2">TotN_gas</a> / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);
<a name="l00112"></a>00112                   save_PartAllocFactor = -1;
<a name="l00113"></a>00113                 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> != save_TreeAllocFactor)
<a name="l00116"></a>00116                 {
<a name="l00117"></a>00117                   <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> = save_TreeAllocFactor;
<a name="l00118"></a>00118                   save_TreeAllocFactor = -1;
<a name="l00119"></a>00119                 }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121               <span class="keywordflow">if</span>(all_task0.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> != <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>)
<a name="l00122"></a>00122                 {
<a name="l00123"></a>00123                   printf(<span class="stringliteral">&quot;The restart file on task=%d is not consistent with the one on task=0\n&quot;</span>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);
<a name="l00124"></a>00124                   fflush(stdout);
<a name="l00125"></a>00125                   <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(16);
<a name="l00126"></a>00126                 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128               <a class="code" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7">allocate_memory</a>();
<a name="l00129"></a>00129             }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131           <a class="code" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5">in</a>(&amp;<a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>, modus);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>)
<a name="l00134"></a>00134             {
<a name="l00135"></a>00135               printf
<a name="l00136"></a>00136                 (<span class="stringliteral">&quot;it seems you have reduced(!) &#39;PartAllocFactor&#39; below the value of %g needed to load the restart file.\n&quot;</span>,
<a name="l00137"></a>00137                  <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> / (((<span class="keywordtype">double</span>) <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a>) / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>));
<a name="l00138"></a>00138               printf(<span class="stringliteral">&quot;fatal error\n&quot;</span>);
<a name="l00139"></a>00139               <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(22);
<a name="l00140"></a>00140             }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142           <span class="comment">/* Particle data  */</span>
<a name="l00143"></a>00143           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(&amp;<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[0], <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structparticle__data.html">particle_data</a>), modus);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145           <a class="code" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5">in</a>(&amp;<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>, modus);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> &gt; 0)
<a name="l00148"></a>00148             {
<a name="l00149"></a>00149               <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a43dccd3997af759d43a2f3bcce44a2c4">MaxPartSph</a>)
<a name="l00150"></a>00150                 {
<a name="l00151"></a>00151                   printf
<a name="l00152"></a>00152                     (<span class="stringliteral">&quot;SPH: it seems you have reduced(!) &#39;PartAllocFactor&#39; below the value of %g needed to load the restart file.\n&quot;</span>,
<a name="l00153"></a>00153                      <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> / (((<span class="keywordtype">double</span>) <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2bb70816a4d5f56e0df2d9b8d706cef2">TotN_gas</a>) / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>));
<a name="l00154"></a>00154                   printf(<span class="stringliteral">&quot;fatal error\n&quot;</span>);
<a name="l00155"></a>00155                   <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(222);
<a name="l00156"></a>00156                 }
<a name="l00157"></a>00157               <span class="comment">/* Sph-Particle data  */</span>
<a name="l00158"></a>00158               <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(&amp;<a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[0], <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsph__particle__data.html">sph_particle_data</a>), modus);
<a name="l00159"></a>00159             }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161           <span class="comment">/* write state of random number generator */</span>
<a name="l00162"></a>00162           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(gsl_rng_state(<a class="code" href="allvars_8c.html#a4ec93729b85eb5da23dd6ffb23c3702b">random_generator</a>), gsl_rng_size(<a class="code" href="allvars_8c.html#a4ec93729b85eb5da23dd6ffb23c3702b">random_generator</a>), modus);
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00165"></a>00165           <span class="comment">/* now store relevant data for tree */</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167           <span class="keywordflow">if</span>(modus)             <span class="comment">/* read */</span>
<a name="l00168"></a>00168             {
<a name="l00169"></a>00169               <a class="code" href="ngb_8c.html#a6f7a3b85f10701b9067f012cc9a30f55">ngb_treeallocate</a>(<a class="code" href="allvars_8h.html#a459bf1b27bb8a17c4496d2783e62161c">MAX_NGB</a>);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171               <a class="code" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2">force_treeallocate</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>);
<a name="l00172"></a>00172             }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 
<a name="l00175"></a>00175           <a class="code" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5">in</a>(&amp;<a class="code" href="allvars_8c.html#acf4151281b98d29aa500c5e56e66741f">Numnodestree</a>, modus);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177           <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#acf4151281b98d29aa500c5e56e66741f">Numnodestree</a> &gt; <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>)
<a name="l00178"></a>00178             {
<a name="l00179"></a>00179               printf
<a name="l00180"></a>00180                 (<span class="stringliteral">&quot;Tree storage: it seems you have reduced(!) &#39;PartAllocFactor&#39; below the value needed to load the restart file (task=%d). &quot;</span>
<a name="l00181"></a>00181                  <span class="stringliteral">&quot;Numnodestree=%d  MaxNodes=%d\n&quot;</span>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, <a class="code" href="allvars_8c.html#acf4151281b98d29aa500c5e56e66741f">Numnodestree</a>, <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>);
<a name="l00182"></a>00182               <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(221);
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>, <a class="code" href="allvars_8c.html#acf4151281b98d29aa500c5e56e66741f">Numnodestree</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structNODE.html">NODE</a>), modus);
<a name="l00186"></a>00186           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#a57932378336b142ac6e6a9ddb60dce3f">Extnodes_base</a>, <a class="code" href="allvars_8c.html#acf4151281b98d29aa500c5e56e66741f">Numnodestree</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structextNODE.html">extNODE</a>), modus);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>, <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>, <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00191"></a>00191           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>, <a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#a3c2a7b96fe94b5151d568fe321888d23">DomainStartList</a>, <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00194"></a>00194           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#abb42257c117a39d968334cd054c16dcf">DomainEndList</a>, <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00195"></a>00195           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#a6f4a30ea20d1347d14d2e32de91390bb">DomainTask</a>, <a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00196"></a>00196           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#acd2b211f08f9b7e83da8cb58bf3931a0">DomainNodeIndex</a>, <a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00197"></a>00197           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#a52e5390127f5298d6639b9399077bfbf">DomainTreeNodeLen</a>, <a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a>), modus);
<a name="l00198"></a>00198           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#a5a4689ebf26bc52b81819580362ef4dc">DomainHmax</a>, <a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a>), modus);
<a name="l00199"></a>00199           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#ad90674eef0b2180889d1620d5cc8672b">DomainMoment</a>, <a class="code" href="allvars_8h.html#a803069f3cb8753ac3db10d5decebfc0d">MAXTOPNODES</a> * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structDomainNODE.html">DomainNODE</a>), modus);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#a55dacf524ba7bbc5210fc68469a05d0f">DomainCorner</a>, 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
<a name="l00202"></a>00202           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<a class="code" href="allvars_8c.html#ad13aabcbb50307c005ffa0b2edccdaeb">DomainCenter</a>, 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
<a name="l00203"></a>00203           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(&amp;<a class="code" href="allvars_8c.html#a3dd9593672bf68f0c36fa3e5451e9265">DomainLen</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
<a name="l00204"></a>00204           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(&amp;<a class="code" href="allvars_8c.html#a4488078cfcc203156f193c43a1d3a2ef">DomainFac</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>), modus);
<a name="l00205"></a>00205           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(&amp;<a class="code" href="allvars_8c.html#a424b31dae72cd3331485d2fb6490c7ac">DomainMyStart</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00206"></a>00206           <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(&amp;<a class="code" href="allvars_8c.html#ad6c1a01f55d5c8b7b642525118acbebe">DomainMyLast</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), modus);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208           <span class="keywordflow">if</span>(modus)             <span class="comment">/* read */</span>
<a name="l00209"></a>00209             <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> != save_PartAllocFactor || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a374a92c40b930e388b7180b8862c3670">TreeAllocFactor</a> != save_TreeAllocFactor)
<a name="l00210"></a>00210               {
<a name="l00211"></a>00211                 <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
<a name="l00212"></a>00212                   <a class="code" href="allvars_8c.html#ae1adfde6b271afd077130a64e6b85766">Father</a>[i] += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214                 <span class="keywordflow">for</span>(i = 0; i &lt; NumPart; i++)
<a name="l00215"></a>00215                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i] &gt;= old_MaxPart)
<a name="l00216"></a>00216                     {
<a name="l00217"></a>00217                       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i] &gt;= old_MaxPart + old_MaxNodes)
<a name="l00218"></a>00218                         <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i] += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> - old_MaxPart);
<a name="l00219"></a>00219                       <span class="keywordflow">else</span>
<a name="l00220"></a>00220                         <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i] += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart);
<a name="l00221"></a>00221                     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223                 <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#acf4151281b98d29aa500c5e56e66741f">Numnodestree</a>; i++)
<a name="l00224"></a>00224                   {
<a name="l00225"></a>00225                     <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].u.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.sibling &gt;= old_MaxPart)
<a name="l00226"></a>00226                       {
<a name="l00227"></a>00227                         <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].u.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.sibling &gt;= old_MaxPart + old_MaxNodes)
<a name="l00228"></a>00228                           <a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.sibling +=
<a name="l00229"></a>00229                             (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> - old_MaxNodes);
<a name="l00230"></a>00230                         <span class="keywordflow">else</span>
<a name="l00231"></a>00231                           <a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.sibling += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart);
<a name="l00232"></a>00232                       }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234                     <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].u.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.father &gt;= old_MaxPart)
<a name="l00235"></a>00235                       {
<a name="l00236"></a>00236                         <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].u.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.father &gt;= old_MaxPart + old_MaxNodes)
<a name="l00237"></a>00237                           <a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.father += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> - old_MaxNodes);
<a name="l00238"></a>00238                         <span class="keywordflow">else</span>
<a name="l00239"></a>00239                           <a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.father += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart);
<a name="l00240"></a>00240                       }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242                     <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].u.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.nextnode &gt;= old_MaxPart)
<a name="l00243"></a>00243                       {
<a name="l00244"></a>00244                         <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].u.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.nextnode &gt;= old_MaxPart + old_MaxNodes)
<a name="l00245"></a>00245                           <a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.nextnode +=
<a name="l00246"></a>00246                             (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> - old_MaxNodes);
<a name="l00247"></a>00247                         <span class="keywordflow">else</span>
<a name="l00248"></a>00248                           <a class="code" href="allvars_8c.html#a0cb940c6ac9331805bcc91b437c78e9a">Nodes_base</a>[i].<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.<a class="code" href="structNODE.html#a5ab829c8c9c85992ba220635f776de74">d</a>.nextnode += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart);
<a name="l00249"></a>00249                       }
<a name="l00250"></a>00250                   }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252                 <span class="keywordflow">for</span>(i = 0; i &lt; MAXTOPNODES; i++)
<a name="l00253"></a>00253                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>] &gt;= old_MaxPart)
<a name="l00254"></a>00254                     {
<a name="l00255"></a>00255                       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>] &gt;= old_MaxPart + old_MaxNodes)
<a name="l00256"></a>00256                         <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>] += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> - old_MaxNodes);
<a name="l00257"></a>00257                       <span class="keywordflow">else</span>
<a name="l00258"></a>00258                         <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[i + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>] += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart);
<a name="l00259"></a>00259                     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261                 <span class="keywordflow">for</span>(i = 0; i &lt; MAXTOPNODES; i++)
<a name="l00262"></a>00262                   <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#acd2b211f08f9b7e83da8cb58bf3931a0">DomainNodeIndex</a>[i] &gt;= old_MaxPart)
<a name="l00263"></a>00263                     {
<a name="l00264"></a>00264                       <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#acd2b211f08f9b7e83da8cb58bf3931a0">DomainNodeIndex</a>[i] &gt;= old_MaxPart + old_MaxNodes)
<a name="l00265"></a>00265                         <a class="code" href="allvars_8c.html#acd2b211f08f9b7e83da8cb58bf3931a0">DomainNodeIndex</a>[i] += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart) + (<a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a> - old_MaxNodes);
<a name="l00266"></a>00266                       <span class="keywordflow">else</span>
<a name="l00267"></a>00267                         <a class="code" href="allvars_8c.html#acd2b211f08f9b7e83da8cb58bf3931a0">DomainNodeIndex</a>[i] += (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> - old_MaxPart);
<a name="l00268"></a>00268                     }
<a name="l00269"></a>00269               }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271           fclose(<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273       <span class="keywordflow">else</span>                      <span class="comment">/* wait inside the group */</span>
<a name="l00274"></a>00274         {
<a name="l00275"></a>00275           <span class="keywordflow">if</span>(modus &gt; 0 &amp;&amp; groupTask == 0)       <span class="comment">/* read */</span>
<a name="l00276"></a>00276             {
<a name="l00277"></a>00277               MPI_Bcast(&amp;all_task0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structglobal__data__all__processes.html">global_data_all_processes</a>), MPI_BYTE, 0, MPI_COMM_WORLD);
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281       MPI_Barrier(MPI_COMM_WORLD);
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00289"></a><a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">00289</a> <span class="keywordtype">void</span> <a class="code" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21">byten</a>(<span class="keywordtype">void</span> *x, <span class="keywordtype">size_t</span> n, <span class="keywordtype">int</span> modus)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291   <span class="keywordflow">if</span>(modus)
<a name="l00292"></a>00292     <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(x, n, 1, <a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);
<a name="l00293"></a>00293   <span class="keywordflow">else</span>
<a name="l00294"></a>00294     <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(x, n, 1, <a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);
<a name="l00295"></a>00295 }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297 
<a name="l00300"></a><a class="code" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5">00300</a> <span class="keywordtype">void</span> <a class="code" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5">in</a>(<span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> modus)
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302   <span class="keywordflow">if</span>(modus)
<a name="l00303"></a>00303     <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(x, 1, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);
<a name="l00304"></a>00304   <span class="keywordflow">else</span>
<a name="l00305"></a>00305     <a class="code" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21">my_fwrite</a>(x, 1, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), <a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);
<a name="l00306"></a>00306 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 3 2010 18:45:43 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
