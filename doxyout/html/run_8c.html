<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: run.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>run.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>iterates over timesteps, main loop  
<a href="#_details">More...</a></p>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for run.c:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c__incl.png" border="0" usemap="#run_8c" alt=""/></div>
<map name="run_8c" id="run_8c">
<area shape="rect" id="node15" href="allvars_8h.html" title="declares global variables." alt="" coords="448,160,523,189"/><area shape="rect" id="node22" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="533,83,600,112"/><area shape="rect" id="node20" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="508,237,569,267"/></map>
</div>

<p><a href="run_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2">run</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="run_8c.html#ad52604af910b3e1677718d863ab09391">find_next_sync_point_and_drift</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="run_8c.html#a00802290d71ce2a6de3f121de55ddd20">find_next_outputtime</a> (int ti_curr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="run_8c.html#a7e26319b203616f2c85b5fd6f2ade85d">every_timestep_stuff</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="run_8c.html#ae903322da17c6875ab606b032b918099">energy_statistics</a> (void)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>iterates over timesteps, main loop </p>

<p>Definition in file <a class="el" href="run_8c_source.html">run.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae903322da17c6875ab606b032b918099"></a><!-- doxytag: member="run.c::energy_statistics" ref="ae903322da17c6875ab606b032b918099" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void energy_statistics </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine first calls a computation of various global quantities of the particle distribution, and then writes some statistics about the energies in the various particle components to the file FdEnergy. </p>

<p>Definition at line <a class="el" href="run_8c_source.html#l00432">432</a> of file <a class="el" href="run_8c_source.html">run.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="global_8c_source.html#l00022">compute_global_quantities_of_system()</a>, <a class="el" href="allvars_8h_source.html#l00685">state_of_system::EnergyInt</a>, <a class="el" href="allvars_8h_source.html#l00693">state_of_system::EnergyIntComp</a>, <a class="el" href="allvars_8h_source.html#l00683">state_of_system::EnergyKin</a>, <a class="el" href="allvars_8h_source.html#l00691">state_of_system::EnergyKinComp</a>, <a class="el" href="allvars_8h_source.html#l00684">state_of_system::EnergyPot</a>, <a class="el" href="allvars_8h_source.html#l00692">state_of_system::EnergyPotComp</a>, <a class="el" href="allvars_8c_source.html#l00090">FdEnergy</a>, <a class="el" href="allvars_8h_source.html#l00690">state_of_system::MassComp</a>, <a class="el" href="allvars_8c_source.html#l00173">SysState</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, and <a class="el" href="allvars_8h_source.html#l00369">global_data_all_processes::Time</a>.</p>

<p>Referenced by <a class="el" href="run_8c_source.html#l00020">run()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <a class="code" href="global_8c.html#ada58109949c2431ca9b0cdaa01cfb5b1">compute_global_quantities_of_system</a>();

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      fprintf(<a class="code" href="allvars_8c.html#a0230903e40950ac42dbff71dddd12176">FdEnergy</a>,
              <span class="stringliteral">&quot;%g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g %g\n&quot;</span>,
              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a8ee567f49007a65817989a252d8c4f90">EnergyInt</a>, <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#aece07698cdbe00520fcb92ad9f04d435">EnergyPot</a>, <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a92ed1ad5f1a02586030b21f5f3e560ec">EnergyKin</a>, <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af96bea4b9655900eef6d7734629241a7">EnergyIntComp</a>[0],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af495e90a93989d10e7f138c33c5cdad3">EnergyPotComp</a>[0], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a8b776a503b441fc690c0940e3386a2fb">EnergyKinComp</a>[0], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af96bea4b9655900eef6d7734629241a7">EnergyIntComp</a>[1],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af495e90a93989d10e7f138c33c5cdad3">EnergyPotComp</a>[1], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a8b776a503b441fc690c0940e3386a2fb">EnergyKinComp</a>[1], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af96bea4b9655900eef6d7734629241a7">EnergyIntComp</a>[2],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af495e90a93989d10e7f138c33c5cdad3">EnergyPotComp</a>[2], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a8b776a503b441fc690c0940e3386a2fb">EnergyKinComp</a>[2], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af96bea4b9655900eef6d7734629241a7">EnergyIntComp</a>[3],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af495e90a93989d10e7f138c33c5cdad3">EnergyPotComp</a>[3], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a8b776a503b441fc690c0940e3386a2fb">EnergyKinComp</a>[3], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af96bea4b9655900eef6d7734629241a7">EnergyIntComp</a>[4],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af495e90a93989d10e7f138c33c5cdad3">EnergyPotComp</a>[4], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a8b776a503b441fc690c0940e3386a2fb">EnergyKinComp</a>[4], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af96bea4b9655900eef6d7734629241a7">EnergyIntComp</a>[5],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#af495e90a93989d10e7f138c33c5cdad3">EnergyPotComp</a>[5], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a8b776a503b441fc690c0940e3386a2fb">EnergyKinComp</a>[5], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a760dbd458028ff092d8fab04f54f90ff">MassComp</a>[0],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a760dbd458028ff092d8fab04f54f90ff">MassComp</a>[1], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a760dbd458028ff092d8fab04f54f90ff">MassComp</a>[2], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a760dbd458028ff092d8fab04f54f90ff">MassComp</a>[3], <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a760dbd458028ff092d8fab04f54f90ff">MassComp</a>[4],
              <a class="code" href="allvars_8c.html#af53292602db23da91797b37daeb9b8ce">SysState</a>.<a class="code" href="structstate__of__system.html#a760dbd458028ff092d8fab04f54f90ff">MassComp</a>[5]);

      fflush(<a class="code" href="allvars_8c.html#a0230903e40950ac42dbff71dddd12176">FdEnergy</a>);
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_ae903322da17c6875ab606b032b918099_cgraph.png" border="0" usemap="#run_8c_ae903322da17c6875ab606b032b918099_cgraph" alt=""/></div>
<map name="run_8c_ae903322da17c6875ab606b032b918099_cgraph" id="run_8c_ae903322da17c6875ab606b032b918099_cgraph">
<area shape="rect" id="node3" href="global_8c.html#ada58109949c2431ca9b0cdaa01cfb5b1" title="compute_global_quantities_of_system" alt="" coords="184,59,451,88"/><area shape="rect" id="node5" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059" title="get_gravkick_factor" alt="" coords="503,5,649,35"/><area shape="rect" id="node7" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c" title="get_hydrokick_factor" alt="" coords="499,59,653,88"/><area shape="rect" id="node9" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="553,112,599,141"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_ae903322da17c6875ab606b032b918099_icgraph.png" border="0" usemap="#run_8c_ae903322da17c6875ab606b032b918099_icgraph" alt=""/></div>
<map name="run_8c_ae903322da17c6875ab606b032b918099_icgraph" id="run_8c_ae903322da17c6875ab606b032b918099_icgraph">
<area shape="rect" id="node3" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="184,5,227,35"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="276,5,329,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7e26319b203616f2c85b5fd6f2ade85d"></a><!-- doxytag: member="run.c::every_timestep_stuff" ref="a7e26319b203616f2c85b5fd6f2ade85d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void every_timestep_stuff </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine writes one line for every timestep to two log-files. In FdInfo, we just list the timesteps that have been done, while in FdCPU the cumulative cpu-time consumption in various parts of the code is stored. </p>

<p>Definition at line <a class="el" href="run_8c_source.html#l00370">370</a> of file <a class="el" href="run_8c_source.html">run.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00347">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="allvars_8h_source.html#l00413">global_data_all_processes::CPU_CommSum</a>, <a class="el" href="allvars_8h_source.html#l00410">global_data_all_processes::CPU_Domain</a>, <a class="el" href="allvars_8h_source.html#l00419">global_data_all_processes::CPU_EnsureNgb</a>, <a class="el" href="allvars_8h_source.html#l00408">global_data_all_processes::CPU_Gravity</a>, <a class="el" href="allvars_8h_source.html#l00416">global_data_all_processes::CPU_HydCommSumm</a>, <a class="el" href="allvars_8h_source.html#l00415">global_data_all_processes::CPU_HydCompWalk</a>, <a class="el" href="allvars_8h_source.html#l00417">global_data_all_processes::CPU_HydImbalance</a>, <a class="el" href="allvars_8h_source.html#l00418">global_data_all_processes::CPU_Hydro</a>, <a class="el" href="allvars_8h_source.html#l00414">global_data_all_processes::CPU_Imbalance</a>, <a class="el" href="allvars_8h_source.html#l00423">global_data_all_processes::CPU_Peano</a>, <a class="el" href="allvars_8h_source.html#l00422">global_data_all_processes::CPU_PM</a>, <a class="el" href="allvars_8h_source.html#l00409">global_data_all_processes::CPU_Potential</a>, <a class="el" href="allvars_8h_source.html#l00420">global_data_all_processes::CPU_Predict</a>, <a class="el" href="allvars_8h_source.html#l00411">global_data_all_processes::CPU_Snapshot</a>, <a class="el" href="allvars_8h_source.html#l00421">global_data_all_processes::CPU_TimeLine</a>, <a class="el" href="allvars_8h_source.html#l00412">global_data_all_processes::CPU_Total</a>, <a class="el" href="allvars_8h_source.html#l00406">global_data_all_processes::CPU_TreeConstruction</a>, <a class="el" href="allvars_8h_source.html#l00407">global_data_all_processes::CPU_TreeWalk</a>, <a class="el" href="allvars_8c_source.html#l00092">FdCPU</a>, <a class="el" href="allvars_8c_source.html#l00089">FdInfo</a>, <a class="el" href="allvars_8c_source.html#l00016">NTask</a>, <a class="el" href="allvars_8h_source.html#l00364">global_data_all_processes::NumCurrentTiStep</a>, <a class="el" href="system_8c_source.html#l00037">set_random_numbers()</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, <a class="el" href="allvars_8h_source.html#l00369">global_data_all_processes::Time</a>, and <a class="el" href="allvars_8h_source.html#l00371">global_data_all_processes::TimeStep</a>.</p>

<p>Referenced by <a class="el" href="run_8c_source.html#l00020">run()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> z;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
<span class="preprocessor">#ifdef COMPUTE_SELFINTERACTION_FORDARK</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
        {
          z = 1.0 / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) - 1;
          fprintf(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>, <span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Redshift: %g, Systemstep: %g, Dloga: %g, NselfInteractions: %lu\n&quot;</span>, 
                  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, z, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>,
                  log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) - log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>),  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactionsSum);
          printf(<span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Redshift: %g, Systemstep: %g, Dloga: %g, NselfInteractions: %lu\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>,
                 <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, z, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>, log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) - log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>), <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactionsSum);
          fflush(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>);
        }
      <span class="keywordflow">else</span>
        {
          fprintf(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>, <span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Systemstep: %g, NselfInteractions: %lu\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>,
                  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactionsSum);
          printf(<span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Systemstep: %g, NselfInteractions: %lu\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.Nself_interactionsSum);
          fflush(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>);
        }
<span class="preprocessor">#else       </span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
        {
          z = 1.0 / (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) - 1;
          fprintf(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>, <span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Redshift: %g, Systemstep: %g, Dloga: %g\n&quot;</span>,
                  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, z, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>,
                  log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) - log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>));
          printf(<span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Redshift: %g, Systemstep: %g, Dloga: %g\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>,
                 <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, z, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>, log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>) - log(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>));
          fflush(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>);
        }
      <span class="keywordflow">else</span>
        {
          fprintf(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>, <span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Systemstep: %g\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>,
                  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>);
          printf(<span class="stringliteral">&quot;\nBegin Step %d, Time: %g, Systemstep: %g\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a>);
          fflush(<a class="code" href="allvars_8c.html#af26719ed46b19cc760b7b55c3cb9968c">FdInfo</a>);
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      fprintf(<a class="code" href="allvars_8c.html#a889700103f4f515009e98a7d789fd164">FdCPU</a>, <span class="stringliteral">&quot;Step %d, Time: %g, CPUs: %d\n&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>, <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);

      fprintf(<a class="code" href="allvars_8c.html#a889700103f4f515009e98a7d789fd164">FdCPU</a>,
              <span class="stringliteral">&quot;%10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f %10.2f\n&quot;</span>,
              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3d87cd9a94ce540341d4fb713b253c9e">CPU_Total</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a27dce58feba6ff0e933ed6f24f857168">CPU_Gravity</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#add20a8e70f3c4cc7912dc81ef141daa2">CPU_Hydro</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a786736d9e91341733e286f6e03ab26a5">CPU_Domain</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab5f1e056cdaa2562ec2bd3945f634d73">CPU_Potential</a>,
              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#afb9d30620ea0dc8b9e46000e3ce0b3e3">CPU_Predict</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a675f7230ece5f6d88fcc0384a8e1f6c9">CPU_TimeLine</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4b533ec2fc1af7ee057eaa5805a65a7a">CPU_Snapshot</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#acf5e983357d7be116cd6663958e5a149">CPU_TreeWalk</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac9eb650a8550b48eb464b6a0a8629a27">CPU_TreeConstruction</a>,
              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a41ab81d126219e1ff8119f8400428216">CPU_CommSum</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a94e4eed16c5b353ec3c3c9ce380ec96a">CPU_Imbalance</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a918e3d80cf4fdaf22a803f4014588ad4">CPU_HydCompWalk</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad03842fb23d3c15316ca07c7ac1bce27">CPU_HydCommSumm</a>,
              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a848f914dfb3ae24d6faedc1944bcb265">CPU_HydImbalance</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad3447593858d4165b669b5e70b2521cd">CPU_EnsureNgb</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2251bf94479cb20a7af9c34ed56587d1">CPU_PM</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3d1492ec738b3ebf2025de1d2f398b7d">CPU_Peano</a>);
      fflush(<a class="code" href="allvars_8c.html#a889700103f4f515009e98a7d789fd164">FdCPU</a>);
    }

  <a class="code" href="proto_8h.html#a9cb45ef22cae101906f021fb7a23afbe">set_random_numbers</a>();
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_a7e26319b203616f2c85b5fd6f2ade85d_cgraph.png" border="0" usemap="#run_8c_a7e26319b203616f2c85b5fd6f2ade85d_cgraph" alt=""/></div>
<map name="run_8c_a7e26319b203616f2c85b5fd6f2ade85d_cgraph" id="run_8c_a7e26319b203616f2c85b5fd6f2ade85d_cgraph">
<area shape="rect" id="node3" href="proto_8h.html#a9cb45ef22cae101906f021fb7a23afbe" title="set_random_numbers" alt="" coords="211,5,373,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_a7e26319b203616f2c85b5fd6f2ade85d_icgraph.png" border="0" usemap="#run_8c_a7e26319b203616f2c85b5fd6f2ade85d_icgraph" alt=""/></div>
<map name="run_8c_a7e26319b203616f2c85b5fd6f2ade85d_icgraph" id="run_8c_a7e26319b203616f2c85b5fd6f2ade85d_icgraph">
<area shape="rect" id="node3" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="211,5,253,35"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="303,5,356,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a00802290d71ce2a6de3f121de55ddd20"></a><!-- doxytag: member="run.c::find_next_outputtime" ref="a00802290d71ce2a6de3f121de55ddd20" args="(int ti_curr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int find_next_outputtime </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ti_curr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>this function returns the next output time that is equal or larger to ti_curr </p>

<p><p>&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], * where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 </p>
</p>

<p>Definition at line <a class="el" href="run_8c_source.html#l00244">244</a> of file <a class="el" href="run_8c_source.html">run.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00347">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="allvars_8h_source.html#l00501">global_data_all_processes::OutputListLength</a>, <a class="el" href="allvars_8h_source.html#l00352">global_data_all_processes::OutputListOn</a>, <a class="el" href="allvars_8h_source.html#l00500">global_data_all_processes::OutputListTimes</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, <a class="el" href="allvars_8h_source.html#l00377">global_data_all_processes::Timebase_interval</a>, <a class="el" href="allvars_8h_source.html#l00370">global_data_all_processes::TimeBegin</a>, <a class="el" href="allvars_8h_source.html#l00358">global_data_all_processes::TimeBetSnapshot</a>, <a class="el" href="allvars_8h_source.html#l00372">global_data_all_processes::TimeMax</a>, and <a class="el" href="allvars_8h_source.html#l00359">global_data_all_processes::TimeOfFirstSnapshot</a>.</p>

<p>Referenced by <a class="el" href="begrun_8c_source.html#l00028">begrun()</a>, and <a class="el" href="run_8c_source.html#l00151">find_next_sync_point_and_drift()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i, ti, ti_next, iter = 0;
  <span class="keywordtype">double</span> next, time;

  ti_next = -1;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4e9d69a3dd88c6aef6f4afd640243950">OutputListOn</a>)
    {
      <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af0ada535a17b75233e0e0de6ff8fa448">OutputListLength</a>; i++)
        {
          time = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a7f3307450336a806e545661ba6c79ba5">OutputListTimes</a>[i];

          <span class="keywordflow">if</span>(time &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> &amp;&amp; time &lt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3e22fbc2ce177c1e383e9acbbf44f8d5">TimeMax</a>)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
                ti = log(time / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>) / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;
              <span class="keywordflow">else</span>
                ti = (time - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>) / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;

              <span class="keywordflow">if</span>(ti &gt;= ti_curr)
                {
                  <span class="keywordflow">if</span>(ti_next == -1)
                    ti_next = ti;

                  <span class="keywordflow">if</span>(ti_next &gt; ti)
                    ti_next = ti;
                }
            }
        }
    }
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0c02c06bb5214dcf72dd4eb757df8ad3">TimeBetSnapshot</a> &lt;= 1.0)
            {
              printf(<span class="stringliteral">&quot;TimeBetSnapshot &gt; 1.0 required for your simulation.\n&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(13123);
            }
        }
      <span class="keywordflow">else</span>
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0c02c06bb5214dcf72dd4eb757df8ad3">TimeBetSnapshot</a> &lt;= 0.0)
            {
              printf(<span class="stringliteral">&quot;TimeBetSnapshot &gt; 0.0 required for your simulation.\n&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(13123);
            }
        }

      time = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a18e4063fbc1f92e8c59d6e59c7b20631">TimeOfFirstSnapshot</a>;

      iter = 0;

      <span class="keywordflow">while</span>(time &lt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>)
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
            time *= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0c02c06bb5214dcf72dd4eb757df8ad3">TimeBetSnapshot</a>;
          <span class="keywordflow">else</span>
            time += <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0c02c06bb5214dcf72dd4eb757df8ad3">TimeBetSnapshot</a>;

          iter++;

          <span class="keywordflow">if</span>(iter &gt; 1000000)
            {
              printf(<span class="stringliteral">&quot;Can&#39;t determine next output time.\n&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(110);
            }
        }

      <span class="keywordflow">while</span>(time &lt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3e22fbc2ce177c1e383e9acbbf44f8d5">TimeMax</a>)
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
            ti = log(time / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>) / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;
          <span class="keywordflow">else</span>
            ti = (time - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a>) / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;

          <span class="keywordflow">if</span>(ti &gt;= ti_curr)
            {
              ti_next = ti;
              <span class="keywordflow">break</span>;
            }

          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
            time *= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0c02c06bb5214dcf72dd4eb757df8ad3">TimeBetSnapshot</a>;
          <span class="keywordflow">else</span>
            time += <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0c02c06bb5214dcf72dd4eb757df8ad3">TimeBetSnapshot</a>;

          iter++;

          <span class="keywordflow">if</span>(iter &gt; 1000000)
            {
              printf(<span class="stringliteral">&quot;Can&#39;t determine next output time.\n&quot;</span>);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(111);
            }
        }
    }

  <span class="keywordflow">if</span>(ti_next == -1)
    {
      ti_next = 2 * TIMEBASE;   <span class="comment">/* this will prevent any further output */</span>

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;\nThere is no valid time for a further snapshot file.\n&quot;</span>);
    }
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
        next = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> * exp(ti_next * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>);
      <span class="keywordflow">else</span>
        next = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> + ti_next * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;\nSetting next time for snapshot file to Time_next= %g\n\n&quot;</span>, next);
    }

  <span class="keywordflow">return</span> ti_next;
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_a00802290d71ce2a6de3f121de55ddd20_cgraph.png" border="0" usemap="#run_8c_a00802290d71ce2a6de3f121de55ddd20_cgraph" alt=""/></div>
<map name="run_8c_a00802290d71ce2a6de3f121de55ddd20_cgraph" id="run_8c_a00802290d71ce2a6de3f121de55ddd20_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="213,5,280,35"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="328,5,485,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_a00802290d71ce2a6de3f121de55ddd20_icgraph.png" border="0" usemap="#run_8c_a00802290d71ce2a6de3f121de55ddd20_icgraph" alt=""/></div>
<map name="run_8c_a00802290d71ce2a6de3f121de55ddd20_icgraph" id="run_8c_a00802290d71ce2a6de3f121de55ddd20_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="480,5,547,35"/><area shape="rect" id="node7" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="213,59,432,88"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="596,32,649,61"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="492,59,535,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad52604af910b3e1677718d863ab09391"></a><!-- doxytag: member="run.c::find_next_sync_point_and_drift" ref="ad52604af910b3e1677718d863ab09391" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void find_next_sync_point_and_drift </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function finds the next synchronization point of the system (i.e. the earliest point of time any of the particles needs a force computation), and drifts the system to this point of time. If the system drifts over the desired time of a snapshot file, the function will drift to this moment, generate an output, and then resume the drift. </p>

<p>Definition at line <a class="el" href="run_8c_source.html#l00151">151</a> of file <a class="el" href="run_8c_source.html">run.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00347">global_data_all_processes::ComovingIntegrationOn</a>, <a class="el" href="potential_8c_source.html#l00022">compute_potential()</a>, <a class="el" href="allvars_8h_source.html#l00420">global_data_all_processes::CPU_Predict</a>, <a class="el" href="domain_8c_source.html#l00062">domain_Decomposition()</a>, <a class="el" href="run_8c_source.html#l00244">find_next_outputtime()</a>, <a class="el" href="allvars_8c_source.html#l00040">Flag_FullStep</a>, <a class="el" href="predict_8c_source.html#l00031">move_particles()</a>, <a class="el" href="allvars_8c_source.html#l00016">NTask</a>, <a class="el" href="allvars_8h_source.html#l00316">global_data_all_processes::NumForcesSinceLastDomainDecomp</a>, <a class="el" href="allvars_8c_source.html#l00024">NumForceUpdate</a>, <a class="el" href="allvars_8c_source.html#l00019">NumPart</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="allvars_8h_source.html#l00385">global_data_all_processes::PM_Ti_endstep</a>, <a class="el" href="io_8c_source.html#l00033">savepositions()</a>, <a class="el" href="system_8c_source.html#l00049">second()</a>, <a class="el" href="allvars_8h_source.html#l00357">global_data_all_processes::SnapshotFileCount</a>, <a class="el" href="allvars_8h_source.html#l00378">global_data_all_processes::Ti_Current</a>, <a class="el" href="allvars_8h_source.html#l00532">particle_data::Ti_endstep</a>, <a class="el" href="allvars_8h_source.html#l00379">global_data_all_processes::Ti_nextoutput</a>, <a class="el" href="allvars_8h_source.html#l00369">global_data_all_processes::Time</a>, <a class="el" href="allvars_8h_source.html#l00377">global_data_all_processes::Timebase_interval</a>, <a class="el" href="allvars_8h_source.html#l00370">global_data_all_processes::TimeBegin</a>, <a class="el" href="system_8c_source.html#l00070">timediff()</a>, <a class="el" href="allvars_8h_source.html#l00371">global_data_all_processes::TimeStep</a>, <a class="el" href="allvars_8h_source.html#l00272">global_data_all_processes::TotNumPart</a>, and <a class="el" href="allvars_8h_source.html#l00452">global_data_all_processes::TreeDomainUpdateFrequency</a>.</p>

<p>Referenced by <a class="el" href="run_8c_source.html#l00020">run()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> n, min, min_glob, flag, *temp;
  <span class="keywordtype">double</span> timeold;
  <span class="keywordtype">double</span> t0, t1;

  t0 = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();

  timeold = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a>;

  <span class="keywordflow">for</span>(n = 1, min = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[0].Ti_endstep; n &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; n++)
    <span class="keywordflow">if</span>(min &gt; <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[n].Ti_endstep)
      min = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[n].<a class="code" href="structparticle__data.html#a9bf2c52c7378a961222d9fe8faa9c208">Ti_endstep</a>;

  MPI_Allreduce(&amp;min, &amp;min_glob, 1, MPI_INT, MPI_MIN, MPI_COMM_WORLD);

  <span class="comment">/* We check whether this is a full step where all particles are synchronized */</span>
  flag = 1;
  <span class="keywordflow">for</span>(n = 0; n &lt; NumPart; n++)
    <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[n].Ti_endstep &gt; min_glob)
      flag = 0;

  MPI_Allreduce(&amp;flag, &amp;<a class="code" href="allvars_8c.html#a6343a9f3619e77c1796309b8deda7f50">Flag_FullStep</a>, 1, MPI_INT, MPI_MIN, MPI_COMM_WORLD);

<span class="preprocessor">#ifdef PMGRID</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(min_glob &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a723a0aa2f2ac0ac4cc58ebc049dda9b3">PM_Ti_endstep</a>)
    {
      min_glob = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a723a0aa2f2ac0ac4cc58ebc049dda9b3">PM_Ti_endstep</a>;
      <a class="code" href="allvars_8c.html#a6343a9f3619e77c1796309b8deda7f50">Flag_FullStep</a> = 1;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">/* Determine &#39;NumForceUpdate&#39;, i.e. the number of particles on this processor that are going to be active */</span>
  <span class="keywordflow">for</span>(n = 0, <a class="code" href="allvars_8c.html#a4c8b412a9883b4f6e0e8962ba54fd4ef">NumForceUpdate</a> = 0; n &lt; NumPart; n++)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[n].Ti_endstep == min_glob)
<span class="preprocessor">#ifdef SELECTIVE_NO_GRAVITY</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span>(!((1 &lt;&lt; <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[n].Type) &amp; (SELECTIVE_NO_GRAVITY)))
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a4c8b412a9883b4f6e0e8962ba54fd4ef">NumForceUpdate</a>++;
    }

  <span class="comment">/* note: NumForcesSinceLastDomainDecomp has type &quot;long long&quot; */</span>
  temp = malloc(<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
  MPI_Allgather(&amp;<a class="code" href="allvars_8c.html#a4c8b412a9883b4f6e0e8962ba54fd4ef">NumForceUpdate</a>, 1, MPI_INT, temp, 1, MPI_INT, MPI_COMM_WORLD);
  <span class="keywordflow">for</span>(n = 0; n &lt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>; n++)
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a64e0b5f35f25dd09297bc41acf0502f7">NumForcesSinceLastDomainDecomp</a> += temp[n];
  free(temp);



  t1 = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#afb9d30620ea0dc8b9e46000e3ce0b3e3">CPU_Predict</a> += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(t0, t1);

  <span class="keywordflow">while</span>(min_glob &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af1655016614a8c7ae59520abae300f67">Ti_nextoutput</a> &amp;&amp; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af1655016614a8c7ae59520abae300f67">Ti_nextoutput</a> &gt;= 0)
    {
      <a class="code" href="predict_8c.html#a02a8a27a7a75ce5cd6c2a27b4d641e31">move_particles</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af1655016614a8c7ae59520abae300f67">Ti_nextoutput</a>);

      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af1655016614a8c7ae59520abae300f67">Ti_nextoutput</a>;

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> * exp(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>);
      <span class="keywordflow">else</span>
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;

<span class="preprocessor">#ifdef OUTPUTPOTENTIAL</span>
<span class="preprocessor"></span>      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a64e0b5f35f25dd09297bc41acf0502f7">NumForcesSinceLastDomainDecomp</a> = 1 + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a31f122fafb06e13f611ff905f514bfa9">TreeDomainUpdateFrequency</a>;
      <a class="code" href="domain_8c.html#ae8e3aa408eaab9544cb7f93e69185492">domain_Decomposition</a>();
      <a class="code" href="potential_8c.html#a04474459731219f9601aaefedb37ab27">compute_potential</a>();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      <a class="code" href="io_8c.html#a523730833804b6d92aa7f4dd474805c5">savepositions</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aac0d3fcbac688a31e6bda55ef819c44b">SnapshotFileCount</a>++);   <span class="comment">/* write snapshot file */</span>

      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af1655016614a8c7ae59520abae300f67">Ti_nextoutput</a> = <a class="code" href="proto_8h.html#a532b4637166ab194c1b1d0dee9f003f2">find_next_outputtime</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af1655016614a8c7ae59520abae300f67">Ti_nextoutput</a> + 1);
    }

  <a class="code" href="predict_8c.html#a02a8a27a7a75ce5cd6c2a27b4d641e31">move_particles</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a>, min_glob);

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> = min_glob;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a4104c753df69fb4da0dd9bbb57e2a5f4">ComovingIntegrationOn</a>)
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> * exp(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>);
  <span class="keywordflow">else</span>
    <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> + <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0dd4962a455bb955f04ec271d7af7bb4">Timebase_interval</a>;

  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a05a40a90ec77ac379054f82acbec87dc">TimeStep</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> - timeold;
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_ad52604af910b3e1677718d863ab09391_cgraph.png" border="0" usemap="#run_8c_ad52604af910b3e1677718d863ab09391_cgraph" alt=""/></div>
<map name="run_8c_ad52604af910b3e1677718d863ab09391_cgraph" id="run_8c_ad52604af910b3e1677718d863ab09391_cgraph">
<area shape="rect" id="node3" href="potential_8c.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="288,477,429,507"/><area shape="rect" id="node48" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174" title="second" alt="" coords="601,949,668,979"/><area shape="rect" id="node52" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d" title="timediff" alt="" coords="600,1003,669,1032"/><area shape="rect" id="node55" href="domain_8c.html#ae8e3aa408eaab9544cb7f93e69185492" title="domain_Decomposition" alt="" coords="272,1053,445,1083"/><area shape="rect" id="node90" href="proto_8h.html#a532b4637166ab194c1b1d0dee9f003f2" title="find_next_outputtime" alt="" coords="280,240,437,269"/><area shape="rect" id="node93" href="predict_8c.html#a02a8a27a7a75ce5cd6c2a27b4d641e31" title="move_particles" alt="" coords="300,1159,417,1188"/><area shape="rect" id="node109" href="io_8c.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="304,896,413,925"/><area shape="rect" id="node5" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="1093,557,1160,587"/><area shape="rect" id="node9" href="forcetree_8c.html#a10f92098e86f82baec9f84a283f4c9e5" title="force_treebuild" alt="" coords="576,557,693,587"/><area shape="rect" id="node18" href="forcetree_8c.html#af29d257a1e4545ba4b9c3648444979b6" title="force_treeevaluate_potential" alt="" coords="532,344,737,373"/><area shape="rect" id="node23" href="forcetree_8c.html#abd9d86a6c08e77a4fa78fa76b96cdde7" title="force_treeevaluate_potential_shortrange" alt="" coords="493,611,776,640"/><area shape="rect" id="node26" href="gravtree_8c.html#ae9c157451dcc4cdbe02813141df2be42" title="grav_tree_compare_key" alt="" coords="547,397,723,427"/><area shape="rect" id="node28" href="proto_8h.html#a57f2f415791cd83ace42bff59b2feb97" title="pm_init_regionsize" alt="" coords="564,451,705,480"/><area shape="rect" id="node30" href="proto_8h.html#ae3950c19708f6a2886dd32897efa10c4" title="pm_setup_nonperiodic_kernel" alt="" coords="528,504,741,533"/><area shape="rect" id="node32" href="proto_8h.html#a480e7cb454d4e690653cc0db2bb9ebf9" title="pmpotential_nonperiodic" alt="" coords="545,133,724,163"/><area shape="rect" id="node34" href="pm__periodic_8c.html#a7938f2181f23d56ac46f3625d1a855a0" title="pmpotential_periodic" alt="" coords="557,187,712,216"/><area shape="rect" id="node46" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="912,837,957,867"/><area shape="rect" id="node50" href="gravtree_8c.html#aab39b7857a85e95ef6f926ac82d4ff91" title="set_softenings" alt="" coords="577,291,692,320"/><area shape="rect" id="node7" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="1208,557,1365,587"/><area shape="rect" id="node11" href="forcetree_8c.html#a947a734f3bbba14d4092c7480880d3c7" title="force_flag_localnodes" alt="" coords="856,504,1013,533"/><area shape="rect" id="node13" href="forcetree_8c.html#aadc9b1624ed78f3ccd0dbb9908fe0bb6" title="force_treebuild_single" alt="" coords="855,557,1015,587"/><area shape="rect" id="node16" href="forcetree_8c.html#af9a7e3a922557e089da5d7ee1dde89a0" title="force_update_pseudoparticles" alt="" coords="828,781,1041,811"/><area shape="rect" id="node21" href="forcetree_8c.html#aa0657e3de6bfb76715c14ddd72d25e58" title="ewald_pot_corr" alt="" coords="876,371,993,400"/><area shape="rect" id="node36" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2" title="force_treeallocate" alt="" coords="867,107,1003,136"/><area shape="rect" id="node39" href="forcetree_8c.html#a0a9667f530dad09ebed8c0c98e5d3888" title="force_treefree" alt="" coords="879,267,991,296"/><area shape="rect" id="node41" href="pm__periodic_8c.html#acb5c64377fad9e1a34bad88fb7c61a3e" title="pm_init_periodic_allocate" alt="" coords="844,160,1025,189"/><area shape="rect" id="node44" href="pm__periodic_8c.html#a259e6f8400ee889c64bc667334060742" title="pm_init_periodic_free" alt="" coords="856,213,1013,243"/><area shape="rect" id="node57" href="predict_8c.html#adda9e167a16a53d1aa40180406950446" title="do_box_wrapping" alt="" coords="569,1056,700,1085"/><area shape="rect" id="node59" href="domain_8c.html#a647e0c1a76b7f064ed5d201662f364bf" title="domain_decompose" alt="" coords="559,1211,711,1240"/><area shape="rect" id="node80" href="peano_8c.html#af3e45a4293584b3fe28e83af75c6ed71" title="peano_hilbert_order" alt="" coords="560,1264,709,1293"/><area shape="rect" id="node61" href="domain_8c.html#a77c115c3aa2069d0eb8521329be0483c" title="domain_countToGo" alt="" coords="863,1101,1007,1131"/><area shape="rect" id="node63" href="domain_8c.html#a25b4f5eb395f918bad4b4bc1fc3dc729" title="domain_determineTopTree" alt="" coords="839,1155,1031,1184"/><area shape="rect" id="node65" href="domain_8c.html#ab7d41435f73c1626208d63b2d5ba28ca" title="domain_exchangeParticles" alt="" coords="839,941,1031,971"/><area shape="rect" id="node68" href="domain_8c.html#a0e758ec7eef32fc7180092547f5a11b9" title="domain_findExchangeNumbers" alt="" coords="824,1208,1045,1237"/><area shape="rect" id="node70" href="domain_8c.html#add5620cbc133c73f0ce7da3a8fe9c01e" title="domain_findExtent" alt="" coords="864,1261,1005,1291"/><area shape="rect" id="node72" href="domain_8c.html#a412d5d8810751249cc8dcd9e219e4e57" title="domain_findSplit" alt="" coords="871,1339,999,1368"/><area shape="rect" id="node75" href="domain_8c.html#a89c54187117b91d4270a4f0c406ce2ba" title="domain_shiftSplit" alt="" coords="869,995,1000,1024"/><area shape="rect" id="node77" href="domain_8c.html#a25aada0d3751c2afd2a376151d1d917e" title="domain_sumCost" alt="" coords="868,1048,1001,1077"/><area shape="rect" id="node82" href="peano_8c.html#af3ffb253e14a79419d1effeee1b7261d" title="compare_key" alt="" coords="881,1392,988,1421"/><area shape="rect" id="node84" href="peano_8c.html#af744cef873e3093ba2924da8265d1711" title="reorder_gas" alt="" coords="885,1445,984,1475"/><area shape="rect" id="node86" href="peano_8c.html#afcb358154dd7fd5de8b4156f417fb0ba" title="reorder_particles" alt="" coords="869,1499,1000,1528"/><area shape="rect" id="node95" href="forcetree_8c.html#a04fb647ef783d5baeb9275d806c08365" title="force_update_len" alt="" coords="569,1371,700,1400"/><area shape="rect" id="node100" href="driftfac_8c.html#adadb384299eb936596574417d4b6b28c" title="get_drift_factor" alt="" coords="576,1477,693,1507"/><area shape="rect" id="node102" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059" title="get_gravkick_factor" alt="" coords="561,1317,708,1347"/><area shape="rect" id="node104" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c" title="get_hydrokick_factor" alt="" coords="557,1424,712,1453"/><area shape="rect" id="node97" href="forcetree_8c.html#a4592b750f8555f580691103acf1e5366" title="force_update_node_len_local" alt="" coords="832,1552,1037,1581"/><area shape="rect" id="node111" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab" title="distribute_file" alt="" coords="581,896,688,925"/><area shape="rect" id="node115" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345" title="fill_Tab_IO_Labels" alt="" coords="569,819,700,848"/><area shape="rect" id="node119" href="io_8c.html#a2b3f5bacd7313da0f3ffa55e41907481" title="write_file" alt="" coords="596,765,673,795"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_ad52604af910b3e1677718d863ab09391_icgraph.png" border="0" usemap="#run_8c_ad52604af910b3e1677718d863ab09391_icgraph" alt=""/></div>
<map name="run_8c_ad52604af910b3e1677718d863ab09391_icgraph" id="run_8c_ad52604af910b3e1677718d863ab09391_icgraph">
<area shape="rect" id="node3" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="272,5,315,35"/><area shape="rect" id="node5" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="364,5,417,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a05e0ffe612d44e6d7f3a9ae5b9df56a2"></a><!-- doxytag: member="run.c::run" ref="a05e0ffe612d44e6d7f3a9ae5b9df56a2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void run </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine contains the main simulation loop that iterates over single timesteps. The loop terminates when the cpu-time limit is reached, when a `stop' file is found in the output directory, or when the simulation ends because we arrived at TimeMax. </p>

<p><p>&lt; The simulated timespan is mapped onto the integer interval [0,TIMESPAN], * where TIMESPAN needs to be a power of 2. Note that (1&lt;&lt;28) corresponds to 2^29 </p>
</p>

<p>Definition at line <a class="el" href="run_8c_source.html#l00020">20</a> of file <a class="el" href="run_8c_source.html">run.c</a>.</p>

<p>References <a class="el" href="timestep_8c_source.html#l00024">advance_and_find_timesteps()</a>, <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="begrun_8c_source.html#l00262">close_outputfiles()</a>, <a class="el" href="accel_8c_source.html#l00024">compute_accelerations()</a>, <a class="el" href="potential_8c_source.html#l00022">compute_potential()</a>, <a class="el" href="allvars_8h_source.html#l00412">global_data_all_processes::CPU_Total</a>, <a class="el" href="allvars_8c_source.html#l00027">CPUThisRun</a>, <a class="el" href="allvars_8h_source.html#l00360">global_data_all_processes::CpuTimeBetRestartFile</a>, <a class="el" href="domain_8c_source.html#l00062">domain_Decomposition()</a>, <a class="el" href="run_8c_source.html#l00432">energy_statistics()</a>, <a class="el" href="run_8c_source.html#l00370">every_timestep_stuff()</a>, <a class="el" href="restart_8c_source.html#l00021">fd</a>, <a class="el" href="run_8c_source.html#l00151">find_next_sync_point_and_drift()</a>, <a class="el" href="allvars_8h_source.html#l00364">global_data_all_processes::NumCurrentTiStep</a>, <a class="el" href="allvars_8h_source.html#l00490">global_data_all_processes::OutputDir</a>, <a class="el" href="restart_8c_source.html#l00035">restart()</a>, <a class="el" href="allvars_8h_source.html#l00497">global_data_all_processes::ResubmitCommand</a>, <a class="el" href="allvars_8h_source.html#l00349">global_data_all_processes::ResubmitOn</a>, <a class="el" href="io_8c_source.html#l00033">savepositions()</a>, <a class="el" href="system_8c_source.html#l00049">second()</a>, <a class="el" href="allvars_8h_source.html#l00357">global_data_all_processes::SnapshotFileCount</a>, <a class="el" href="allvars_8c_source.html#l00015">ThisTask</a>, <a class="el" href="allvars_8h_source.html#l00378">global_data_all_processes::Ti_Current</a>, <a class="el" href="allvars_8h_source.html#l00369">global_data_all_processes::Time</a>, <a class="el" href="allvars_8h_source.html#l00041">TIMEBASE</a>, <a class="el" href="allvars_8h_source.html#l00362">global_data_all_processes::TimeBetStatistics</a>, <a class="el" href="system_8c_source.html#l00070">timediff()</a>, <a class="el" href="allvars_8h_source.html#l00361">global_data_all_processes::TimeLastRestartFile</a>, <a class="el" href="allvars_8h_source.html#l00363">global_data_all_processes::TimeLastStatistics</a>, <a class="el" href="allvars_8h_source.html#l00405">global_data_all_processes::TimeLimitCPU</a>, and <a class="el" href="allvars_8h_source.html#l00372">global_data_all_processes::TimeMax</a>.</p>

<p>Referenced by <a class="el" href="main_8c_source.html#l00022">main()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  FILE *<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>;
  <span class="keywordtype">int</span> stopflag = 0;
  <span class="keywordtype">char</span> stopfname[200], contfname[200];
  <span class="keywordtype">double</span> t0, t1;


  sprintf(stopfname, <span class="stringliteral">&quot;%sstop&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aebda5d1b80cfb767b9668d7858c36bcc">OutputDir</a>);
  sprintf(contfname, <span class="stringliteral">&quot;%scont&quot;</span>, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aebda5d1b80cfb767b9668d7858c36bcc">OutputDir</a>);
  unlink(contfname);

  <span class="keywordflow">do</span>                            <span class="comment">/* main loop */</span>
    {
      t0 = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();

      <a class="code" href="proto_8h.html#ad52604af910b3e1677718d863ab09391">find_next_sync_point_and_drift</a>(); <span class="comment">/* find next synchronization point and drift particles to this time.</span>
<span class="comment">                                         * If needed, this function will also write an output file</span>
<span class="comment">                                         * at the desired time.</span>
<span class="comment">                                         */</span>

      <a class="code" href="proto_8h.html#a7e26319b203616f2c85b5fd6f2ade85d">every_timestep_stuff</a>();   <span class="comment">/* write some info to log-files */</span>


      <a class="code" href="domain_8c.html#ae8e3aa408eaab9544cb7f93e69185492">domain_Decomposition</a>();   <span class="comment">/* do domain decomposition if needed */</span>


      <a class="code" href="accel_8c.html#a147f9422f4bca4666608da992486b417">compute_accelerations</a>(0); <span class="comment">/* compute accelerations for </span>
<span class="comment">                                 * the particles that are to be advanced  </span>
<span class="comment">                                 */</span>

      <span class="comment">/* check whether we want a full energy statistics */</span>
      <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab088f20e7889a88f2e0f652df4781e44">TimeLastStatistics</a>) &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a516be9ff5c4fd4171aa8e1a687e1e72d">TimeBetStatistics</a>)
        {
<span class="preprocessor">#ifdef COMPUTE_POTENTIAL_ENERGY</span>
<span class="preprocessor"></span>          <a class="code" href="potential_8c.html#a04474459731219f9601aaefedb37ab27">compute_potential</a>();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          <a class="code" href="proto_8h.html#ae903322da17c6875ab606b032b918099">energy_statistics</a>();  <span class="comment">/* compute and output energy statistics */</span>
          <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab088f20e7889a88f2e0f652df4781e44">TimeLastStatistics</a> += <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a516be9ff5c4fd4171aa8e1a687e1e72d">TimeBetStatistics</a>;
        }

      <a class="code" href="proto_8h.html#a05e5a546d63684b55d2457aa56efdd06">advance_and_find_timesteps</a>();     <span class="comment">/* &#39;kick&#39; active particles in</span>
<span class="comment">                                         * momentum space and compute new</span>
<span class="comment">                                         * timesteps for them</span>
<span class="comment">                                         */</span>
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a35de8a7666698b80478bfedf4362e844">NumCurrentTiStep</a>++;

      <span class="comment">/* Check whether we need to interrupt the run */</span>
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        {
          <span class="comment">/* Is the stop-file present? If yes, interrupt the run. */</span>
          <span class="keywordflow">if</span>((fd = fopen(stopfname, <span class="stringliteral">&quot;r&quot;</span>)))
            {
              fclose(fd);
              stopflag = 1;
              unlink(stopfname);
            }

          <span class="comment">/* are we running out of CPU-time ? If yes, interrupt run. */</span>
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a2550e86a899b36eaf7428b23f98a05ec">CPUThisRun</a> &gt; 0.85 * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#accf0e0ec1acab3f51f583470910049d2">TimeLimitCPU</a>)
            {
              printf(<span class="stringliteral">&quot;reaching time-limit. stopping.\n&quot;</span>);
              stopflag = 2;
            }
        }

      MPI_Bcast(&amp;stopflag, 1, MPI_INT, 0, MPI_COMM_WORLD);

      <span class="keywordflow">if</span>(stopflag)
        {
          <a class="code" href="proto_8h.html#af3e3dd8294f983f9ed9f75c81d149ec9">restart</a>(0);           <span class="comment">/* write restart file */</span>
          MPI_Barrier(MPI_COMM_WORLD);

          <span class="keywordflow">if</span>(stopflag == 2 &amp;&amp; <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
            {
              <span class="keywordflow">if</span>((fd = fopen(contfname, <span class="stringliteral">&quot;w&quot;</span>)))
                fclose(fd);
            }

          <span class="keywordflow">if</span>(stopflag == 2 &amp;&amp; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a6578ce0ee08f770891c662c0ab4ad10c">ResubmitOn</a> &amp;&amp; <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
            {
              <a class="code" href="begrun_8c.html#aa1abb9ee0e0a43ec19cdaa55c8ecd43c">close_outputfiles</a>();
              system(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a59f86964a3a1b03933a787cfc280951a">ResubmitCommand</a>);
            }
          <span class="keywordflow">return</span>;
        }

      <span class="comment">/* is it time to write a regular restart-file? (for security) */</span>
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        {
          <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a2550e86a899b36eaf7428b23f98a05ec">CPUThisRun</a> - <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1042ebf3c648c2b23dca6fc65ff22785">TimeLastRestartFile</a>) &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#af087b459cc41cb6b81bdbdd0e339cb6f">CpuTimeBetRestartFile</a>)
            {
              <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1042ebf3c648c2b23dca6fc65ff22785">TimeLastRestartFile</a> = <a class="code" href="allvars_8c.html#a2550e86a899b36eaf7428b23f98a05ec">CPUThisRun</a>;
              stopflag = 3;
            }
          <span class="keywordflow">else</span>
            stopflag = 0;
        }

      MPI_Bcast(&amp;stopflag, 1, MPI_INT, 0, MPI_COMM_WORLD);

      <span class="keywordflow">if</span>(stopflag == 3)
        {
          <a class="code" href="proto_8h.html#af3e3dd8294f983f9ed9f75c81d149ec9">restart</a>(0);           <span class="comment">/* write an occasional restart file */</span>
          stopflag = 0;
        }

      t1 = <a class="code" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174">second</a>();

      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3d87cd9a94ce540341d4fb713b253c9e">CPU_Total</a> += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(t0, t1);
      <a class="code" href="allvars_8c.html#a2550e86a899b36eaf7428b23f98a05ec">CPUThisRun</a> += <a class="code" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d">timediff</a>(t0, t1);
    }
  <span class="keywordflow">while</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0720db6b598f7295ec843708a1d3c6f">Ti_Current</a> &lt; <a class="code" href="allvars_8h.html#ad44dabdb7a0bef8536e2d34a01177d48">TIMEBASE</a> &amp;&amp; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> &lt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a3e22fbc2ce177c1e383e9acbbf44f8d5">TimeMax</a>);

  <a class="code" href="proto_8h.html#af3e3dd8294f983f9ed9f75c81d149ec9">restart</a>(0);

  <a class="code" href="io_8c.html#a523730833804b6d92aa7f4dd474805c5">savepositions</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aac0d3fcbac688a31e6bda55ef819c44b">SnapshotFileCount</a>++);       <span class="comment">/* write a last snapshot</span>
<span class="comment">                                                 * file at final time (will</span>
<span class="comment">                                                 * be overwritten if</span>
<span class="comment">                                                 * All.TimeMax is increased</span>
<span class="comment">                                                 * and the run is continued)</span>
<span class="comment">                                                 */</span>
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_cgraph.png" border="0" usemap="#run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_cgraph" alt=""/></div>
<map name="run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_cgraph" id="run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_cgraph">
<area shape="rect" id="node3" href="proto_8h.html#a05e5a546d63684b55d2457aa56efdd06" title="advance_and_find_timesteps" alt="" coords="392,450,600,479"/><area shape="rect" id="node20" href="proto_8h.html#ad24c35a2016ce428248988795c1d3174" title="second" alt="" coords="759,239,825,268"/><area shape="rect" id="node22" href="proto_8h.html#a890645bdc4536bd797ca53028072e30d" title="timediff" alt="" coords="757,551,827,580"/><area shape="rect" id="node25" href="begrun_8c.html#aa1abb9ee0e0a43ec19cdaa55c8ecd43c" title="close_outputfiles" alt="" coords="141,502,269,531"/><area shape="rect" id="node27" href="accel_8c.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="120,294,291,323"/><area shape="rect" id="node69" href="potential_8c.html#a04474459731219f9601aaefedb37ab27" title="compute_potential" alt="" coords="425,815,567,844"/><area shape="rect" id="node93" href="domain_8c.html#ae8e3aa408eaab9544cb7f93e69185492" title="domain_Decomposition" alt="" coords="409,1328,583,1358"/><area shape="rect" id="node104" href="proto_8h.html#ae903322da17c6875ab606b032b918099" title="energy_statistics" alt="" coords="140,688,271,718"/><area shape="rect" id="node111" href="proto_8h.html#a7e26319b203616f2c85b5fd6f2ade85d" title="every_timestep_stuff" alt="" coords="128,610,283,639"/><area shape="rect" id="node115" href="proto_8h.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="96,754,315,783"/><area shape="rect" id="node129" href="io_8c.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="441,1548,551,1578"/><area shape="rect" id="node144" href="proto_8h.html#af3e3dd8294f983f9ed9f75c81d149ec9" title="restart" alt="" coords="760,1487,824,1516"/><area shape="rect" id="node5" href="proto_8h.html#a78ed439b8a1cb93647a2b9de998d9269" title="find_dt_displacement_constraint" alt="" coords="677,394,907,423"/><area shape="rect" id="node7" href="proto_8h.html#a96ae9abed439401fd6dd28a1e2c2f94e" title="pow" alt="" coords="1073,526,1119,555"/><area shape="rect" id="node9" href="driftfac_8c.html#a29057b821b850ab54b318d7339633059" title="get_gravkick_factor" alt="" coords="719,604,865,634"/><area shape="rect" id="node11" href="driftfac_8c.html#ace65dca1556185b12c7f22427724c90c" title="get_hydrokick_factor" alt="" coords="715,708,869,738"/><area shape="rect" id="node13" href="proto_8h.html#a0d508d57eb6f608ff6eec8ac11bb9c05" title="get_random_number" alt="" coords="713,79,871,108"/><area shape="rect" id="node15" href="proto_8h.html#a1d72b071e6cb4691ecc0da4de4cb8af8" title="get_timestep" alt="" coords="1043,419,1149,448"/><area shape="rect" id="node17" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="1285,1223,1352,1252"/><area shape="rect" id="node29" href="density_8c.html#ad86cdeb9e3bfbe9af379ac9f7daf194c" title="density" alt="" coords="463,31,529,60"/><area shape="rect" id="node35" href="forcetree_8c.html#a4764c1fb83a956c1712345538630854c" title="force_update_hmax" alt="" coords="421,188,571,218"/><area shape="rect" id="node37" href="gravtree__forcetest_8c.html#a51b074bdf1ec1efc0f7a323415a47e79" title="gravity_forcetest" alt="" coords="432,84,560,114"/><area shape="rect" id="node47" href="gravtree_8c.html#ac559dc2aeb21d5a379a3751bea7736af" title="gravity_tree" alt="" coords="447,242,545,271"/><area shape="rect" id="node55" href="hydra_8c.html#a6789381bce7d1c316df8ecf04b47a607" title="hydro_force" alt="" coords="448,396,544,426"/><area shape="rect" id="node60" href="longrange_8c.html#a5989a3f57c7d6dfdef205dc6b72a1d25" title="long_range_force" alt="" coords="431,1148,561,1178"/><area shape="rect" id="node41" href="gravtree_8c.html#ae9c157451dcc4cdbe02813141df2be42" title="grav_tree_compare_key" alt="" coords="704,132,880,162"/><area shape="rect" id="node44" href="gravtree_8c.html#aab39b7857a85e95ef6f926ac82d4ff91" title="set_softenings" alt="" coords="735,186,849,215"/><area shape="rect" id="node49" href="forcetree_8c.html#a10f92098e86f82baec9f84a283f4c9e5" title="force_treebuild" alt="" coords="733,447,851,476"/><area shape="rect" id="node63" href="proto_8h.html#a57f2f415791cd83ace42bff59b2feb97" title="pm_init_regionsize" alt="" coords="721,1122,863,1151"/><area shape="rect" id="node65" href="proto_8h.html#ae3950c19708f6a2886dd32897efa10c4" title="pm_setup_nonperiodic_kernel" alt="" coords="685,1175,899,1204"/><area shape="rect" id="node73" href="forcetree_8c.html#af29d257a1e4545ba4b9c3648444979b6" title="force_treeevaluate_potential" alt="" coords="993,991,1199,1020"/><area shape="rect" id="node76" href="forcetree_8c.html#abd9d86a6c08e77a4fa78fa76b96cdde7" title="force_treeevaluate_potential_shortrange" alt="" coords="955,1094,1237,1123"/><area shape="rect" id="node82" href="proto_8h.html#a480e7cb454d4e690653cc0db2bb9ebf9" title="pmpotential_nonperiodic" alt="" coords="703,863,881,892"/><area shape="rect" id="node84" href="pm__periodic_8c.html#a7938f2181f23d56ac46f3625d1a855a0" title="pmpotential_periodic" alt="" coords="715,1068,869,1098"/><area shape="rect" id="node86" href="forcetree_8c.html#ab98788ba31869c7bc55ce71b807d2ff2" title="force_treeallocate" alt="" coords="1028,1276,1164,1306"/><area shape="rect" id="node95" href="predict_8c.html#adda9e167a16a53d1aa40180406950446" title="do_box_wrapping" alt="" coords="727,1434,857,1463"/><area shape="rect" id="node97" href="domain_8c.html#a647e0c1a76b7f064ed5d201662f364bf" title="domain_decompose" alt="" coords="1020,1330,1172,1359"/><area shape="rect" id="node100" href="peano_8c.html#af3e45a4293584b3fe28e83af75c6ed71" title="peano_hilbert_order" alt="" coords="717,1380,867,1410"/><area shape="rect" id="node106" href="global_8c.html#ada58109949c2431ca9b0cdaa01cfb5b1" title="compute_global_quantities_of_system" alt="" coords="363,762,629,791"/><area shape="rect" id="node113" href="proto_8h.html#a9cb45ef22cae101906f021fb7a23afbe" title="set_random_numbers" alt="" coords="415,604,577,634"/><area shape="rect" id="node119" href="proto_8h.html#a532b4637166ab194c1b1d0dee9f003f2" title="find_next_outputtime" alt="" coords="1017,1223,1175,1252"/><area shape="rect" id="node122" href="predict_8c.html#a02a8a27a7a75ce5cd6c2a27b4d641e31" title="move_particles" alt="" coords="437,708,555,738"/><area shape="rect" id="node131" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab" title="distribute_file" alt="" coords="739,1564,845,1594"/><area shape="rect" id="node135" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345" title="fill_Tab_IO_Labels" alt="" coords="727,1618,857,1647"/><area shape="rect" id="node139" href="io_8c.html#a2b3f5bacd7313da0f3ffa55e41907481" title="write_file" alt="" coords="1057,1658,1135,1687"/><area shape="rect" id="node146" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7" title="allocate_memory" alt="" coords="1029,1487,1163,1516"/><area shape="rect" id="node149" href="restart_8c.html#aaecf930e789ca4889b8e40770306fe21" title="byten" alt="" coords="1067,1540,1125,1570"/><area shape="rect" id="node153" href="restart_8c.html#a2f4631df8dbc2cc10c5d7ce28c975ad5" title="in" alt="" coords="1077,1594,1115,1623"/><area shape="rect" id="node155" href="ngb_8c.html#a6f7a3b85f10701b9067f012cc9a30f55" title="ngb_treeallocate" alt="" coords="1032,1383,1160,1412"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_icgraph.png" border="0" usemap="#run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_icgraph" alt=""/></div>
<map name="run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_icgraph" id="run_8c_a05e0ffe612d44e6d7f3a9ae5b9df56a2_icgraph">
<area shape="rect" id="node3" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="97,5,151,35"/></map>
</div>
</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 3 2010 18:45:45 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
