<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: read_ic.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>read_ic.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>Read initial conditions in one of Gadget's file formats.  
<a href="#_details">More...</a></p>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for read_ic.c:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c__incl.png" border="0" usemap="#read__ic_8c" alt=""/></div>
<map name="read__ic_8c" id="read__ic_8c">
<area shape="rect" id="node13" href="allvars_8h.html" title="declares global variables." alt="" coords="352,160,427,189"/><area shape="rect" id="node20" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="437,83,504,112"/><area shape="rect" id="node18" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="412,237,473,267"/></map>
</div>

<p><a href="read__ic_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>&nbsp;&nbsp;&nbsp;{my_fread(&amp;blksize1,sizeof(int),1,<a class="el" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);}</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#ad6e22cd67afa690d73b53919372622d6">SKIP2</a>&nbsp;&nbsp;&nbsp;{my_fread(&amp;blksize2,sizeof(int),1,<a class="el" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);}</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1">read_ic</a> (char *fname)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#a3757efb7e470353080a128388ccebec9">empty_read_buffer</a> (enum <a class="el" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8">iofields</a> blocknr, int offset, int pc, int type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1">read_file</a> (char *fname, int readTask, int lastTask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#ac028b474d53a40e79377b7ae5dde636a">find_files</a> (char *fname)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a> (int nfiles, int firstfile, int firsttask, int lasttask, int *filenr, int *master, int *<a class="el" href="forcetree_8c.html#a72e27dee31b1c4c6a504fbed29542d97">last</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="read__ic_8c.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a> (char *fname)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Read initial conditions in one of Gadget's file formats. </p>

<p>Definition in file <a class="el" href="read__ic_8c_source.html">read_ic.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a688a4adbb87520a2b68681bd6bfb199e"></a><!-- doxytag: member="read_ic.c::SKIP" ref="a688a4adbb87520a2b68681bd6bfb199e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SKIP&nbsp;&nbsp;&nbsp;{my_fread(&amp;blksize1,sizeof(int),1,<a class="el" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad6e22cd67afa690d73b53919372622d6"></a><!-- doxytag: member="read_ic.c::SKIP2" ref="ad6e22cd67afa690d73b53919372622d6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SKIP2&nbsp;&nbsp;&nbsp;{my_fread(&amp;blksize2,sizeof(int),1,<a class="el" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>);}</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="abf75a70e8719e8ed6de565a6ae90f1ab"></a><!-- doxytag: member="read_ic.c::distribute_file" ref="abf75a70e8719e8ed6de565a6ae90f1ab" args="(int nfiles, int firstfile, int firsttask, int lasttask, int *filenr, int *master, int *last)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void distribute_file </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nfiles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>firstfile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>firsttask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lasttask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>filenr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>master</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>last</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function assigns a certain number of files to processors, such that each processor is exactly assigned to one file, and the number of cpus per file is as homogenous as possible. The number of files may at most be equal to the number of processors. </p>

<p>Definition at line <a class="el" href="read__ic_8c_source.html#l00724">724</a> of file <a class="el" href="read__ic_8c_source.html">read_ic.c</a>.</p>

<p>References <a class="el" href="read__ic_8c_source.html#l00724">distribute_file()</a>, and <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00724">distribute_file()</a>, <a class="el" href="read__ic_8c_source.html#l00031">read_ic()</a>, and <a class="el" href="io_8c_source.html#l00033">savepositions()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> ntask, filesleft, filesright, tasksleft, tasksright;

  <span class="keywordflow">if</span>(nfiles &gt; 1)
    {
      ntask = lasttask - firsttask + 1;

      filesleft = (((double) (ntask / 2)) / ntask) * nfiles;
      <span class="keywordflow">if</span>(filesleft &lt;= 0)
        filesleft = 1;
      <span class="keywordflow">if</span>(filesleft &gt;= nfiles)
        filesleft = nfiles - 1;

      filesright = nfiles - filesleft;

      tasksleft = ntask / 2;
      tasksright = ntask - tasksleft;

      <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(filesleft, firstfile, firsttask, firsttask + tasksleft - 1, filenr, master, <a class="code" href="forcetree_8c.html#a72e27dee31b1c4c6a504fbed29542d97">last</a>);
      <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(filesright, firstfile + filesleft, firsttask + tasksleft, lasttask, filenr, master,
                      <a class="code" href="forcetree_8c.html#a72e27dee31b1c4c6a504fbed29542d97">last</a>);
    }
  <span class="keywordflow">else</span>
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> &gt;= firsttask &amp;&amp; <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> &lt;= lasttask)
        {
          *filenr = firstfile;
          *master = firsttask;
          *<a class="code" href="forcetree_8c.html#a72e27dee31b1c4c6a504fbed29542d97">last</a> = lasttask;
        }
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_cgraph.png" border="0" usemap="#read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_cgraph" alt=""/></div>
<map name="read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_cgraph" id="read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_cgraph">
<area shape="rect" id="node3" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab" title="distribute_file" alt="" coords="160,29,267,59"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_icgraph.png" border="0" usemap="#read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_icgraph" alt=""/></div>
<map name="read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_icgraph" id="read__ic_8c_abf75a70e8719e8ed6de565a6ae90f1ab_icgraph">
<area shape="rect" id="node4" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="181,5,248,35"/><area shape="rect" id="node12" href="proto_8h.html#a523730833804b6d92aa7f4dd474805c5" title="savepositions" alt="" coords="160,59,269,88"/><area shape="rect" id="node6" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="407,5,447,35"/><area shape="rect" id="node8" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="584,5,651,35"/><area shape="rect" id="node10" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="700,32,753,61"/><area shape="rect" id="node14" href="run_8c.html#ad52604af910b3e1677718d863ab09391" title="find_next_sync_point_and_drift" alt="" coords="317,59,536,88"/><area shape="rect" id="node16" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="596,59,639,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3757efb7e470353080a128388ccebec9"></a><!-- doxytag: member="read_ic.c::empty_read_buffer" ref="a3757efb7e470353080a128388ccebec9" args="(enum iofields blocknr, int offset, int pc, int type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void empty_read_buffer </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8">iofields</a>&nbsp;</td>
          <td class="paramname"> <em>blocknr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function reads out the buffer that was filled with particle data, and stores it at the appropriate place in the particle structures. </p>

<p>Definition at line <a class="el" href="read__ic_8c_source.html#l00168">168</a> of file <a class="el" href="read__ic_8c_source.html">read_ic.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00103">CommBuffer</a>, <a class="el" href="allvars_8h_source.html#l00517">particle_data::ID</a>, <a class="el" href="allvars_8h_source.html#l00660">IO_ACCEL</a>, <a class="el" href="allvars_8h_source.html#l00661">IO_DTENTR</a>, <a class="el" href="allvars_8h_source.html#l00658">IO_HSML</a>, <a class="el" href="allvars_8h_source.html#l00654">IO_ID</a>, <a class="el" href="allvars_8h_source.html#l00655">IO_MASS</a>, <a class="el" href="allvars_8h_source.html#l00652">IO_POS</a>, <a class="el" href="allvars_8h_source.html#l00659">IO_POT</a>, <a class="el" href="allvars_8h_source.html#l00657">IO_RHO</a>, <a class="el" href="allvars_8h_source.html#l00662">IO_TSTP</a>, <a class="el" href="allvars_8h_source.html#l00656">IO_U</a>, <a class="el" href="allvars_8h_source.html#l00653">IO_VEL</a>, <a class="el" href="allvars_8h_source.html#l00505">particle_data::Mass</a>, <a class="el" href="allvars_8c_source.html#l00121">P</a>, <a class="el" href="allvars_8h_source.html#l00504">particle_data::Pos</a>, <a class="el" href="allvars_8c_source.html#l00129">SphP</a>, <a class="el" href="allvars_8h_source.html#l00522">particle_data::Type</a>, and <a class="el" href="allvars_8h_source.html#l00506">particle_data::Vel</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> n, k;
  <span class="keywordtype">float</span> *fp;

<span class="preprocessor">#ifdef LONGIDS</span>
<span class="preprocessor"></span>  <span class="keywordtype">long</span> <span class="keywordtype">long</span> *ip;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <span class="keywordtype">int</span> *ip;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  fp = <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;
  ip = <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>;

  <span class="keywordflow">switch</span> (blocknr)
    {
    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a0207eb67d96fe97fb8158c42af624f8f">IO_POS</a>:                <span class="comment">/* positions */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
          <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].Pos[k] = *fp++;

      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].Type = type;      <span class="comment">/* initialize type here as well */</span>
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8aa4c3992546632e0db8015ebe534c0282">IO_VEL</a>:                <span class="comment">/* velocities */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)
          <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].Vel[k] = *fp++;
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a34f71f128fc699de3792687fd79edf03">IO_ID</a>:         <span class="comment">/* particle ID */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].ID = *ip++;
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a72e1cc8b602ab38f0f3491464ed82063">IO_MASS</a>:               <span class="comment">/* particle mass */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[offset + n].Mass = *fp++;
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a942cbf4dca00cd5260edc905f5976682">IO_U</a>:                  <span class="comment">/* temperature */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[offset + n].Entropy = *fp++;
      <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a8dd43018a3f2d1caed951b249a38b106">IO_RHO</a>:                <span class="comment">/* density */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[offset + n].Density = *fp++;
      <span class="keywordflow">break</span>;


    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a429c6a7a56e3b53597bd1eb72b87f941">IO_HSML</a>:               <span class="comment">/* SPH smoothing length */</span>
      <span class="keywordflow">for</span>(n = 0; n &lt; pc; n++)
        <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[offset + n].Hsml = *fp++;
      <span class="keywordflow">break</span>;




      <span class="comment">/* the other input fields (if present) are not needed to define the </span>
<span class="comment">         initial conditions of the code */</span>

    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a27c32f555479567b88ad11dcce803fe9">IO_POT</a>:
    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a6f80f32dfa1c0cde8a71b773f42bb97a">IO_ACCEL</a>:
    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a74d42dcd51f76c1919f44e9f89581457">IO_DTENTR</a>:
    <span class="keywordflow">case</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8aac2070d9e6c597be29ae9a4c9acc36da">IO_TSTP</a>:
      <span class="keywordflow">break</span>;
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_a3757efb7e470353080a128388ccebec9_icgraph.png" border="0" usemap="#read__ic_8c_a3757efb7e470353080a128388ccebec9_icgraph" alt=""/></div>
<map name="read__ic_8c_a3757efb7e470353080a128388ccebec9_icgraph" id="read__ic_8c_a3757efb7e470353080a128388ccebec9_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="199,5,273,35"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="324,5,391,35"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="441,5,481,35"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="531,5,597,35"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="647,5,700,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac028b474d53a40e79377b7ae5dde636a"></a><!-- doxytag: member="read_ic.c::find_files" ref="ac028b474d53a40e79377b7ae5dde636a" args="(char *fname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int find_files </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function determines onto how many files a given snapshot is distributed. </p>

<p>Definition at line <a class="el" href="read__ic_8c_source.html#l00615">615</a> of file <a class="el" href="read__ic_8c_source.html">read_ic.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00113">All</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="restart_8c_source.html#l00021">fd</a>, <a class="el" href="allvars_8c_source.html#l00163">header</a>, <a class="el" href="allvars_8h_source.html#l00271">global_data_all_processes::ICFormat</a>, <a class="el" href="allvars_8h_source.html#l00633">io_header::num_files</a>, <a class="el" href="read__ic_8c_source.html#l00764">read_header_attributes_in_hdf5()</a>, and <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00031">read_ic()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  FILE *<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a>;
  <span class="keywordtype">char</span> buf[200], buf1[200];
  <span class="keywordtype">int</span> dummy;

  sprintf(buf, <span class="stringliteral">&quot;%s.%d&quot;</span>, fname, 0);
  sprintf(buf1, <span class="stringliteral">&quot;%s&quot;</span>, fname);

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
    {
      sprintf(buf, <span class="stringliteral">&quot;%s.%d.hdf5&quot;</span>, fname, 0);
      sprintf(buf1, <span class="stringliteral">&quot;%s.hdf5&quot;</span>, fname);
    }

<span class="preprocessor">#ifndef  HAVE_HDF5</span>
<span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
        printf(<span class="stringliteral">&quot;Code wasn&#39;t compiled with HDF5 support enabled!\n&quot;</span>);
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> = 0;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      <span class="keywordflow">if</span>((fd = fopen(buf, <span class="stringliteral">&quot;r&quot;</span>)))
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
                {
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                }

              fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
              fread(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), 1, fd);
              fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
            }
          fclose(fd);

<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
            <a class="code" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a>(buf);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        }
    }

  MPI_Bcast(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, 0, MPI_COMM_WORLD);

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> &gt; 0)
    <span class="keywordflow">return</span> <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a>;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      <span class="keywordflow">if</span>((fd = fopen(buf1, <span class="stringliteral">&quot;r&quot;</span>)))
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
                {
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                  fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
                }

              fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
              fread(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), 1, fd);
              fread(&amp;dummy, <span class="keyword">sizeof</span>(dummy), 1, fd);
            }
          fclose(fd);

<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
            <a class="code" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a>(buf1);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> = 1;
        }
    }

  MPI_Bcast(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, 0, MPI_COMM_WORLD);

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> &gt; 0)
    <span class="keywordflow">return</span> <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a>;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      printf(<span class="stringliteral">&quot;\nCan&#39;t find initial conditions file.&quot;</span>);
      printf(<span class="stringliteral">&quot;neither as &#39;%s&#39;\nnor as &#39;%s&#39;\n&quot;</span>, buf, buf1);
      fflush(stdout);
    }

  <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(0);
  <span class="keywordflow">return</span> 0;
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_cgraph.png" border="0" usemap="#read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_cgraph" alt=""/></div>
<map name="read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_cgraph" id="read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="211,5,277,35"/><area shape="rect" id="node7" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9" title="read_header_attributes_in_hdf5" alt="" coords="132,59,356,88"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="405,5,563,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_icgraph.png" border="0" usemap="#read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_icgraph" alt=""/></div>
<map name="read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_icgraph" id="read__ic_8c_ac028b474d53a40e79377b7ae5dde636a_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="132,5,199,35"/><area shape="rect" id="node5" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="249,5,289,35"/><area shape="rect" id="node7" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="339,5,405,35"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="455,5,508,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="affd0f4e6b7bcdabf7d6f8191145f78d1"></a><!-- doxytag: member="read_ic.c::read_file" ref="affd0f4e6b7bcdabf7d6f8191145f78d1" args="(char *fname, int readTask, int lastTask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_file </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>readTask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lastTask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function reads a snapshot file and distributes the data it contains to tasks 'readTask' to 'lastTask'. </p>

<p><p>&lt; total number of defined 0 0 for snapshot files. Must be equal to the number of entries in "enum iofields" </p>
</p>

<p>Definition at line <a class="el" href="read__ic_8c_source.html#l00244">244</a> of file <a class="el" href="read__ic_8c_source.html">read_ic.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00113">All</a>, <a class="el" href="allocate_8c_source.html#l00103">allocate_memory()</a>, <a class="el" href="io_8c_source.html#l00532">blockpresent()</a>, <a class="el" href="allvars_8h_source.html#l00279">global_data_all_processes::BufferSize</a>, <a class="el" href="allvars_8c_source.html#l00103">CommBuffer</a>, <a class="el" href="read__ic_8c_source.html#l00168">empty_read_buffer()</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="restart_8c_source.html#l00021">fd</a>, <a class="el" href="io_8c_source.html#l00366">get_bytes_per_blockelement()</a>, <a class="el" href="io_8c_source.html#l00613">get_dataset_name()</a>, <a class="el" href="io_8c_source.html#l00405">get_datatype_in_block()</a>, <a class="el" href="io_8c_source.html#l00465">get_particles_in_block()</a>, <a class="el" href="io_8c_source.html#l00432">get_values_per_blockelement()</a>, <a class="el" href="allvars_8c_source.html#l00163">header</a>, <a class="el" href="allvars_8h_source.html#l00271">global_data_all_processes::ICFormat</a>, <a class="el" href="allvars_8h_source.html#l00656">IO_U</a>, <a class="el" href="allvars_8h_source.html#l00624">io_header::mass</a>, <a class="el" href="allvars_8h_source.html#l00472">global_data_all_processes::MassTable</a>, <a class="el" href="allvars_8h_source.html#l00266">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8h_source.html#l00267">global_data_all_processes::MaxPartSph</a>, <a class="el" href="io_8c_source.html#l01139">my_fread()</a>, <a class="el" href="allvars_8c_source.html#l00016">N_gas</a>, <a class="el" href="allvars_8h_source.html#l00623">io_header::npart</a>, <a class="el" href="allvars_8h_source.html#l00630">io_header::npartTotal</a>, <a class="el" href="allvars_8h_source.html#l00640">io_header::npartTotalHighWord</a>, <a class="el" href="allvars_8c_source.html#l00012">NTask</a>, <a class="el" href="allvars_8h_source.html#l00633">io_header::num_files</a>, <a class="el" href="allvars_8c_source.html#l00015">NumPart</a>, <a class="el" href="allvars_8c_source.html#l00121">P</a>, <a class="el" href="allvars_8h_source.html#l00285">global_data_all_processes::PartAllocFactor</a>, <a class="el" href="read__ic_8c_source.html#l00764">read_header_attributes_in_hdf5()</a>, <a class="el" href="allvars_8c_source.html#l00026">RestartFlag</a>, <a class="el" href="allvars_8c_source.html#l00168">Tab_IO_Labels</a>, <a class="el" href="tags_8h_source.html#l00006">TAG_HEADER</a>, <a class="el" href="tags_8h_source.html#l00007">TAG_PDATA</a>, <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h_source.html#l00626">io_header::time</a>, <a class="el" href="allvars_8h_source.html#l00360">global_data_all_processes::Time</a>, <a class="el" href="allvars_8h_source.html#l00361">global_data_all_processes::TimeBegin</a>, <a class="el" href="allvars_8h_source.html#l00264">global_data_all_processes::TotN_gas</a>, and <a class="el" href="allvars_8h_source.html#l00263">global_data_all_processes::TotNumPart</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00031">read_ic()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> blockmaxlen;
  <span class="keywordtype">int</span> i, n_in_file, n_for_this_task, ntask, pc, offset = 0, task;
  <span class="keywordtype">int</span> blksize1, blksize2;
  MPI_Status status;
  FILE *<a class="code" href="restart_8c.html#a600b792d6d2ff2e71096dfa60d97a3b0">fd</a> = 0;
  <span class="keywordtype">int</span> nall;
  <span class="keywordtype">int</span> type;
  <span class="keywordtype">char</span> label[4];
  <span class="keywordtype">int</span> nstart, bytes_per_blockelement, npart, nextblock, typelist[6];
  <span class="keyword">enum</span> <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8">iofields</a> blocknr;

<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>  <span class="keywordtype">char</span> buf[500];
  <span class="keywordtype">int</span> rank, pcsum;
  hid_t hdf5_file, hdf5_grp[6], hdf5_dataspace_in_file;
  hid_t hdf5_datatype, hdf5_dataspace_in_memory, hdf5_dataset;
  hsize_t dims[2], count[2], start[2];
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define SKIP  {my_fread(&amp;blksize1,sizeof(int),1,fd);}</span>
<span class="preprocessor"></span><span class="preprocessor">#define SKIP2  {my_fread(&amp;blksize2,sizeof(int),1,fd);}</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
        {
          <span class="keywordflow">if</span>(!(fd = fopen(fname, <span class="stringliteral">&quot;r&quot;</span>)))
            {
              printf(<span class="stringliteral">&quot;can&#39;t open file `%s&#39; for reading initial conditions.\n&quot;</span>, fname);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(123);
            }

          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
            {
              SKIP;
              <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;label, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 4, fd);
              <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;nextblock, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, fd);
              printf(<span class="stringliteral">&quot;Reading header =&gt; &#39;%c%c%c%c&#39; (%d byte)\n&quot;</span>, label[0], label[1], label[2], label[3],
                     nextblock);
              SKIP2;
            }

          SKIP;
          <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), 1, fd);
          SKIP2;

          <span class="keywordflow">if</span>(blksize1 != 256 || blksize2 != 256)
            {
              printf(<span class="stringliteral">&quot;incorrect header format\n&quot;</span>);
              fflush(stdout);
              <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(890);
            }
        }


<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
        {
          <a class="code" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9">read_header_attributes_in_hdf5</a>(fname);

          hdf5_file = H5Fopen(fname, H5F_ACC_RDONLY, H5P_DEFAULT);

          <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type] &gt; 0)
                {
                  sprintf(buf, <span class="stringliteral">&quot;/PartType%d&quot;</span>, type);
                  hdf5_grp[type] = H5Gopen(hdf5_file, buf);
                }
            }
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
      <span class="keywordflow">for</span>(task = readTask + 1; task &lt;= lastTask; task++)
        MPI_Ssend(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, task, <a class="code" href="tags_8h.html#a048ec72bf4150a4d7d2aa377a18d6cb8">TAG_HEADER</a>, MPI_COMM_WORLD);
    }
  <span class="keywordflow">else</span>
    MPI_Recv(&amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>, <span class="keyword">sizeof</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>), MPI_BYTE, readTask, <a class="code" href="tags_8h.html#a048ec72bf4150a4d7d2aa377a18d6cb8">TAG_HEADER</a>, MPI_COMM_WORLD, &amp;status);


  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> == 0)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a> &lt;= 1)
        <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
          <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[i] = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[i];

      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2bb70816a4d5f56e0df2d9b8d706cef2">TotN_gas</a> = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[0] + (((<span class="keywordtype">long</span> <span class="keywordtype">long</span>) <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a56f54a68fe289b19902b3c4c561a7159">npartTotalHighWord</a>[0]) &lt;&lt; 32);

      <span class="keywordflow">for</span>(i = 0, <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> = 0; i &lt; 6; i++)
        {
          <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> += <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[i];
          <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> += (((<span class="keywordtype">long</span> long) <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a56f54a68fe289b19902b3c4c561a7159">npartTotalHighWord</a>[i]) &lt;&lt; 32);
        }


      <span class="keywordflow">for</span>(i = 0; i &lt; 6; i++)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[i] = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a2c387b0c7c823287d424fedc70175917">mass</a>[i];

      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);     <span class="comment">/* sets the maximum number of particles that may */</span>
      <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a43dccd3997af759d43a2f3bcce44a2c4">MaxPartSph</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#aa9ceb5cacadcf2cadfc7154ab8d7fc88">PartAllocFactor</a> * (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a2bb70816a4d5f56e0df2d9b8d706cef2">TotN_gas</a> / <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>);    <span class="comment">/* sets the maximum number of particles that may </span>
<span class="comment">                                                                           reside on a processor */</span>
      <a class="code" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7">allocate_memory</a>();

      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 2)
        <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a25b9da73fdcbdc45fbe4a6ad45479f09">Time</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ad671e0af15abea094631b996dc78c8f1">TimeBegin</a> = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad6237959a3590772366f18000a47a7d6">time</a>;
    }

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
    {
      <span class="keywordflow">for</span>(i = 0, n_in_file = 0; i &lt; 6; i++)
        n_in_file += <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[i];

      printf(<span class="stringliteral">&quot;\nreading file `%s&#39; on task=%d (contains %d particles.)\n&quot;</span>
             <span class="stringliteral">&quot;distributing this file to tasks %d-%d\n&quot;</span>
             <span class="stringliteral">&quot;Type 0 (gas):   %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
             <span class="stringliteral">&quot;Type 1 (halo):  %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
             <span class="stringliteral">&quot;Type 2 (disk):  %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
             <span class="stringliteral">&quot;Type 3 (bulge): %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
             <span class="stringliteral">&quot;Type 4 (stars): %8d  (tot=%6d%09d) masstab=%g\n&quot;</span>
             <span class="stringliteral">&quot;Type 5 (bndry): %8d  (tot=%6d%09d) masstab=%g\n\n&quot;</span>, fname, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, n_in_file, readTask,
             lastTask, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[0], (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[0] / 1000000000),
             (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[0] % 1000000000), <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[0], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[1],
             (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[1] / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[1] % 1000000000),
             <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[1], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[2], (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[2] / 1000000000),
             (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[2] % 1000000000), <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[2], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[3],
             (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[3] / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[3] % 1000000000),
             <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[3], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[4], (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[4] / 1000000000),
             (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[4] % 1000000000), <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[4], <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[5],
             (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[5] / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>[5] % 1000000000),
             <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[5]);
      fflush(stdout);
    }


  ntask = lastTask - readTask + 1;


  <span class="comment">/* to collect the gas particles all at the beginning (in case several</span>
<span class="comment">     snapshot files are read on the current CPU) we move the collisionless</span>
<span class="comment">     particles such that a gap of the right size is created */</span>

  <span class="keywordflow">for</span>(type = 0, nall = 0; type &lt; 6; type++)
    {
      n_in_file = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];

      n_for_this_task = n_in_file / ntask;
      <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> - readTask) &lt; (n_in_file % ntask))
        n_for_this_task++;

      nall += n_for_this_task;
    }

  memmove(&amp;<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> + nall], &amp;<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>], (<a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> - N_gas) * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structparticle__data.html">particle_data</a>));
  nstart = N_gas;



  <span class="keywordflow">for</span>(blocknr = 0; blocknr &lt; IO_NBLOCKS; blocknr++)
    {
      <span class="keywordflow">if</span>(<a class="code" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e">blockpresent</a>(blocknr))
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 0 &amp;&amp; blocknr &gt; <a class="code" href="allvars_8h.html#a3f7452ec51c4f746e7070abd666147d8a942cbf4dca00cd5260edc905f5976682">IO_U</a>)
            <span class="keywordflow">continue</span>;           <span class="comment">/* ignore all other blocks in initial conditions */</span>

          bytes_per_blockelement = <a class="code" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c">get_bytes_per_blockelement</a>(blocknr);

          blockmaxlen = ((int) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#abd0120516eb7fee5a534464546fc5c7f">BufferSize</a> * 1024 * 1024)) / bytes_per_blockelement;

          npart = <a class="code" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9">get_particles_in_block</a>(blocknr, &amp;typelist[0]);

          <span class="keywordflow">if</span>(npart &gt; 0)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
                {
                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
                    {
                      SKIP;
                      <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;label, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 4, fd);
                      <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(&amp;nextblock, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, fd);
                      printf(<span class="stringliteral">&quot;Reading header =&gt; &#39;%c%c%c%c&#39; (%d byte)\n&quot;</span>, label[0], label[1], label[2],
                             label[3], nextblock);
                      SKIP2;

                      <span class="keywordflow">if</span>(strncmp(label, <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr], 4) != 0)
                        {
                          printf(<span class="stringliteral">&quot;incorrect block-structure!\n&quot;</span>);
                          printf(<span class="stringliteral">&quot;expected &#39;%c%c%c%c&#39; but found &#39;%c%c%c%c&#39;\n&quot;</span>,
                                 label[0], label[1], label[2], label[3],
                                 <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][0], <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][1],
                                 <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][2], <a class="code" href="allvars_8c.html#ab0664df93d97f96270978b84eb6fb80c">Tab_IO_Labels</a>[blocknr][3]);
                          fflush(stdout);
                          <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1890);
                        }
                    }

                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
                    SKIP;
                }

              <span class="keywordflow">for</span>(type = 0, offset = 0; type &lt; 6; type++)
                {
                  n_in_file = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];
<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>                  pcsum = 0;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                  <span class="keywordflow">if</span>(typelist[type] == 0)
                    {
                      n_for_this_task = n_in_file / ntask;
                      <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> - readTask) &lt; (n_in_file % ntask))
                        n_for_this_task++;

                      offset += n_for_this_task;
                    }
                  <span class="keywordflow">else</span>
                    {
                      <span class="keywordflow">for</span>(task = readTask; task &lt;= lastTask; task++)
                        {
                          n_for_this_task = n_in_file / ntask;
                          <span class="keywordflow">if</span>((task - readTask) &lt; (n_in_file % ntask))
                            n_for_this_task++;

                          <span class="keywordflow">if</span>(task == <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                            <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> + n_for_this_task &gt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>)
                              {
                                printf(<span class="stringliteral">&quot;too many particles\n&quot;</span>);
                                <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1313);
                              }


                          <span class="keywordflow">do</span>
                            {
                              pc = n_for_this_task;

                              <span class="keywordflow">if</span>(pc &gt; blockmaxlen)
                                pc = blockmaxlen;

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
                                {
                                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
                                    <a class="code" href="io_8c.html#a1609620c03f6b0068601735c42e3c660">my_fread</a>(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement, pc, fd);
<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>                                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
                                    {
                                      <a class="code" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686">get_dataset_name</a>(blocknr, buf);
                                      hdf5_dataset = H5Dopen(hdf5_grp[type], buf);

                                      dims[0] = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];
                                      dims[1] = <a class="code" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a>(blocknr);
                                      <span class="keywordflow">if</span>(dims[1] == 1)
                                        rank = 1;
                                      <span class="keywordflow">else</span>
                                        rank = 2;

                                      hdf5_dataspace_in_file = H5Screate_simple(rank, dims, NULL);

                                      dims[0] = pc;
                                      hdf5_dataspace_in_memory = H5Screate_simple(rank, dims, NULL);

                                      start[0] = pcsum;
                                      start[1] = 0;

                                      count[0] = pc;
                                      count[1] = <a class="code" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f">get_values_per_blockelement</a>(blocknr);
                                      pcsum += pc;

                                      H5Sselect_hyperslab(hdf5_dataspace_in_file, H5S_SELECT_SET,
                                                          start, NULL, count, NULL);

                                      <span class="keywordflow">switch</span> (<a class="code" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1">get_datatype_in_block</a>(blocknr))
                                        {
                                        <span class="keywordflow">case</span> 0:
                                          hdf5_datatype = H5Tcopy(H5T_NATIVE_UINT);
                                          <span class="keywordflow">break</span>;
                                        <span class="keywordflow">case</span> 1:
                                          hdf5_datatype = H5Tcopy(H5T_NATIVE_FLOAT);
                                          <span class="keywordflow">break</span>;
                                        <span class="keywordflow">case</span> 2:
                                          hdf5_datatype = H5Tcopy(H5T_NATIVE_UINT64);
                                          <span class="keywordflow">break</span>;
                                        }

                                      H5Dread(hdf5_dataset, hdf5_datatype, hdf5_dataspace_in_memory,
                                              hdf5_dataspace_in_file, H5P_DEFAULT, <a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>);

                                      H5Tclose(hdf5_datatype);
                                      H5Sclose(hdf5_dataspace_in_memory);
                                      H5Sclose(hdf5_dataspace_in_file);
                                      H5Dclose(hdf5_dataset);
                                    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                                }

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask &amp;&amp; task != readTask)
                                MPI_Ssend(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement * pc, MPI_BYTE, task, <a class="code" href="tags_8h.html#a41c046c7898c1956074313fd83f50b39">TAG_PDATA</a>,
                                          MPI_COMM_WORLD);

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> != readTask &amp;&amp; task == <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>)
                                MPI_Recv(<a class="code" href="allvars_8c.html#ab9d6a5a8cf4049ad304ea6d23d8efb09">CommBuffer</a>, bytes_per_blockelement * pc, MPI_BYTE, readTask,
                                         <a class="code" href="tags_8h.html#a41c046c7898c1956074313fd83f50b39">TAG_PDATA</a>, MPI_COMM_WORLD, &amp;status);

                              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == task)
                                {
                                  <a class="code" href="proto_8h.html#a3757efb7e470353080a128388ccebec9">empty_read_buffer</a>(blocknr, nstart + offset, pc, type);

                                  offset += pc;
                                }

                              n_for_this_task -= pc;
                            }
                          <span class="keywordflow">while</span>(n_for_this_task &gt; 0);
                        }
                    }
                }
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
                {
                  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
                    {
                      SKIP2;
                      <span class="keywordflow">if</span>(blksize1 != blksize2)
                        {
                          printf(<span class="stringliteral">&quot;incorrect block-sizes detected!\n&quot;</span>);
                          printf(<span class="stringliteral">&quot;Task=%d   blocknr=%d  blksize1=%d  blksize2=%d\n&quot;</span>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, blocknr,
                                 blksize1, blksize2);
                          fflush(stdout);
                          <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(1889);
                        }
                    }
                }
            }
        }
    }


  <span class="keywordflow">for</span>(type = 0; type &lt; 6; type++)
    {
      n_in_file = <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type];

      n_for_this_task = n_in_file / ntask;
      <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> - readTask) &lt; (n_in_file % ntask))
        n_for_this_task++;

      <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> += n_for_this_task;

      <span class="keywordflow">if</span>(type == 0)
        N_gas += n_for_this_task;
    }

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == readTask)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 1 || <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 2)
        fclose(fd);
<span class="preprocessor">#ifdef HAVE_HDF5</span>
<span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
        {
          <span class="keywordflow">for</span>(type = 5; type &gt;= 0; type--)
            <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>[type] &gt; 0)
              H5Gclose(hdf5_grp[type]);
          H5Fclose(hdf5_file);
        }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_cgraph.png" border="0" usemap="#read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_cgraph" alt=""/></div>
<map name="read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_cgraph" id="read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_cgraph">
<area shape="rect" id="node3" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7" title="allocate_memory" alt="" coords="177,5,311,35"/><area shape="rect" id="node5" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="405,217,472,247"/><area shape="rect" id="node9" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e" title="blockpresent" alt="" coords="192,109,296,139"/><area shape="rect" id="node11" href="proto_8h.html#a3757efb7e470353080a128388ccebec9" title="empty_read_buffer" alt="" coords="173,163,315,192"/><area shape="rect" id="node14" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c" title="get_bytes_per_blockelement" alt="" coords="141,216,347,245"/><area shape="rect" id="node16" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686" title="get_dataset_name" alt="" coords="173,269,315,299"/><area shape="rect" id="node18" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1" title="get_datatype_in_block" alt="" coords="161,323,327,352"/><area shape="rect" id="node20" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9" title="get_particles_in_block" alt="" coords="163,376,325,405"/><area shape="rect" id="node23" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f" title="get_values_per_blockelement" alt="" coords="139,429,349,459"/><area shape="rect" id="node25" href="io_8c.html#a1609620c03f6b0068601735c42e3c660" title="my_fread" alt="" coords="203,483,285,512"/><area shape="rect" id="node28" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9" title="read_header_attributes_in_hdf5" alt="" coords="132,536,356,565"/><area shape="rect" id="node7" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="520,217,677,247"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_icgraph.png" border="0" usemap="#read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_icgraph" alt=""/></div>
<map name="read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_icgraph" id="read__ic_8c_affd0f4e6b7bcdabf7d6f8191145f78d1_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="132,5,199,35"/><area shape="rect" id="node5" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="249,5,289,35"/><area shape="rect" id="node7" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="339,5,405,35"/><area shape="rect" id="node9" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="455,5,508,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af87c21a0c70ac5e7d5f769b952d08fe9"></a><!-- doxytag: member="read_ic.c::read_header_attributes_in_hdf5" ref="af87c21a0c70ac5e7d5f769b952d08fe9" args="(char *fname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_header_attributes_in_hdf5 </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function reads the header information in case the HDF5 file format is used. </p>

<p>Definition at line <a class="el" href="read__ic_8c_source.html#l00764">764</a> of file <a class="el" href="read__ic_8c_source.html">read_ic.c</a>.</p>

<p>References <a class="el" href="allvars_8h_source.html#l00641">io_header::flag_entropy_instead_u</a>, <a class="el" href="allvars_8c_source.html#l00163">header</a>, <a class="el" href="allvars_8h_source.html#l00624">io_header::mass</a>, <a class="el" href="allvars_8h_source.html#l00623">io_header::npart</a>, <a class="el" href="allvars_8h_source.html#l00630">io_header::npartTotal</a>, <a class="el" href="allvars_8h_source.html#l00640">io_header::npartTotalHighWord</a>, <a class="el" href="allvars_8h_source.html#l00633">io_header::num_files</a>, and <a class="el" href="allvars_8h_source.html#l00626">io_header::time</a>.</p>

<p>Referenced by <a class="el" href="read__ic_8c_source.html#l00615">find_files()</a>, and <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  hid_t hdf5_file, hdf5_headergrp, hdf5_attribute;


  hdf5_file = H5Fopen(fname, H5F_ACC_RDONLY, H5P_DEFAULT);
  hdf5_headergrp = H5Gopen(hdf5_file, <span class="stringliteral">&quot;/Header&quot;</span>);


  hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumPart_ThisFile&quot;</span>);
  H5Aread(hdf5_attribute, H5T_NATIVE_INT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#adc88d581cf3d57eb975a51f587538bdd">npart</a>);
  H5Aclose(hdf5_attribute);

  hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumPart_Total&quot;</span>);
  H5Aread(hdf5_attribute, H5T_NATIVE_UINT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad63a8b413a6b56c33bf5ecc25550a6dd">npartTotal</a>);
  H5Aclose(hdf5_attribute);

  hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumPart_Total_HighWord&quot;</span>);
  H5Aread(hdf5_attribute, H5T_NATIVE_UINT, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a56f54a68fe289b19902b3c4c561a7159">npartTotalHighWord</a>);
  H5Aclose(hdf5_attribute);

  hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;MassTable&quot;</span>);
  H5Aread(hdf5_attribute, H5T_NATIVE_DOUBLE, <a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a2c387b0c7c823287d424fedc70175917">mass</a>);
  H5Aclose(hdf5_attribute);

  hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;Time&quot;</span>);
  H5Aread(hdf5_attribute, H5T_NATIVE_DOUBLE, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#ad6237959a3590772366f18000a47a7d6">time</a>);
  H5Aclose(hdf5_attribute);

  hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;NumFilesPerSnapshot&quot;</span>);
  H5Aread(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a5688351781a2845beb2c52a035cc5f71">num_files</a>);
  H5Aclose(hdf5_attribute);

  hdf5_attribute = H5Aopen_name(hdf5_headergrp, <span class="stringliteral">&quot;Flag_Entropy_ICs&quot;</span>);
  H5Aread(hdf5_attribute, H5T_NATIVE_INT, &amp;<a class="code" href="allvars_8c.html#a5d111aa83cef5894eea3939d815bb803">header</a>.<a class="code" href="structio__header.html#a448788ace72155e22d19af1c01917857">flag_entropy_instead_u</a>);
  H5Aclose(hdf5_attribute);

  H5Gclose(hdf5_headergrp);
  H5Fclose(hdf5_file);
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_af87c21a0c70ac5e7d5f769b952d08fe9_icgraph.png" border="0" usemap="#read__ic_8c_af87c21a0c70ac5e7d5f769b952d08fe9_icgraph" alt=""/></div>
<map name="read__ic_8c_af87c21a0c70ac5e7d5f769b952d08fe9_icgraph" id="read__ic_8c_af87c21a0c70ac5e7d5f769b952d08fe9_icgraph">
<area shape="rect" id="node3" href="read__ic_8c.html#ac028b474d53a40e79377b7ae5dde636a" title="find_files" alt="" coords="280,5,357,35"/><area shape="rect" id="node13" href="read__ic_8c.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="281,59,356,88"/><area shape="rect" id="node5" href="read__ic_8c.html#a150344fdc0c6e132aecdb6c646529df1" title="read_ic" alt="" coords="407,32,473,61"/><area shape="rect" id="node7" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="524,32,564,61"/><area shape="rect" id="node9" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="613,32,680,61"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="729,32,783,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a150344fdc0c6e132aecdb6c646529df1"></a><!-- doxytag: member="read_ic.c::read_ic" ref="a150344fdc0c6e132aecdb6c646529df1" args="(char *fname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_ic </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function reads initial conditions, in one of the three possible file formats currently supported by Gadget. Note: When a snapshot file is started from initial conditions (start-option 0), not all the information in the header is used, in particular, the STARTING TIME needs to be set in the parameterfile. Also, for gas particles, only the internal energy is read, the density and mean molecular weight will be recomputed by the code. When InitGasTemp&gt;0 is given, the gas temperature will be initialzed to this value assuming a mean colecular weight either corresponding to complete neutrality, or full ionization.</p>
<p>However, when the code is started with start-option 2, then all the this data in the snapshot files is preserved, i.e. this is also the way to resume a simulation from a snapshot file in case a regular restart file is not available. </p>

<p><p>&lt; adiabatic index of simulated gas</p>
<p>&lt; mass fraction of hydrogen, relevant only for radiative cooling</p>
<p>&lt; mass fraction of hydrogen, relevant only for radiative cooling </p>
</p>

<p>Definition at line <a class="el" href="read__ic_8c_source.html#l00031">31</a> of file <a class="el" href="read__ic_8c_source.html">read_ic.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00113">All</a>, <a class="el" href="allvars_8h_source.html#l00066">BOLTZMANN</a>, <a class="el" href="read__ic_8c_source.html#l00724">distribute_file()</a>, <a class="el" href="system_8c_source.html#l00091">dmax()</a>, <a class="el" href="allvars_8h_source.html#l00545">sph_particle_data::Entropy</a>, <a class="el" href="io_8c_source.html#l00566">fill_Tab_IO_Labels()</a>, <a class="el" href="read__ic_8c_source.html#l00615">find_files()</a>, <a class="el" href="allvars_8h_source.html#l00055">GAMMA_MINUS1</a>, <a class="el" href="allvars_8h_source.html#l00271">global_data_all_processes::ICFormat</a>, <a class="el" href="allvars_8h_source.html#l00299">global_data_all_processes::InitGasTemp</a>, <a class="el" href="allvars_8h_source.html#l00505">particle_data::Mass</a>, <a class="el" href="allvars_8h_source.html#l00472">global_data_all_processes::MassTable</a>, <a class="el" href="allvars_8h_source.html#l00301">global_data_all_processes::MinEgySpec</a>, <a class="el" href="allvars_8c_source.html#l00016">N_gas</a>, <a class="el" href="allvars_8c_source.html#l00012">NTask</a>, <a class="el" href="allvars_8h_source.html#l00276">global_data_all_processes::NumFilesWrittenInParallel</a>, <a class="el" href="allvars_8c_source.html#l00015">NumPart</a>, <a class="el" href="allvars_8c_source.html#l00121">P</a>, <a class="el" href="read__ic_8c_source.html#l00244">read_file()</a>, <a class="el" href="allvars_8c_source.html#l00026">RestartFlag</a>, <a class="el" href="allvars_8c_source.html#l00129">SphP</a>, <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>, <a class="el" href="allvars_8h_source.html#l00263">global_data_all_processes::TotNumPart</a>, <a class="el" href="allvars_8h_source.html#l00522">particle_data::Type</a>, <a class="el" href="allvars_8h_source.html#l00320">global_data_all_processes::UnitEnergy_in_cgs</a>, and <a class="el" href="allvars_8h_source.html#l00314">global_data_all_processes::UnitMass_in_g</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00020">init()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i, num_files, rest_files, ngroups, gr, filenr, masterTask, lastTask, groupMaster;
  <span class="keywordtype">double</span> u_init;
  <span class="keywordtype">char</span> buf[500];

<span class="preprocessor">#ifndef ISOTHERM_EQS</span>
<span class="preprocessor"></span>  <span class="keywordtype">double</span> molecular_weight;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef SFR</span>
<span class="preprocessor"></span>  <span class="keywordtype">double</span> original_gas_mass, mass, masstot;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a> = 0;
  <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a> = 0;
  <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> = 0;

  num_files = <a class="code" href="proto_8h.html#ac028b474d53a40e79377b7ae5dde636a">find_files</a>(fname);

  rest_files = num_files;

  <a class="code" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345">fill_Tab_IO_Labels</a>();

  <span class="keywordflow">while</span>(rest_files &gt; <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>)
    {
      sprintf(buf, <span class="stringliteral">&quot;%s.%d&quot;</span>, fname, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> + (rest_files - <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>));
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
        sprintf(buf, <span class="stringliteral">&quot;%s.%d.hdf5&quot;</span>, fname, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> + (rest_files - <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>));

      ngroups = <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>;
      <span class="keywordflow">if</span>((<a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> % <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>))
        ngroups++;
      groupMaster = (<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> / ngroups) * ngroups;

      <span class="keywordflow">for</span>(gr = 0; gr &lt; ngroups; gr++)
        {
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == (groupMaster + gr))    <span class="comment">/* ok, it&#39;s this processor&#39;s turn */</span>
            <a class="code" href="proto_8h.html#affd0f4e6b7bcdabf7d6f8191145f78d1">read_file</a>(buf, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>);
          MPI_Barrier(MPI_COMM_WORLD);
        }

      rest_files -= <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a>;
    }


  <span class="keywordflow">if</span>(rest_files &gt; 0)
    {
      <a class="code" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab">distribute_file</a>(rest_files, 0, 0, <a class="code" href="allvars_8c.html#a675acdcd149f5993271a1fdc11673b65">NTask</a> - 1, &amp;filenr, &amp;masterTask, &amp;lastTask);

      <span class="keywordflow">if</span>(num_files &gt; 1)
        {
          sprintf(buf, <span class="stringliteral">&quot;%s.%d&quot;</span>, fname, filenr);
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
            sprintf(buf, <span class="stringliteral">&quot;%s.%d.hdf5&quot;</span>, fname, filenr);
        }
      <span class="keywordflow">else</span>
        {
          sprintf(buf, <span class="stringliteral">&quot;%s&quot;</span>, fname);
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a1c63650e75378a527870ab40f1145df1">ICFormat</a> == 3)
            sprintf(buf, <span class="stringliteral">&quot;%s.hdf5&quot;</span>, fname);
        }

      ngroups = rest_files / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>;
      <span class="keywordflow">if</span>((rest_files % <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>))
        ngroups++;

      <span class="keywordflow">for</span>(gr = 0; gr &lt; ngroups; gr++)
        {
          <span class="keywordflow">if</span>((filenr / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0e328240a1fb59c7bf55332a1a691029">NumFilesWrittenInParallel</a>) == gr)    <span class="comment">/* ok, it&#39;s this processor&#39;s turn */</span>
            <a class="code" href="proto_8h.html#affd0f4e6b7bcdabf7d6f8191145f78d1">read_file</a>(buf, masterTask, lastTask);
          MPI_Barrier(MPI_COMM_WORLD);
        }
    }


  <span class="comment">/* this makes sure that masses are initialized in the case that the mass-block</span>
<span class="comment">     is completely empty */</span>
  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a9ec69b53278f9bbe12890e50299026af">NumPart</a>; i++)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#ab6119b261ff95e8f84ae171139704cbd">Type</a>] != 0)
        <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#a710e551be01f4ef85442d0928aca728c">Mass</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a0d1dbe97a03958559781d9619f8b17c1">MassTable</a>[<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[i].<a class="code" href="structparticle__data.html#ab6119b261ff95e8f84ae171139704cbd">Type</a>];
    }

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a7f2decfd266dfa9b4560409b9e72b4ab">RestartFlag</a> == 0)
    {
      <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a633fbd557554f7932dab2641d15e6ea1">InitGasTemp</a> &gt; 0)
        {
          u_init = (<a class="code" href="allvars_8h.html#aa1487dae81baa2e0a5643e7b571633a0">BOLTZMANN</a> / PROTONMASS) * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a633fbd557554f7932dab2641d15e6ea1">InitGasTemp</a>;
          u_init *= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#adccf5aa82d4252d8d24ead7681b29052">UnitMass_in_g</a> / <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ab0d48e2253ad31d76eda8e677eba2cf1">UnitEnergy_in_cgs</a>;  <span class="comment">/* unit conversion */</span>

#ifdef ISOTHERM_EQS
          u_init *= 1.0;
#<span class="keywordflow">else</span>
          u_init *= (1.0 / <a class="code" href="allvars_8h.html#a75216f9bf4030240b1fc0e1855e032d2">GAMMA_MINUS1</a>);

          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a633fbd557554f7932dab2641d15e6ea1">InitGasTemp</a> &gt; 1.0e4)   <span class="comment">/* assuming FULL ionization */</span>
            molecular_weight = 4 / (8 - 5 * (1 - HYDROGEN_MASSFRAC));
          <span class="keywordflow">else</span>                  <span class="comment">/* assuming NEUTRAL GAS */</span>
            molecular_weight = 4 / (1 + 3 * HYDROGEN_MASSFRAC);

          u_init /= molecular_weight;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
          <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>; i++)
            {
              <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Entropy == 0)
                <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#a7cbe9bb2086f525f400b2c12103b3116">Entropy</a> = u_init;

              <span class="comment">/* Note: the coversion to entropy will be done in the function init(),</span>
<span class="comment">                 after the densities have been computed */</span>
            }
        }
    }

  <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>; i++)
    <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].Entropy = <a class="code" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85">dmax</a>(<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ae298f2b76a8f1d0b932bee24c28987cf">MinEgySpec</a>, <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[i].<a class="code" href="structsph__particle__data.html#a7cbe9bb2086f525f400b2c12103b3116">Entropy</a>);

  MPI_Barrier(MPI_COMM_WORLD);

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      printf(<span class="stringliteral">&quot;reading done.\n&quot;</span>);
      fflush(stdout);
    }

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    {
      printf(<span class="stringliteral">&quot;Total number of particles :  %d%09d\n\n&quot;</span>,
             (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> / 1000000000), (<span class="keywordtype">int</span>) (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a853bbd3ea833c0a6a57af1434b611868">TotNumPart</a> % 1000000000));
      fflush(stdout);
    }
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_cgraph.png" border="0" usemap="#read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_cgraph" alt=""/></div>
<map name="read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_cgraph" id="read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_cgraph">
<area shape="rect" id="node3" href="proto_8h.html#abf75a70e8719e8ed6de565a6ae90f1ab" title="distribute_file" alt="" coords="136,29,243,59"/><area shape="rect" id="node6" href="proto_8h.html#ac5e72d197cde6d71017e89db9b986b85" title="dmax" alt="" coords="160,83,219,112"/><area shape="rect" id="node8" href="io_8c.html#a10281a87abe1e07d6ca603de6a533345" title="fill_Tab_IO_Labels" alt="" coords="124,136,255,165"/><area shape="rect" id="node10" href="proto_8h.html#ac028b474d53a40e79377b7ae5dde636a" title="find_files" alt="" coords="151,189,228,219"/><area shape="rect" id="node18" href="proto_8h.html#affd0f4e6b7bcdabf7d6f8191145f78d1" title="read_file" alt="" coords="152,427,227,456"/><area shape="rect" id="node12" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="579,293,645,323"/><area shape="rect" id="node16" href="proto_8h.html#af87c21a0c70ac5e7d5f769b952d08fe9" title="read_header_attributes_in_hdf5" alt="" coords="305,189,529,219"/><area shape="rect" id="node14" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="693,293,851,323"/><area shape="rect" id="node20" href="allocate_8c.html#a7fe5e304baaf5f418a22fef9a9cc02c7" title="allocate_memory" alt="" coords="351,293,484,323"/><area shape="rect" id="node23" href="io_8c.html#ad9c685a2d6d48224bfec61680ce82b1e" title="blockpresent" alt="" coords="365,347,469,376"/><area shape="rect" id="node25" href="proto_8h.html#a3757efb7e470353080a128388ccebec9" title="empty_read_buffer" alt="" coords="347,400,488,429"/><area shape="rect" id="node28" href="io_8c.html#a49492470fcccf9d05bf51993f281f16c" title="get_bytes_per_blockelement" alt="" coords="315,453,520,483"/><area shape="rect" id="node30" href="io_8c.html#a4d30ce1aad9c69d5af676a6a13173686" title="get_dataset_name" alt="" coords="347,507,488,536"/><area shape="rect" id="node32" href="io_8c.html#acdf59daa02f065452a596cf88b4de1a1" title="get_datatype_in_block" alt="" coords="335,560,500,589"/><area shape="rect" id="node34" href="io_8c.html#a5ce310b1efc19d96d530c1264fd5eca9" title="get_particles_in_block" alt="" coords="336,613,499,643"/><area shape="rect" id="node37" href="io_8c.html#a3892776d6528c51f720d2a48deb2486f" title="get_values_per_blockelement" alt="" coords="312,667,523,696"/><area shape="rect" id="node39" href="io_8c.html#a1609620c03f6b0068601735c42e3c660" title="my_fread" alt="" coords="376,720,459,749"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_icgraph.png" border="0" usemap="#read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_icgraph" alt=""/></div>
<map name="read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_icgraph" id="read__ic_8c_a150344fdc0c6e132aecdb6c646529df1_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="124,5,164,35"/><area shape="rect" id="node5" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="213,5,280,35"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="329,5,383,35"/></map>
</div>
</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Nov 5 2010 18:27:04 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
