<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GADGET-2: ngb.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>ngb.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>neighbour search by means of the tree  
<a href="#_details">More...</a></p>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="allvars_8h_source.html">allvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="proto_8h_source.html">proto.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for ngb.c:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c__incl.png" border="0" usemap="#ngb_8c" alt=""/></div>
<map name="ngb_8c" id="ngb_8c">
<area shape="rect" id="node15" href="allvars_8h.html" title="declares global variables." alt="" coords="437,160,512,189"/><area shape="rect" id="node22" href="proto_8h.html" title="this file contains all function prototypes of the code" alt="" coords="523,83,589,112"/><area shape="rect" id="node20" href="tags_8h.html" title="declares various tags for labelling MPI messages." alt="" coords="497,237,559,267"/></map>
</div>

<p><a href="ngb_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a5c5328b307b005e6682669279878cef0">boxSize_X</a>&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a0ecceb71797a529fb6f2b8c47b51686c">boxHalf_X</a>&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#ab0db73a31e08d33d840e28651e3cf610">boxSize_Y</a>&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a59f20d7decc2bdfedcaafb70ef23df0e">boxHalf_Y</a>&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a8a97a1c456bdd396791c84c370f0aa18">boxSize_Z</a>&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a34e9d5d079320cbfc0576d26f58d2fe7">boxHalf_Z</a>&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(x)&nbsp;&nbsp;&nbsp;(xtmp=(x),(xtmp&gt;boxHalf_X)?(xtmp-boxSize_X):((xtmp&lt;-boxHalf_X)?(xtmp+boxSize_X):xtmp))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(x)&nbsp;&nbsp;&nbsp;(xtmp=(x),(xtmp&gt;boxHalf_Y)?(xtmp-boxSize_Y):((xtmp&lt;-boxHalf_Y)?(xtmp+boxSize_Y):xtmp))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(x)&nbsp;&nbsp;&nbsp;(xtmp=(x),(xtmp&gt;boxHalf_Z)?(xtmp-boxSize_Z):((xtmp&lt;-boxHalf_Z)?(xtmp+boxSize_Z):xtmp))</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a96ec7acfa3c046abc6902ca77ee4bddd">ngb_treefind_pairs</a> (float searchcenter[3], float hsml, int *startnode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#ae39a878e9bb71ae346097aace71632f9">ngb_treefind_variable</a> (float searchcenter[3], float hsml, int *startnode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a674ac0d18eaff78ba700f1278f078274">ngb_clear_buf</a> (float searchcenter[3], float hsml, int numngb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#a6f7a3b85f10701b9067f012cc9a30f55">ngb_treeallocate</a> (int npart)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#aab22cf240079ef5846d83729e4565f97">ngb_treefree</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#ac56af97a1dbbbbb07db8207246852f79">ngb_treebuild</a> (void)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>neighbour search by means of the tree </p>
<p>This file contains routines for neighbour finding. We use the gravity-tree and a range-searching technique to find neighbours. </p>

<p>Definition in file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a0ecceb71797a529fb6f2b8c47b51686c"></a><!-- doxytag: member="ngb.c::boxHalf_X" ref="a0ecceb71797a529fb6f2b8c47b51686c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define boxHalf_X&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00026">26</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
<a class="anchor" id="a59f20d7decc2bdfedcaafb70ef23df0e"></a><!-- doxytag: member="ngb.c::boxHalf_Y" ref="a59f20d7decc2bdfedcaafb70ef23df0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define boxHalf_Y&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00032">32</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
<a class="anchor" id="a34e9d5d079320cbfc0576d26f58d2fe7"></a><!-- doxytag: member="ngb.c::boxHalf_Z" ref="a34e9d5d079320cbfc0576d26f58d2fe7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define boxHalf_Z&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00038">38</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
<a class="anchor" id="a5c5328b307b005e6682669279878cef0"></a><!-- doxytag: member="ngb.c::boxSize_X" ref="a5c5328b307b005e6682669279878cef0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define boxSize_X&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00025">25</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0db73a31e08d33d840e28651e3cf610"></a><!-- doxytag: member="ngb.c::boxSize_Y" ref="ab0db73a31e08d33d840e28651e3cf610" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define boxSize_Y&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00031">31</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
<a class="anchor" id="a8a97a1c456bdd396791c84c370f0aa18"></a><!-- doxytag: member="ngb.c::boxSize_Z" ref="a8a97a1c456bdd396791c84c370f0aa18" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define boxSize_Z&nbsp;&nbsp;&nbsp;<a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00037">37</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
<a class="anchor" id="a49d4cb21065981774552d097f6f8832c"></a><!-- doxytag: member="ngb.c::NGB_PERIODIC_X" ref="a49d4cb21065981774552d097f6f8832c" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NGB_PERIODIC_X</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">x</td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(xtmp=(x),(xtmp&gt;boxHalf_X)?(xtmp-boxSize_X):((xtmp&lt;-boxHalf_X)?(xtmp+boxSize_X):xtmp))</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>these macros maps a coordinate difference to the nearest periodic image </p>

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00047">47</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00320">ngb_clear_buf()</a>, <a class="el" href="ngb_8c_source.html#l00064">ngb_treefind_pairs()</a>, and <a class="el" href="ngb_8c_source.html#l00194">ngb_treefind_variable()</a>.</p>

</div>
</div>
<a class="anchor" id="a3721767146404458e6955428a6e78cfd"></a><!-- doxytag: member="ngb.c::NGB_PERIODIC_Y" ref="a3721767146404458e6955428a6e78cfd" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NGB_PERIODIC_Y</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">x</td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(xtmp=(x),(xtmp&gt;boxHalf_Y)?(xtmp-boxSize_Y):((xtmp&lt;-boxHalf_Y)?(xtmp+boxSize_Y):xtmp))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00048">48</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00320">ngb_clear_buf()</a>, <a class="el" href="ngb_8c_source.html#l00064">ngb_treefind_pairs()</a>, and <a class="el" href="ngb_8c_source.html#l00194">ngb_treefind_variable()</a>.</p>

</div>
</div>
<a class="anchor" id="ab563068e480f07f2fea4a94fb29ac11b"></a><!-- doxytag: member="ngb.c::NGB_PERIODIC_Z" ref="ab563068e480f07f2fea4a94fb29ac11b" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NGB_PERIODIC_Z</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">x</td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(xtmp=(x),(xtmp&gt;boxHalf_Z)?(xtmp-boxSize_Z):((xtmp&lt;-boxHalf_Z)?(xtmp+boxSize_Z):xtmp))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00049">49</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00320">ngb_clear_buf()</a>, <a class="el" href="ngb_8c_source.html#l00064">ngb_treefind_pairs()</a>, and <a class="el" href="ngb_8c_source.html#l00194">ngb_treefind_variable()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a674ac0d18eaff78ba700f1278f078274"></a><!-- doxytag: member="ngb.c::ngb_clear_buf" ref="a674ac0d18eaff78ba700f1278f078274" args="(float searchcenter[3], float hsml, int numngb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ngb_clear_buf </td>
          <td>(</td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>searchcenter</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>hsml</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numngb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The buffer for the neighbour list has a finite length MAX_NGB. For a large search region, this buffer can get full, in which case this routine can be called to eliminate some of the superfluous particles in the "corners" of the search box - only the ones in the inscribed sphere need to be kept. </p>

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00320">320</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>References <a class="el" href="allvars_8h_source.html#l00103">FLOAT</a>, <a class="el" href="ngb_8c_source.html#l00047">NGB_PERIODIC_X</a>, <a class="el" href="ngb_8c_source.html#l00048">NGB_PERIODIC_Y</a>, <a class="el" href="ngb_8c_source.html#l00049">NGB_PERIODIC_Z</a>, <a class="el" href="allvars_8c_source.html#l00032">Ngblist</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, and <a class="el" href="allvars_8h_source.html#l00499">particle_data::Pos</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00194">ngb_treefind_variable()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> i, p;
  <a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a> dx, dy, dz, r2;

<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>  <span class="keywordtype">double</span> xtmp;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">for</span>(i = 0; i &lt; numngb; i++)
    {
      p = <a class="code" href="allvars_8c.html#ade1b96e6772d0d1ccb06bcbec352b5bd">Ngblist</a>[i];
<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>      dx = <a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] - searchcenter[0]);
      dy = <a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] - searchcenter[1]);
      dz = <a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] - searchcenter[2]);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      dx = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].<a class="code" href="structparticle__data.html#a764ffe35d82a64065f585e3a84263dd1">Pos</a>[0] - searchcenter[0];
      dy = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].<a class="code" href="structparticle__data.html#a764ffe35d82a64065f585e3a84263dd1">Pos</a>[1] - searchcenter[1];
      dz = <a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].<a class="code" href="structparticle__data.html#a764ffe35d82a64065f585e3a84263dd1">Pos</a>[2] - searchcenter[2];
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>      r2 = dx * dx + dy * dy + dz * dz;

      <span class="keywordflow">if</span>(r2 &gt; hsml * hsml)
        {
          <a class="code" href="allvars_8c.html#ade1b96e6772d0d1ccb06bcbec352b5bd">Ngblist</a>[i] = <a class="code" href="allvars_8c.html#ade1b96e6772d0d1ccb06bcbec352b5bd">Ngblist</a>[numngb - 1];
          i--;
          numngb--;
        }
    }

  <span class="keywordflow">return</span> numngb;
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_a674ac0d18eaff78ba700f1278f078274_icgraph.png" border="0" usemap="#ngb_8c_a674ac0d18eaff78ba700f1278f078274_icgraph" alt=""/></div>
<map name="ngb_8c_a674ac0d18eaff78ba700f1278f078274_icgraph" id="ngb_8c_a674ac0d18eaff78ba700f1278f078274_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a008284f92570d4d1fa6e3dadb5902cf8" title="ngb_treefind_variable" alt="" coords="167,32,324,61"/><area shape="rect" id="node5" href="proto_8h.html#a19f7a07621c698ae894f53836e9ff03c" title="density_evaluate" alt="" coords="373,32,504,61"/><area shape="rect" id="node7" href="proto_8h.html#ad86cdeb9e3bfbe9af379ac9f7daf194c" title="density" alt="" coords="553,32,620,61"/><area shape="rect" id="node9" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="675,5,845,35"/><area shape="rect" id="node15" href="proto_8h.html#abca44f066552d38c44a1cd6020d349d5" title="setup_smoothinglengths" alt="" coords="671,59,849,88"/><area shape="rect" id="node11" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="1001,5,1044,35"/><area shape="rect" id="node13" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="1105,32,1159,61"/><area shape="rect" id="node17" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="900,59,940,88"/><area shape="rect" id="node19" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="989,59,1056,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6f7a3b85f10701b9067f012cc9a30f55"></a><!-- doxytag: member="ngb.c::ngb_treeallocate" ref="a6f7a3b85f10701b9067f012cc9a30f55" args="(int npart)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ngb_treeallocate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npart</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allocates memory for the neighbour list buffer. </p>

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00358">358</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="ngb_8c_source.html#l00020">boxHalf</a>, <a class="el" href="ngb_8c_source.html#l00026">boxHalf_X</a>, <a class="el" href="ngb_8c_source.html#l00032">boxHalf_Y</a>, <a class="el" href="ngb_8c_source.html#l00038">boxHalf_Z</a>, <a class="el" href="allvars_8h_source.html#l00264">global_data_all_processes::BoxSize</a>, <a class="el" href="ngb_8c_source.html#l00020">boxSize</a>, <a class="el" href="ngb_8c_source.html#l00025">boxSize_X</a>, <a class="el" href="ngb_8c_source.html#l00031">boxSize_Y</a>, <a class="el" href="ngb_8c_source.html#l00037">boxSize_Z</a>, <a class="el" href="endrun_8c_source.html#l00025">endrun()</a>, <a class="el" href="allvars_8c_source.html#l00032">Ngblist</a>, and <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00020">init()</a>, and <a class="el" href="restart_8c_source.html#l00035">restart()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">double</span> totbytes = 0;
  <span class="keywordtype">size_t</span> bytes;

<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>  <a class="code" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a> = <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">BoxSize</a>;
  <a class="code" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a> = 0.5 * <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#ac1b2e52cf547f5b2fe4bdfb0eaafa22f">BoxSize</a>;
<span class="preprocessor">#ifdef LONG_X</span>
<span class="preprocessor"></span>  <a class="code" href="ngb_8c.html#a0ecceb71797a529fb6f2b8c47b51686c">boxHalf_X</a> = <a class="code" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a> * LONG_X;
  <a class="code" href="ngb_8c.html#a5c5328b307b005e6682669279878cef0">boxSize_X</a> = <a class="code" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a> * LONG_X;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef LONG_Y</span>
<span class="preprocessor"></span>  <a class="code" href="ngb_8c.html#a59f20d7decc2bdfedcaafb70ef23df0e">boxHalf_Y</a> = <a class="code" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a> * LONG_Y;
  <a class="code" href="ngb_8c.html#ab0db73a31e08d33d840e28651e3cf610">boxSize_Y</a> = <a class="code" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a> * LONG_Y;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef LONG_Z</span>
<span class="preprocessor"></span>  <a class="code" href="ngb_8c.html#a34e9d5d079320cbfc0576d26f58d2fe7">boxHalf_Z</a> = <a class="code" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a> * LONG_Z;
  <a class="code" href="ngb_8c.html#a8a97a1c456bdd396791c84c370f0aa18">boxSize_Z</a> = <a class="code" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a> * LONG_Z;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">if</span>(!(<a class="code" href="allvars_8c.html#ade1b96e6772d0d1ccb06bcbec352b5bd">Ngblist</a> = malloc(bytes = npart * (<span class="keywordtype">long</span>) <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>))))
    {
      printf(<span class="stringliteral">&quot;Failed to allocate %g MB for ngblist array\n&quot;</span>, bytes / (1024.0 * 1024.0));
      <a class="code" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839">endrun</a>(78);
    }
  totbytes += bytes;

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    printf(<span class="stringliteral">&quot;allocated %g Mbyte for ngb search.\n&quot;</span>, totbytes / (1024.0 * 1024.0));
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_cgraph.png" border="0" usemap="#ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_cgraph" alt=""/></div>
<map name="ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_cgraph" id="ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_cgraph">
<area shape="rect" id="node3" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="184,5,251,35"/><area shape="rect" id="node5" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="299,5,456,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_icgraph.png" border="0" usemap="#ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_icgraph" alt=""/></div>
<map name="ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_icgraph" id="ngb_8c_a6f7a3b85f10701b9067f012cc9a30f55_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="197,5,237,35"/><area shape="rect" id="node9" href="restart_8c.html#ae81d30f52dddd39aef76bb1890d16f2f" title="restart" alt="" coords="185,59,249,88"/><area shape="rect" id="node5" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="299,5,365,35"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="415,32,468,61"/><area shape="rect" id="node12" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="311,59,353,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac56af97a1dbbbbb07db8207246852f79"></a><!-- doxytag: member="ngb.c::ngb_treebuild" ref="ac56af97a1dbbbbb07db8207246852f79" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ngb_treebuild </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function constructs the neighbour tree. To this end, we actually need to construct the gravitational tree, because we use it now for the neighbour search. </p>

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00403">403</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>References <a class="el" href="forcetree_8c_source.html#l00061">force_treebuild()</a>, <a class="el" href="allvars_8c_source.html#l00016">N_gas</a>, and <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>.</p>

<p>Referenced by <a class="el" href="init_8c_source.html#l00020">init()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    printf(<span class="stringliteral">&quot;Begin Ngb-tree construction.\n&quot;</span>);

  <a class="code" href="forcetree_8c.html#a10f92098e86f82baec9f84a283f4c9e5">force_treebuild</a>(<a class="code" href="allvars_8c.html#a8312e7470883d71db46cda5f1e616974">N_gas</a>);

  <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a> == 0)
    printf(<span class="stringliteral">&quot;Ngb-Tree contruction finished \n&quot;</span>);
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_ac56af97a1dbbbbb07db8207246852f79_cgraph.png" border="0" usemap="#ngb_8c_ac56af97a1dbbbbb07db8207246852f79_cgraph" alt=""/></div>
<map name="ngb_8c_ac56af97a1dbbbbb07db8207246852f79_cgraph" id="ngb_8c_ac56af97a1dbbbbb07db8207246852f79_cgraph">
<area shape="rect" id="node3" href="forcetree_8c.html#a10f92098e86f82baec9f84a283f4c9e5" title="force_treebuild" alt="" coords="163,224,280,253"/><area shape="rect" id="node5" href="forcetree_8c.html#a947a734f3bbba14d4092c7480880d3c7" title="force_flag_localnodes" alt="" coords="357,171,515,200"/><area shape="rect" id="node7" href="forcetree_8c.html#aadc9b1624ed78f3ccd0dbb9908fe0bb6" title="force_treebuild_single" alt="" coords="356,224,516,253"/><area shape="rect" id="node34" href="forcetree_8c.html#af9a7e3a922557e089da5d7ee1dde89a0" title="force_update_pseudoparticles" alt="" coords="329,416,543,445"/><area shape="rect" id="node9" href="forcetree_8c.html#ab303b92c6d6b4144999c5cebabd65ec0" title="dump_particles" alt="" coords="860,208,980,237"/><area shape="rect" id="node13" href="endrun_8c.html#a6c7c5d488c8a9e1fb9c408ae00aa8839" title="endrun" alt="" coords="1299,235,1365,264"/><area shape="rect" id="node18" href="forcetree_8c.html#a8eaedfa5c6d72bca79b465003679ed89" title="force_create_empty_nodes" alt="" coords="600,261,795,291"/><area shape="rect" id="node23" href="peano_8c.html#a9eec17b80ae63eb79e98064f2d4f25df" title="peano_hilbert_key" alt="" coords="851,312,989,341"/><area shape="rect" id="node25" href="forcetree_8c.html#ad9e0a57b7577d64a315c142e197d292d" title="force_insert_pseudo_particles" alt="" coords="1039,337,1249,367"/><area shape="rect" id="node28" href="forcetree_8c.html#ab745c54c805d07ad255a3f86ff77e18d" title="force_update_node_recursive" alt="" coords="592,29,803,59"/><area shape="rect" id="node31" href="proto_8h.html#a0d508d57eb6f608ff6eec8ac11bb9c05" title="get_random_number" alt="" coords="619,83,776,112"/><area shape="rect" id="node11" href="io_8c.html#aab1e6568bf14b3a23c66f70c94aabd21" title="my_fwrite" alt="" coords="1103,208,1185,237"/><area shape="rect" id="node15" href="proto_8h.html#a869daac8b2af5667db265026f09fb9d8" title="terminate_processes" alt="" coords="1413,235,1571,264"/><area shape="rect" id="node36" href="forcetree_8c.html#aaabf16b5e99c9ac6bc6bbe039756bddb" title="force_exchange_pseudodata" alt="" coords="595,469,800,499"/><area shape="rect" id="node38" href="forcetree_8c.html#ab8e5d4fed349d96c6d4f55897473ce19" title="force_treeupdate_pseudos" alt="" coords="601,416,793,445"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_ac56af97a1dbbbbb07db8207246852f79_icgraph.png" border="0" usemap="#ngb_8c_ac56af97a1dbbbbb07db8207246852f79_icgraph" alt=""/></div>
<map name="ngb_8c_ac56af97a1dbbbbb07db8207246852f79_icgraph" id="ngb_8c_ac56af97a1dbbbbb07db8207246852f79_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="164,5,204,35"/><area shape="rect" id="node5" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="253,5,320,35"/><area shape="rect" id="node7" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="369,5,423,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a96ec7acfa3c046abc6902ca77ee4bddd"></a><!-- doxytag: member="ngb.c::ngb_treefind_pairs" ref="a96ec7acfa3c046abc6902ca77ee4bddd" args="(float searchcenter[3], float hsml, int *startnode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ngb_treefind_pairs </td>
          <td>(</td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>searchcenter</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>hsml</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>startnode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine finds all neighbours `j' that can interact with the particle `i' in the communication buffer.</p>
<p>Note that an interaction can take place if <img class="formulaInl" alt="$ r_{ij} < h_i $" src="form_12.png"/> OR if <img class="formulaInl" alt="$ r_{ij} < h_j $" src="form_13.png"/>.</p>
<p>In the range-search this is taken into account, i.e. it is guaranteed that all particles are found that fulfil this condition, including the (more difficult) second part of it. For this purpose, each node knows the maximum h occuring among the particles it represents. </p>

<p><p>&lt; defines maximum length of neighbour list </p>
</p>

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00064">64</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00572">NODE::center</a>, <a class="el" href="allvars_8c_source.html#l00056">DomainTask</a>, <a class="el" href="allvars_8c_source.html#l00030">Exportflag</a>, <a class="el" href="allvars_8c_source.html#l00152">Extnodes</a>, <a class="el" href="allvars_8h_source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8h_source.html#l00604">extNODE::hmax</a>, <a class="el" href="allvars_8h_source.html#l00542">sph_particle_data::Hsml</a>, <a class="el" href="allvars_8h_source.html#l00571">NODE::len</a>, <a class="el" href="allvars_8h_source.html#l00091">MAX_NGB</a>, <a class="el" href="allvars_8c_source.html#l00139">MaxNodes</a>, <a class="el" href="allvars_8h_source.html#l00261">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8c_source.html#l00148">Nextnode</a>, <a class="el" href="ngb_8c_source.html#l00047">NGB_PERIODIC_X</a>, <a class="el" href="ngb_8c_source.html#l00048">NGB_PERIODIC_Y</a>, <a class="el" href="ngb_8c_source.html#l00049">NGB_PERIODIC_Z</a>, <a class="el" href="allvars_8c_source.html#l00032">Ngblist</a>, <a class="el" href="allvars_8c_source.html#l00142">Nodes</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="allvars_8c_source.html#l00128">SphP</a>, <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>, and <a class="el" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">NODE::u</a>.</p>

<p>Referenced by <a class="el" href="hydra_8c_source.html#l00353">hydro_evaluate()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> k, no, p, numngb;
  <a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a> hdiff;
  <a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a> searchmin[3], searchmax[3];
  <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *<span class="keyword">this</span>;

<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>  <span class="keywordtype">double</span> xtmp;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)        <span class="comment">/* cube-box window */</span>
    {
      searchmin[k] = searchcenter[k] - hsml;
      searchmax[k] = searchcenter[k] + hsml;
    }

  numngb = 0;
  no = *startnode;

  <span class="keywordflow">while</span>(no &gt;= 0)
    {
      <span class="keywordflow">if</span>(no &lt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>)      <span class="comment">/* single particle */</span>
        {
          p = no;
          no = <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no];

          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Type &gt; 0)
            <span class="keywordflow">continue</span>;

          hdiff = <a class="code" href="allvars_8c.html#a331d32b863e95f7d488a26ae38bda6af">SphP</a>[p].<a class="code" href="structsph__particle__data.html#af9efa599cdd656b26a0df5f89430b4d1">Hsml</a> - hsml;
          <span class="keywordflow">if</span>(hdiff &lt; 0)
            hdiff = 0;

<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] - searchcenter[0]) &lt; (-hsml - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] - searchcenter[0]) &gt; (hsml + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] - searchcenter[1]) &lt; (-hsml - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] - searchcenter[1]) &gt; (hsml + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] - searchcenter[2]) &lt; (-hsml - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] - searchcenter[2]) &gt; (hsml + hdiff))
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] &lt; (searchmin[0] - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] &gt; (searchmax[0] + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] &lt; (searchmin[1] - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] &gt; (searchmax[1] + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] &lt; (searchmin[2] - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] &gt; (searchmax[2] + hdiff))
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#ade1b96e6772d0d1ccb06bcbec352b5bd">Ngblist</a>[numngb++] = p;

          <span class="keywordflow">if</span>(numngb == <a class="code" href="allvars_8h.html#a459bf1b27bb8a17c4496d2783e62161c">MAX_NGB</a>)
            {
              printf
                (<span class="stringliteral">&quot;ThisTask=%d: Need to do a second neighbour loop in hydro-force for (%g|%g|%g) hsml=%g no=%d\n&quot;</span>,
                 <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, searchcenter[0], searchcenter[1], searchcenter[2], hsml, no);
              *startnode = no;
              <span class="keywordflow">return</span> numngb;
            }
        }
      <span class="keywordflow">else</span>
        {
          <span class="keywordflow">if</span>(no &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> + <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>)      <span class="comment">/* pseudo particle */</span>
            {
              <a class="code" href="allvars_8c.html#a768b23818449e1b33a55747cb3cc2025">Exportflag</a>[<a class="code" href="allvars_8c.html#a6f4a30ea20d1347d14d2e32de91390bb">DomainTask</a>[no - (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> + <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>)]] = 1;
              no = <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no - <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>];
              <span class="keywordflow">continue</span>;
            }

          <span class="keyword">this</span> = &amp;<a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no];
          hdiff = <a class="code" href="allvars_8c.html#a32df265d89a3353759d155bbfad4f3e6">Extnodes</a>[no].<a class="code" href="structextNODE.html#ac479dcb30bffad0266b13b9200bbe9ad">hmax</a> - hsml;
          <span class="keywordflow">if</span>(hdiff &lt; 0)
            hdiff = 0;

          no = this-&gt;<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.d.sibling;       <span class="comment">/* in case the node can be discarded */</span>

<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] - searchcenter[0]) + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (-hsml - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] - searchcenter[0]) - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (hsml + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] - searchcenter[1]) + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (-hsml - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] - searchcenter[1]) - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (hsml + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] - searchcenter[2]) + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (-hsml - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] - searchcenter[2]) - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (hsml + hdiff))
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (searchmin[0] - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (searchmax[0] + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (searchmin[1] - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (searchmax[1] + hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (searchmin[2] - hdiff))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (searchmax[2] + hdiff))
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          no = this-&gt;<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.d.nextnode;      <span class="comment">/* ok, we need to open the node */</span>
        }
    }

  *startnode = -1;
  <span class="keywordflow">return</span> numngb;
}
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_a96ec7acfa3c046abc6902ca77ee4bddd_icgraph.png" border="0" usemap="#ngb_8c_a96ec7acfa3c046abc6902ca77ee4bddd_icgraph" alt=""/></div>
<map name="ngb_8c_a96ec7acfa3c046abc6902ca77ee4bddd_icgraph" id="ngb_8c_a96ec7acfa3c046abc6902ca77ee4bddd_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a818695254c9525e01bc9ddc95e8eaf7e" title="hydro_evaluate" alt="" coords="195,5,315,35"/><area shape="rect" id="node5" href="proto_8h.html#a6789381bce7d1c316df8ecf04b47a607" title="hydro_force" alt="" coords="364,5,460,35"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="509,5,680,35"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="728,5,771,35"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="820,5,873,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae39a878e9bb71ae346097aace71632f9"></a><!-- doxytag: member="ngb.c::ngb_treefind_variable" ref="ae39a878e9bb71ae346097aace71632f9" args="(float searchcenter[3], float hsml, int *startnode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ngb_treefind_variable </td>
          <td>(</td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>searchcenter</em>[3], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>hsml</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>startnode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function returns neighbours with distance &lt;= hsml and returns them in Ngblist. Actually, particles in a box of half side length hsml are returned, i.e. the reduction to a sphere still needs to be done in the calling routine. </p>

<p><p>&lt; defines maximum length of neighbour list</p>
<p>&lt; defines maximum length of neighbour list </p>
</p>

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00194">194</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00112">All</a>, <a class="el" href="allvars_8h_source.html#l00572">NODE::center</a>, <a class="el" href="allvars_8c_source.html#l00056">DomainTask</a>, <a class="el" href="allvars_8c_source.html#l00030">Exportflag</a>, <a class="el" href="allvars_8h_source.html#l00103">FLOAT</a>, <a class="el" href="allvars_8h_source.html#l00571">NODE::len</a>, <a class="el" href="allvars_8h_source.html#l00091">MAX_NGB</a>, <a class="el" href="allvars_8c_source.html#l00139">MaxNodes</a>, <a class="el" href="allvars_8h_source.html#l00261">global_data_all_processes::MaxPart</a>, <a class="el" href="allvars_8c_source.html#l00148">Nextnode</a>, <a class="el" href="ngb_8c_source.html#l00320">ngb_clear_buf()</a>, <a class="el" href="ngb_8c_source.html#l00047">NGB_PERIODIC_X</a>, <a class="el" href="ngb_8c_source.html#l00048">NGB_PERIODIC_Y</a>, <a class="el" href="ngb_8c_source.html#l00049">NGB_PERIODIC_Z</a>, <a class="el" href="allvars_8c_source.html#l00032">Ngblist</a>, <a class="el" href="allvars_8c_source.html#l00142">Nodes</a>, <a class="el" href="allvars_8c_source.html#l00120">P</a>, <a class="el" href="allvars_8c_source.html#l00011">ThisTask</a>, and <a class="el" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">NODE::u</a>.</p>

<p>Referenced by <a class="el" href="density_8c_source.html#l00467">density_evaluate()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  <span class="keywordtype">int</span> k, numngb;
  <span class="keywordtype">int</span> no, p;
  <span class="keyword">struct </span><a class="code" href="structNODE.html">NODE</a> *<span class="keyword">this</span>;
  <a class="code" href="allvars_8h.html#ae8690abbffa85934d64d545920e2b108">FLOAT</a> searchmin[3], searchmax[3];

<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>  <span class="keywordtype">double</span> xtmp;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="keywordflow">for</span>(k = 0; k &lt; 3; k++)        <span class="comment">/* cube-box window */</span>
    {
      searchmin[k] = searchcenter[k] - hsml;
      searchmax[k] = searchcenter[k] + hsml;
    }

  numngb = 0;
  no = *startnode;

  <span class="keywordflow">while</span>(no &gt;= 0)
    {
      <span class="keywordflow">if</span>(no &lt; <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a>)      <span class="comment">/* single particle */</span>
        {
          p = no;
          no = <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no];

          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Type &gt; 0)
            <span class="keywordflow">continue</span>;

<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] - searchcenter[0]) &lt; -hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] - searchcenter[0]) &gt; hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] - searchcenter[1]) &lt; -hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] - searchcenter[1]) &gt; hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] - searchcenter[2]) &lt; -hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] - searchcenter[2]) &gt; hsml)
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] &lt; searchmin[0])
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[0] &gt; searchmax[0])
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] &lt; searchmin[1])
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[1] &gt; searchmax[1])
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] &lt; searchmin[2])
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>(<a class="code" href="allvars_8c.html#a29aa1b496fa7d42c32c4cae3c77aa068">P</a>[p].Pos[2] &gt; searchmax[2])
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          <a class="code" href="allvars_8c.html#ade1b96e6772d0d1ccb06bcbec352b5bd">Ngblist</a>[numngb++] = p;

          <span class="keywordflow">if</span>(numngb == <a class="code" href="allvars_8h.html#a459bf1b27bb8a17c4496d2783e62161c">MAX_NGB</a>)
            {
              numngb = <a class="code" href="ngb_8c.html#a674ac0d18eaff78ba700f1278f078274">ngb_clear_buf</a>(searchcenter, hsml, numngb);
              <span class="keywordflow">if</span>(numngb == <a class="code" href="allvars_8h.html#a459bf1b27bb8a17c4496d2783e62161c">MAX_NGB</a>)
                {
                  printf(<span class="stringliteral">&quot;ThisTask=%d: Need to do a second neighbour loop for (%g|%g|%g) hsml=%g no=%d\n&quot;</span>,
                         <a class="code" href="allvars_8c.html#a52c8c7d2abff436111942e02c5bb466a">ThisTask</a>, searchcenter[0], searchcenter[1], searchcenter[2], hsml, no);
                  *startnode = no;
                  <span class="keywordflow">return</span> numngb;
                }
            }
        }
      <span class="keywordflow">else</span>
        {
          <span class="keywordflow">if</span>(no &gt;= <a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> + <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>)      <span class="comment">/* pseudo particle */</span>
            {
              <a class="code" href="allvars_8c.html#a768b23818449e1b33a55747cb3cc2025">Exportflag</a>[<a class="code" href="allvars_8c.html#a6f4a30ea20d1347d14d2e32de91390bb">DomainTask</a>[no - (<a class="code" href="allvars_8c.html#ad49123ae0461ffe61629a0d4cf2ba91f">All</a>.<a class="code" href="structglobal__data__all__processes.html#a413b30e91ae833d0c78b42744a99e67f">MaxPart</a> + <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>)]] = 1;
              no = <a class="code" href="allvars_8c.html#ad14ab43f541f9c33cb9222ea018c1365">Nextnode</a>[no - <a class="code" href="allvars_8c.html#aca70a1751175167a36c1c6775a338bee">MaxNodes</a>];
              <span class="keywordflow">continue</span>;
            }

          <span class="keyword">this</span> = &amp;<a class="code" href="allvars_8c.html#ac46f89ba3715dfa877c2e1b8822da657">Nodes</a>[no];

          no = this-&gt;<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.d.sibling;       <span class="comment">/* in case the node can be discarded */</span>
<span class="preprocessor">#ifdef PERIODIC</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] - searchcenter[0]) + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; -hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a49d4cb21065981774552d097f6f8832c">NGB_PERIODIC_X</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] - searchcenter[0]) - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] - searchcenter[1]) + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; -hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#a3721767146404458e6955428a6e78cfd">NGB_PERIODIC_Y</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] - searchcenter[1]) - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] - searchcenter[2]) + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; -hsml)
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((<a class="code" href="ngb_8c.html#ab563068e480f07f2fea4a94fb29ac11b">NGB_PERIODIC_Z</a>(this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] - searchcenter[2]) - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; hsml)
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (searchmin[0]))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[0] - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (searchmax[0]))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (searchmin[1]))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[1] - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (searchmax[1]))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] + 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &lt; (searchmin[2]))
            <span class="keywordflow">continue</span>;
          <span class="keywordflow">if</span>((this-&gt;<a class="code" href="structNODE.html#a27584ddd52a800cbf36c4de8e3fb4bc9">center</a>[2] - 0.5 * this-&gt;<a class="code" href="structNODE.html#aae35ad626e2613a4926d4e07fdf9be5c">len</a>) &gt; (searchmax[2]))
            <span class="keywordflow">continue</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>          no = this-&gt;<a class="code" href="structNODE.html#acd7e6747d70c2205a6fb3d44b6465dd4">u</a>.d.nextnode;      <span class="comment">/* ok, we need to open the node */</span>
        }
    }

  *startnode = -1;
  <span class="keywordflow">return</span> numngb;
}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_ae39a878e9bb71ae346097aace71632f9_cgraph.png" border="0" usemap="#ngb_8c_ae39a878e9bb71ae346097aace71632f9_cgraph" alt=""/></div>
<map name="ngb_8c_ae39a878e9bb71ae346097aace71632f9_cgraph" id="ngb_8c_ae39a878e9bb71ae346097aace71632f9_cgraph">
<area shape="rect" id="node3" href="ngb_8c.html#a674ac0d18eaff78ba700f1278f078274" title="ngb_clear_buf" alt="" coords="215,5,324,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ngb_8c_ae39a878e9bb71ae346097aace71632f9_icgraph.png" border="0" usemap="#ngb_8c_ae39a878e9bb71ae346097aace71632f9_icgraph" alt=""/></div>
<map name="ngb_8c_ae39a878e9bb71ae346097aace71632f9_icgraph" id="ngb_8c_ae39a878e9bb71ae346097aace71632f9_icgraph">
<area shape="rect" id="node3" href="proto_8h.html#a19f7a07621c698ae894f53836e9ff03c" title="density_evaluate" alt="" coords="213,32,344,61"/><area shape="rect" id="node5" href="proto_8h.html#ad86cdeb9e3bfbe9af379ac9f7daf194c" title="density" alt="" coords="393,32,460,61"/><area shape="rect" id="node7" href="proto_8h.html#a147f9422f4bca4666608da992486b417" title="compute_accelerations" alt="" coords="515,5,685,35"/><area shape="rect" id="node13" href="proto_8h.html#abca44f066552d38c44a1cd6020d349d5" title="setup_smoothinglengths" alt="" coords="511,59,689,88"/><area shape="rect" id="node9" href="run_8c.html#a05e0ffe612d44e6d7f3a9ae5b9df56a2" title="run" alt="" coords="841,5,884,35"/><area shape="rect" id="node11" href="main_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="main" alt="" coords="945,32,999,61"/><area shape="rect" id="node15" href="proto_8h.html#a2858154e2009b0e6e616f313177762bc" title="init" alt="" coords="740,59,780,88"/><area shape="rect" id="node17" href="proto_8h.html#aceeb5c8909331b90ea8345e0fc853f82" title="begrun" alt="" coords="829,59,896,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aab22cf240079ef5846d83729e4565f97"></a><!-- doxytag: member="ngb.c::ngb_treefree" ref="aab22cf240079ef5846d83729e4565f97" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ngb_treefree </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>free memory allocated for neighbour list buffer. </p>

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00394">394</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>References <a class="el" href="allvars_8c_source.html#l00032">Ngblist</a>.</p>

<p><div class="fragment"><pre class="fragment">{
  free(<a class="code" href="allvars_8c.html#ade1b96e6772d0d1ccb06bcbec352b5bd">Ngblist</a>);
}
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="af62571c97dc75a691aeafead0528b369"></a><!-- doxytag: member="ngb.c::boxHalf" ref="af62571c97dc75a691aeafead0528b369" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="ngb_8c.html#af62571c97dc75a691aeafead0528b369">boxHalf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00020">20</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
<a class="anchor" id="ac9067960018a06b81c117434c01f19cc"></a><!-- doxytag: member="ngb.c::boxSize" ref="ac9067960018a06b81c117434c01f19cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="ngb_8c.html#ac9067960018a06b81c117434c01f19cc">boxSize</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ngb_8c_source.html#l00020">20</a> of file <a class="el" href="ngb_8c_source.html">ngb.c</a>.</p>

<p>Referenced by <a class="el" href="ngb_8c_source.html#l00358">ngb_treeallocate()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 26 2010 21:34:16 for GADGET-2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
